(function(){var c3=Array;if((typeof Float32Array!=="undefined")&&(Float32Array.prototype!==undefined)&&(Float32Array.prototype.slice===undefined)){Float32Array.prototype.slice=function dZ(gq,gs){var gr=this.length;if(gq===undefined){gq=0}else{if(gq<0){gq+=gr}}if(gs===undefined){gs=gr}else{if(gs<0){gs+=gr}}gr=(gs-gq);if(0<gr){var gu=new Float32Array(gr);var gt=0;do{gu[gt]=this[gq];gt+=1;gq+=1}while(gq<gs);return gu}else{return new Float32Array(0)}}}var f2={version:1,precision:0.000001,FLOAT_MAX:3.402823466e+38,select:function aV(gr,gs,gq){if(gr){return gs}else{return gq}},reciprocal:function cq(gq){if(gq!==0){return(1/gq)}else{throw"Division by zero"}},truncate:function cF(gq){return(gq|0)},v2BuildZero:function U(gq){if(gq===undefined){gq=new c3(2)}gq[0]=0;gq[1]=0;return gq},v2BuildOne:function aI(gq){if(gq===undefined){gq=new c3(2)}gq[0]=1;gq[1]=1;return gq},v2BuildXAxis:function df(gq){if(gq===undefined){gq=new c3(2)}gq[0]=1;gq[1]=0;return gq},v2BuildYAxis:function ae(gq){if(gq===undefined){gq=new c3(2)
}gq[0]=0;gq[1]=1;return gq},v2Build:function aB(gr,gq,gs){if(gs===undefined){gs=new c3(2)}gs[0]=gr;gs[1]=gq;return gs},v2Copy:function bn(gq,gr){if(gr===undefined){gr=new c3(2)}gr[0]=gq[0];gr[1]=gq[1];return gr},v2Set:function fD(gr,gq){gr[0]=gq[0];gr[1]=gq[1]},v2Neg:function dg(gq,gr){if(gr===undefined){gr=new c3(2)}gr[0]=-gq[0];gr[1]=-gq[1];return gr},v2Add:function n(gr,gq,gs){if(gs===undefined){gs=new c3(2)}gs[0]=gr[0]+gq[0];gs[1]=gr[1]+gq[1];return gs},v2Add3:function M(gr,gq,gt,gs){if(gs===undefined){gs=new c3(2)}gs[0]=gr[0]+gq[0]+gt[0];gs[1]=gr[1]+gq[1]+gt[1];return gs},v2Add4:function fa(gr,gq,gu,gs,gt){if(gt===undefined){gt=new c3(2)}gt[0]=gr[0]+gq[0]+gu[0]+gs[0];gt[1]=gr[1]+gq[1]+gu[1]+gs[1];return gt},v2Sub:function gg(gr,gq,gs){if(gs===undefined){gs=new c3(2)}gs[0]=(gr[0]-gq[0]);gs[1]=(gr[1]-gq[1]);return gs},v2Mul:function fw(gr,gq,gs){if(gs===undefined){gs=new c3(2)}gs[0]=(gr[0]*gq[0]);gs[1]=(gr[1]*gq[1]);return gs},v2MulAdd:function fP(gr,gq,gt,gs){if(gs===undefined){gs=new c3(2)
}gs[0]=(gr[0]*gq[0])+gt[0];gs[1]=(gr[1]*gq[1])+gt[1];return gs},v2Dot:function dc(gr,gq){return((gr[0]*gq[0])+(gr[1]*gq[1]))},v2PerpDot:function am(gr,gq){return((gr[0]*gq[1])-(gr[1]*gq[0]))},v2LengthSq:function eY(gr){var gs=gr[0];var gq=gr[1];return((gs*gs)+(gq*gq))},v2Length:function fs(gr){var gs=gr[0];var gq=gr[1];return Math.sqrt((gs*gs)+(gq*gq))},v2Reciprocal:function fR(gq,gs){if(gs===undefined){gs=new c3(2)}var gr=f2.reciprocal;gs[0]=gr(gq[0]);gs[1]=gr(gq[1]);return gs},v2Normalize:function q(gr,gv){if(gv===undefined){gv=new c3(2)}var gt=gr[0];var gq=gr[1];var gu=((gt*gt)+(gq*gq));if(gu>0){var gs=1/Math.sqrt(gu);gv[0]=(gt*gs);gv[1]=(gq*gs)}else{gv[0]=0;gv[1]=0}return gv},v2Abs:function fJ(gr,gs){if(gs===undefined){gs=new c3(2)}var gq=Math.abs;gs[0]=gq(gr[0]);gs[1]=gq(gr[1]);return gs},v2Max:function d0(gs,gr,gt){if(gt===undefined){gt=new c3(2)}var gq=Math.max;gt[0]=gq(gs[0],gr[0]);gt[1]=gq(gs[1],gr[1]);return gt},v2Min:function cM(gr,gq,gt){if(gt===undefined){gt=new c3(2)}var gs=Math.min;
gt[0]=gs(gr[0],gq[0]);gt[1]=gs(gr[1],gq[1]);return gt},v2Equal:function dU(gt,gr,gs){var gq=Math.abs;if(gs===undefined){gs=this.precision}return(gq(gt[0]-gr[0])<=gs&&gq(gt[1]-gr[1])<=gs)},v2MaskEqual:function aA(gt,gr){var gq=Math.abs;var gs=f2.precision;return[(gq(gt[0]-gr[0])<=gs),(gq(gt[1]-gr[1])<=gs)]},v2MaskLess:function b8(gr,gq){return[(gr[0]<gq[0]),(gr[1]<gq[1])]},v2MaskGreater:function fK(gr,gq){return[(gr[0]>gq[0]),(gr[1]>gq[1])]},v2MaskGreaterEq:function dj(gr,gq){return[(gr[0]>=gq[0]),(gr[1]>=gq[1])]},v2MaskNot:function fh(gq){return[!gq[0],!gq[1]]},v2MaskOr:function fg(gr,gq){return[(gr[0]||gq[0]),(gr[1]||gq[1])]},v2MaskAnd:function dT(gr,gq){return[(gr[0]&&gq[0]),(gr[1]&&gq[1])]},v2Select:function cV(gr,gs,gq,gt){if(gt===undefined){gt=new c3(2)}gt[0]=gr[0]?gs[0]:gq[0];gt[1]=gr[1]?gs[1]:gq[1];return gt},v2ScalarBuild:function aN(gq,gr){if(gr===undefined){gr=new c3(2)}gr[0]=gq;gr[1]=gq;return gr},v2ScalarMax:function cg(gs,gr,gt){if(gt===undefined){gt=new c3(2)}var gq=Math.max;
gt[0]=gq(gs[0],gr);gt[1]=gq(gs[1],gr);return gt},v2ScalarMin:function aL(gr,gq,gt){if(gt===undefined){gt=new c3(2)}var gs=Math.min;gt[0]=gs(gr[0],gq);gt[1]=gs(gr[1],gq);return gt},v2ScalarAdd:function ey(gr,gq,gs){if(gs===undefined){gs=new c3(2)}gs[0]=(gr[0]+gq);gs[1]=(gr[1]+gq);return gs},v2ScalarSub:function em(gr,gq,gs){if(gs===undefined){gs=new c3(2)}gs[0]=(gr[0]-gq);gs[1]=(gr[1]-gq);return gs},v2ScalarMul:function dF(gr,gq,gs){if(gs===undefined){gs=new c3(2)}if(gq===0){gs[0]=0;gs[1]=0}else{gs[0]=gr[0]*gq;gs[1]=gr[1]*gq}return gs},v2AddScalarMul:function eh(gr,gq,gt,gs){if(gs===undefined){gs=new c3(2)}gs[0]=gr[0]+gq[0]*gt;gs[1]=gr[1]+gq[1]*gt;return gs},v2EqualScalarMask:function f(gt,gr){var gq=Math.abs;var gs=f2.precision;return[(gq(gt[0]-gr)<=gs),(gq(gt[1]-gr)<=gs)]},v2LessScalarMask:function al(gr,gq){return[(gr[0]<gq),(gr[1]<gq)]},v2GreaterScalarMask:function fT(gr,gq){return[(gr[0]>gq),(gr[1]>gq)]},v2GreaterEqScalarMask:function cK(gr,gq){return[(gr[0]>=gq),(gr[1]>=gq)]},v2Lerp:function bt(gr,gq,gs,gt){if(gt===undefined){gt=new c3(2)
}gt[0]=(gr[0]+((gq[0]-gr[0])*gs));gt[1]=(gr[1]+((gq[1]-gr[1])*gs));return gt},v3BuildZero:function c5(gr){var gq=gr;if(gq===undefined){gq=new c3(3)}gq[0]=0;gq[1]=0;gq[2]=0;return gq},v3BuildOne:function ax(gr){var gq=gr;if(gq===undefined){gq=new c3(3)}gq[0]=1;gq[1]=1;gq[2]=1;return gq},v3BuildXAxis:function eP(gr){var gq=gr;if(gq===undefined){gq=new c3(3)}gq[0]=1;gq[1]=0;gq[2]=0;return gq},v3BuildYAxis:function ch(gr){var gq=gr;if(gq===undefined){gq=new c3(3)}gq[0]=0;gq[1]=1;gq[2]=0;return gq},v3BuildZAxis:function by(gr){var gq=gr;if(gq===undefined){gq=new c3(3)}gq[0]=0;gq[1]=0;gq[2]=1;return gq},v3Build:function fH(gr,gq,gu,gt){var gs=gt;if(gs===undefined){gs=new c3(3)}gs[0]=gr;gs[1]=gq;gs[2]=gu;return gs},v3Copy:function fd(gr,gs){var gq=gs;if(gq===undefined){gq=new c3(3)}gq[0]=gr[0];gq[1]=gr[1];gq[2]=gr[2];return gq},v3Set:function eC(gr,gq){gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2]},v3Neg:function cm(gq,gr){if(gr===undefined){gr=new c3(3)}gr[0]=-gq[0];gr[1]=-gq[1];gr[2]=-gq[2];return gr},v3Add:function fz(gr,gq,gt){var gs=gt;
if(gs===undefined){gs=new c3(3)}gs[0]=(gr[0]+gq[0]);gs[1]=(gr[1]+gq[1]);gs[2]=(gr[2]+gq[2]);return gs},v3Add3:function d7(gr,gq,gt,gs){if(gs===undefined){gs=new c3(3)}gs[0]=gr[0]+gq[0]+gt[0];gs[1]=gr[1]+gq[1]+gt[1];gs[2]=gr[2]+gq[2]+gt[2];return gs},v3Add4:function cz(gr,gq,gu,gs,gt){if(gt===undefined){gt=new c3(3)}gt[0]=gr[0]+gq[0]+gu[0]+gs[0];gt[1]=gr[1]+gq[1]+gu[1]+gs[1];gt[2]=gr[2]+gq[2]+gu[2]+gs[2];return gt},v3Sub:function fl(gr,gq,gt){var gs=gt;if(gs===undefined){gs=new c3(3)}gs[0]=(gr[0]-gq[0]);gs[1]=(gr[1]-gq[1]);gs[2]=(gr[2]-gq[2]);return gs},v3Mul:function ew(gr,gq,gs){if(gs===undefined){gs=new c3(3)}gs[0]=(gr[0]*gq[0]);gs[1]=(gr[1]*gq[1]);gs[2]=(gr[2]*gq[2]);return gs},v3MulAdd:function cc(gr,gq,gt,gs){if(gs===undefined){gs=new c3(3)}gs[0]=(gr[0]*gq[0])+gt[0];gs[1]=(gr[1]*gq[1])+gt[1];gs[2]=(gr[2]*gq[2])+gt[2];return gs},v3Dot:function cl(gr,gq){return((gr[0]*gq[0])+(gr[1]*gq[1])+(gr[2]*gq[2]))},v3Cross:function fv(gy,gw,gu){var gt=gu;if(gt===undefined){gt=new c3(3)}var gs=gy[0];
var gr=gy[1];var gq=gy[2];var gz=gw[0];var gx=gw[1];var gv=gw[2];gt[0]=((gr*gv)-(gq*gx));gt[1]=((gq*gz)-(gs*gv));gt[2]=((gs*gx)-(gr*gz));return gt},v3LengthSq:function cT(gs){var gt=gs[0];var gr=gs[1];var gq=gs[2];return((gt*gt)+(gr*gr)+(gq*gq))},v3Length:function bF(gs){var gt=gs[0];var gr=gs[1];var gq=gs[2];return Math.sqrt((gt*gt)+(gr*gr)+(gq*gq))},v3Reciprocal:function aU(gq,gs){if(gs===undefined){gs=new c3(3)}var gr=f2.reciprocal;gs[0]=gr(gq[0]);gs[1]=gr(gq[1]);gs[2]=gr(gq[2]);return gs},v3Normalize:function cB(gs,gx){var gw=gx;if(gw===undefined){gw=new c3(3)}var gu=gs[0];var gr=gs[1];var gq=gs[2];var gv=((gu*gu)+(gr*gr)+(gq*gq));if(gv>0){var gt=1/Math.sqrt(gv);gw[0]=(gu*gt);gw[1]=(gr*gt);gw[2]=(gq*gt)}else{gw[0]=0;gw[1]=0;gw[2]=0}return gw},v3Abs:function eL(gr,gt){var gs=gt;if(gs===undefined){gs=new c3(3)}var gq=Math.abs;gs[0]=gq(gr[0]);gs[1]=gq(gr[1]);gs[2]=gq(gr[2]);return gs},v3Max:function c7(gs,gr,gu){var gt=gu;if(gt===undefined){gt=new c3(3)}var gq=Math.max;gt[0]=gq(gs[0],gr[0]);
gt[1]=gq(gs[1],gr[1]);gt[2]=gq(gs[2],gr[2]);return gt},v3Min:function bQ(gr,gq,gu){var gt=gu;if(gt===undefined){gt=new c3(3)}var gs=Math.min;gt[0]=gs(gr[0],gq[0]);gt[1]=gs(gr[1],gq[1]);gt[2]=gs(gr[2],gq[2]);return gt},v3Equal:function gm(gt,gr,gs){var gq=Math.abs;if(gs===undefined){gs=this.precision}return(gq(gt[0]-gr[0])<=gs&&gq(gt[1]-gr[1])<=gs&&gq(gt[2]-gr[2])<=gs)},v3MaskEqual:function dt(gt,gr){var gq=Math.abs;var gs=f2.precision;return[(gq(gt[0]-gr[0])<=gs),(gq(gt[1]-gr[1])<=gs),(gq(gt[2]-gr[2])<=gs)]},v3MaskLess:function i(gr,gq){return[(gr[0]<gq[0]),(gr[1]<gq[1]),(gr[2]<gq[2])]},v3MaskGreater:function bU(gr,gq){return[(gr[0]>gq[0]),(gr[1]>gq[1]),(gr[2]>gq[2])]},v3MaskGreaterEq:function bC(gr,gq){return[(gr[0]>=gq[0]),(gr[1]>=gq[1]),(gr[2]>=gq[2])]},v3MaskNot:function ct(gq){return[!gq[0],!gq[1],!gq[2]]},v3MaskOr:function bx(gr,gq){return[(gr[0]||gq[0]),(gr[1]||gq[1]),(gr[2]||gq[2])]},v3MaskAnd:function aY(gr,gq){return[(gr[0]&&gq[0]),(gr[1]&&gq[1]),(gr[2]&&gq[2])]},v3Select:function fG(gr,gs,gq,gt){if(gt===undefined){gt=new c3(3)
}gt[0]=gr[0]?gs[0]:gq[0];gt[1]=gr[1]?gs[1]:gq[1];gt[2]=gr[2]?gs[2]:gq[2];return gt},v3ScalarBuild:function fB(gq,gr){if(gr===undefined){gr=new c3(3)}gr[0]=gq;gr[1]=gq;gr[2]=gq;return gr},v3ScalarMax:function eQ(gs,gr,gt){if(gt===undefined){gt=new c3(3)}var gq=Math.max;gt[0]=gq(gs[0],gr);gt[1]=gq(gs[1],gr);gt[2]=gq(gs[2],gr);return gt},v3ScalarMin:function dB(gr,gq,gt){if(gt===undefined){gt=new c3(3)}var gs=Math.min;gt[0]=gs(gr[0],gq);gt[1]=gs(gr[1],gq);gt[2]=gs(gr[2],gq);return gt},v3ScalarAdd:function aw(gr,gq,gs){if(gs===undefined){gs=new c3(3)}gs[0]=(gr[0]+gq);gs[1]=(gr[1]+gq);gs[2]=(gr[2]+gq);return gs},v3ScalarSub:function ab(gr,gq,gs){if(gs===undefined){gs=new c3(3)}gs[0]=(gr[0]-gq);gs[1]=(gr[1]-gq);gs[2]=(gr[2]-gq);return gs},v3ScalarMul:function gl(gr,gq,gt){var gs=gt;if(gs===undefined){gs=new c3(3)}if(gq===0){gs[0]=0;gs[1]=0;gs[2]=0}else{gs[0]=(gr[0]*gq);gs[1]=(gr[1]*gq);gs[2]=(gr[2]*gq)}return gs},v3AddScalarMul:function b6(gr,gq,gt,gs){if(gs===undefined){gs=new c3(3)}gs[0]=gr[0]+gq[0]*gt;
gs[1]=gr[1]+gq[1]*gt;gs[2]=gr[2]+gq[2]*gt;return gs},v3EqualScalarMask:function ga(gt,gr){var gq=Math.abs;var gs=f2.precision;return[(gq(gt[0]-gr)<=gs),(gq(gt[1]-gr)<=gs),(gq(gt[2]-gr)<=gs)]},v3LessScalarMask:function eq(gr,gq){return[(gr[0]<gq),(gr[1]<gq),(gr[2]<gq)]},v3GreaterScalarMask:function aQ(gr,gq){return[(gr[0]>gq),(gr[1]>gq),(gr[2]>gq)]},v3GreaterEqScalarMask:function az(gr,gq){return[(gr[0]>=gq),(gr[1]>=gq),(gr[2]>=gq)]},v3Lerp:function fj(gr,gq,gt,gu){var gs=gu;if(gs===undefined){gs=new c3(3)}gs[0]=(gr[0]+((gq[0]-gr[0])*gt));gs[1]=(gr[1]+((gq[1]-gr[1])*gt));gs[2]=(gr[2]+((gq[2]-gr[2])*gt));return gs},v4BuildZero:function fL(gr){var gq=gr;if(gq===undefined){gq=new c3(4)}gq[0]=0;gq[1]=0;gq[2]=0;gq[3]=0;return gq},v4BuildOne:function e7(gr){var gq=gr;if(gq===undefined){gq=new c3(4)}gq[0]=1;gq[1]=1;gq[2]=1;gq[3]=1;return gq},v4Build:function gp(gr,gq,gv,gt,gu){var gs=gu;if(gs===undefined){gs=new c3(4)}gs[0]=gr;gs[1]=gq;gs[2]=gv;gs[3]=gt;return gs},v4Copy:function ex(gr,gs){var gq=gs;
if(gq===undefined){gq=new c3(4)}gq[0]=gr[0];gq[1]=gr[1];gq[2]=gr[2];gq[3]=gr[3];return gq},v4Set:function dL(gr,gq){gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];gr[3]=gq[3]},v4Neg:function bl(gq,gr){if(gr===undefined){gr=new c3(4)}gr[0]=-gq[0];gr[1]=-gq[1];gr[2]=-gq[2];gr[3]=-gq[3];return gr},v4Add:function eA(gr,gq,gs){if(gs===undefined){gs=new c3(4)}gs[0]=(gr[0]+gq[0]);gs[1]=(gr[1]+gq[1]);gs[2]=(gr[2]+gq[2]);gs[3]=(gr[3]+gq[3]);return gs},v4Add3:function dz(gr,gq,gt,gs){if(gs===undefined){gs=new c3(4)}gs[0]=gr[0]+gq[0]+gt[0];gs[1]=gr[1]+gq[1]+gt[1];gs[2]=gr[2]+gq[2]+gt[2];gs[3]=gr[3]+gq[3]+gt[3];return gs},v4Add4:function bV(gr,gq,gu,gs,gt){if(gt===undefined){gt=new c3(4)}gt[0]=gr[0]+gq[0]+gu[0]+gs[0];gt[1]=gr[1]+gq[1]+gu[1]+gs[1];gt[2]=gr[2]+gq[2]+gu[2]+gs[2];gt[3]=gr[3]+gq[3]+gu[3]+gs[3];return gt},v4Sub:function en(gr,gq,gs){if(gs===undefined){gs=new c3(4)}gs[0]=(gr[0]-gq[0]);gs[1]=(gr[1]-gq[1]);gs[2]=(gr[2]-gq[2]);gs[3]=(gr[3]-gq[3]);return gs},v4Mul:function dI(gr,gq,gs){if(gs===undefined){gs=new c3(4)
}gs[0]=(gr[0]*gq[0]);gs[1]=(gr[1]*gq[1]);gs[2]=(gr[2]*gq[2]);gs[3]=(gr[3]*gq[3]);return gs},v4MulAdd:function eO(gr,gq,gt,gs){if(gs===undefined){gs=new c3(4)}gs[0]=(gr[0]*gq[0])+gt[0];gs[1]=(gr[1]*gq[1])+gt[1];gs[2]=(gr[2]*gq[2])+gt[2];gs[3]=(gr[3]*gq[3])+gt[3];return gs},v4Dot:function bh(gr,gq){return((gr[0]*gq[0])+(gr[1]*gq[1])+(gr[2]*gq[2])+(gr[3]*gq[3]))},v4LengthSq:function cH(gs){var gt=gs[0];var gr=gs[1];var gq=gs[2];var gu=gs[3];return((gt*gt)+(gr*gr)+(gq*gq)+(gu*gu))},v4Length:function ep(gs){var gt=gs[0];var gr=gs[1];var gq=gs[2];var gu=gs[3];return Math.sqrt((gt*gt)+(gr*gr)+(gq*gq)+(gu*gu))},v4Reciprocal:function cG(gq,gs){if(gs===undefined){gs=new c3(4)}var gr=f2.reciprocal;gs[0]=gr(gq[0]);gs[1]=gr(gq[1]);gs[2]=gr(gq[2]);gs[3]=gr(gq[3]);return gs},v4Normalize:function fi(gs,gx){if(gx===undefined){gx=new c3(4)}var gu=gs[0];var gr=gs[1];var gq=gs[2];var gw=gs[3];var gv=((gu*gu)+(gr*gr)+(gq*gq)+(gw*gw));if(gv>0){var gt=1/Math.sqrt(gv);gx[0]=gu*gt;gx[1]=gr*gt;gx[2]=gq*gt;gx[3]=gw*gt
}else{gx[0]=0;gx[1]=0;gx[2]=0;gx[3]=0}return gx},v4Abs:function dS(gr,gs){if(gs===undefined){gs=new c3(4)}var gq=Math.abs;gs[0]=gq(gr[0]);gs[1]=gq(gr[1]);gs[2]=gq(gr[2]);gs[3]=gq(gr[3]);return gs},v4Max:function ck(gs,gr,gt){if(gt===undefined){gt=new c3(4)}var gq=Math.max;gt[0]=gq(gs[0],gr[0]);gt[1]=gq(gs[1],gr[1]);gt[2]=gq(gs[2],gr[2]);gt[3]=gq(gs[3],gr[3]);return gt},v4Min:function aO(gr,gq,gt){if(gt===undefined){gt=new c3(4)}var gs=Math.min;gt[0]=gs(gr[0],gq[0]);gt[1]=gs(gr[1],gq[1]);gt[2]=gs(gr[2],gq[2]);gt[3]=gs(gr[3],gq[3]);return gt},v4Equal:function G(gt,gr,gs){var gq=Math.abs;if(gs===undefined){gs=this.precision}return(gq(gt[0]-gr[0])<=gs&&gq(gt[1]-gr[1])<=gs&&gq(gt[2]-gr[2])<=gs&&gq(gt[3]-gr[3])<=gs)},v4MaskEqual:function f9(gt,gr){var gq=Math.abs;var gs=f2.precision;return[(gq(gt[0]-gr[0])<=gs),(gq(gt[1]-gr[1])<=gs),(gq(gt[2]-gr[2])<=gs),(gq(gt[3]-gr[3])<=gs)]},v4MaskLess:function eg(gr,gq){return[(gr[0]<gq[0]),(gr[1]<gq[1]),(gr[2]<gq[2]),(gr[3]<gq[3])]},v4MaskGreater:function t(gr,gq){return[(gr[0]>gq[0]),(gr[1]>gq[1]),(gr[2]>gq[2]),(gr[3]>gq[3])]
},v4MaskGreaterEq:function g(gr,gq){return[(gr[0]>=gq[0]),(gr[1]>=gq[1]),(gr[2]>=gq[2]),(gr[3]>=gq[3])]},v4MaskNot:function gb(gq){return[!gq[0],!gq[1],!gq[2],!gq[3]]},v4MaskOr:function eb(gr,gq){return[(gr[0]||gq[0]),(gr[1]||gq[1]),(gr[2]||gq[2]),(gr[3]||gq[3])]},v4MaskAnd:function eJ(gr,gq){return[(gr[0]&&gq[0]),(gr[1]&&gq[1]),(gr[2]&&gq[2]),(gr[3]&&gq[3])]},v4Many:function f7(gq){return(gq[0]||gq[1]||gq[2]||gq[3])},v4MaskAll:function cw(gq){return(gq[0]&&gq[1]&&gq[2]&&gq[3])},v4Select:function dR(gr,gs,gq,gt){if(gt===undefined){gt=new c3(4)}gt[0]=gr[0]?gs[0]:gq[0];gt[1]=gr[1]?gs[1]:gq[1];gt[2]=gr[2]?gs[2]:gq[2];gt[3]=gr[3]?gs[3]:gq[3];return gt},v4ScalarBuild:function bK(gq,gr){if(gr===undefined){gr=new c3(4)}gr[0]=gq;gr[1]=gq;gr[2]=gq;gr[3]=gq;return gr},v4ScalarMax:function aS(gs,gr,gt){if(gt===undefined){gt=new c3(4)}var gq=Math.max;gt[0]=gq(gs[0],gr);gt[1]=gq(gs[1],gr);gt[2]=gq(gs[2],gr);gt[3]=gq(gs[3],gr);return gt},v4ScalarMin:function gh(gr,gq,gt){if(gt===undefined){gt=new c3(4)
}var gs=Math.min;gt[0]=gs(gr[0],gq);gt[1]=gs(gr[1],gq);gt[2]=gs(gr[2],gq);gt[3]=gs(gr[3],gq);return gt},v4ScalarAdd:function dp(gr,gq,gs){if(gs===undefined){gs=new c3(4)}gs[0]=(gr[0]+gq);gs[1]=(gr[1]+gq);gs[2]=(gr[2]+gq);gs[3]=(gr[3]+gq);return gs},v4ScalarSub:function db(gr,gq,gs){if(gs===undefined){gs=new c3(4)}gs[0]=(gr[0]-gq);gs[1]=(gr[1]-gq);gs[2]=(gr[2]-gq);gs[3]=(gr[3]-gq);return gs},v4ScalarMul:function co(gr,gq,gs){if(gq===0){return f2.v4BuildZero(gs)}else{if(gs===undefined){gs=new c3(4)}gs[0]=(gr[0]*gq);gs[1]=(gr[1]*gq);gs[2]=(gr[2]*gq);gs[3]=(gr[3]*gq);return gs}},v4AddScalarMul:function bG(gr,gq,gt,gs){if(gs===undefined){gs=new c3(4)}gs[0]=gr[0]+gq[0]*gt;gs[1]=gr[1]+gq[1]*gt;gs[2]=gr[2]+gq[2]*gt;gs[3]=gr[3]+gq[3]*gt;return gs},v4ScalarEqual:function dX(gt,gr){var gq=Math.abs;var gs=f2.precision;return(gq(gt[0]-gr)<=gs&&gq(gt[1]-gr)<=gs&&gq(gt[2]-gr)<=gs&&gq(gt[3]-gr)<=gs)},v4EqualScalarMask:function dO(gt,gr){var gq=Math.abs;var gs=f2.precision;return[(gq(gt[0]-gr)<=gs),(gq(gt[1]-gr)<=gs),(gq(gt[2]-gr)<=gs),(gq(gt[3]-gr)<=gs)]
},v4LessScalarMask:function dH(gr,gq){return[(gr[0]<gq),(gr[1]<gq),(gr[2]<gq),(gr[3]<gq)]},v4GreaterScalarMask:function ag(gr,gq){return[(gr[0]>gq),(gr[1]>gq),(gr[2]>gq),(gr[3]>gq)]},v4GreaterEqScalarMask:function ff(gr,gq){return[(gr[0]>=gq),(gr[1]>=gq),(gr[2]>=gq),(gr[3]>=gq)]},v4Lerp:function eB(gr,gq,gs,gt){if(gt===undefined){gt=new c3(4)}gt[0]=(gr[0]+((gq[0]-gr[0])*gs));gt[1]=(gr[1]+((gq[1]-gr[1])*gs));gt[2]=(gr[2]+((gq[2]-gr[2])*gs));gt[3]=(gr[3]+((gq[3]-gr[3])*gs));return gt},aabbBuild:function ap(gs,gr,gq,gx,gv,gu,gw){var gt=gw;if(gt===undefined){gt=new c3(6)}gt[0]=gs;gt[1]=gr;gt[2]=gq;gt[3]=gx;gt[4]=gv;gt[5]=gu;return gt},aabbBuildEmpty:function cZ(gs){var gq=this.FLOAT_MAX;var gr=gs;if(gr===undefined){gr=new c3(6)}gr[0]=gq;gr[1]=gq;gr[2]=gq;gr[3]=-gq;gr[4]=-gq;gr[5]=-gq;return gr},aabbCopy:function cQ(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(6)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];gr[3]=gq[3];gr[4]=gq[4];gr[5]=gq[5];return gr},aabbSet:function fy(gr,gq){gr[0]=gq[0];gr[1]=gq[1];
gr[2]=gq[2];gr[3]=gq[3];gr[4]=gq[4];gr[5]=gq[5]},aabbIsEmpty:function fn(gq){return gq[0]>gq[3]},aabbMin:function cA(gq,gr){if(gr===undefined){return gq.slice(0,3)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];return gr},aabbMax:function dQ(gq,gr){if(gr===undefined){return gq.slice(3,6)}gr[0]=gq[3];gr[1]=gq[4];gr[2]=gq[5];return gr},aabbGetCenterAndHalf:function a4(gr,gq,gs){var gv=(gr[0]+gr[3])*0.5;var gu=(gr[1]+gr[4])*0.5;var gt=(gr[2]+gr[5])*0.5;gq[0]=gv;gq[1]=gu;gq[2]=gt;gs[0]=gr[3]-gv;gs[1]=gr[4]-gu;gs[2]=gr[5]-gt},aabbIsInsidePlanes:function fQ(gr,gt){var gs=gt.length;var gx=0;do{var gq=gt[gx];var gw=gq[0];var gv=gq[1];var gu=gq[2];if((gw*(gw<0?gr[0]:gr[3])+gv*(gv<0?gr[1]:gr[4])+gu*(gu<0?gr[2]:gr[5]))<gq[3]){return false}gx+=1}while(gx<gs);return true},aabbIsFullyInsidePlanes:function R(gr,gt){var gs=gt.length;var gx=0;do{var gq=gt[gx];var gw=gq[0];var gv=gq[1];var gu=gq[2];if((gw*(gw>0?gr[0]:gr[3])+gv*(gv>0?gr[1]:gr[4])+gu*(gu>0?gr[2]:gr[5]))<gq[3]){return false}gx+=1}while(gx<gs);return true
},aabbUnion:function eZ(gr,gq,gs){if(gs===undefined){gs=new c3(6)}gs[0]=gr[0]<gq[0]?gr[0]:gq[0];gs[1]=gr[1]<gq[1]?gr[1]:gq[1];gs[2]=gr[2]<gq[2]?gr[2]:gq[2];gs[3]=gr[3]>gq[3]?gr[3]:gq[3];gs[4]=gr[4]>gq[4]?gr[4]:gq[4];gs[5]=gr[5]>gq[5]?gr[5]:gq[5];return gs},aabbUnionArray:function bu(gs,gu){if(gu===undefined){gu=new c3(6)}f2.aabbCopy(gs[0],gu);var gt=gs.length;for(var gr=1;gr<gt;gr+=1){var gq=gs[gr];gu[0]=(gu[0]<gq[0]?gu[0]:gq[0]);gu[1]=(gu[1]<gq[1]?gu[1]:gq[1]);gu[2]=(gu[2]<gq[2]?gu[2]:gq[2]);gu[3]=(gu[3]>gq[3]?gu[3]:gq[3]);gu[4]=(gu[4]>gq[4]?gu[4]:gq[4]);gu[5]=(gu[5]>gq[5]?gu[5]:gq[5])}return gu},aabbAddPoints:function aD(gz,gr){var gy;var gA=gr.length;var gx=gz[0];var gw=gz[1];var gv=gz[2];var gu=gz[3];var gs=gz[4];var gq=gz[5];var gt,gD,gC,gB;for(gy=0;gy<gA;gy+=1){gt=gr[gy];gD=gt[0];gC=gt[1];gB=gt[2];gx=(gx<gD?gx:gD);gw=(gw<gC?gw:gC);gv=(gv<gB?gv:gB);gu=(gu>gD?gu:gD);gs=(gs>gC?gs:gC);gq=(gq>gB?gq:gB)}gz[0]=gx;gz[1]=gw;gz[2]=gv;gz[3]=gu;gz[4]=gs;gz[5]=gq},aabbTransform:function au(gA,gF,gO){if(gO===undefined){gO=new c3(6)
}var gI=(gA[0]+gA[3])*0.5;var gH=(gA[1]+gA[4])*0.5;var gG=(gA[2]+gA[5])*0.5;var gD=gA[3]-gI;var gC=gA[4]-gH;var gB=gA[5]-gG;var gt=gF[0];var gs=gF[1];var gr=gF[2];var gq=gF[3];var gN=gF[4];var gM=gF[5];var gL=gF[6];var gK=gF[7];var gJ=gF[8];var gz=gF[9]+(gt*gI+gq*gH+gL*gG);var gy=gF[10]+(gs*gI+gN*gH+gK*gG);var gx=gF[11]+(gr*gI+gM*gH+gJ*gG);var gE=Math.abs;var gw=(gE(gt)*gD+gE(gq)*gC+gE(gL)*gB);var gv=(gE(gs)*gD+gE(gN)*gC+gE(gK)*gB);var gu=(gE(gr)*gD+gE(gM)*gC+gE(gJ)*gB);gO[0]=gz-gw;gO[1]=gy-gv;gO[2]=gx-gu;gO[3]=gz+gw;gO[4]=gy+gv;gO[5]=gx+gu;return gO},aabbIntercept:function dl(gr,gq,gs){if(gs===undefined){gs=new c3(6)}gs[0]=gr[0]>gq[0]?gr[0]:gq[0];gs[1]=gr[1]>gq[1]?gr[1]:gq[1];gs[2]=gr[2]>gq[2]?gr[2]:gq[2];gs[3]=gr[3]<gq[3]?gr[3]:gq[3];gs[4]=gr[4]<gq[4]?gr[4]:gq[4];gs[5]=gr[5]<gq[5]?gr[5]:gq[5];return gs},aabbOverlaps:function b7(gr,gq){return((gr[0]<=gq[3])&&(gr[1]<=gq[4])&&(gr[2]<=gq[5])&&(gr[3]>=gq[0])&&(gr[4]>=gq[1])&&(gr[5]>=gq[2]))},aabbSphereOverlaps:function aG(gz,gr,gA){var gy=gr[0];
var gx=gr[1];var gv=gr[2];var gC=gA*gA;var gw=gz[0];var gu=gz[1];var gt=gz[2];var gs=gz[3];var gq=gz[4];var gE=gz[5];var gB=0,gD;if(gy<gw){gD=(gw-gy);gB+=(gD*gD)}else{if(gy>gs){gD=(gy-gs);gB+=(gD*gD)}}if(gx<gu){gD=(gu-gx);gB+=(gD*gD)}else{if(gx>gq){gD=(gx-gq);gB+=(gD*gD)}}if(gv<gt){gD=(gt-gv);gB+=(gD*gD)}else{if(gv>gE){gD=(gv-gE);gB+=(gD*gD)}}return(gB<=gC)},aabbIsInside:function cE(gr,gq){return((gr[0]>=gq[0])&&(gr[1]>=gq[1])&&(gr[2]>=gq[2])&&(gr[3]<=gq[3])&&(gr[4]<=gq[4])&&(gr[5]<=gq[5]))},aabbTestInside:function aP(gr,gq){if((gr[0]<=gq[3])&&(gr[1]<=gq[4])&&(gr[2]<=gq[5])&&(gr[3]>=gq[0])&&(gr[4]>=gq[1])&&(gr[5]>=gq[2])){if((gr[0]>=gq[0])&&(gr[1]>=gq[1])&&(gr[2]>=gq[2])&&(gr[3]<=gq[3])&&(gr[4]<=gq[4])&&(gr[5]<=gq[5])){return 2}return 1}return 0},m33BuildIdentity:function bS(gr){var gq=gr;if(gq===undefined){gq=new c3(9)}gq[0]=1;gq[1]=0;gq[2]=0;gq[3]=0;gq[4]=1;gq[5]=0;gq[6]=0;gq[7]=0;gq[8]=1;return gq},m33Build:function aX(gu,gr,gq,gv){var gs;var gt=arguments.length;if(gt>=9){if(gt>9){gs=arguments[9];
if(gs===undefined){gs=new c3(9)}}else{gs=new c3(9)}gs[0]=arguments[0];gs[1]=arguments[1];gs[2]=arguments[2];gs[3]=arguments[3];gs[4]=arguments[4];gs[5]=arguments[5];gs[6]=arguments[6];gs[7]=arguments[7];gs[8]=arguments[8]}else{gs=gv;if(gs===undefined){gs=new c3(9)}gs[0]=gu[0];gs[1]=gu[1];gs[2]=gu[2];gs[3]=gr[0];gs[4]=gr[1];gs[5]=gr[2];gs[6]=gq[0];gs[7]=gq[1];gs[8]=gq[2]}return gs},m33Copy:function dh(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(9)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];gr[3]=gq[3];gr[4]=gq[4];gr[5]=gq[5];gr[6]=gq[6];gr[7]=gq[7];gr[8]=gq[8];return gr},m33FromAxisRotation:function gn(gt,gu,gA){var gy=gA;if(gy===undefined){gy=new c3(9)}var gF=Math.sin(gu);var gB=Math.cos(gu);var gE=1-gB;var gs=gt[0];var gr=gt[1];var gq=gt[2];var gx=gE*gs;var gw=gE*gr;var gv=gE*gq;var gD=gF*gs;var gC=gF*gr;var gz=gF*gq;gy[0]=gx*gs+gB;gy[1]=gx*gr-gz;gy[2]=gx*gq+gC;gy[3]=gw*gs+gz;gy[4]=gw*gr+gB;gy[5]=gw*gq-gD;gy[6]=gv*gs-gC;gy[7]=gv*gr+gD;gy[8]=gv*gq+gB;return gy},m33FromQuat:function bJ(gs,gC){var gB=gC;
if(gB===undefined){gB=new c3(9)}var gx=gs[0];var gw=gs[1];var gv=gs[2];var gy=gs[3];var gq=2*gx*gx;var gA=2*gw*gw;var gt=2*gv*gv;var gF=2*gx*gw;var gu=2*gv*gy;var gE=2*gx*gv;var gD=2*gw*gy;var gz=2*gw*gv;var gr=2*gx*gy;gB[0]=1-gA-gt;gB[1]=gF-gu;gB[2]=gE+gD;gB[3]=gF+gu;gB[4]=1-gq-gt;gB[5]=gz-gr;gB[6]=gE-gD;gB[7]=gz+gr;gB[8]=1-gq-gA;return gB},m33Right:function ea(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(3)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];return gr},m33Up:function fu(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(3)}gr[0]=gq[3];gr[1]=gq[4];gr[2]=gq[5];return gr},m33At:function d4(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(3)}gr[0]=gq[6];gr[1]=gq[7];gr[2]=gq[8];return gr},m33SetRight:function N(gq,gr){gq[0]=gr[0];gq[1]=gr[1];gq[2]=gr[2]},m33SetUp:function bk(gq,gr){gq[3]=gr[0];gq[4]=gr[1];gq[5]=gr[2]},m33SetAt:function C(gq,gr){gq[6]=gr[0];gq[7]=gr[1];gq[8]=gr[2]},m33Transpose:function an(gq,gt){if(gt===undefined){gt=new c3(9)}var gA=gq[0];var gz=gq[1];var gy=gq[2];var gx=gq[3];
var gw=gq[4];var gv=gq[5];var gu=gq[6];var gs=gq[7];var gr=gq[8];gt[0]=gA;gt[1]=gx;gt[2]=gu;gt[3]=gz;gt[4]=gw;gt[5]=gs;gt[6]=gy;gt[7]=gv;gt[8]=gr;return gt},m33Determinant:function gd(gq){var gz=gq[0];var gy=gq[1];var gx=gq[2];var gw=gq[3];var gv=gq[4];var gu=gq[5];var gt=gq[6];var gs=gq[7];var gr=gq[8];return(gz*(gv*gr-gu*gs)+gy*(gu*gt-gw*gr)+gx*(gw*gs-gv*gt))},m33Inverse:function dd(gq,gu){if(gu===undefined){gu=new c3(9)}var gr=f2.m33Determinant(gq);if(gr===0){gu[0]=gu[1]=gu[2]=0;gu[3]=gu[4]=gu[5]=0;gu[6]=gu[7]=gu[8]=0;return gu}else{var gC=gq[0];var gA=gq[1];var gz=gq[2];var gy=gq[3];var gx=gq[4];var gw=gq[5];var gv=gq[6];var gt=gq[7];var gs=gq[8];var gB=1/gr;gu[0]=((gx*gs+gw*(-gt))*gB);gu[1]=((gt*gz+gs*(-gA))*gB);gu[2]=((gA*gw-gz*gx)*gB);gu[3]=((gw*gv+gy*(-gs))*gB);gu[4]=((gs*gC+gv*(-gz))*gB);gu[5]=((gy*gz-gC*gw)*gB);gu[6]=((gy*gt+gx*(-gv))*gB);gu[7]=((gv*gA+gt*(-gC))*gB);gu[8]=((gC*gx-gy*gA)*gB);return gu}},m33InverseTranspose:function a9(gq,gu){if(gu===undefined){gu=new c3(9)}var gC=gq[0];
var gA=gq[1];var gz=gq[2];var gy=gq[3];var gx=gq[4];var gw=gq[5];var gv=gq[6];var gt=gq[7];var gs=gq[8];var gr=(gC*(gx*gs-gw*gt)+gA*(gw*gv-gy*gs)+gz*(gy*gt-gx*gv));if(gr===0){gu[0]=gu[1]=gu[2]=0;gu[3]=gu[4]=gu[5]=0;gu[6]=gu[7]=gu[8]=0;return gu}else{var gB=1/gr;gu[0]=((gx*gs+gw*(-gt))*gB);gu[3]=((gt*gz+gs*(-gA))*gB);gu[6]=((gA*gw-gz*gx)*gB);gu[1]=((gw*gv+gy*(-gs))*gB);gu[4]=((gs*gC+gv*(-gz))*gB);gu[7]=((gy*gz-gC*gw)*gB);gu[2]=((gy*gt+gx*(-gv))*gB);gu[5]=((gv*gA+gt*(-gC))*gB);gu[8]=((gC*gx-gy*gA)*gB);return gu}},m33Mul:function fC(gF,gE,gJ){var gK=gF[0];var gI=gF[1];var gH=gF[2];var gG=gF[3];var gD=gF[4];var gC=gF[5];var gB=gF[6];var gA=gF[7];var gz=gF[8];var gy=gE[0];var gx=gE[1];var gw=gE[2];var gv=gE[3];var gu=gE[4];var gt=gE[5];var gs=gE[6];var gr=gE[7];var gq=gE[8];if(gJ===undefined){gJ=new c3(9)}gJ[0]=(gy*gK+gv*gI+gs*gH);gJ[1]=(gx*gK+gu*gI+gr*gH);gJ[2]=(gw*gK+gt*gI+gq*gH);gJ[3]=(gy*gG+gv*gD+gs*gC);gJ[4]=(gx*gG+gu*gD+gr*gC);gJ[5]=(gw*gG+gt*gD+gq*gC);gJ[6]=(gy*gB+gv*gA+gs*gz);gJ[7]=(gx*gB+gu*gA+gr*gz);
gJ[8]=(gw*gB+gt*gA+gq*gz);return gJ},m33Transform:function ci(gr,gs,gv){if(gv===undefined){gv=new c3(3)}var gq=gs[0];var gu=gs[1];var gt=gs[2];gv[0]=(gr[0]*gq+gr[3]*gu+gr[6]*gt);gv[1]=(gr[1]*gq+gr[4]*gu+gr[7]*gt);gv[2]=(gr[2]*gq+gr[5]*gu+gr[8]*gt);return gv},m33Equal:function bs(gt,gr,gs){var gq=Math.abs;if(gs===undefined){gs=this.precision}return(gq(gt[0]-gr[0])<=gs&&gq(gt[1]-gr[1])<=gs&&gq(gt[2]-gr[2])<=gs&&gq(gt[3]-gr[3])<=gs&&gq(gt[4]-gr[4])<=gs&&gq(gt[5]-gr[5])<=gs&&gq(gt[6]-gr[6])<=gs&&gq(gt[7]-gr[7])<=gs&&gq(gt[8]-gr[8])<=gs)},m33MulM43:function e(gF,gE,gJ){if(gJ===undefined){gJ=new c3(12)}var gK=gF[0];var gI=gF[1];var gH=gF[2];var gG=gF[3];var gD=gF[4];var gC=gF[5];var gB=gF[6];var gA=gF[7];var gz=gF[8];var gy=gE[0];var gx=gE[1];var gw=gE[2];var gv=gE[3];var gu=gE[4];var gt=gE[5];var gs=gE[6];var gr=gE[7];var gq=gE[8];gJ[0]=gy*gK+gv*gI+gs*gH;gJ[1]=gx*gK+gu*gI+gr*gH;gJ[2]=gw*gK+gt*gI+gq*gH;gJ[3]=gy*gG+gv*gD+gs*gC;gJ[4]=gx*gG+gu*gD+gr*gC;gJ[5]=gw*gG+gt*gD+gq*gC;gJ[6]=gy*gB+gv*gA+gs*gz;
gJ[7]=gx*gB+gu*gA+gr*gz;gJ[8]=gw*gB+gt*gA+gq*gz;gJ[9]=gE[9];gJ[10]=gE[10];gJ[11]=gE[11];return gJ},m33MulM44:function eG(gI,gH,gM){if(gM===undefined){gM=new c3(16)}var gN=gI[0];var gL=gI[1];var gK=gI[2];var gJ=gI[3];var gG=gI[4];var gF=gI[5];var gE=gI[6];var gC=gI[7];var gA=gI[8];var gz=gH[0];var gy=gH[1];var gx=gH[2];var gw=gH[3];var gv=gH[4];var gu=gH[5];var gt=gH[6];var gs=gH[7];var gr=gH[8];var gq=gH[9];var gD=gH[10];var gB=gH[11];gM[0]=gz*gN+gv*gL+gr*gK;gM[1]=gy*gN+gu*gL+gq*gK;gM[2]=gx*gN+gt*gL+gD*gK;gM[3]=gw*gN+gs*gL+gB*gK;gM[4]=gz*gJ+gv*gG+gr*gF;gM[5]=gy*gJ+gu*gG+gq*gF;gM[6]=gx*gJ+gt*gG+gD*gF;gM[7]=gw*gJ+gs*gG+gB*gF;gM[8]=gz*gE+gv*gC+gr*gA;gM[9]=gy*gE+gu*gC+gq*gA;gM[10]=gx*gE+gt*gC+gD*gA;gM[11]=gw*gE+gs*gC+gB*gA;gM[12]=gH[12];gM[13]=gH[13];gM[14]=gH[14];gM[15]=gH[15];return gM},m33ScalarAdd:function cU(gq,gr,gt){if(gt===undefined){gt=new c3(9)}for(var gs=0;gs<9;gs+=1){gt[gs]=(gq[gs]+gr)}return gt},m33ScalarSub:function cD(gq,gr,gt){if(gt===undefined){gt=new c3(9)}for(var gs=0;gs<9;
gs+=1){gt[gs]=(gq[gs]-gr)}return gt},m33ScalarMul:function bX(gq,gr,gt){if(gt===undefined){gt=new c3(9)}for(var gs=0;gs<9;gs+=1){gt[gs]=(gq[gs]*gr)}return gt},m34BuildIdentity:function I(gr){var gq=gr;if(gq===undefined){gq=new c3(12)}gq[0]=1;gq[1]=0;gq[2]=0;gq[3]=0;gq[4]=0;gq[5]=1;gq[6]=0;gq[7]=0;gq[8]=0;gq[9]=0;gq[10]=1;gq[11]=0;return gq},m34Pos:function e4(gq,gr){if(gr===undefined){gr=new c3(3)}gr[0]=gq[3];gr[1]=gq[7];gr[2]=gq[11];return gr},m34Scale:function b3(gq,gt,gv){if(gv===undefined){gv=new c3(12)}var gu=gt[0];var gs=gt[1];var gr=gt[2];gv[0]=gq[0]*gu;gv[1]=gq[1]*gu;gv[2]=gq[2]*gu;gv[3]=gq[3];gv[4]=gq[4]*gs;gv[5]=gq[5]*gs;gv[6]=gq[6]*gs;gv[7]=gq[7];gv[8]=gq[8]*gr;gv[9]=gq[9]*gr;gv[10]=gq[10]*gr;gv[11]=gq[11];return gv},m43BuildIdentity:function a2(gr){var gq=gr;if(gq===undefined){gq=new c3(12)}gq[0]=1;gq[1]=0;gq[2]=0;gq[3]=0;gq[4]=1;gq[5]=0;gq[6]=0;gq[7]=0;gq[8]=1;gq[9]=0;gq[10]=0;gq[11]=0;return gq},m43Build:function dN(gq,gE,gA,gr,gz,gx,gu,gC,gw,gt,gB,gv,gD){var gy;var gs=arguments.length;
if(gs>=12){if(gs>12){gy=arguments[12];if(gy===undefined){gy=new c3(12)}}else{gy=new c3(12)}gy[0]=arguments[0];gy[1]=arguments[1];gy[2]=arguments[2];gy[3]=arguments[3];gy[4]=arguments[4];gy[5]=arguments[5];gy[6]=arguments[6];gy[7]=arguments[7];gy[8]=arguments[8];gy[9]=arguments[9];gy[10]=arguments[10];gy[11]=arguments[11]}else{gy=gz;if(gy===undefined){gy=new c3(12)}gy[0]=gq[0];gy[1]=gq[1];gy[2]=gq[2];gy[3]=gE[0];gy[4]=gE[1];gy[5]=gE[2];gy[6]=gA[0];gy[7]=gA[1];gy[8]=gA[2];gy[9]=gr[0];gy[10]=gr[1];gy[11]=gr[2]}return gy},m43BuildTranslation:function cf(gq,gu,gs,gt){var gr;if(3<=arguments.length){gr=gt;if(gr===undefined){gr=new c3(12)}gr[9]=gq;gr[10]=gu;gr[11]=gs}else{gr=gu;if(gr===undefined){gr=new c3(12)}gr[9]=gq[0];gr[10]=gq[1];gr[11]=gq[2]}gr[0]=1;gr[1]=0;gr[2]=0;gr[3]=0;gr[4]=1;gr[5]=0;gr[6]=0;gr[7]=0;gr[8]=1;return gr},m43Copy:function fE(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(12)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];gr[3]=gq[3];gr[4]=gq[4];gr[5]=gq[5];gr[6]=gq[6];gr[7]=gq[7];gr[8]=gq[8];
gr[9]=gq[9];gr[10]=gq[10];gr[11]=gq[11];return gr},m43FromM33V3:function dK(gq,gr,gt){var gs=gt;if(gs===undefined){gs=new c3(12)}gs[0]=gq[0];gs[1]=gq[1];gs[2]=gq[2];gs[3]=gq[3];gs[4]=gq[4];gs[5]=gq[5];gs[6]=gq[6];gs[7]=gq[7];gs[8]=gq[8];gs[9]=gr[0];gs[10]=gr[1];gs[11]=gr[2];return gs},m43FromAxisRotation:function bj(gt,gu,gA){var gF=Math.sin(gu);var gB=Math.cos(gu);var gE=1-gB;var gs=gt[0];var gr=gt[1];var gq=gt[2];var gx=gE*gs;var gw=gE*gr;var gv=gE*gq;var gD=gF*gs;var gC=gF*gr;var gz=gF*gq;var gy=gA;if(gy===undefined){gy=new c3(12)}gy[0]=gx*gs+gB;gy[1]=gx*gr-gz;gy[2]=gx*gq+gC;gy[3]=gw*gs+gz;gy[4]=gw*gr+gB;gy[5]=gw*gq-gD;gy[6]=gv*gs-gC;gy[7]=gv*gr+gD;gy[8]=gv*gq+gB;gy[9]=0;gy[10]=0;gy[11]=0;return gy},m43FromQuatPos:function dx(gq,gG){var gH=gG;if(gH===undefined){gH=new c3(12)}var gD=gq[0];var gC=gq[1];var gB=gq[2];var gE=gq[3];var gx=gq[4];var gw=gq[5];var gv=gq[6];var gt=2*gD*gD;var gz=2*gC*gC;var gF=2*gB*gB;var gs=2*gD*gC;var gI=2*gB*gE;var gr=2*gD*gB;var gA=2*gC*gE;var gy=2*gC*gB;var gu=2*gD*gE;
gH[0]=1-gz-gF;gH[1]=gs-gI;gH[2]=gr+gA;gH[3]=gs+gI;gH[4]=1-gt-gF;gH[5]=gy-gu;gH[6]=gr-gA;gH[7]=gy+gu;gH[8]=1-gt-gz;gH[9]=gx;gH[10]=gw;gH[11]=gv;return gH},m43FromRTS:function eo(gq,gt,gH,gJ){var gE=gq[0];var gD=gq[1];var gC=gq[2];var gF=gq[3];var gu=(2*gE*gE);var gA=(2*gD*gD);var gG=(2*gC*gC);var gs=(2*gE*gD);var gK=(2*gC*gF);var gr=(2*gE*gC);var gB=(2*gD*gF);var gz=(2*gD*gC);var gv=(2*gE*gF);var gy=gH[0];var gx=gH[1];var gw=gH[2];var gI=gJ;if(gI===undefined){gI=new c3(12)}gI[0]=gy*(1-gA-gG);gI[1]=gy*(gs-gK);gI[2]=gy*(gr+gB);gI[3]=gx*(gs+gK);gI[4]=gx*(1-gu-gG);gI[5]=gx*(gz-gv);gI[6]=gw*(gr-gB);gI[7]=gw*(gz+gv);gI[8]=gw*(1-gu-gA);gI[9]=gt[0];gI[10]=gt[1];gI[11]=gt[2];return gI},m43FromRT:function F(gs,gE,gC){var gx=gs[0];var gw=gs[1];var gv=gs[2];var gy=gs[3];var gq=(2*gx*gx);var gB=(2*gw*gw);var gt=(2*gv*gv);var gG=(2*gx*gw);var gu=(2*gv*gy);var gF=(2*gx*gv);var gD=(2*gw*gy);var gz=(2*gw*gv);var gr=(2*gx*gy);var gA=gC;if(gA===undefined){gA=new c3(12)}gA[0]=1-gB-gt;gA[1]=gG-gu;gA[2]=gF+gD;
gA[3]=gG+gu;gA[4]=1-gq-gt;gA[5]=gz-gr;gA[6]=gF-gD;gA[7]=gz+gr;gA[8]=1-gq-gB;gA[9]=gE[0];gA[10]=gE[1];gA[11]=gE[2];return gA},m43Right:function Y(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(3)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];return gr},m43Up:function eu(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(3)}gr[0]=gq[3];gr[1]=gq[4];gr[2]=gq[5];return gr},m43At:function di(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(3)}gr[0]=gq[6];gr[1]=gq[7];gr[2]=gq[8];return gr},m43Pos:function dn(gq,gs){var gr=gs;if(gr===undefined){gr=new c3(3)}gr[0]=gq[9];gr[1]=gq[10];gr[2]=gq[11];return gr},m43SetRight:function c0(gq,gr){gq[0]=gr[0];gq[1]=gr[1];gq[2]=gr[2]},m43SetUp:function d2(gq,gr){gq[3]=gr[0];gq[4]=gr[1];gq[5]=gr[2]},m43SetAt:function cS(gq,gr){gq[6]=gr[0];gq[7]=gr[1];gq[8]=gr[2]},m43SetPos:function d6(gq,gr){gq[9]=gr[0];gq[10]=gr[1];gq[11]=gr[2]},m43SetAxisRotation:function b0(gu,gt,gv){var gE=Math.sin(gv);var gA=Math.cos(gv);var gD=1-gA;var gs=gt[0];var gr=gt[1];var gq=gt[2];var gy=gD*gs;var gx=gD*gr;
var gw=gD*gq;var gC=gE*gs;var gB=gE*gr;var gz=gE*gq;gu[0]=gy*gs+gA;gu[1]=gy*gr-gz;gu[2]=gy*gq+gB;gu[3]=gx*gs+gz;gu[4]=gx*gr+gA;gu[5]=gx*gq-gC;gu[6]=gw*gs-gB;gu[7]=gw*gr+gC;gu[8]=gw*gq+gA},m43InverseOrthonormal:function T(gq,gt){if(gt===undefined){gt=new c3(12)}var gD=gq[0];var gC=gq[1];var gB=gq[2];var gA=gq[3];var gz=gq[4];var gx=gq[5];var gv=gq[6];var gs=gq[7];var gr=gq[8];var gy=gq[9];var gw=gq[10];var gu=gq[11];gt[0]=gD;gt[1]=gA;gt[2]=gv;gt[3]=gC;gt[4]=gz;gt[5]=gs;gt[6]=gB;gt[7]=gx;gt[8]=gr;gt[9]=-((gy*gD)+(gw*gC)+(gu*gB));gt[10]=-((gy*gA)+(gw*gz)+(gu*gx));gt[11]=-((gy*gv)+(gw*gs)+(gu*gr));return gt},m43Orthonormalize:function bL(gA,gJ){var gB=f2.v3Normalize;var gr=f2.v3Length;var gz=f2.v3Dot;var gq=f2.v3Cross;var gw=Math.abs;var gG=f2.m43Right(gA);var gt=f2.m43Up(gA);var gv=f2.m43At(gA);var gs=f2.m43Pos(gA);var gI=gr(gG);var gH=gr(gt);var gE=gr(gv);gB(gG,gG);gB(gt,gt);gB(gv,gv);var gy,gx,gu;if(gI>0){if(gH>0){if(gE>0){var gF=gw(gz(gt,gv));var gD=gw(gz(gv,gG));var gC=gw(gz(gG,gt));if(gF<gD){if(gF<gC){gy=gt;
gx=gv;gu=gG}else{gy=gG;gx=gt;gu=gv}}else{if(gD<gC){gy=gv;gx=gG;gu=gt}else{gy=gG;gx=gt;gu=gv}}}else{gy=gG;gx=gt;gu=gv}}else{gy=gv;gx=gG;gu=gt}}else{gy=gt;gx=gv;gu=gG}gq(gy,gx,gu);gB(gu,gu);gq(gu,gy,gx);gB(gx,gx);if(gJ===undefined){gJ=new c3(12)}gJ[0]=gG[0];gJ[1]=gG[1];gJ[2]=gG[2];gJ[3]=gt[0];gJ[4]=gt[1];gJ[5]=gt[2];gJ[6]=gv[0];gJ[7]=gv[1];gJ[8]=gv[2];gJ[9]=gs[0];gJ[10]=gs[1];gJ[11]=gs[2];return gJ},m43Determinant:function fS(gq){return(gq[0]*(gq[4]*gq[8]-gq[5]*gq[7])+gq[1]*(gq[5]*gq[6]-gq[3]*gq[8])+gq[2]*(gq[3]*gq[7]-gq[4]*gq[6]))},m43Inverse:function aW(gq,gx){if(gx===undefined){gx=new c3(12)}var gF=gq[0];var gD=gq[1];var gC=gq[2];var gB=gq[3];var gA=gq[4];var gz=gq[5];var gy=gq[6];var gw=gq[7];var gv=gq[8];var gu=gq[9];var gt=gq[10];var gr=gq[11];var gs=(gF*(gA*gv-gz*gw)+gD*(gz*gy-gB*gv)+gC*(gB*gw-gA*gy));if(gs===0){return gx}else{if(gx===undefined){gx=new c3(12)}var gE=1/gs;gx[0]=((gA*gv+gz*(-gw))*gE);gx[1]=((gw*gC+gv*(-gD))*gE);gx[2]=((gD*gz-gC*gA)*gE);gx[3]=((gz*gy+gB*(-gv))*gE);gx[4]=((gv*gF+gy*(-gC))*gE);
gx[5]=((gB*gC-gF*gz)*gE);gx[6]=((gB*gw+gA*(-gy))*gE);gx[7]=((gy*gD+gw*(-gF))*gE);gx[8]=((gF*gA-gB*gD)*gE);gx[9]=((gB*(gt*gv-gw*gr)+gA*(gy*gr-gu*gv)+gz*(gu*gw-gy*gt))*gE);gx[10]=((gy*(gC*gt-gD*gr)+gw*(gF*gr-gu*gC)+gv*(gu*gD-gF*gt))*gE);gx[11]=((gu*(gC*gA-gD*gz)+gt*(gF*gz-gB*gC)+gr*(gB*gD-gF*gA))*gE);return gx}},m43Translate:function P(gq,gr){gq[9]+=gr[0];gq[10]+=gr[1];gq[11]+=gr[2]},m43Scale:function el(gq,gt,gv){if(gv===undefined){gv=new c3(12)}var gu=gt[0];var gs=gt[1];var gr=gt[2];gv[0]=gq[0]*gu;gv[1]=gq[1]*gu;gv[2]=gq[2]*gu;gv[3]=gq[3]*gs;gv[4]=gq[4]*gs;gv[5]=gq[5]*gs;gv[6]=gq[6]*gr;gv[7]=gq[7]*gr;gv[8]=gq[8]*gr;gv[9]=gq[9];gv[10]=gq[10];gv[11]=gq[11];return gv},m43TransformVector:function dy(gr,gs,gw){var gt=gw;if(gt===undefined){gt=new c3(3)}var gq=gs[0];var gv=gs[1];var gu=gs[2];gt[0]=(gr[0]*gq+gr[3]*gv+gr[6]*gu);gt[1]=(gr[1]*gq+gr[4]*gv+gr[7]*gu);gt[2]=(gr[2]*gq+gr[5]*gv+gr[8]*gu);return gt},m43TransformPoint:function a5(gr,gs,gw){var gt=gw;if(gt===undefined){gt=new c3(3)}var gq=gs[0];
var gv=gs[1];var gu=gs[2];gt[0]=(gr[0]*gq+gr[3]*gv+gr[6]*gu+gr[9]);gt[1]=(gr[1]*gq+gr[4]*gv+gr[7]*gu+gr[10]);gt[2]=(gr[2]*gq+gr[5]*gv+gr[8]*gu+gr[11]);return gt},m43Mul:function cW(gI,gH,gN){var gO=gI[0];var gL=gI[1];var gK=gI[2];var gJ=gI[3];var gG=gI[4];var gF=gI[5];var gE=gI[6];var gD=gI[7];var gC=gI[8];var gB=gI[9];var gy=gI[10];var gx=gI[11];var gA=gH[0];var gz=gH[1];var gw=gH[2];var gv=gH[3];var gu=gH[4];var gt=gH[5];var gs=gH[6];var gr=gH[7];var gq=gH[8];var gM=gN;if(gM===undefined){gM=new c3(12)}gM[0]=(gA*gO+gv*gL+gs*gK);gM[1]=(gz*gO+gu*gL+gr*gK);gM[2]=(gw*gO+gt*gL+gq*gK);gM[3]=(gA*gJ+gv*gG+gs*gF);gM[4]=(gz*gJ+gu*gG+gr*gF);gM[5]=(gw*gJ+gt*gG+gq*gF);gM[6]=(gA*gE+gv*gD+gs*gC);gM[7]=(gz*gE+gu*gD+gr*gC);gM[8]=(gw*gE+gt*gD+gq*gC);gM[9]=(gA*gB+gv*gy+gs*gx+gH[9]);gM[10]=(gz*gB+gu*gy+gr*gx+gH[10]);gM[11]=(gw*gB+gt*gy+gq*gx+gH[11]);return gM},m43MulM44:function bY(gL,gK,gQ){var gR=gL[0];var gO=gL[1];var gN=gL[2];var gM=gL[3];var gJ=gL[4];var gI=gL[5];var gH=gL[6];var gF=gL[7];var gD=gL[8];
var gC=gL[9];var gz=gL[10];var gy=gL[11];var gB=gK[0];var gA=gK[1];var gx=gK[2];var gw=gK[3];var gv=gK[4];var gu=gK[5];var gt=gK[6];var gs=gK[7];var gr=gK[8];var gq=gK[9];var gG=gK[10];var gE=gK[11];var gP=gQ;if(gP===undefined){gP=new c3(16)}gP[0]=(gB*gR+gv*gO+gr*gN);gP[1]=(gA*gR+gu*gO+gq*gN);gP[2]=(gx*gR+gt*gO+gG*gN);gP[3]=(gw*gR+gs*gO+gE*gN);gP[4]=(gB*gM+gv*gJ+gr*gI);gP[5]=(gA*gM+gu*gJ+gq*gI);gP[6]=(gx*gM+gt*gJ+gG*gI);gP[7]=(gw*gM+gs*gJ+gE*gI);gP[8]=(gB*gH+gv*gF+gr*gD);gP[9]=(gA*gH+gu*gF+gq*gD);gP[10]=(gx*gH+gt*gF+gG*gD);gP[11]=(gw*gH+gs*gF+gE*gD);gP[12]=(gB*gC+gv*gz+gr*gy+gK[12]);gP[13]=(gA*gC+gu*gz+gq*gy+gK[13]);gP[14]=(gx*gC+gt*gz+gG*gy+gK[14]);gP[15]=(gw*gC+gs*gz+gE*gy+gK[15]);return gP},m43Transpose:function cn(gq,gx){var gv=gx;if(gv===undefined){gv=new c3(12)}var gE=gq[0];var gD=gq[1];var gC=gq[2];var gB=gq[3];var gA=gq[4];var gz=gq[5];var gy=gq[6];var gw=gq[7];var gu=gq[8];var gt=gq[9];var gs=gq[10];var gr=gq[11];gv[0]=gE;gv[1]=gB;gv[2]=gy;gv[3]=gt;gv[4]=gD;gv[5]=gA;gv[6]=gw;gv[7]=gs;
gv[8]=gC;gv[9]=gz;gv[10]=gu;gv[11]=gr;return gv},m43MulTranspose:function c1(gL,gK,gQ){var gR=gL[0];var gO=gL[1];var gN=gL[2];var gM=gL[3];var gJ=gL[4];var gI=gL[5];var gH=gL[6];var gF=gL[7];var gD=gL[8];var gC=gL[9];var gz=gL[10];var gy=gL[11];var gB=gK[0];var gA=gK[1];var gx=gK[2];var gw=gK[3];var gv=gK[4];var gu=gK[5];var gt=gK[6];var gs=gK[7];var gr=gK[8];var gq=gK[9];var gG=gK[10];var gE=gK[11];var gP=gQ;if(gP===undefined){gP=new c3(12)}gP[0]=(gB*gR+gw*gO+gt*gN);gP[1]=(gB*gM+gw*gJ+gt*gI);gP[2]=(gB*gH+gw*gF+gt*gD);gP[3]=(gB*gC+gw*gz+gt*gy+gq);gP[4]=(gA*gR+gv*gO+gs*gN);gP[5]=(gA*gM+gv*gJ+gs*gI);gP[6]=(gA*gH+gv*gF+gs*gD);gP[7]=(gA*gC+gv*gz+gs*gy+gG);gP[8]=(gx*gR+gu*gO+gr*gN);gP[9]=(gx*gM+gu*gJ+gr*gI);gP[10]=(gx*gH+gu*gF+gr*gD);gP[11]=(gx*gC+gu*gz+gr*gy+gE);return gP},m43Offset:function fo(gv,gu,gH){if(gH===undefined){gH=new c3(12)}var gt=gv[0];var gs=gv[1];var gr=gv[2];var gq=gv[3];var gG=gv[4];var gF=gv[5];var gD=gv[6];var gB=gv[7];var gA=gv[8];var gz=gv[9];var gE=gv[10];var gC=gv[11];
var gy=gu[0];var gx=gu[1];var gw=gu[2];gH[0]=gt;gH[1]=gs;gH[2]=gr;gH[3]=gq;gH[4]=gG;gH[5]=gF;gH[6]=gD;gH[7]=gB;gH[8]=gA;gH[9]=(gt*gy+gq*gx+gD*gw+gz);gH[10]=(gs*gy+gG*gx+gB*gw+gE);gH[11]=(gr*gy+gF*gx+gA*gw+gC);return gH},m43NegOffset:function f6(gv,gu,gH){if(gH===undefined){gH=new c3(12)}var gt=gv[0];var gs=gv[1];var gr=gv[2];var gq=gv[3];var gG=gv[4];var gF=gv[5];var gD=gv[6];var gB=gv[7];var gA=gv[8];var gz=gv[9];var gE=gv[10];var gC=gv[11];var gy=-gu[0];var gx=-gu[1];var gw=-gu[2];gH[0]=gt;gH[1]=gs;gH[2]=gr;gH[3]=gq;gH[4]=gG;gH[5]=gF;gH[6]=gD;gH[7]=gB;gH[8]=gA;gH[9]=(gt*gy+gq*gx+gD*gw+gz);gH[10]=(gs*gy+gG*gx+gB*gw+gE);gH[11]=(gr*gy+gF*gx+gA*gw+gC);return gH},m43InverseTransposeProjection:function ef(gB,gx,gH){if(gH===undefined){gH=new c3(12)}var gA=(0.5/gx[0]);var gr=(0.5/gx[1]);var gv=(0.5/gx[2]);var gu=(gB[0]*gA);var gt=(gB[1]*gA);var gs=(gB[2]*gA);var gq=(gB[3]*gr);var gG=(gB[4]*gr);var gF=(gB[5]*gr);var gE=(gB[6]*gv);var gD=(gB[7]*gv);var gC=(gB[8]*gv);var gz=gB[9];var gy=gB[10];var gw=gB[11];
gH[0]=gu;gH[1]=gt;gH[2]=gs;gH[3]=(0.5-((gz*gu)+(gy*gt)+(gw*gs)));gH[4]=gq;gH[5]=gG;gH[6]=gF;gH[7]=(0.5-((gz*gq)+(gy*gG)+(gw*gF)));gH[8]=gE;gH[9]=gD;gH[10]=gC;gH[11]=(0.5-((gz*gE)+(gy*gD)+(gw*gC)));return gH},m43ScalarAdd:function ev(gq,gr,gt){if(gt===undefined){gt=new c3(12)}for(var gs=0;gs<12;gs+=1){gt[gs]=(gq[gs]+gr)}return gt},m43ScalarSub:function ej(gq,gr,gt){if(gt===undefined){gt=new c3(12)}for(var gs=0;gs<12;gs+=1){gt[gs]=(gq[gs]-gr)}return gt},m43ScalarMul:function dC(gq,gr,gt){if(gt===undefined){gt=new c3(12)}for(var gs=0;gs<12;gs+=1){gt[gs]=(gq[gs]*gr)}return gt},m44BuildIdentity:function fU(gr){var gq=gr;if(gq===undefined){gq=new c3(16)}gq[0]=1;gq[1]=0;gq[2]=0;gq[3]=0;gq[4]=0;gq[5]=1;gq[6]=0;gq[7]=0;gq[8]=0;gq[9]=0;gq[10]=1;gq[11]=0;gq[12]=0;gq[13]=0;gq[14]=0;gq[15]=1;return gq},m44Build:function gc(gu,gr,gq,gv,gw){var gs;var gt=arguments.length;if(gt>=16){if(gt>16){gs=arguments[16];if(gs===undefined){gs=new c3(16)}}else{gs=new c3(16)}gs[0]=arguments[0];gs[1]=arguments[1];gs[2]=arguments[2];
gs[3]=arguments[3];gs[4]=arguments[4];gs[5]=arguments[5];gs[6]=arguments[6];gs[7]=arguments[7];gs[8]=arguments[8];gs[9]=arguments[9];gs[10]=arguments[10];gs[11]=arguments[11];gs[12]=arguments[12];gs[13]=arguments[13];gs[14]=arguments[14];gs[15]=arguments[15]}else{gs=gw;if(gs===undefined){gs=new c3(16)}gs[0]=gu[0];gs[1]=gu[1];gs[2]=gu[2];gs[3]=gu[3];gs[4]=gr[0];gs[5]=gr[1];gs[6]=gr[2];gs[7]=gr[3];gs[8]=gq[0];gs[9]=gq[1];gs[10]=gq[2];gs[11]=gq[3];gs[12]=gv[0];gs[13]=gv[1];gs[14]=gv[2];gs[15]=gv[3]}return gs},m44Copy:function cY(gq,gr){if(gr===undefined){gr=new c3(16)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];gr[3]=gq[3];gr[4]=gq[4];gr[5]=gq[5];gr[6]=gq[6];gr[7]=gq[7];gr[8]=gq[8];gr[9]=gq[9];gr[10]=gq[10];gr[11]=gq[11];gr[12]=gq[12];gr[13]=gq[13];gr[14]=gq[14];gr[15]=gq[15];return gr},m44Right:function cR(gq,gr){if(gr===undefined){return gq.slice(0,4)}gr[0]=gq[0];gr[1]=gq[1];gr[2]=gq[2];gr[3]=gq[3];return gr},m44Up:function dY(gq,gr){if(gr===undefined){return gq.slice(4,8)}gr[0]=gq[4];gr[1]=gq[5];
gr[2]=gq[6];gr[3]=gq[7];return gr},m44At:function cN(gq,gr){if(gr===undefined){return gq.slice(8,12)}gr[0]=gq[8];gr[1]=gq[9];gr[2]=gq[10];gr[3]=gq[11];return gr},m44Pos:function cp(gq,gr){if(gr===undefined){return gq.slice(12)}gr[0]=gq[12];gr[1]=gq[13];gr[2]=gq[14];gr[3]=gq[15];return gr},m44SetRight:function aH(gq,gr){gq[0]=gr[0];gq[1]=gr[1];gq[2]=gr[2];gq[3]=gr[3]},m44SetUp:function o(gq,gr){gq[4]=gr[0];gq[5]=gr[1];gq[6]=gr[2];gq[7]=gr[3]},m44SetAt:function e9(gq,gr){gq[8]=gr[0];gq[9]=gr[1];gq[10]=gr[2];gq[11]=gr[3]},m44SetPos:function V(gq,gr){gq[12]=gr[0];gq[13]=gr[1];gq[14]=gr[2];gq[15]=gr[3]},m44Translate:function c2(gq,gr){gq[12]+=gr[0];gq[13]+=gr[1];gq[14]+=gr[2];gq[15]+=gr[3]},m44Scale:function H(gq,gr,gs){if(gs===undefined){gs=new c3(16)}gs[0]=gq[0]*gr[0];gs[1]=gq[1]*gr[0];gs[2]=gq[2]*gr[0];gs[3]=gq[3];gs[4]=gq[4]*gr[1];gs[5]=gq[5]*gr[1];gs[6]=gq[6]*gr[1];gs[7]=gq[7];gs[8]=gq[8]*gr[2];gs[9]=gq[9]*gr[2];gs[10]=gq[10]*gr[2];gs[11]=gq[11];gs[12]=gq[12];gs[13]=gq[13];gs[14]=gq[14];
gs[15]=gq[15];return gs},m44Transform:function w(gr,gs,gw){var gq=gs[0];var gv=gs[1];var gu=gs[2];var gt=gs[3];if(gw===undefined){gw=new c3(4)}if(gt!==1){gw[0]=((gr[0]*gq)+(gr[4]*gv)+(gr[8]*gu)+(gr[12]*gt));gw[1]=((gr[1]*gq)+(gr[5]*gv)+(gr[9]*gu)+(gr[13]*gt));gw[2]=((gr[2]*gq)+(gr[6]*gv)+(gr[10]*gu)+(gr[14]*gt));gw[3]=((gr[3]*gq)+(gr[7]*gv)+(gr[11]*gu)+(gr[15]*gt))}else{gw[0]=((gr[0]*gq)+(gr[4]*gv)+(gr[8]*gu)+gr[12]);gw[1]=((gr[1]*gq)+(gr[5]*gv)+(gr[9]*gu)+gr[13]);gw[2]=((gr[2]*gq)+(gr[6]*gv)+(gr[10]*gu)+gr[14]);gw[3]=((gr[3]*gq)+(gr[7]*gv)+(gr[11]*gu)+gr[15])}return gw},m44Mul:function b4(gT,gS,gX){var gY=gT[0];var gW=gT[1];var gV=gT[2];var gU=gT[3];var gR=gT[4];var gQ=gT[5];var gP=gT[6];var gN=gT[7];var gL=gT[8];var gJ=gT[9];var gE=gT[10];var gC=gT[11];var gA=gT[12];var gy=gT[13];var gw=gT[14];var gu=gT[15];var gF=gS[0];var gD=gS[1];var gB=gS[2];var gz=gS[3];var gx=gS[4];var gv=gS[5];var gt=gS[6];var gs=gS[7];var gr=gS[8];var gq=gS[9];var gO=gS[10];var gM=gS[11];var gK=gS[12];var gI=gS[13];
var gH=gS[14];var gG=gS[15];if(gX===undefined){gX=new c3(16)}gX[0]=(gF*gY+gx*gW+gr*gV+gK*gU);gX[1]=(gD*gY+gv*gW+gq*gV+gI*gU);gX[2]=(gB*gY+gt*gW+gO*gV+gH*gU);gX[3]=(gz*gY+gs*gW+gM*gV+gG*gU);gX[4]=(gF*gR+gx*gQ+gr*gP+gK*gN);gX[5]=(gD*gR+gv*gQ+gq*gP+gI*gN);gX[6]=(gB*gR+gt*gQ+gO*gP+gH*gN);gX[7]=(gz*gR+gs*gQ+gM*gP+gG*gN);gX[8]=(gF*gL+gx*gJ+gr*gE+gK*gC);gX[9]=(gD*gL+gv*gJ+gq*gE+gI*gC);gX[10]=(gB*gL+gt*gJ+gO*gE+gH*gC);gX[11]=(gz*gL+gs*gJ+gM*gE+gG*gC);gX[12]=(gF*gA+gx*gy+gr*gw+gK*gu);gX[13]=(gD*gA+gv*gy+gq*gw+gI*gu);gX[14]=(gB*gA+gt*gy+gO*gw+gH*gu);gX[15]=(gz*gA+gs*gy+gM*gw+gG*gu);return gX},m44Inverse:function eH(gH,gV){var gx=gH[0];var gv=gH[1];var gt=gH[2];var gr=gH[3];var gU=gH[4];var gS=gH[5];var gQ=gH[6];var gO=gH[7];var gM=gH[8];var gK=gH[9];var gR=gH[10];var gP=gH[11];var gN=gH[12];var gL=gH[13];var gJ=gH[14];var gI=gH[15];if(gV===undefined){gV=new c3(16)}var gy=((gx*gS)-(gv*gU));var gw=((gx*gQ)-(gt*gU));var gu=((gx*gO)-(gr*gU));var gs=((gv*gQ)-(gt*gS));var gq=((gv*gO)-(gr*gS));var gT=((gt*gO)-(gr*gQ));
var gG=((gM*gL)-(gK*gN));var gF=((gM*gJ)-(gR*gN));var gE=((gM*gI)-(gP*gN));var gD=((gK*gJ)-(gR*gL));var gC=((gK*gI)-(gP*gL));var gB=((gR*gI)-(gP*gJ));var gA=((gy*gB)-(gw*gC)+(gu*gD)+(gs*gE)-(gq*gF)+(gT*gG));if(gA===0){gV[0]=0;gV[1]=0;gV[2]=0;gV[3]=0;gV[4]=0;gV[5]=0;gV[6]=0;gV[7]=0;gV[8]=0;gV[9]=0;gV[10]=0;gV[11]=0;gV[12]=0;gV[13]=0;gV[14]=0;gV[15]=0}else{var gz=1/gA;gV[0]=(+(gS*gB)-(gQ*gC)+(gO*gD))*gz;gV[4]=(-(gU*gB)+(gQ*gE)-(gO*gF))*gz;gV[8]=(+(gU*gC)-(gS*gE)+(gO*gG))*gz;gV[12]=(-(gU*gD)+(gS*gF)-(gQ*gG))*gz;gV[1]=(-(gv*gB)+(gt*gC)-(gr*gD))*gz;gV[5]=(+(gx*gB)-(gt*gE)+(gr*gF))*gz;gV[9]=(-(gx*gC)+(gv*gE)-(gr*gG))*gz;gV[13]=(+(gx*gD)-(gv*gF)+(gt*gG))*gz;gV[2]=(+(gL*gT)-(gJ*gq)+(gI*gs))*gz;gV[6]=(-(gN*gT)+(gJ*gu)-(gI*gw))*gz;gV[10]=(+(gN*gq)-(gL*gu)+(gI*gy))*gz;gV[14]=(-(gN*gs)+(gL*gw)-(gJ*gy))*gz;gV[3]=(-(gK*gT)+(gR*gq)-(gP*gs))*gz;gV[7]=(+(gM*gT)-(gR*gu)+(gP*gw))*gz;gV[11]=(-(gM*gq)+(gK*gu)-(gP*gy))*gz;gV[15]=(+(gM*gs)-(gK*gw)+(gR*gy))*gz}return gV},m44Transpose:function e1(gq,gr){if(gr===undefined){gr=new c3(16)
}gr[0]=gq[0];gr[1]=gq[4];gr[2]=gq[8];gr[3]=gq[12];gr[4]=gq[1];gr[5]=gq[5];gr[6]=gq[9];gr[7]=gq[13];gr[8]=gq[2];gr[9]=gq[6];gr[10]=gq[10];gr[11]=gq[14];gr[12]=gq[3];gr[13]=gq[7];gr[14]=gq[11];gr[15]=gq[15];return gr},m44ScalarAdd:function ao(gq,gr,gt){if(gt===undefined){gt=new c3(16)}for(var gs=0;gs<16;gs+=1){gt[gs]=(gq[gs]+gr)}return gt},m44ScalarSub:function X(gq,gr,gt){if(gt===undefined){gt=new c3(16)}for(var gs=0;gs<16;gs+=1){gt[gs]=(gq[gs]-gr)}return gt},m44ScalarMul:function gf(gq,gr,gt){if(gt===undefined){gt=new c3(16)}for(var gs=0;gs<16;gs+=1){gt[gs]=(gq[gs]*gr)}return gt},quatBuild:function eK(gq,gv,gt,gr,gu){var gs=gu;if(gs===undefined){gs=new c3(4)}gs[0]=gq;gs[1]=gv;gs[2]=gt;gs[3]=gr;return gs},quatCopy:function p(gr,gs){var gq=gs;if(gq===undefined){gq=new c3(4)}gq[0]=gr[0];gq[1]=gr[1];gq[2]=gr[2];gq[3]=gr[3];return gq},quatIsSimilar:function aj(gq,gv,gr){if(gr===undefined){gr=this.precision}var gu=gq;if(gq[3]*gv[3]<0){gu=f2.v4Neg(gq)}var gt=f2.v4LengthSq(f2.v4Sub(gu,gv));var gs=(gr*gr);
return gt<gs},quatLength:function ba(gq){return f2.v4Length(gq)},quatDot:function h(gq,gr){return f2.v4Dot(gq,gr)},quatMul:function cj(gy,gx,gz){if(gz===undefined){gz=new c3(4)}var gC=gy[0];var gB=gy[1];var gA=gy[2];var gD=gy[3];var gu=gx[0];var gs=gx[1];var gq=gx[2];var gw=gx[3];var gv=(gq*gB)-(gs*gA);var gt=(gu*gA)-(gq*gC);var gr=(gs*gC)-(gu*gB);gz[0]=(gC*gw)+(gu*gD)+gv;gz[1]=(gB*gw)+(gs*gD)+gt;gz[2]=(gA*gw)+(gq*gD)+gr;gz[3]=(gw*gD)-(gu*gC+gs*gB+gq*gA);return gz},quatMulTranslate:function bc(gI,gv,gH,gu,gr,gO){var gR=gI[0];var gQ=gI[1];var gP=gI[2];var gS=gI[3];var gF=gH[0];var gE=gH[1];var gD=gH[2];var gG=gH[3];var gz=(gP*gE)-(gQ*gD);var gy=(gR*gD)-(gP*gF);var gw=(gQ*gF)-(gR*gE);gr[0]=(gF*gS)+(gR*gG)+gz;gr[1]=(gE*gS)+(gQ*gG)+gy;gr[2]=(gD*gS)+(gP*gG)+gw;gr[3]=(gS*gG)-(gR*gF+gQ*gE+gP*gD);var gN=gv[0];var gL=gv[1];var gK=gv[2];var gt=gu[0];var gs=gu[1];var gq=gu[2];var gJ=(gS*gS)-(gR*gR+gQ*gQ+gP*gP);var gC=gt*gJ;var gB=gs*gJ;var gA=gq*gJ;gJ=gR*gt+gQ*gs+gP*gq;var gx=gJ+gJ;gC+=gR*gx;gB+=gQ*gx;
gA+=gP*gx;gz=(gP*gs)-(gQ*gq);gy=(gR*gq)-(gP*gt);gw=(gQ*gt)-(gR*gs);var gM=gS+gS;gC+=gz*gM;gB+=gy*gM;gA+=gw*gM;gO[0]=gC+gN;gO[1]=gB+gL;gO[2]=gA+gK},quatNormalize:function f0(gr,gt){var gs=f2.quatDot(gr,gr);if(gs===0){return f2.v4BuildZero(gt)}else{var gq=1/Math.sqrt(gs);return f2.v4ScalarMul(gr,gq,gt)}},quatConjugate:function eR(gq,gr){if(gr===undefined){gr=new c3(4)}gr[0]=-gq[0];gr[1]=-gq[1];gr[2]=-gq[2];gr[3]=gq[3];return gr},quatLerp:function s(gv,gu,gA,gw){if(gw===undefined){gw=new c3(4)}var gs=gv[0];var gr=gv[1];var gq=gv[2];var gt=gv[3];var gz=gu[0];var gy=gu[1];var gx=gu[2];var gB=gu[3];gw[0]=((gz-gs)*gA)+gs;gw[1]=((gy-gr)*gA)+gr;gw[2]=((gx-gq)*gA)+gq;gw[3]=((gB-gt)*gA)+gt;return gw},cosMinSlerpAngle:Math.cos(Math.PI/40),quatSlerp:function cO(gs,gr,gu,gO){var gP=gO;if(gP===undefined){gP=new c3(4)}var gz=gs[0];var gy=gs[1];var gx=gs[2];var gA=gs[3];var gL=gr[0];var gK=gr[1];var gJ=gr[2];var gN=gr[3];var gw=(gz*gL)+(gy*gK)+(gx*gJ)+(gA*gN);var gB=gw;if(gB<0){gz=-gz;gy=-gy;gx=-gx;gA=-gA;
gB=-gB}if(gB>f2.cosMinSlerpAngle){if(gB>(1-0.000001)){gP[0]=gz;gP[1]=gy;gP[2]=gx;gP[3]=gA;return gP}var gH=gu;if(gw<=0){gH=-gu}var gF=((gL-gz)*gH)+gz;var gE=((gK-gy)*gH)+gy;var gC=((gJ-gx)*gH)+gx;var gG=((gN-gA)*gH)+gA;var gq=Math.sqrt((gF*gF)+(gE*gE)+(gC*gC)+(gG*gG));var gt=1/gq;gP[0]=gF*gt;gP[1]=gE*gt;gP[2]=gC*gt;gP[3]=gG*gt;return gP}var gI=Math.sin;var gv=Math.acos(gB);var gD=1/gI(gv);var gM=gI((1-gu)*gv)*gD;gz=gz*gM;gy=gy*gM;gx=gx*gM;gA=gA*gM;gM=gI(gu*gv)*gD;gL=gL*gM;gK=gK*gM;gJ=gJ*gM;gN=gN*gM;gP[0]=gz+gL;gP[1]=gy+gK;gP[2]=gx+gJ;gP[3]=gA+gN;return gP},quatFromM43:function aE(gA,gH){var gt=gA[0];var gs=gA[1];var gr=gA[2];var gq=gA[3];var gG=gA[4];var gF=gA[5];var gE=gA[6];var gD=gA[7];var gC=gA[8];var gw,gv,gu,gx,gy;var gB=gt+gG+gC+1;if(gB>f2.precision){gx=Math.sqrt(gB)/2;gw=(gF-gD)/(4*gx);gv=(gE-gr)/(4*gx);gu=(gs-gq)/(4*gx)}else{if((gt>gG)&&(gt>gC)){gy=Math.sqrt(1+gt-gG-gC)*2;gx=(gF-gD)/gy;gw=0.25*gy;gv=(gq+gs)/gy;gu=(gE+gr)/gy}else{if(gG>gC){gy=Math.sqrt(1+gG-gt-gC)*2;gx=(gE-gr)/gy;
gw=(gq+gs)/gy;gv=0.25*gy;gu=(gD+gF)/gy}else{gy=Math.sqrt(1+gC-gt-gG)*2;gx=(gs-gq)/gy;gw=(gE+gr)/gy;gv=(gD+gF)/gy;gu=0.25*gy}}}var gz=f2.quatNormalize([gw,gv,gu,gx],gH);return f2.quatConjugate(gz,gH)},quatFromAxisRotation:function b1(gs,gt,gw){var gv=0.5*gt;var gr=Math.sin(gv);var gu=Math.cos(gv);var gq=gw;if(gq===undefined){gq=new c3(4)}gq[0]=gs[0]*gr;gq[1]=gs[1]*gr;gq[2]=gs[2]*gr;gq[3]=gu;return f2.quatNormalize(gq,gq)},quatToAxisRotation:function ds(gr,gv){if(gv===undefined){gv=new c3(4)}var gu=gr[3];var gt=Math.acos(gu)*2;var gq=1-gu*gu;if(gq<f2.precision){gv[0]=1;gv[1]=0;gv[2]=0;gv[3]=gt}else{var gs=1/Math.sqrt(gq);gv[0]=gr[0]*gs;gv[1]=gr[1]*gs;gv[2]=gr[2]*gs;gv[3]=gt}return gv},quatTransformVector:function bq(gB,gx,gI){var gG=gB[0];var gF=gB[1];var gE=gB[2];var gH=gB[3];var gC=gx[0];var gA=gx[1];var gz=gx[2];var gy=(gH*gH)-(gG*gG+gF*gF+gE*gE);var gw=gC*gy;var gv=gA*gy;var gu=gz*gy;gy=gG*gC+gF*gA+gE*gz;var gr=gy+gy;gw+=gG*gr;gv+=gF*gr;gu+=gE*gr;var gt=(gE*gA)-(gF*gz);var gs=(gG*gz)-(gE*gC);
var gq=(gF*gC)-(gG*gA);var gD=gH+gH;gw+=gt*gD;gv+=gs*gD;gu+=gq*gD;if(gI===undefined){gI=new c3(3)}gI[0]=gw;gI[1]=gv;gI[2]=gu;return gI},quatEqual:function fN(gr,gt,gs){if(gs===undefined){gs=this.precision}var gq=Math.abs;return(gq(gr[0]-gt[0])<=gs&&gq(gr[1]-gt[1])<=gs&&gq(gr[2]-gt[2])<=gs&&gq(gr[3]-gt[3])<=gs)},quatPosBuild:function fA(gw,gt,gs,gy,gx,gv,gu,gr){var gq;if(arguments.length<7){gq=gs;if(gq===undefined){gq=new c3(7)}gq[0]=gw[0];gq[1]=gw[1];gq[2]=gw[2];gq[3]=gw[3];gq[4]=gt[0];gq[5]=gt[1];gq[6]=gt[2]}else{gq=gr;if(gq===undefined){gq=new c3(7)}gq[0]=gw;gq[1]=gt;gq[2]=gs;gq[3]=gy;gq[4]=gx;gq[5]=gv;gq[6]=gu}return gq},quatPosTransformVector:function fV(gq,gs,gr){return f2.quatTransformVector(gq,gs,gr)},quatPosTransformPoint:function b9(gq,gs){var gt=gq.slice(4,7);var gr=f2.quatTransformVector(gq,gs);return f2.v3Add(gr,gt)},quatPosMul:function eF(gs,gr){var gt=gr.slice(4,7);var gq=f2.quatMul(gs,gr);var gu=f2.quatPosTransformPoint(gs,gt);gq[4]=gu[0];gq[5]=gu[1];gq[6]=gu[2];return gq
},isVisibleBox:function ak(gr,gM,gJ){var gH=Math.abs;var gz=gr[0];var gy=gr[1];var gx=gr[2];var gG=gM[0];var gF=gM[1];var gE=gM[2];var gZ=gJ[0];var gY=gJ[1];var gX=gJ[2];var gW=gJ[3];var gU=gJ[4];var gS=gJ[5];var gR=gJ[6];var gQ=gJ[7];var gP=gJ[8];var gO=gJ[9];var gV=gJ[10];var gT=gJ[11];var gN=(gZ*gG);var gL=(gY*gG);var gK=(gX*gG);var gI=(gW*gG);var gD=(gU*gF);var gC=(gS*gF);var gB=(gR*gF);var gA=(gQ*gF);var gs=(gP*gE);var gq=(gO*gE);var g1=(gV*gE);var g0=(gT*gE);var gw=(gZ*gz+gU*gy+gP*gx+gJ[12]);var gv=(gY*gz+gS*gy+gO*gx+gJ[13]);var gu=(gX*gz+gR*gy+gV*gx+gJ[14]);var gt=(gW*gz+gQ*gy+gT*gx+gJ[15]);return !(((gw-gt)>(gH(gN-gI)+gH(gD-gA)+gH(gs-g0)))||((gw+gt)<-(gH(gN+gI)+gH(gD+gA)+gH(gs+g0)))||((gv-gt)>(gH(gL-gI)+gH(gC-gA)+gH(gq-g0)))||((gv+gt)<-(gH(gL+gI)+gH(gC+gA)+gH(gq+g0)))||((gu-gt)>(gH(gK-gI)+gH(gB-gA)+gH(g1-g0)))||((gu+gt)<-(gH(gK+gI)+gH(gB+gA)+gH(g1+g0)))||((gt+gt)<-(gH(gI+gI)+gH(gA+gA)+gH(g0+g0))))},isVisibleBoxOrigin:function aJ(gv,gq){var gH=Math.abs;var gy=gv[0];var gx=gv[1];var gw=gv[2];
var gL=(gq[0]*gy);var gK=(gq[1]*gy);var gJ=(gq[2]*gy);var gI=(gq[3]*gy);var gu=(gq[4]*gx);var gt=(gq[5]*gx);var gs=(gq[6]*gx);var gr=(gq[7]*gx);var gD=(gq[8]*gw);var gB=(gq[9]*gw);var gA=(gq[10]*gw);var gz=(gq[11]*gw);var gG=gq[12];var gF=gq[13];var gE=gq[14];var gC=gq[15];return !(((gG-gC)>(gH(gL-gI)+gH(gu-gr)+gH(gD-gz)))||((gG+gC)<-(gH(gL+gI)+gH(gu+gr)+gH(gD+gz)))||((gF-gC)>(gH(gK-gI)+gH(gt-gr)+gH(gB-gz)))||((gF+gC)<-(gH(gK+gI)+gH(gt+gr)+gH(gB+gz)))||((gE-gC)>(gH(gJ-gI)+gH(gs-gr)+gH(gA-gz)))||((gE+gC)<-(gH(gJ+gI)+gH(gs+gr)+gH(gA+gz)))||((gC+gC)<-(gH(gI+gI)+gH(gr+gr)+gH(gz+gz))))},isVisibleSphere:function u(gr,gL,gH){var gF=Math.abs;var gA=gr[0];var gz=gr[1];var gy=gr[2];var gX=gH[0];var gW=gH[1];var gV=gH[2];var gU=gH[3];var gS=gH[4];var gQ=gH[5];var gP=gH[6];var gO=gH[7];var gN=gH[8];var gM=gH[9];var gT=gH[10];var gR=gH[11];var gK=gX;var gJ=gW;var gI=gV;var gG=gU;var gE=gS;var gD=gQ;var gC=gP;var gB=gO;var gs=gN;var gq=gM;var gZ=gT;var gY=gR;var gx=(gX*gA+gS*gz+gN*gy+gH[12]);var gv=(gW*gA+gQ*gz+gM*gy+gH[13]);
var gu=(gV*gA+gP*gz+gT*gy+gH[14]);var gt=(gU*gA+gO*gz+gR*gy+gH[15]);var gw=-gL;return !(((gx-gt)>gL*(gF(gK-gG)+gF(gE-gB)+gF(gs-gY)))||((gx+gt)<gw*(gF(gK+gG)+gF(gE+gB)+gF(gs+gY)))||((gv-gt)>gL*(gF(gJ-gG)+gF(gD-gB)+gF(gq-gY)))||((gv+gt)<gw*(gF(gJ+gG)+gF(gD+gB)+gF(gq+gY)))||((gu-gt)>gL*(gF(gI-gG)+gF(gC-gB)+gF(gZ-gY)))||((gu+gt)<gw*(gF(gI+gG)+gF(gC+gB)+gF(gZ+gY)))||((gt+gt)<gw*(gF(gG+gG)+gF(gB+gB)+gF(gY+gY))))},isVisibleSphereOrigin:function fx(gw,gr){var gE=Math.abs;var gJ=gr[0];var gI=gr[1];var gH=gr[2];var gG=gr[3];var gv=gr[4];var gu=gr[5];var gt=gr[6];var gs=gr[7];var gB=gr[8];var gz=gr[9];var gy=gr[10];var gx=gr[11];var gF=gr[12];var gD=gr[13];var gC=gr[14];var gA=gr[15];var gq=-gw;return !(((gF-gA)>gw*(gE(gJ-gG)+gE(gv-gs)+gE(gB-gx)))||((gF+gA)<gq*(gE(gJ+gG)+gE(gv+gs)+gE(gB+gx)))||((gD-gA)>gw*(gE(gI-gG)+gE(gu-gs)+gE(gz-gx)))||((gD+gA)<gq*(gE(gI+gG)+gE(gu+gs)+gE(gz+gx)))||((gC-gA)>gw*(gE(gH-gG)+gE(gt-gs)+gE(gy-gx)))||((gC+gA)<gq*(gE(gH+gG)+gE(gt+gs)+gE(gy+gx)))||((gA+gA)<gq*(gE(gG+gG)+gE(gs+gs)+gE(gx+gx))))
},isVisibleSphereUnit:function e0(gq){var gC=Math.abs;var gH=gq[0];var gG=gq[1];var gF=gq[2];var gE=gq[3];var gu=gq[4];var gt=gq[5];var gs=gq[6];var gr=gq[7];var gz=gq[8];var gx=gq[9];var gw=gq[10];var gv=gq[11];var gD=gq[12];var gB=gq[13];var gA=gq[14];var gy=gq[15];return !(((gD-gy)>(gC(gH-gE)+gC(gu-gr)+gC(gz-gv)))||((gD+gy)<-(gC(gH+gE)+gC(gu+gr)+gC(gz+gv)))||((gB-gy)>(gC(gG-gE)+gC(gt-gr)+gC(gx-gv)))||((gB+gy)<-(gC(gG+gE)+gC(gt+gr)+gC(gx+gv)))||((gA-gy)>(gC(gF-gE)+gC(gs-gr)+gC(gw-gv)))||((gA+gy)<-(gC(gF+gE)+gC(gs+gr)+gC(gw+gv)))||((gy+gy)<-(gC(gE+gE)+gC(gr+gr)+gC(gv+gv))))},transformBox:function at(gG,gE,gD){var gz=Math.abs;var gu=gD[0];var gs=gD[1];var gr=gD[2];var gq=gD[3];var gK=gD[4];var gJ=gD[5];var gI=gD[6];var gH=gD[7];var gF=gD[8];var gC=gG[0];var gB=gG[1];var gA=gG[2];var gy=gE[0];var gw=gE[1];var gv=gE[2];var gx=new c3(3);gx[0]=gu*gC+gq*gB+gI*gA+gD[9];gx[1]=gs*gC+gK*gB+gH*gA+gD[10];gx[2]=gr*gC+gJ*gB+gF*gA+gD[11];var gt=new c3(3);gt[0]=gz(gu)*gy+gz(gq)*gw+gz(gI)*gv;gt[1]=gz(gs)*gy+gz(gK)*gw+gz(gH)*gv;
gt[2]=gz(gr)*gy+gz(gJ)*gw+gz(gF)*gv;return{center:gx,halfExtents:gx}},planeNormalize:function bI(gs,gu){if(gu===undefined){gu=new c3(4)}var gr=gs[0];var gq=gs[1];var gw=gs[2];var gv=((gr*gr)+(gq*gq)+(gw*gw));if(gv>0){var gt=1/Math.sqrt(gv);gu[0]=(gr*gt);gu[1]=(gq*gt);gu[2]=(gw*gt);gu[3]=(gs[3]*gt)}else{gu[0]=0;gu[1]=0;gu[2]=0;gu[3]=0}return gu},extractFrustumPlanes:function c6(gx,gw){var gu=f2.planeNormalize;var gt=gx[0];var gs=gx[1];var gr=gx[2];var gq=gx[3];var gJ=gx[4];var gI=gx[5];var gG=gx[6];var gE=gx[7];var gC=gx[8];var gA=gx[9];var gH=gx[10];var gF=gx[11];var gD=gx[12];var gB=gx[13];var gz=gx[14];var gy=gx[15];var gv=(gw||[]);gv[0]=gu([(gq+gt),(gE+gJ),(gF+gC),-(gy+gD)],gv[0]);gv[1]=gu([(gq-gt),(gE-gJ),(gF-gC),-(gy-gD)],gv[1]);gv[2]=gu([(gq-gs),(gE-gI),(gF-gA),-(gy-gB)],gv[2]);gv[3]=gu([(gq+gs),(gE+gI),(gF+gA),-(gy+gB)],gv[3]);gv[4]=gu([(gq+gr),(gE+gG),(gF+gH),-(gy+gz)],gv[4]);gv[5]=gu([(gq-gr),(gE-gG),(gF-gH),-(gy-gz)],gv[5]);return gv},isInsidePlanesPoint:function aK(gu,gs){var gx=gu[0];
var gv=gu[1];var gt=gu[2];var gr=gs.length;var gw=0;do{var gq=gs[gw];if((gq[0]*gx+gq[1]*gv+gq[2]*gt)<gq[3]){return false}gw+=1}while(gw<gr);return true},isInsidePlanesSphere:function cL(gy,gq,gv){var gw=gy[0];var gu=gy[1];var gt=gy[2];var gs=gv.length;var gr=0;do{var gx=gv[gr];if((gx[0]*gw+gx[1]*gu+gx[2]*gt)<(gx[3]-gq)){return false}gr+=1}while(gr<gs);return true},isInsidePlanesBox:function ge(gI,gG,gB){var gF=gI[0];var gD=gI[1];var gC=gI[2];var gx=gG[0];var gw=gG[1];var gv=gG[2];var gt=(gF+gx);var gs=(gD+gw);var gr=(gC+gv);var gA=(gF-gx);var gz=(gD-gw);var gy=(gC-gv);var gH=gB.length;var gE=0;do{var gu=gB[gE];var gq=gu[0];var gK=gu[1];var gJ=gu[2];if((gq*(gq<0?gA:gt)+gK*(gK<0?gz:gs)+gJ*(gJ<0?gy:gr))<gu[3]){return false}gE+=1}while(gE<gH);return true},extractIntersectingPlanes:function cy(gB,gw){var gA=gB[0];var gz=gB[1];var gy=gB[2];var gF=gB[3];var gE=gB[4];var gD=gB[5];var gv=gw.length;var gt=[];var gC=0;var gu=0;do{var gx=gw[gu];var gs=gx[0];var gr=gx[1];var gq=gx[2];if((gs*(gs>0?gA:gF)+gr*(gr>0?gz:gE)+gq*(gq>0?gy:gD))<gx[3]){gt[gC]=gx;
gC+=1}gu+=1}while(gu<gv);return gt}};if(typeof Float32Array!=="undefined"){var bd=new Float32Array([1,2,3]);bd[0]=f2.FLOAT_MAX;f2.FLOAT_MAX=bd[0];c3=Float32Array}f2.arrayConstructor=c3;if(TurbulenzEngine.hasOwnProperty("VMath")){TurbulenzEngine.VMath=f2}var a7={skipAsserts:false,assert:function Z(gr,gq){if(!gr){if(!this.skipAsserts){this.breakInDebugger.doesNotExist()}}},beget:function f1(gr){var gq=function(){};gq.prototype=gr;return new gq()},log:function aM(gr,gq){var gs=window.console;if(gs){switch(arguments.length){case 1:gs.log(arguments[0]);break;case 2:gs.log(arguments[0],arguments[1]);break;case 3:gs.log(arguments[0],arguments[1],arguments[2]);break;case 4:gs.log(arguments[0],arguments[1],arguments[2],arguments[3]);break;default:var gt=[].splice.call(arguments,0);gs.log(gt.join(" "));break}}},nearestLowerPow2:function fb(gq){gq=gq|(gq>>>1);gq=gq|(gq>>>2);gq=gq|(gq>>>4);gq=gq|(gq>>>8);gq=gq|(gq>>>16);return(gq-(gq>>>1))},nearestUpperPow2:function de(gq){gq=gq-1;gq=gq|(gq>>>1);gq=gq|(gq>>>2);
gq=gq|(gq>>>4);gq=gq|(gq>>>8);gq=gq|(gq>>>16);return(gq+1)},ajax:function dm(gw){var gE="";var gq=gw.method;var gz=gw.data||{};var gA=gw.encrypt;var gu=null;var gs=gw.url;var gv=gw.requestHandler;var gC=gw.callback;if(gA){gz.requestUrl=gs;var gD=JSON.stringify(gz);if(gq==="POST"){gD=TurbulenzEngine.encrypt(gD)}gE+="data="+encodeURIComponent(gD)+"&";gE+="gameSessionId="+encodeURIComponent(gz.gameSessionId);gu=TurbulenzEngine.generateSignature(gD)}else{if(gz){var gF;for(gF in gz){if(gz.hasOwnProperty(gF)){if(gE.length!==0){gE+="&"}if(gq==="POST"){gE+=gF+"="+gz[gF]}else{gE+=encodeURIComponent(gF)+"="+encodeURIComponent(gz[gF])}}}}}var gB=function gx(gI,gH){var gK=this.xhr;this.xhr.onreadystatechange=null;this.xhr=null;var gG;gG=JSON.parse(gI);if(gA){var gJ=gK.getResponseHeader("X-TZ-Signature");var gL=TurbulenzEngine.verifySignature(gI,gJ);gI=null;TurbulenzEngine.setTimeout(function(){var gM=gG.requestUrl;if(gL){if(!TurbulenzEngine.encryptionEnabled||gM===gs){gC(gG,gH);gC=null;return}}if(gH===400){gC(gG,gH,"Verification Failed")
}else{gC({msg:"Verification failed",ok:false},400,"Verification Failed")}gC=null},0)}else{gI=null;TurbulenzEngine.setTimeout(function(){gC(gG,gH);gC=null},0)}};var gy=function gt(gG,gI,gL){var gK;if(window.XMLHttpRequest){gK=new window.XMLHttpRequest()}else{if(window.ActiveXObject){gK=new window.ActiveXObject("Microsoft.XMLHTTP")}else{if(gw.error){gw.error("No XMLHTTPRequest object could be created")}return}}gL.xhr=gK;var gJ=function gH(){if(gK.readyState===4&&TurbulenzEngine&&!TurbulenzEngine.isUnloading()){var gO=gK.responseText;var gN=gK.status;var gM=(gN!==0&&gK.statusText)||"No connection or cross domain request";if(gK.getAllResponseHeaders()===""&&gO===""&&gN===200&&gM==="OK"){gI("",0);return}gI.call(gL,gO,gN)}};gK.open(gq,((gE&&(gq!=="POST"))?gG+"?"+gE:gG),true);if(gC){gK.onreadystatechange=gJ}if(gu){gK.setRequestHeader("X-TZ-Signature",gu)}if(gq==="POST"){gK.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");gK.send(gE)}else{gK.send()}};if(gv){gv.request({src:gs,requestFn:gy,responseFilter:gw.responseFilter,onload:gB})
}else{var gr={src:gs};gy(gs,gB,gr)}},ajaxStatusCodes:{0:"No Connection, Timeout Or Cross Domain Request",100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested range not satisfiable",417:"Expectation Failed",429:"Too Many Requests",480:"Temporarily Unavailable",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported"}};
var j={v2ToArray:function J(gq){return[gq[0],gq[1]]},arrayToV2:function dk(gq,gr,gs){return gq.v2Build(gr[0],gr[1],gs)},v3ToArray:function go(gq){return[gq[0],gq[1],gq[2]]},arrayToV3:function bE(gr,gq,gs){return gr.v3Build(gq[0],gq[1],gq[2],gs)},v4ToArray:function bo(gq){return[gq[0],gq[1],gq[2],gq[3]]},arrayToV4:function r(gr,gq,gs){return gr.v4Build(gq[0],gq[1],gq[2],gq[3],gs)},quatToArray:function dE(gq){return[gq[0],gq[1],gq[2],gq[3]]},arrayToQuat:function ad(gr,gq,gs){return gr.quatBuild(gq[0],gq[1],gq[2],gq[3],gs)},aabbToArray:function v(gq){return[gq[0],gq[1],gq[2],gq[3],gq[4],gq[5]]},arrayToAABB:function ad(gq,gs,gr){return gq.aabbBuild(gs[0],gs[1],gs[2],gs[3],gs[4],gs[5],gr)},quatPosToArray:function c9(gq){return[gq[0],gq[1],gq[2],gq[3],gq[4],gq[5],gq[6]]},arrayToQuatPos:function dV(gr,gs,gq){return gr.quatPosBuild(gs[0],gs[1],gs[2],gs[3],gs[4],gs[5],gs[6],gq)},m33ToArray:function L(gq){return[gq[0],gq[1],gq[2],gq[3],gq[4],gq[5],gq[6],gq[7],gq[8]]},arrayToM33:function dA(gr,gs,gq){return gr.m33Build(gs[0],gs[1],gs[2],gs[3],gs[4],gs[5],gs[6],gs[7],gs[8],gq)
},m43ToArray:function eU(gq){return[gq[0],gq[1],gq[2],gq[3],gq[4],gq[5],gq[6],gq[7],gq[8],gq[9],gq[10],gq[11]]},arrayToM43:function ez(gr,gs,gq){return gr.m43Build(gs[0],gs[1],gs[2],gs[3],gs[4],gs[5],gs[6],gs[7],gs[8],gs[9],gs[10],gs[11],gq)},m34ToArray:function bR(gq){return[gq[0],gq[1],gq[2],gq[3],gq[4],gq[5],gq[6],gq[7],gq[8],gq[9],gq[10],gq[11]]},m44ToArray:function m(gq){return[gq[0],gq[1],gq[2],gq[3],gq[4],gq[5],gq[6],gq[7],gq[8],gq[9],gq[10],gq[11],gq[12],gq[13],gq[14],gq[15]]},arrayToM44:function cX(gq,gr,gs){return gq.m44Build(gr[0],gr[1],gr[2],gr[3],gr[4],gr[5],gr[6],gr[7],gr[8],gr[9],gr[10],gr[11],gr[12],gr[13],gr[14],gr[15],gs)}};var fq=(function(){function gq(){}gq.prototype.add=function(){this.referenceCount+=1};gq.prototype.remove=function(){this.referenceCount-=1;if(this.referenceCount===0){if(this.destroyedObserver){this.destroyedObserver.notify(this.object)}this.object.destroy();this.object=null}};gq.prototype.subscribeDestroyed=function(gr){if(!this.destroyedObserver){this.destroyedObserver=e3.create()
}this.destroyedObserver.subscribe(gr)};gq.prototype.unsubscribeDestroyed=function(gr){this.destroyedObserver.unsubscribe(gr)};gq.create=function(gs){var gr=new gq();gr.object=gs;gr.referenceCount=0;return gr};gq.version=1;return gq})();var ay={profiles:{},sortMode:{alphabetical:0,duration:1,max:2,min:3,calls:4},start:function z(gq){var gr=this.profiles[gq];if(!gr){gr={name:gq,calls:0,duration:0,min:Number.MAX_VALUE,max:0,sumOfSquares:0};this.profiles[gq]=gr}gr.start=TurbulenzEngine.time},stop:function du(gr){var gq=TurbulenzEngine.time;var gs=this.profiles[gr];if(gs){var gt=gq-gs.start;gs.duration+=gt;gs.calls+=1;gs.sumOfSquares+=gt*gt;if(gt>gs.max){gs.max=gt}if(gt<gs.min){gs.min=gt}}},reset:function bA(){this.profiles={}},getReport:function fO(gB,gG){var gJ=[];var gI;var gx=0;var gK;for(gK in this.profiles){if(this.profiles.hasOwnProperty(gK)){gI=this.profiles[gK];if(gx<gI.duration){gx=gI.duration}gJ.push(gI)}}var gE;if(gB===ay.sortMode.alphabetical){gE=function gs(gM,gL){return(gM.name<gL.name)?-1:(gM.name>gL.name)?1:0
}}else{if(gB===ay.sortMode.max){gE=function gy(gM,gL){return gL.max-gM.max}}else{if(gB===ay.sortMode.min){gE=function gw(gM,gL){return gL.min-gM.min}}else{if(gB===ay.sortMode.calls){gE=function gq(gM,gL){return gL.calls-gM.calls}}else{gE=function gr(gM,gL){return gL.duration-gM.duration}}}}}gJ.sort(gE);var gz;var gA="";var gH=gG?gG.precision:8;var gu=gG?gG.percentagePrecision:1;var gD=gG?gG.seperator:" ";var gt=gJ.length;var gC;var gF;var gv;for(gv=0;gv<gt;gv+=1){gI=gJ[gv];gz=gI.name;gz+=gD+gI.calls;gz+=gD+gI.duration.toFixed(gH);gz+=gD+gI.max.toFixed(gH);gz+=gD+gI.min.toFixed(gH);gF=gI.duration/gI.calls;gz+=gD+gF.toFixed(gH);gC=Math.sqrt(gI.sumOfSquares/gI.calls-gF*gF);gz+=gD+gC.toFixed(gH);gz+=gD+(100*gI.duration/gx).toFixed(gu)+"%\n";gA+=gz}return gA}};var f3={};f3.createArray=function A(gq){var gs={};var gu=[];if(gq.head){gq=gq.head}var gt=function gr(gy){var gv=gs[gy.url];if(!gv){gv={};gs[gy.url]=gv}var gC=gy.functionName===""?"(anonymous)":gy.functionName;var gx=gv[gC];if(!gx){gx={};
gv[gC]=gx}var gB=gx[gy.lineNumber];if(!gB){var gD={functionName:gC,numberOfCalls:gy.numberOfCalls,totalTime:gy.totalTime,selfTime:gy.selfTime,url:gy.url,lineNumber:gy.lineNumber};gu[gu.length]=gD;gx[gy.lineNumber]=gD}else{gB.totalTime+=gy.totalTime;gB.selfTime+=gy.selfTime;gB.numberOfCalls+=gy.numberOfCalls}var gw=typeof gy.children==="function"?gy.children():gy.children;if(gw){var gA=gw.length;var gz;for(gz=0;gz<gA;gz+=1){gt(gw[gz])}}};gt(gq);return gu};f3.sort=function cC(gu,gq,gs){if(!gq){gq="totalTime"}var gr=function(gw,gv){return gw[gq]-gv[gq]};var gt=function(gw,gv){return gv[gq]-gw[gq]};if(gs===false){gu.sort(gr)}else{gu.sort(gt)}};var x=(function(){function gq(gt,gs,gr){this.escapeNodeOffset=gs;this.externalNode=gr;this.extents=gt;return this}gq.prototype.isLeaf=function(){return !!this.externalNode};gq.prototype.reset=function(gv,gu,gt,gs,gr,gz,gw,gx){this.escapeNodeOffset=gw;this.externalNode=gx;var gy=this.extents;gy[0]=gv;gy[1]=gu;gy[2]=gt;gy[3]=gs;gy[4]=gr;gy[5]=gz};gq.prototype.clear=function(){this.escapeNodeOffset=1;
this.externalNode=undefined;var gs=this.extents;var gr=Number.MAX_VALUE;gs[0]=gr;gs[1]=gr;gs[2]=gr;gs[3]=-gr;gs[4]=-gr;gs[5]=-gr};gq.create=function(gt,gs,gr){return new gq(gt,gs,gr)};gq.version=1;return gq})();var af=(function(){function gq(gr){this.numNodesLeaf=4;this.nodes=[];this.endNode=0;this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.numUpdates=0;this.numExternalNodes=0;this.startUpdate=2147483647;this.endUpdate=-2147483647;this.highQuality=gr;this.ignoreY=false;this.nodesStack=new Array(32)}gq.prototype.add=function(gs,gu){var gr=this.endNode;gs.spatialIndex=gr;var gt=new this.arrayConstructor(6);gt[0]=gu[0];gt[1]=gu[1];gt[2]=gu[2];gt[3]=gu[3];gt[4]=gu[4];gt[5]=gu[5];this.nodes[gr]=x.create(gt,1,gs);this.endNode=(gr+1);this.needsRebuild=true;this.numAdds+=1;this.numExternalNodes+=1};gq.prototype.remove=function(gu){var gt=gu.spatialIndex;if(gt!==undefined){if(this.numExternalNodes>1){var gs=this.nodes;gs[gt].clear();var gr=this.endNode;if((gt+1)>=gr){while(!gs[gr-1].externalNode){gr-=1
}this.endNode=gr}else{this.needsRebuild=true}this.numExternalNodes-=1}else{this.clear()}gu.spatialIndex=undefined}};gq.prototype.findParent=function(gv){var gr=this.nodes;var gs=gv;var gu=0;var gt;do{gs-=1;gu+=1;gt=gr[gs]}while(gt.escapeNodeOffset<=gu);return gt};gq.prototype.update=function(gx,gA){var gy=gx.spatialIndex;if(gy!==undefined){var gr=gA[0];var gH=gA[1];var gG=gA[2];var gD=gA[3];var gB=gA[4];var gz=gA[5];var gw=this.needsRebuild;var gF=this.needsRebound;var gs=this.nodes;var gv=gs[gy];var gu=gv.extents;var gE=(gw||gF||gu[0]>gr||gu[1]>gH||gu[2]>gG||gu[3]<gD||gu[4]<gB||gu[5]<gz);gu[0]=gr;gu[1]=gH;gu[2]=gG;gu[3]=gD;gu[4]=gB;gu[5]=gz;if(gE){if(!gw&&1<gs.length){this.numUpdates+=1;if(this.startUpdate>gy){this.startUpdate=gy}if(this.endUpdate<gy){this.endUpdate=gy}if(!gF){if((2*this.numUpdates)>this.numExternalNodes){this.needsRebound=true}else{var gC=this.findParent(gy);var gt=gC.extents;if(gt[0]>gr||gt[1]>gH||gt[2]>gG||gt[3]<gD||gt[4]<gB||gt[5]<gz){this.needsRebound=true}}}else{if(this.numUpdates>(3*this.numExternalNodes)){this.needsRebuild=true;
this.numAdds=this.numUpdates}}}}}else{this.add(gx,gA)}};gq.prototype.needsFinalize=function(){return(this.needsRebuild||this.needsRebound)};gq.prototype.finalize=function(){if(this.needsRebuild){this.rebuild()}else{if(this.needsRebound){this.rebound()}}};gq.prototype.rebound=function(){var gw=this.nodes;if(gw.length>1){var gA=this.startUpdate;var gy=this.endUpdate;var gv=this.nodesStack;var gJ=0;var gu=0;for(;;){var gs=gw[gu];var gt=gu;var gx=(gu+gs.escapeNodeOffset);var gC=(gu+1);var gz;do{gz=gw[gC];var gr=(gC+gz.escapeNodeOffset);if(gC<gy){if(!gz.externalNode){if(gr>gA){gv[gJ]=gu;gJ+=1;gu=gC}}}else{break}gC=gr}while(gC<gx);if(gu===gt){gC=(gu+1);gz=gw[gC];var gB=gz.extents;var gI=gB[0];var gG=gB[1];var gF=gB[2];var gH=gB[3];var gE=gB[4];var gD=gB[5];gC=(gC+gz.escapeNodeOffset);while(gC<gx){gz=gw[gC];gB=gz.extents;if(gI>gB[0]){gI=gB[0]}if(gG>gB[1]){gG=gB[1]}if(gF>gB[2]){gF=gB[2]}if(gH<gB[3]){gH=gB[3]}if(gE<gB[4]){gE=gB[4]}if(gD<gB[5]){gD=gB[5]}gC=(gC+gz.escapeNodeOffset)}gB=gs.extents;gB[0]=gI;
gB[1]=gG;gB[2]=gF;gB[3]=gH;gB[4]=gE;gB[5]=gD;gy=gu;if(0<gJ){gJ-=1;gu=gv[gJ]}else{break}}}}this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.startUpdate=2147483647;this.endUpdate=-2147483647};gq.prototype.rebuild=function(){if(this.numExternalNodes>0){var gs=this.nodes;var gr,gA,gv;if(this.numExternalNodes===gs.length){gr=gs;gA=gs.length;gs=[];this.nodes=gs}else{gr=[];gr.length=this.numExternalNodes;gA=0;gv=this.endNode;for(var gu=0;gu<gv;gu+=1){var gt=gs[gu];if(gt.externalNode){gs[gu]=undefined;gr[gA]=gt;gA+=1}}if(gr.length>gA){gr.length=gA}}var gw;if(gA>1){if(gA>this.numNodesLeaf&&this.numAdds>0){if(this.highQuality){this._sortNodesHighQuality(gr)}else{if(this.ignoreY){this._sortNodesNoY(gr)}else{this._sortNodes(gr)}}}gs.length=this._predictNumNodes(0,gA,0);this._recursiveBuild(gr,0,gA,0);gv=gs[0].escapeNodeOffset;if(gs.length>gv){gs.length=gv}this.endNode=gv;gw=gs[0];var gB=gw.extents;var gz=(gB[3]-gB[0]);var gy=(gB[4]-gB[1]);var gx=(gB[5]-gB[2]);this.ignoreY=((4*gy)<(gz<=gx?gz:gx))
}else{gw=gr[0];gw.externalNode.spatialIndex=0;gs.length=1;gs[0]=gw;this.endNode=1}gr=null}this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.numUpdates=0;this.startUpdate=2147483647;this.endUpdate=-2147483647};gq.prototype._sortNodes=function(gr){var gx=this.numNodesLeaf;var gu=gr.length;function gB(gF){var gE=gF.extents;return(gE[0]+gE[3])}function gD(gF){var gE=gF.extents;return(gE[1]+gE[4])}function gs(gF){var gE=gF.extents;return(gE[2]+gE[5])}function gt(gF){var gE=gF.extents;return -(gE[0]+gE[3])}function gw(gF){var gE=gF.extents;return -(gE[1]+gE[4])}function gy(gF){var gE=gF.extents;return -(gE[2]+gE[5])}var gA=this._nthElement;var gz=false;var gv=0;function gC(gF,gH,gG){var gE=((gH+gG)>>1);if(gv===0){if(gz){gA(gF,gH,gE,gG,gt)}else{gA(gF,gH,gE,gG,gB)}}else{if(gv===2){if(gz){gA(gF,gH,gE,gG,gy)}else{gA(gF,gH,gE,gG,gs)}}else{if(gz){gA(gF,gH,gE,gG,gw)}else{gA(gF,gH,gE,gG,gD)}}}if(gv===0){gv=2}else{if(gv===2){gv=1}else{gv=0}}gz=!gz;if((gH+gx)<gE){gC(gF,gH,gE)}if((gE+gx)<gG){gC(gF,gE,gG)
}}gC(gr,0,gu)};gq.prototype._sortNodesNoY=function(gr){var gw=this.numNodesLeaf;var gu=gr.length;function gA(gD){var gC=gD.extents;return(gC[0]+gC[3])}function gs(gD){var gC=gD.extents;return(gC[2]+gC[5])}function gt(gD){var gC=gD.extents;return -(gC[0]+gC[3])}function gx(gD){var gC=gD.extents;return -(gC[2]+gC[5])}var gB=this._nthElement;var gz=false;var gv=0;function gy(gD,gF,gE){var gC=((gF+gE)>>1);if(gv===0){if(gz){gB(gD,gF,gC,gE,gt)}else{gB(gD,gF,gC,gE,gA)}}else{if(gz){gB(gD,gF,gC,gE,gx)}else{gB(gD,gF,gC,gE,gs)}}if(gv===0){gv=2}else{gv=0}gz=!gz;if((gF+gw)<gC){gy(gD,gF,gC)}if((gC+gw)<gE){gy(gD,gC,gE)}}gy(gr,0,gu)};gq.prototype._sortNodesHighQuality=function(gt){var gz=this.numNodesLeaf;var gx=gt.length;function gE(gJ){var gI=gJ.extents;return(gI[0]+gI[3])}function gG(gJ){var gI=gJ.extents;return(gI[1]+gI[4])}function gu(gJ){var gI=gJ.extents;return(gI[2]+gI[5])}function gs(gJ){var gI=gJ.extents;return(gI[0]+gI[2]+gI[3]+gI[5])}function gw(gJ){var gI=gJ.extents;return(gI[0]-gI[2]+gI[3]-gI[5])
}function gv(gJ){var gI=gJ.extents;return -(gI[0]+gI[3])}function gy(gJ){var gI=gJ.extents;return -(gI[1]+gI[4])}function gA(gJ){var gI=gJ.extents;return -(gI[2]+gI[5])}function gH(gJ){var gI=gJ.extents;return -(gI[0]+gI[2]+gI[3]+gI[5])}function gr(gJ){var gI=gJ.extents;return -(gI[0]-gI[2]+gI[3]-gI[5])}var gD=this._nthElement;var gC=this._calculateSAH;var gB=false;function gF(gJ,gP,gM){var gN=((gP+gM)>>1);gD(gJ,gP,gN,gM,gE);var gK=(gC(gJ,gP,gN)+gC(gJ,gN,gM));gD(gJ,gP,gN,gM,gG);var gI=(gC(gJ,gP,gN)+gC(gJ,gN,gM));gD(gJ,gP,gN,gM,gu);var gQ=(gC(gJ,gP,gN)+gC(gJ,gN,gM));gD(gJ,gP,gN,gM,gs);var gO=(gC(gJ,gP,gN)+gC(gJ,gN,gM));gD(gJ,gP,gN,gM,gw);var gL=(gC(gJ,gP,gN)+gC(gJ,gN,gM));if(gK<=gI&&gK<=gQ&&gK<=gO&&gK<=gL){if(gB){gD(gJ,gP,gN,gM,gv)}else{gD(gJ,gP,gN,gM,gE)}}else{if(gQ<=gI&&gQ<=gO&&gQ<=gL){if(gB){gD(gJ,gP,gN,gM,gA)}else{gD(gJ,gP,gN,gM,gu)}}else{if(gI<=gO&&gI<=gL){if(gB){gD(gJ,gP,gN,gM,gy)}else{gD(gJ,gP,gN,gM,gG)}}else{if(gO<=gL){if(gB){gD(gJ,gP,gN,gM,gH)}else{gD(gJ,gP,gN,gM,gs)}}else{if(gB){gD(gJ,gP,gN,gM,gr)
}else{gD(gJ,gP,gN,gM,gw)}}}}}gB=!gB;if((gP+gz)<gN){gF(gJ,gP,gN)}if((gN+gz)<gM){gF(gJ,gN,gM)}}gF(gt,0,gx)};gq.prototype._calculateSAH=function(gt,gB,gz){var gy,gA,gx,gw,gv,gs,gr,gC;gy=gt[gB];gA=gy.extents;gx=gA[0];gw=gA[1];gv=gA[2];gs=gA[3];gr=gA[4];gC=gA[5];for(var gu=(gB+1);gu<gz;gu+=1){gy=gt[gu];gA=gy.extents;if(gx>gA[0]){gx=gA[0]}if(gw>gA[1]){gw=gA[1]}if(gv>gA[2]){gv=gA[2]}if(gs<gA[3]){gs=gA[3]}if(gr<gA[4]){gr=gA[4]}if(gC<gA[5]){gC=gA[5]}}return((gs-gx)+(gr-gw)+(gC-gv))};gq.prototype._nthElement=function(gt,gx,gr,gA,gw){function gu(gE,gD,gF){if(gE<gD){if(gD<gF){return gD}else{if(gE<gF){return gF}else{return gE}}}else{if(gE<gF){return gE}else{if(gD<gF){return gF}}}return gD}function gv(gD,gH,gL,gG){var gK=(gH+1);while(gK!==gL){var gF=gD[gK];var gE=gG(gF);var gI=gK;var gJ=(gK-1);while(gI!==gH&&gE<gG(gD[gJ])){gD[gI]=gD[gJ];gI-=1;gJ-=1}if(gI!==gK){gD[gI]=gF}gK+=1}}while((gA-gx)>8){var gz=gu(gw(gt[gx]),gw(gt[gx+((gA-gx)>>1)]),gw(gt[gA-1]));var gs=gx;var gy=gA;var gC;for(;;gs+=1){while(gw(gt[gs])<gz){gs+=1
}do{gy-=1}while(gz<gw(gt[gy]));if(gs>=gy){gC=gs;break}else{var gB=gt[gs];gt[gs]=gt[gy];gt[gy]=gB}}if(gC<=gr){gx=gC}else{gA=gC}}gv(gt,gx,gA,gw)};gq.prototype._recursiveBuild=function(gJ,gu,gt,gv){var gy=this.nodes;var gB=gv;gv+=1;var gI,gF,gD,gG,gE,gC,gA;var gs,gw;if((gu+this.numNodesLeaf)>=gt){gs=gJ[gu];gA=gs.extents;gI=gA[0];gF=gA[1];gD=gA[2];gG=gA[3];gE=gA[4];gC=gA[5];gs.externalNode.spatialIndex=gv;this._replaceNode(gy,gv,gs);for(var gx=(gu+1);gx<gt;gx+=1){gs=gJ[gx];gA=gs.extents;if(gI>gA[0]){gI=gA[0]}if(gF>gA[1]){gF=gA[1]}if(gD>gA[2]){gD=gA[2]}if(gG<gA[3]){gG=gA[3]}if(gE<gA[4]){gE=gA[4]}if(gC<gA[5]){gC=gA[5]}gv+=1;gs.externalNode.spatialIndex=gv;this._replaceNode(gy,gv,gs)}gw=gy[gv]}else{var gr=((gu+gt)>>1);if((gu+1)>=gr){gs=gJ[gu];gs.externalNode.spatialIndex=gv;this._replaceNode(gy,gv,gs)}else{this._recursiveBuild(gJ,gu,gr,gv)}gw=gy[gv];gA=gw.extents;gI=gA[0];gF=gA[1];gD=gA[2];gG=gA[3];gE=gA[4];gC=gA[5];gv=(gv+gw.escapeNodeOffset);if((gr+1)>=gt){gs=gJ[gr];gs.externalNode.spatialIndex=gv;
this._replaceNode(gy,gv,gs)}else{this._recursiveBuild(gJ,gr,gt,gv)}gw=gy[gv];gA=gw.extents;if(gI>gA[0]){gI=gA[0]}if(gF>gA[1]){gF=gA[1]}if(gD>gA[2]){gD=gA[2]}if(gG<gA[3]){gG=gA[3]}if(gE<gA[4]){gE=gA[4]}if(gC<gA[5]){gC=gA[5]}}var gz=gy[gB];if(gz!==undefined){gz.reset(gI,gF,gD,gG,gE,gC,(gv+gw.escapeNodeOffset-gB))}else{var gH=new this.arrayConstructor(6);gH[0]=gI;gH[1]=gF;gH[2]=gD;gH[3]=gG;gH[4]=gE;gH[5]=gC;gy[gB]=x.create(gH,(gv+gw.escapeNodeOffset-gB))}};gq.prototype._replaceNode=function(gr,gu,gs){var gt=gr[gu];gr[gu]=gs;if(gt!==undefined){do{gu+=1}while(gr[gu]!==undefined);gr[gu]=gt}};gq.prototype._predictNumNodes=function(gu,gs,gr){gr+=1;if((gu+this.numNodesLeaf)>=gs){gr+=(gs-gu)}else{var gt=((gu+gs)>>1);if((gu+1)>=gt){gr+=1}else{gr=this._predictNumNodes(gu,gt,gr)}if((gt+1)>=gs){gr+=1}else{gr=this._predictNumNodes(gt,gs,gr)}}return gr};gq.prototype.getVisibleNodes=function(gF,gJ,gw){var gA=0;if(this.numExternalNodes>0){var gH=this.nodes;var gx=this.endNode;var gM=gF.length;var gB=(gw===undefined)?gJ.length:gw;
var gI,gK,gy;var gE,gD,gC,gu,gt,gs;var gz,gG,gv,gr,gO,gN;var gL=0;for(;;){gI=gH[gL];gK=gI.extents;gE=gK[0];gD=gK[1];gC=gK[2];gu=gK[3];gt=gK[4];gs=gK[5];gz=true;gG=0;do{gv=gF[gG];gr=gv[0];gO=gv[1];gN=gv[2];if((gr*(gr<0?gE:gu)+gO*(gO<0?gD:gt)+gN*(gN<0?gC:gs))<gv[3]){gz=false;break}gG+=1}while(gG<gM);if(gz){if(gI.externalNode){gJ[gB]=gI.externalNode;gB+=1;gA+=1;gL+=1;if(gL>=gx){break}}else{gz=true;gG=0;do{gv=gF[gG];gr=gv[0];gO=gv[1];gN=gv[2];if((gr*(gr>0?gE:gu)+gO*(gO>0?gD:gt)+gN*(gN>0?gC:gs))<gv[3]){gz=false;break}gG+=1}while(gG<gM);if(gz){gy=(gL+gI.escapeNodeOffset);gL+=1;do{gI=gH[gL];if(gI.externalNode){gJ[gB]=gI.externalNode;gB+=1;gA+=1}gL+=1}while(gL<gy);if(gL>=gx){break}}else{gL+=1}}}else{gL+=gI.escapeNodeOffset;if(gL>=gx){break}}}}return gA};gq.prototype.getOverlappingNodes=function(gs,gy,gt){if(this.numExternalNodes>0){var gr=gs[0];var gM=gs[1];var gK=gs[2];var gN=gs[3];var gL=gs[4];var gJ=gs[5];var gz=this.nodes;var gv=this.endNode;var gA,gB,gw;var gu=0;var gx=(gt===undefined)?gy.length:gt;
var gC=0;for(;;){gA=gz[gC];gB=gA.extents;var gI=gB[0];var gH=gB[1];var gF=gB[2];var gG=gB[3];var gE=gB[4];var gD=gB[5];if(gr<=gG&&gM<=gE&&gK<=gD&&gN>=gI&&gL>=gH&&gJ>=gF){if(gA.externalNode){gy[gx]=gA.externalNode;gx+=1;gu+=1;gC+=1;if(gC>=gv){break}}else{if(gN>=gG&&gL>=gE&&gJ>=gD&&gr<=gI&&gM<=gH&&gK<=gF){gw=(gC+gA.escapeNodeOffset);gC+=1;do{gA=gz[gC];if(gA.externalNode){gy[gx]=gA.externalNode;gx+=1;gu+=1}gC+=1}while(gC<gw);if(gC>=gv){break}}else{gC+=1}}}else{gC+=gA.escapeNodeOffset;if(gC>=gv){break}}}return gu}else{return 0}};gq.prototype.getSphereOverlappingNodes=function(gL,gs,gz){if(this.numExternalNodes>0){var gG=(gs*gs);var gx=gL[0];var gw=gL[1];var gv=gL[2];var gA=this.nodes;var gu=this.endNode;var gB,gC;var gt=gz.length;var gD=0;for(;;){gB=gA[gD];gC=gB.extents;var gK=gC[0];var gI=gC[1];var gH=gC[2];var gJ=gC[3];var gF=gC[4];var gE=gC[5];var gr=0,gy;if(gx<gK){gy=(gK-gx);gr+=(gy*gy)}else{if(gx>gJ){gy=(gx-gJ);gr+=(gy*gy)}}if(gw<gI){gy=(gI-gw);gr+=(gy*gy)}else{if(gw>gF){gy=(gw-gF);gr+=(gy*gy)
}}if(gv<gH){gy=(gH-gv);gr+=(gy*gy)}else{if(gv>gE){gy=(gv-gE);gr+=(gy*gy)}}if(gr<=gG){gD+=1;if(gB.externalNode){gz[gt]=gB.externalNode;gt+=1;if(gD>=gu){break}}}else{gD+=gB.escapeNodeOffset;if(gD>=gu){break}}}}};gq.prototype.getOverlappingPairs=function(gI,gs){if(this.numExternalNodes>0){var gx=this.nodes;var gt=this.endNode;var gr,gw,gy,gz;var gA=0;var gu=(gs===undefined)?gI.length:gs;var gv=0,gB;for(;;){gr=gx[gv];while(!gr.externalNode){gv+=1;gr=gx[gv]}gv+=1;if(gv<gt){gw=gr.externalNode;gz=gr.extents;var gH=gz[0];var gF=gz[1];var gD=gz[2];var gG=gz[3];var gE=gz[4];var gC=gz[5];gB=gv;for(;;){gy=gx[gB];gz=gy.extents;if(gH<=gz[3]&&gF<=gz[4]&&gD<=gz[5]&&gG>=gz[0]&&gE>=gz[1]&&gC>=gz[2]){gB+=1;if(gy.externalNode){gI[gu]=gw;gI[gu+1]=gy.externalNode;gu+=2;gA+=2;if(gB>=gt){break}}}else{gB+=gy.escapeNodeOffset;if(gB>=gt){break}}}}else{break}}return gA}else{return 0}};gq.prototype.getExtents=function(){return(0<this.nodes.length?this.nodes[0].extents:null)};gq.prototype.getRootNode=function(){return this.nodes[0]
};gq.prototype.getNodes=function(){return this.nodes};gq.prototype.getEndNodeIndex=function(){return this.endNode};gq.prototype.clear=function(){this.nodes=[];this.endNode=0;this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.numUpdates=0;this.numExternalNodes=0;this.startUpdate=2147483647;this.endUpdate=-2147483647;this.ignoreY=false};gq.rayTest=function(gx,gA,gw){var gP=gA.origin;var gO=gA.direction;var gJ=gP[0];var gH=gP[1];var gG=gP[2];var gr=gO[0];var gR=gO[1];var gQ=gO[2];var gu=1/gr;var gt=1/gR;var gs=1/gQ;function gN(g0,gV){var gS=g0[0];var g6=g0[1];var g5=g0[2];var g3=g0[3];var g1=g0[4];var gZ=g0[5];if(gS<=gJ&&gJ<=g3&&g6<=gH&&gH<=g1&&g5<=gG&&gG<=gZ){return 0}var gU,gX;var gY,gT;var g4;if(gr>=0){g4=(gS-gJ);gU=((g4===0)?0:(g4*gu));g4=(g3-gJ);gX=((g4===0)?0:(g4*gu))}else{gU=((g3-gJ)*gu);gX=((gS-gJ)*gu)}if(gR>=0){g4=(g6-gH);gY=((g4===0)?0:(g4*gt));g4=(g1-gH);gT=((g4===0)?0:(g4*gt))}else{gY=((g1-gH)*gt);gT=((g6-gH)*gt)}if((gU>gT)||(gY>gX)){return undefined}if(gY>gU){gU=gY
}if(gT<gX){gX=gT}var gW,g2;if(gQ>=0){g4=(g5-gG);gW=((g4===0)?0:(g4*gs));g4=(gZ-gG);g2=((g4===0)?0:(g4*gs))}else{gW=((gZ-gG)*gs);g2=((g5-gG)*gs)}if((gU>g2)||(gW>gX)){return undefined}if(gW>gU){gU=gW}if(g2<gX){gX=g2}if(gU<0){gU=gX}return(0<=gU&&gU<gV)?gU:undefined}var gB=[];var gv=null;function gM(g0,gW,gX){var gT=g0.getNodes();var gV=gT[gW];var gS=gN(gV.extents,gX);if(gS===undefined){return gX}if(gV.externalNode){var g1=gw(g0,gV.externalNode,gA,gS,gX);if(g1){gv=g1;gX=g1.factor}}else{var gU=gB.length;var gY;for(gY=0;gY<gU;gY+=1){var gZ=gB[gY];if(gS>gZ.distance){break}}gB.splice(gY-1,0,{tree:g0,nodeIndex:gW,distance:gS})}return gX}var gy=gA.maxFactor;var gC;var gI;for(gI=0;gI<gx.length;gI+=1){gC=gx[gI];if(gC.endNode!==0){gy=gM(gC,0,gy)}}while(gB.length!==0){var gD=gB.pop();if(gD.distance>=gy){continue}var gL=gD.nodeIndex;gC=gD.tree;var gE=gC.getNodes();var gF=gE[gL];var gz=gL+gF.escapeNodeOffset;var gK=gL+1;do{gy=gM(gC,gK,gy);gK+=gE[gK].escapeNodeOffset}while(gK<gz)}return gv};gq.create=function(gr){return new gq(gr?true:false)
};gq.version=1;return gq})();((function(){af.prototype.arrayConstructor=Array;if(typeof Float32Array!=="undefined"){var gq=new Float32Array(4);var gr=Object.prototype.toString.call(gq);if(gr==="[object Float32Array]"){af.prototype.arrayConstructor=Float32Array}}})());var e3=(function(){function gq(){}gq.prototype.subscribe=function(gs){var gu=this.subscribers;var gt=gu.length;for(var gr=0;gr<gt;gr+=1){if(gu[gr]===gs){return}}gu.push(gs)};gq.prototype.unsubscribe=function(gs){var gu=this.subscribers;var gt=gu.length;for(var gr=0;gr<gt;gr+=1){if(gu[gr]===gs){gu.splice(gr,1);break}}};gq.prototype.unsubscribeAll=function(){this.subscribers.length=0};gq.prototype.notify=function(gw,gu,gt,gs,gF,gE,gC,gA,gz,gy,gD,gB){var gr=this.subscribers;var gv=this.subscribers.length;var gx=0;while(gx<gv){gr[gx].apply(null,arguments);if(gr.length===gv){gx+=1}else{gv=gr.length}}};gq.create=function(){var gr=new gq();gr.subscribers=[];return gr};return gq})();var E=(function(){function gq(){}gq.prototype.processBytes=function(gA,gC){if(!this.isValidHeader(gA)){this.onerror(gC);
return}var gw=4;var gD=this.parseHeader(gA,gw);gw+=31*4;this.width=gD.dwWidth;this.height=gD.dwHeight;if((gD.dwCaps2&this.DDSF_VOLUME)&&(gD.dwDepth>0)){this.depth=gD.dwDepth}else{this.depth=1}if(gD.dwFlags&this.DDSF_MIPMAPCOUNT){this.numLevels=gD.dwMipMapCount}else{this.numLevels=1}if(gD.dwCaps2&this.DDSF_CUBEMAP){var gt=0;gt+=((gD.dwCaps2&this.DDSF_CUBEMAP_POSITIVEX)?1:0);gt+=((gD.dwCaps2&this.DDSF_CUBEMAP_NEGATIVEX)?1:0);gt+=((gD.dwCaps2&this.DDSF_CUBEMAP_POSITIVEY)?1:0);gt+=((gD.dwCaps2&this.DDSF_CUBEMAP_NEGATIVEY)?1:0);gt+=((gD.dwCaps2&this.DDSF_CUBEMAP_POSITIVEZ)?1:0);gt+=((gD.dwCaps2&this.DDSF_CUBEMAP_NEGATIVEZ)?1:0);if(gt!==6||this.width!==this.height){this.onerror(gC);return}this.numFaces=gt}else{this.numFaces=1}var gy=false;var gv=0;var gH=this.gd;if(gD.ddspf.dwFlags&this.DDSF_FOURCC){switch(gD.ddspf.dwFourCC){case this.FOURCC_DXT1:this.format=gH.PIXELFORMAT_DXT1;gv=8;gy=true;break;case this.FOURCC_DXT2:case this.FOURCC_DXT3:this.format=gH.PIXELFORMAT_DXT3;gv=16;gy=true;break;case this.FOURCC_DXT4:case this.FOURCC_DXT5:case this.FOURCC_RXGB:this.format=gH.PIXELFORMAT_DXT5;
gv=16;gy=true;break;case this.FOURCC_R8G8B8:this.bgrFormat=this.BGRPIXELFORMAT_B8G8R8;gv=3;break;case this.FOURCC_A8R8G8B8:this.bgrFormat=this.BGRPIXELFORMAT_B8G8R8A8;gv=4;break;case this.FOURCC_R5G6B5:this.bgrFormat=this.BGRPIXELFORMAT_B5G6R5;gv=2;break;case this.FOURCC_A8:this.format=gH.PIXELFORMAT_A8;gv=1;break;case this.FOURCC_A8B8G8R8:this.format=gH.PIXELFORMAT_R8G8B8A8;gv=4;break;case this.FOURCC_L8:this.format=gH.PIXELFORMAT_L8;gv=1;break;case this.FOURCC_A8L8:this.format=gH.PIXELFORMAT_L8A8;gv=2;break;case this.FOURCC_UNKNOWN:case this.FOURCC_ATI1:case this.FOURCC_ATI2:case this.FOURCC_X8R8G8B8:case this.FOURCC_X8B8G8R8:case this.FOURCC_A2B10G10R10:case this.FOURCC_A2R10G10B10:case this.FOURCC_A16B16G16R16:case this.FOURCC_R16F:case this.FOURCC_A16B16G16R16F:case this.FOURCC_R32F:case this.FOURCC_A32B32G32R32F:case this.FOURCC_L16:case this.FOURCC_X1R5G5B5:case this.FOURCC_A1R5G5B5:case this.FOURCC_A4R4G4B4:case this.FOURCC_R3G3B2:case this.FOURCC_A8R3G3B2:case this.FOURCC_X4R4G4B4:case this.FOURCC_A4L4:case this.FOURCC_D16_LOCKABLE:case this.FOURCC_D32:case this.FOURCC_D24X8:case this.FOURCC_D16:case this.FOURCC_D32F_LOCKABLE:case this.FOURCC_G16R16:case this.FOURCC_G16R16F:case this.FOURCC_G32R32F:break;
default:this.onerror(gC);return}}else{if(gD.ddspf.dwFlags===this.DDSF_RGBA&&gD.ddspf.dwRGBBitCount===32){if(gD.ddspf.dwRBitMask===255&&gD.ddspf.dwGBitMask===65280&&gD.ddspf.dwBBitMask===16711680&&gD.ddspf.dwABitMask===4278190080){this.format=gH.PIXELFORMAT_R8G8B8A8}else{this.bgrFormat=this.BGRPIXELFORMAT_B8G8R8A8}gv=4}else{if(gD.ddspf.dwFlags===this.DDSF_RGB&&gD.ddspf.dwRGBBitCount===32){if(gD.ddspf.dwRBitMask===255&&gD.ddspf.dwGBitMask===65280&&gD.ddspf.dwBBitMask===16711680){this.format=gH.PIXELFORMAT_R8G8B8A8}else{this.bgrFormat=this.BGRPIXELFORMAT_B8G8R8A8}gv=4}else{if(gD.ddspf.dwFlags===this.DDSF_RGB&&gD.ddspf.dwRGBBitCount===24){if(gD.ddspf.dwRBitMask===255&&gD.ddspf.dwGBitMask===65280&&gD.ddspf.dwBBitMask===16711680){this.format=gH.PIXELFORMAT_R8G8B8}else{this.bgrFormat=this.BGRPIXELFORMAT_B8G8R8}gv=3}else{if(gD.ddspf.dwFlags===this.DDSF_RGB&&gD.ddspf.dwRGBBitCount===16){if(gD.ddspf.dwRBitMask===63488&&gD.ddspf.dwGBitMask===2016&&gD.ddspf.dwBBitMask===31){this.format=gH.PIXELFORMAT_R5G6B5
}else{this.bgrFormat=this.BGRPIXELFORMAT_B5G6R5}gv=2}else{if(gD.ddspf.dwRGBBitCount===8){this.format=gH.PIXELFORMAT_L8;gv=1}else{this.onerror(gC);return}}}}}}var gB=0;for(var gx=0;gx<this.numFaces;gx+=1){var gz=this.width,gE=this.height,gG=this.depth;for(var gr=0;gr<this.numLevels;gr+=1){var gF=(gy?Math.floor((gz+3)/4):gz);var gu=(gy?Math.floor((gE+3)/4):gE);gB+=(gF*gu*gG*gv);gz=(gz>1?(gz>>1):1);gE=(gE>1?(gE>>1):1);gG=(gG>1?(gG>>1):1)}}if(gA.length<(gw+gB)){this.onerror(gC);return}this.bytesPerPixel=gv;var gI=gA.subarray(gw);gA=null;var gs=false;switch(this.bgrFormat){case this.BGRPIXELFORMAT_B8G8R8:this.format=gH.PIXELFORMAT_R8G8B8;gs=true;break;case this.BGRPIXELFORMAT_B8G8R8A8:this.format=gH.PIXELFORMAT_R8G8B8A8;gs=true;break;case this.BGRPIXELFORMAT_B5G6R5:this.format=gH.PIXELFORMAT_R5G6B5;gs=true;break;default:break}if(gs){gI=this.convertBGR2RGB(gI)}if(this.format===gH.PIXELFORMAT_DXT1){if(!gH.isSupported("TEXTURE_DXT1")){if(this.hasDXT1Alpha(gI)){this.format=gH.PIXELFORMAT_R5G5B5A1;
gq.decodeInWorker(gq.WorkerCommand.DXT1A,gI,this);return}else{this.format=gH.PIXELFORMAT_R5G6B5;gq.decodeInWorker(gq.WorkerCommand.DXT1,gI,this);return}}}else{if(this.format===gH.PIXELFORMAT_DXT3){if(!gH.isSupported("TEXTURE_DXT3")){this.format=gH.PIXELFORMAT_R4G4B4A4;gq.decodeInWorker(gq.WorkerCommand.DXT3,gI,this);return}}else{if(this.format===gH.PIXELFORMAT_DXT5){if(!gH.isSupported("TEXTURE_DXT5")){this.format=gH.PIXELFORMAT_R4G4B4A4;gq.decodeInWorker(gq.WorkerCommand.DXT5,gI,this);return}}}}this.onload(gI,this.width,this.height,this.format,this.numLevels,(this.numFaces>1),this.depth,gC)};gq.createWorker=function(gt){var gv="var convertDXT1To565 = "+this.convertDXT1To565.toString()+";\nvar convertDXT1To5551 = "+this.convertDXT1To5551.toString()+";\nvar convertDXT3To4444 = "+this.convertDXT3To4444.toString()+";\nvar convertDXT5To4444 = "+this.convertDXT5To4444.toString()+";\nvar command, srcWidth, srcHeight, srcNumLevels, srcNumFaces, srcOffset;\nonmessage = function decoderOnMessage(event)\n{\n    var edata = event.data;\n    if (edata instanceof ArrayBuffer)\n    {\n        var data = new Uint8Array(edata, srcOffset);\n        switch (command)\n        {\n            case 0: // DXT1\n                data = convertDXT1To565(data, srcWidth, srcHeight, srcNumLevels, srcNumFaces);\n                break;\n            case 1: // DXT1A\n                data = convertDXT1To5551(data, srcWidth, srcHeight, srcNumLevels, srcNumFaces);\n                break;\n            case 2: // DXT3\n                data = convertDXT3To4444(data, srcWidth, srcHeight, srcNumLevels, srcNumFaces);\n                break;\n            case 3: // DXT4\n                data = convertDXT5To4444(data, srcWidth, srcHeight, srcNumLevels, srcNumFaces);\n                break;\n            default:\n                data = null;\n                break;\n        };\n        if (data)\n        {\n            postMessage(data.buffer, [data.buffer]);\n        }\n        else\n        {\n            postMessage(null);\n        }\n    }\n    else\n    {\n        command = edata.command;\n        srcWidth = edata.width;\n        srcHeight = edata.height;\n        srcNumLevels = edata.numLevels;\n        srcNumFaces = edata.numFaces;\n        srcOffset = edata.byteOffset;\n    }\n};";
var gr=new Blob([gv],{type:"text/javascript"});var gs=(typeof URL!=="undefined"?URL:window.webkitURL);var gu=gs.createObjectURL(gr);var gx=new Worker(gu);if(gx){var gw=gq.workerQueues[gt];gx.onmessage=function(gz){var gy=gw.shift();gx.load-=((((gy.width+3)*(gy.height+3))>>4)*gy.numLevels*gy.numFaces);var gA=gz.data;if(gA){gy.onload(gA,gy.width,gy.height,gy.format,gy.numLevels,(gy.numFaces>1),gy.depth,200)}else{gy.onerror(200)}};gx.load=0}gs.revokeObjectURL(gu);return gx};gq.decodeInWorker=function(gw,gz,gC){var gy=this.maxNumWorkers;if(gy){var gA=this.workerQueues;var gr=this.workers;var gB=-1;var gt;if(!gr){this.workerQueues=gA=[];this.workers=gr=[];gB=0;for(gt=0;gt<gy;gt+=1){gA[gt]=[];gr[gt]=this.createWorker(gt);if(!gr[gt]){gB=-1;break}}}else{gB=0;var gE=gr[0]["load"];for(gt=1;gt<gy;gt+=1){var gD=gr[gt]["load"];if(gE>gD){gE=gD;gB=gt}}}if(gB!==-1){var gv=gr[gB];gv.load+=((((gC.width+3)*(gC.height+3))>>4)*gC.numLevels*gC.numFaces);gA[gB].push(gC);var gs=gz.byteOffset;var gx;if(gC.externalBuffer){gx=gz.buffer.slice(gs,(gs+gz.byteLength));
gs=0}else{gx=gz.buffer}gv.postMessage({command:gw,width:gC.width,height:gC.height,numLevels:gC.numLevels,numFaces:gC.numFaces,byteOffset:gs});gv.postMessage(gx,[gx]);return}else{this.maxNumWorkers=0}}var gu;switch(gw){case gq.WorkerCommand.DXT1:gu=function(){gz=gq.convertDXT1To565(gz,gC.width,gC.height,gC.numLevels,gC.numFaces);gC.onload(gz,gC.width,gC.height,gC.format,gC.numLevels,(gC.numFaces>1),gC.depth,200)};break;case gq.WorkerCommand.DXT1A:gu=function(){gz=gq.convertDXT1To5551(gz,gC.width,gC.height,gC.numLevels,gC.numFaces);gC.onload(gz,gC.width,gC.height,gC.format,gC.numLevels,(gC.numFaces>1),gC.depth,200)};break;case gq.WorkerCommand.DXT3:gu=function(){gz=gq.convertDXT3To4444(gz,gC.width,gC.height,gC.numLevels,gC.numFaces);gC.onload(gz,gC.width,gC.height,gC.format,gC.numLevels,(gC.numFaces>1),gC.depth,200)};break;case gq.WorkerCommand.DXT5:gu=function(){gz=gq.convertDXT5To4444(gz,gC.width,gC.height,gC.numLevels,gC.numFaces);gC.onload(gz,gC.width,gC.height,gC.format,gC.numLevels,(gC.numFaces>1),gC.depth,200)
};break;default:gu=null;break}if(gu){TurbulenzEngine.setTimeout(gu,0)}else{gC.onerror(200)}};gq.prototype.parseHeader=function(gr,gu){function gt(){var gw=((gr[gu])|(gr[gu+1]<<8)|(gr[gu+2]<<16)|(gr[gu+3]<<24));gu+=4;return gw}function gs(){return{dwSize:gt(),dwFlags:gt(),dwFourCC:gt(),dwRGBBitCount:gt(),dwRBitMask:gt(),dwGBitMask:gt(),dwBBitMask:gt(),dwABitMask:gt()}}var gv={dwSize:gt(),dwFlags:gt(),dwHeight:gt(),dwWidth:gt(),dwPitchOrLinearSize:gt(),dwDepth:gt(),dwMipMapCount:gt(),dwReserved1:[gt(),gt(),gt(),gt(),gt(),gt(),gt(),gt(),gt(),gt(),gt()],ddspf:gs(),dwCaps1:gt(),dwCaps2:gt(),dwReserved2:[gt(),gt(),gt()]};return gv};gq.prototype.isValidHeader=function(gr){return(68===gr[0]&&68===gr[1]&&83===gr[2]&&32===gr[3])};gq.prototype.convertBGR2RGB=function(gJ){var gD=this.bytesPerPixel;var gA=this.width;var gz=this.height;var gw=this.numLevels;var gs=this.numFaces;var gG=0;for(var gr=0;gr<gw;gr+=1){gG+=(gA*gz);gA=(gA>1?Math.floor(gA/2):1);gz=(gz>1?Math.floor(gz/2):1)}var gy=(gG*gD*gs);var gt=0;
if(gD===3||gD===4){do{var gH=gJ[gt];gJ[gt]=gJ[gt+2];gJ[gt+2]=gH;gt+=gD}while(gt<gy)}else{if(gD===2){var gK=new Uint16Array(gG*gs);var gu=0,gv=0;var gx,gE,gI;var gC=((1<<5)-1);var gF=(((1<<6)-1)<<5);do{var gB=((gJ[gu+1]<<8)|gJ[gu]);gu+=2;gx=(gB&gC)<<11;gE=(gB&gF);gI=((gB>>11)&gC);gK[gv]=gx|gE|gI;gv+=1}while(gt<gy);return gK}}return gJ};gq.prototype.decode565=function(gv,gs){var gu=((gv>>11)&31);var gt=((gv>>5)&63);var gr=((gv)&31);gs[0]=((gu<<3)|(gu>>2));gs[1]=((gt<<2)|(gt>>4));gs[2]=((gr<<3)|(gr>>2));gs[3]=255;return gs};gq.prototype.decodeColor=function(gJ,gv,gs,gE,gK){var gx=gK.cache;var gr=gq.prototype.decode565;var gI=((gJ[gv+1]<<8)|gJ[gv]);gv+=2;var gF=((gJ[gv+1]<<8)|gJ[gv]);gv+=2;var gB,gA,gz,gy,gD;if(gI!==gF){gB=gr(gI,gx[0]);gA=gr(gF,gx[1]);gz=gx[2];gy=gx[3];if(gI>gF){for(gD=0;gD<3;gD+=1){var gG=gB[gD];var gt=gA[gD];gz[gD]=((((gG*2)+gt)/3)|0);gy[gD]=(((gG+(gt*2))/3)|0)}gz[3]=255;gy[3]=255}else{for(gD=0;gD<3;gD+=1){gz[gD]=((gB[gD]+gA[gD])>>1);gy[gD]=0}gz[3]=255;gy[3]=0}}else{gB=gr(gI,gx[0]);
gA=gB;gz=gB;gy=gx[1];for(gD=0;gD<4;gD+=1){gy[gD]=0}}var gH=gK.colorArray;gH[0]=gB;gH[1]=gA;gH[2]=gz;gH[3]=gy;var gu,gw,gC;if(gs){for(gD=0;gD<4;gD+=1){gu=gJ[gv+gD];gw=gE[gD];gw[0]=gH[(gu)&3];gw[1]=gH[(gu>>2)&3];gw[2]=gH[(gu>>4)&3];gw[3]=gH[(gu>>6)&3]}}else{for(gD=0;gD<4;gD+=1){gu=gJ[gv+gD];gw=gE[gD];gC=gH[(gu)&3];gw[0][0]=gC[0];gw[0][1]=gC[1];gw[0][2]=gC[2];gw[0][3]=gC[3];gC=gH[(gu>>2)&3];gw[1][0]=gC[0];gw[1][1]=gC[1];gw[1][2]=gC[2];gw[1][3]=gC[3];gC=gH[(gu>>4)&3];gw[2][0]=gC[0];gw[2][1]=gC[1];gw[2][2]=gC[2];gw[2][3]=gC[3];gC=gH[(gu>>6)&3];gw[3][0]=gC[0];gw[3][1]=gC[1];gw[3][2]=gC[2];gw[3][3]=gC[3]}}};gq.prototype.decodeDXT3Alpha=function(gu,gw,gs){for(var gt=0;gt<4;gt+=1){var gv=((gu[gw+1]<<8)|gu[gw]);gw+=2;var gr=gs[gt];if(gv){gr[0][3]=((gv)&15)*(255/15);gr[1][3]=((gv>>4)&15)*(255/15);gr[2][3]=((gv>>8)&15)*(255/15);gr[3][3]=((gv>>12)&15)*(255/15)}else{gr[0][3]=0;gr[1][3]=0;gr[2][3]=0;gr[3][3]=0}}};gq.prototype.decodeDXT5Alpha=function(gx,gr,gv,gu){var gt=gx[gr];gr+=1;var gs=gx[gr];gr+=1;
var gy=gu.alphaArray;gy[0]=gt;gy[1]=gs;if(gt>gs){gy[2]=((((gt*6)+(gs*1))/7)|0);gy[3]=((((gt*5)+(gs*2))/7)|0);gy[4]=((((gt*4)+(gs*3))/7)|0);gy[5]=((((gt*3)+(gs*4))/7)|0);gy[6]=((((gt*2)+(gs*5))/7)|0);gy[7]=((((gt*1)+(gs*6))/7)|0)}else{if(gt<gs){gy[2]=((((gt*4)+(gs*1))/5)|0);gy[3]=((((gt*3)+(gs*2))/5)|0);gy[4]=((((gt*2)+(gs*3))/5)|0);gy[5]=((((gt*1)+(gs*4))/5)|0);gy[6]=0;gy[7]=255}else{gy[2]=gt;gy[3]=gt;gy[4]=gt;gy[5]=gt;gy[6]=0;gy[7]=255}}var gA;for(var gw=0;gw<2;gw+=1){var gz=(gx[gr]|(gx[gr+1]<<8)|(gx[gr+2]<<16));gr+=3;gA=gv[(gw*2)];gA[0][3]=gy[(gz)&7];gA[1][3]=gy[(gz>>3)&7];gA[2][3]=gy[(gz>>6)&7];gA[3][3]=gy[(gz>>9)&7];gA=gv[(gw*2)+1];gA[0][3]=gy[(gz>>12)&7];gA[1][3]=gy[(gz>>15)&7];gA[2][3]=gy[(gz>>18)&7];gA[3][3]=gy[(gz>>21)&7]}};gq.prototype.convertToRGBA32=function(gT,gJ,gS){var gr;var gN=this.width;var gL=this.height;var gI=this.numLevels;var gt=this.numFaces;var gR=0;for(gr=0;gr<gI;gr+=1){gR+=(gN*gL);gN=(gN>1?(gN>>1):1);gL=(gL>1?(gL>>1):1)}var gU=new Uint8Array(gR*4*gt);var gA=0,gF=0;
var gO=[[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)]];for(var gC=0;gC<gt;gC+=1){gN=this.width;gL=this.height;for(var gM=0;gM<gI;gM+=1){var gB=(gN>4?4:gN);var gs=(gL>4?4:gL);var gH=((gL+3)>>2);var gu=((gN+3)>>2);var gQ=(gN*4);var gK=(gB*4);var gw=(gQ*(gs-1));for(var gD=0;gD<gH;gD+=1){for(var gE=0;gE<gu;gE+=1){gJ(gT,gA,gO);var gz=gF;for(var gG=0;gG<gs;gG+=1){var gy=gO[gG];var gv=gz;for(var gP=0;gP<gB;gP+=1){var gx=gy[gP];gU[gv]=gx[0];gU[gv+1]=gx[1];gU[gv+2]=gx[2];gU[gv+3]=gx[3];gv+=4}gz+=gQ}gA+=gS;gF+=gK}gF+=gw}gN=(gN>1?(gN>>1):1);gL=(gL>1?(gL>>1):1)}}return gU};gq.prototype.hasDXT1Alpha=function(gt){var gs=gt.length;var gx,gr,gw;for(gx=0;gx<gs;gx+=8){var gv=((gt[gx+1]<<8)|gt[gx]);var gu=((gt[gx+3]<<8)|gt[gx+2]);if(gv<=gu){for(gr=0;gr<4;gr+=1){gw=gt[gx+4+gr];
if(gw===0){continue}if(((gw)&3)===3||((gw>>2)&3)===3||((gw>>4)&3)===3||((gw>>6)&3)===3){return true}}}}return false};gq.prototype.encodeR5G6B5=function(gr){return(((gr[2]&248)>>>3)|((gr[1]&252)<<3)|((gr[0]&248)<<8))};gq.prototype.encodeR5G5B5A1=function(gr){return((gr[3]>>>7)|((gr[2]&248)>>>2)|((gr[1]&248)<<3)|((gr[0]&248)<<8))};gq.prototype.encodeR4G4B4A4=function(gr){return((gr[3]>>>4)|(gr[2]&240)|((gr[1]&240)<<4)|((gr[0]&240)<<8))};gq.convertDXT1To565=function(gr,gQ,gY,gy,gF){var gN=[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)];var gB=new Array(4);function gT(hi,g4,hd,g6,g2){function g0(hn,hk){var hm=((hn>>11)&31);var hl=((hn>>5)&63);var hj=((hn)&31);hk[0]=((hm<<3)|(hm>>2));hk[1]=((hl<<2)|(hl>>4));hk[2]=((hj<<3)|(hj>>2));hk[3]=255;return hk}var hh=((hi[g4+1]<<8)|hi[g4]);g4+=2;var he=((hi[g4+1]<<8)|hi[g4]);g4+=2;var ha,g9,g8,g7,hc;if(hh!==he){ha=g0(hh,g6[0]);g9=g0(he,g6[1]);g8=g6[2];g7=g6[3];if(hh>he){for(hc=0;hc<3;hc+=1){var hf=ha[hc];var g1=g9[hc];g8[hc]=((((hf*2)+g1)/3)|0);
g7[hc]=(((hf+(g1*2))/3)|0)}g8[3]=255;g7[3]=255}else{for(hc=0;hc<3;hc+=1){g8[hc]=((ha[hc]+g9[hc])>>1);g7[hc]=0}g8[3]=255;g7[3]=0}}else{ha=g0(hh,g6[0]);g9=ha;g8=ha;g7=g6[1];for(hc=0;hc<4;hc+=1){g7[hc]=0}}var hg=g2;hg[0]=ha;hg[1]=g9;hg[2]=g8;hg[3]=g7;var g3,g5,hb;for(hc=0;hc<4;hc+=1){g3=hi[g4+hc];g5=hd[hc];g5[0]=hg[(g3)&3];g5[1]=hg[(g3>>2)&3];g5[2]=hg[(g3>>4)&3];g5[3]=hg[(g3>>6)&3]}}var gt;var gS=gQ;var gP=gY;var gM=gy;var gu=gF;var gX=0;for(gt=0;gt<gM;gt+=1){gX+=(gS*gP);gS=(gS>1?(gS>>1):1);gP=(gP>1?(gP>>1):1)}var gZ=new Uint16Array(gX*1*gu);var gD=0,gJ=0;var gU=[[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)]];for(var gG=0;gG<gu;gG+=1){gS=gQ;gP=gY;for(var gR=0;gR<gM;gR+=1){var gE=(gS>4?4:gS);var gs=(gP>4?4:gP);var gL=((gP+3)>>2);var gv=((gS+3)>>2);
var gW=(gS*1);var gO=(gE*1);var gx=(gW*(gs-1));for(var gH=0;gH<gL;gH+=1){for(var gI=0;gI<gv;gI+=1){gT(gr,gD,gU,gN,gB);var gC=gJ;for(var gK=0;gK<gs;gK+=1){var gA=gU[gK];var gw=gC;for(var gV=0;gV<gE;gV+=1){var gz=gA[gV];gZ[gw]=(((gz[2]&248)>>>3)|((gz[1]&252)<<3)|((gz[0]&248)<<8));gw+=1}gC+=gW}gD+=8;gJ+=gO}gJ+=gx}gS=(gS>1?(gS>>1):1);gP=(gP>1?(gP>>1):1)}}return gZ};gq.convertDXT1To5551=function(gr,gQ,gY,gy,gF){var gN=[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)];var gB=new Array(4);function gT(hi,g4,hd,g6,g2){function g0(hn,hk){var hm=((hn>>11)&31);var hl=((hn>>5)&63);var hj=((hn)&31);hk[0]=((hm<<3)|(hm>>2));hk[1]=((hl<<2)|(hl>>4));hk[2]=((hj<<3)|(hj>>2));hk[3]=255;return hk}var hh=((hi[g4+1]<<8)|hi[g4]);g4+=2;var he=((hi[g4+1]<<8)|hi[g4]);g4+=2;var ha,g9,g8,g7,hc;if(hh!==he){ha=g0(hh,g6[0]);g9=g0(he,g6[1]);g8=g6[2];g7=g6[3];if(hh>he){for(hc=0;hc<3;hc+=1){var hf=ha[hc];var g1=g9[hc];g8[hc]=((((hf*2)+g1)/3)|0);g7[hc]=(((hf+(g1*2))/3)|0)}g8[3]=255;g7[3]=255}else{for(hc=0;
hc<3;hc+=1){g8[hc]=((ha[hc]+g9[hc])>>1);g7[hc]=0}g8[3]=255;g7[3]=0}}else{ha=g0(hh,g6[0]);g9=ha;g8=ha;g7=g6[1];for(hc=0;hc<4;hc+=1){g7[hc]=0}}var hg=g2;hg[0]=ha;hg[1]=g9;hg[2]=g8;hg[3]=g7;var g3,g5,hb;for(hc=0;hc<4;hc+=1){g3=hi[g4+hc];g5=hd[hc];g5[0]=hg[(g3)&3];g5[1]=hg[(g3>>2)&3];g5[2]=hg[(g3>>4)&3];g5[3]=hg[(g3>>6)&3]}}var gt;var gS=gQ;var gP=gY;var gM=gy;var gu=gF;var gX=0;for(gt=0;gt<gM;gt+=1){gX+=(gS*gP);gS=(gS>1?(gS>>1):1);gP=(gP>1?(gP>>1):1)}var gZ=new Uint16Array(gX*1*gu);var gD=0,gJ=0;var gU=[[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)]];for(var gG=0;gG<gu;gG+=1){gS=gQ;gP=gY;for(var gR=0;gR<gM;gR+=1){var gE=(gS>4?4:gS);var gs=(gP>4?4:gP);var gL=((gP+3)>>2);var gv=((gS+3)>>2);var gW=(gS*1);var gO=(gE*1);var gx=(gW*(gs-1));for(var gH=0;
gH<gL;gH+=1){for(var gI=0;gI<gv;gI+=1){gT(gr,gD,gU,gN,gB);var gC=gJ;for(var gK=0;gK<gs;gK+=1){var gA=gU[gK];var gw=gC;for(var gV=0;gV<gE;gV+=1){var gz=gA[gV];gZ[gw]=((gz[3]>>>7)|((gz[2]&248)>>>2)|((gz[1]&248)<<3)|((gz[0]&248)<<8));gw+=1}gC+=gW}gD+=8;gJ+=gO}gJ+=gx}gS=(gS>1?(gS>>1):1);gP=(gP>1?(gP>>1):1)}}return gZ};gq.convertDXT3To4444=function(gt,gu,gN,gV,gR){function gE(hj,g5,he,g7,g3){function g1(ho,hl){var hn=((ho>>11)&31);var hm=((ho>>5)&63);var hk=((ho)&31);hl[0]=((hn<<3)|(hn>>2));hl[1]=((hm<<2)|(hm>>4));hl[2]=((hk<<3)|(hk>>2));hl[3]=255;return hl}var hi=((hj[g5+1]<<8)|hj[g5]);g5+=2;var hf=((hj[g5+1]<<8)|hj[g5]);g5+=2;var hb,ha,g9,g8,hd;if(hi!==hf){hb=g1(hi,g7[0]);ha=g1(hf,g7[1]);g9=g7[2];g8=g7[3];if(hi>hf){for(hd=0;hd<3;hd+=1){var hg=hb[hd];var g2=ha[hd];g9[hd]=((((hg*2)+g2)/3)|0);g8[hd]=(((hg+(g2*2))/3)|0)}g9[3]=255;g8[3]=255}else{for(hd=0;hd<3;hd+=1){g9[hd]=((hb[hd]+ha[hd])>>1);g8[hd]=0}g9[3]=255;g8[3]=0}}else{hb=g1(hi,g7[0]);ha=hb;g9=hb;g8=g7[1];for(hd=0;hd<4;hd+=1){g8[hd]=0}}var hh=g3;
hh[0]=hb;hh[1]=ha;hh[2]=g9;hh[3]=g8;var g4,g6,hc;for(hd=0;hd<4;hd+=1){g4=hj[g5+hd];g6=he[hd];hc=hh[(g4)&3];g6[0][0]=hc[0];g6[0][1]=hc[1];g6[0][2]=hc[2];g6[0][3]=hc[3];hc=hh[(g4>>2)&3];g6[1][0]=hc[0];g6[1][1]=hc[1];g6[1][2]=hc[2];g6[1][3]=hc[3];hc=hh[(g4>>4)&3];g6[2][0]=hc[0];g6[2][1]=hc[1];g6[2][2]=hc[2];g6[2][3]=hc[3];hc=hh[(g4>>6)&3];g6[3][0]=hc[0];g6[3][1]=hc[1];g6[3][2]=hc[2];g6[3][3]=hc[3]}}function gM(g4,g6,g2){for(var g3=0;g3<4;g3+=1){var g5=((g4[g6+1]<<8)|g4[g6]);g6+=2;var g1=g2[g3];if(g5){g1[0][3]=((g5)&15)*(255/15);g1[1][3]=((g5>>4)&15)*(255/15);g1[2][3]=((g5>>8)&15)*(255/15);g1[3][3]=((g5>>12)&15)*(255/15)}else{g1[0][3]=0;g1[1][3]=0;g1[2][3]=0;g1[3][3]=0}}}var gz=[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)];var gC=new Array(4);var gv;var gr=gu;var gs=gN;var gw=gV;var gx=gR;var g0=0;for(gv=0;gv<gw;gv+=1){g0+=(gr*gs);gr=(gr>1?(gr>>1):1);gs=(gs>1?(gs>>1):1)}var gL=new Uint16Array(g0*1*gx);var gG=0,gK=0;var gI=[[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)]];
for(var gA=0;gA<gx;gA+=1){gr=gu;gs=gN;for(var gW=0;gW<gw;gW+=1){var gF=(gr>4?4:gr);var gJ=(gs>4?4:gs);var gO=((gs+3)>>2);var gH=((gr+3)>>2);var gT=(gr*1);var gU=(gF*1);var gB=(gT*(gJ-1));for(var gP=0;gP<gO;gP+=1){for(var gQ=0;gQ<gH;gQ+=1){gE(gt,(gG+8),gI,gz,gC);gM(gt,gG,gI);var gS=gK;for(var gy=0;gy<gJ;gy+=1){var gD=gI[gy];var gZ=gS;for(var gY=0;gY<gF;gY+=1){var gX=gD[gY];gL[gZ]=((gX[3]>>>4)|(gX[2]&240)|((gX[1]&240)<<4)|((gX[0]&240)<<8));gZ+=1}gS+=gT}gG+=16;gK+=gU}gK+=gB}gr=(gr>1?(gr>>1):1);gs=(gs>1?(gs>>1):1)}}return gL};gq.convertDXT5To4444=function(gt,gv,gN,gW,gS){function gF(hk,g6,hf,g8,g4){function g2(hp,hm){var ho=((hp>>11)&31);var hn=((hp>>5)&63);var hl=((hp)&31);hm[0]=((ho<<3)|(ho>>2));hm[1]=((hn<<2)|(hn>>4));hm[2]=((hl<<3)|(hl>>2));hm[3]=255;return hm}var hj=((hk[g6+1]<<8)|hk[g6]);g6+=2;var hg=((hk[g6+1]<<8)|hk[g6]);g6+=2;var hc,hb,ha,g9,he;if(hj!==hg){hc=g2(hj,g8[0]);hb=g2(hg,g8[1]);ha=g8[2];g9=g8[3];if(hj>hg){for(he=0;he<3;he+=1){var hh=hc[he];var g3=hb[he];ha[he]=((((hh*2)+g3)/3)|0);
g9[he]=(((hh+(g3*2))/3)|0)}ha[3]=255;g9[3]=255}else{for(he=0;he<3;he+=1){ha[he]=((hc[he]+hb[he])>>1);g9[he]=0}ha[3]=255;g9[3]=0}}else{hc=g2(hj,g8[0]);hb=hc;ha=hc;g9=g8[1];for(he=0;he<4;he+=1){g9[he]=0}}var hi=g4;hi[0]=hc;hi[1]=hb;hi[2]=ha;hi[3]=g9;var g5,g7,hd;for(he=0;he<4;he+=1){g5=hk[g6+he];g7=hf[he];hd=hi[(g5)&3];g7[0][0]=hd[0];g7[0][1]=hd[1];g7[0][2]=hd[2];g7[0][3]=hd[3];hd=hi[(g5>>2)&3];g7[1][0]=hd[0];g7[1][1]=hd[1];g7[1][2]=hd[2];g7[1][3]=hd[3];hd=hi[(g5>>4)&3];g7[2][0]=hd[0];g7[2][1]=hd[1];g7[2][2]=hd[2];g7[2][3]=hd[3];hd=hi[(g5>>6)&3];g7[3][0]=hd[0];g7[3][1]=hd[1];g7[3][2]=hd[2];g7[3][3]=hd[3]}}function gP(g8,g2,g6,g3){var g5=g8[g2];g2+=1;var g4=g8[g2];g2+=1;var g9=g3;g9[0]=g5;g9[1]=g4;if(g5>g4){g9[2]=((((g5*6)+(g4*1))/7)|0);g9[3]=((((g5*5)+(g4*2))/7)|0);g9[4]=((((g5*4)+(g4*3))/7)|0);g9[5]=((((g5*3)+(g4*4))/7)|0);g9[6]=((((g5*2)+(g4*5))/7)|0);g9[7]=((((g5*1)+(g4*6))/7)|0)}else{if(g5<g4){g9[2]=((((g5*4)+(g4*1))/5)|0);g9[3]=((((g5*3)+(g4*2))/5)|0);g9[4]=((((g5*2)+(g4*3))/5)|0);g9[5]=((((g5*1)+(g4*4))/5)|0);
g9[6]=0;g9[7]=255}else{g9[2]=g5;g9[3]=g5;g9[4]=g5;g9[5]=g5;g9[6]=0;g9[7]=255}}var hb;for(var g7=0;g7<2;g7+=1){var ha=(g8[g2]|(g8[g2+1]<<8)|(g8[g2+2]<<16));g2+=3;hb=g6[(g7*2)];hb[0][3]=g9[(ha)&7];hb[1][3]=g9[(ha>>3)&7];hb[2][3]=g9[(ha>>6)&7];hb[3][3]=g9[(ha>>9)&7];hb=g6[(g7*2)+1];hb[0][3]=g9[(ha>>12)&7];hb[1][3]=g9[(ha>>15)&7];hb[2][3]=g9[(ha>>18)&7];hb[3][3]=g9[(ha>>21)&7]}}var gA=[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)];var gD=new Array(4);var gu=new Uint8Array(8);var gw;var gr=gv;var gs=gN;var gx=gW;var gy=gS;var g1=0;for(gw=0;gw<gx;gw+=1){g1+=(gr*gs);gr=(gr>1?(gr>>1):1);gs=(gs>1?(gs>>1):1)}var gM=new Uint16Array(g1*1*gy);var gH=0,gL=0;var gJ=[[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)],[new Uint8Array(4),new Uint8Array(4),new Uint8Array(4),new Uint8Array(4)]];for(var gB=0;gB<gy;
gB+=1){gr=gv;gs=gN;for(var gX=0;gX<gx;gX+=1){var gG=(gr>4?4:gr);var gK=(gs>4?4:gs);var gO=((gs+3)>>2);var gI=((gr+3)>>2);var gU=(gr*1);var gV=(gG*1);var gC=(gU*(gK-1));for(var gQ=0;gQ<gO;gQ+=1){for(var gR=0;gR<gI;gR+=1){gF(gt,(gH+8),gJ,gA,gD);gP(gt,gH,gJ,gu);var gT=gL;for(var gz=0;gz<gK;gz+=1){var gE=gJ[gz];var g0=gT;for(var gZ=0;gZ<gG;gZ+=1){var gY=gE[gZ];gM[g0]=((gY[3]>>>4)|(gY[2]&240)|((gY[1]&240)<<4)|((gY[0]&240)<<8));g0+=1}gT+=gU}gH+=16;gL+=gV}gL+=gC}gr=(gr>1?(gr>>1):1);gs=(gs>1?(gs>>1):1)}}return gM};gq.create=function(gv){var gr=new gq();gr.gd=gv.gd;gr.onload=gv.onload;gr.onerror=gv.onerror;function gs(gz,gy,gx,gw){return(gz.charCodeAt(0)+(gy.charCodeAt(0)*256)+(gx.charCodeAt(0)*65536)+(gw.charCodeAt(0)*16777216))}gr.FOURCC_ATI1=gs("A","T","I","1");gr.FOURCC_ATI2=gs("A","T","I","2");gr.FOURCC_RXGB=gs("R","X","G","B");var gu=gv.src;if(gu){gr.src=gu;var gt;if(window.XMLHttpRequest){gt=new window.XMLHttpRequest()}else{if(window.ActiveXObject){gt=new window.ActiveXObject("Microsoft.XMLHTTP")
}else{if(gv.onerror){gv.onerror(0)}return null}}gt.onreadystatechange=function(){if(gt.readyState===4){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){var gy=gt.status;var gx=gt.status!==0&&gt.statusText||"No connection";if(gy===0&&(window.location.protocol==="file:"||window.location.protocol==="chrome-extension:")){gy=200}if(gt.getAllResponseHeaders()===""){var gA;if(gt.responseType==="arraybuffer"){gA=!gt.response}else{if(gt.mozResponseArrayBuffer){gA=!gt.mozResponseArrayBuffer}else{gA=!gt.responseText}}if(gA){if(gr.onerror){gr.onerror(0)}gt.onreadystatechange=null;gt=null;return}}if(gy===200||gy===0){var gw;if(gt.responseType==="arraybuffer"){gw=gt.response}else{if(gt.mozResponseArrayBuffer){gw=gt.mozResponseArrayBuffer}else{var gC=gt.responseText;var gB=gC.length;gw=[];gw.length=gB;for(var gz=0;gz<gB;gz+=1){gw[gz]=(gC.charCodeAt(gz)&255)}}}gr.externalBuffer=false;gr.processBytes(new Uint8Array(gw),gy)}else{if(gr.onerror){gr.onerror(gy)}}}gt.onreadystatechange=null;gt=null}};gt.open("GET",gv.src,true);
if(gt.hasOwnProperty&&gt.hasOwnProperty("responseType")){gt.responseType="arraybuffer"}else{if(gt.overrideMimeType){gt.overrideMimeType("text/plain; charset=x-user-defined")}else{gt.setRequestHeader("Content-Type","text/plain; charset=x-user-defined")}}gt.send(null)}else{gr.externalBuffer=true;gr.processBytes((gv.data),0)}return gr};gq.destroy=function(){var gt=this.maxNumWorkers;if(gt){this.workerQueues=null;var gr=this.workers;if(gr){this.workers=null;var gs;for(gs=0;gs<gt;gs+=1){gr[gs].terminate()}}}};gq.version=1;gq.maxNumWorkers=(typeof Worker!=="undefined"&&typeof Blob!=="undefined"&&(typeof URL!=="undefined"||typeof window.webkitURL!=="undefined")?4:0);gq.WorkerCommand={DXT1:0,DXT1A:1,DXT3:2,DXT5:3};gq.workerQueues=null;gq.workers=null;return gq})();E.prototype.DDSF_CAPS=1;E.prototype.DDSF_HEIGHT=2;E.prototype.DDSF_WIDTH=4;E.prototype.DDSF_PITCH=8;E.prototype.DDSF_PIXELFORMAT=4096;E.prototype.DDSF_MIPMAPCOUNT=131072;E.prototype.DDSF_LINEARSIZE=524288;E.prototype.DDSF_DEPTH=8388608;
E.prototype.DDSF_ALPHAPIXELS=1;E.prototype.DDSF_FOURCC=4;E.prototype.DDSF_RGB=64;E.prototype.DDSF_RGBA=65;E.prototype.DDSF_COMPLEX=8;E.prototype.DDSF_TEXTURE=4096;E.prototype.DDSF_MIPMAP=4194304;E.prototype.DDSF_CUBEMAP=512;E.prototype.DDSF_CUBEMAP_POSITIVEX=1024;E.prototype.DDSF_CUBEMAP_NEGATIVEX=2048;E.prototype.DDSF_CUBEMAP_POSITIVEY=4096;E.prototype.DDSF_CUBEMAP_NEGATIVEY=8192;E.prototype.DDSF_CUBEMAP_POSITIVEZ=16384;E.prototype.DDSF_CUBEMAP_NEGATIVEZ=32768;E.prototype.DDSF_CUBEMAP_ALL_FACES=64512;E.prototype.DDSF_VOLUME=2097152;E.prototype.FOURCC_UNKNOWN=0;E.prototype.FOURCC_R8G8B8=20;E.prototype.FOURCC_A8R8G8B8=21;E.prototype.FOURCC_X8R8G8B8=22;E.prototype.FOURCC_R5G6B5=23;E.prototype.FOURCC_X1R5G5B5=24;E.prototype.FOURCC_A1R5G5B5=25;E.prototype.FOURCC_A4R4G4B4=26;E.prototype.FOURCC_R3G3B2=27;E.prototype.FOURCC_A8=28;E.prototype.FOURCC_A8R3G3B2=29;E.prototype.FOURCC_X4R4G4B4=30;E.prototype.FOURCC_A2B10G10R10=31;E.prototype.FOURCC_A8B8G8R8=32;E.prototype.FOURCC_X8B8G8R8=33;E.prototype.FOURCC_G16R16=34;
E.prototype.FOURCC_A2R10G10B10=35;E.prototype.FOURCC_A16B16G16R16=36;E.prototype.FOURCC_L8=50;E.prototype.FOURCC_A8L8=51;E.prototype.FOURCC_A4L4=52;E.prototype.FOURCC_DXT1=827611204;E.prototype.FOURCC_DXT2=844388420;E.prototype.FOURCC_DXT3=861165636;E.prototype.FOURCC_DXT4=877942852;E.prototype.FOURCC_DXT5=894720068;E.prototype.FOURCC_D16_LOCKABLE=70;E.prototype.FOURCC_D32=71;E.prototype.FOURCC_D24X8=77;E.prototype.FOURCC_D16=80;E.prototype.FOURCC_D32F_LOCKABLE=82;E.prototype.FOURCC_L16=81;E.prototype.FOURCC_R16F=111;E.prototype.FOURCC_G16R16F=112;E.prototype.FOURCC_A16B16G16R16F=113;E.prototype.FOURCC_R32F=114;E.prototype.FOURCC_G32R32F=115;E.prototype.FOURCC_A32B32G32R32F=116;E.prototype.BGRPIXELFORMAT_B5G6R5=1;E.prototype.BGRPIXELFORMAT_B8G8R8A8=2;E.prototype.BGRPIXELFORMAT_B8G8R8=3;var eD=(function(){function gq(){}gq.prototype.setData=function(gs,gv,gr,gx,gw,gz,gt){var gy=this.gd;var gu=this.target;gy.bindTexture(gu,this.glTexture);if(3<=arguments.length){if(gx===undefined){gx=0}if(gw===undefined){gw=0
}if(gz===undefined){gz=(this.width-gx)}if(gt===undefined){gt=(this.height-gw)}this.updateSubData(gs,gv,gr,gx,gw,gz,gt)}else{this.updateData(gs)}gy.bindTexture(gu,null)};gq.prototype.createGLTexture=function(gs){var gr=this.gd;var gu=gr.gl;var gt;if(this.cubemap){gt=gu.TEXTURE_CUBE_MAP}else{if(this.depth>1){return false}else{gt=gu.TEXTURE_2D}}this.target=gt;var gv=gu.createTexture();this.glTexture=gv;gr.bindTexture(gt,gv);gu.texParameteri(gt,gu.TEXTURE_MAG_FILTER,gu.LINEAR);if(this.mipmaps||1<this.numDataLevels){gu.texParameteri(gt,gu.TEXTURE_MIN_FILTER,gu.LINEAR_MIPMAP_NEAREST)}else{gu.texParameteri(gt,gu.TEXTURE_MIN_FILTER,gu.LINEAR)}gu.texParameteri(gt,gu.TEXTURE_WRAP_S,gu.CLAMP_TO_EDGE);gu.texParameteri(gt,gu.TEXTURE_WRAP_T,gu.CLAMP_TO_EDGE);this.updateData(gs);gr.bindTexture(gt,null);return true};gq.prototype.updateData=function(gL){var gJ=this.gd;var gE=gJ.gl;function gz(gM){return Math.floor(Math.log(gM)/Math.LN2)}var gs=this.mipmaps&&(this.numDataLevels!==(1+Math.max(gz(this.width),gz(this.height))));
var gF=this.format;var gv,gw,gt,gB=null;var gI;if(gF===gJ.PIXELFORMAT_A8){gv=gE.ALPHA;gw=gE.UNSIGNED_BYTE;gt=1;if(gL&&!gL.src){if(gL instanceof Uint8Array){gB=gL}else{gB=new Uint8Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_L8){gv=gE.LUMINANCE;gw=gE.UNSIGNED_BYTE;gt=1;if(gL&&!gL.src){if(gL instanceof Uint8Array){gB=gL}else{gB=new Uint8Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_L8A8){gv=gE.LUMINANCE_ALPHA;gw=gE.UNSIGNED_BYTE;gt=2;if(gL&&!gL.src){if(gL instanceof Uint8Array){gB=gL}else{gB=new Uint8Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_R5G5B5A1){gv=gE.RGBA;gw=gE.UNSIGNED_SHORT_5_5_5_1;gt=1;if(gL&&!gL.src){if(gL instanceof Uint16Array){gB=gL}else{gB=new Uint16Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_R5G6B5){gv=gE.RGB;gw=gE.UNSIGNED_SHORT_5_6_5;gt=1;if(gL&&!gL.src){if(gL instanceof Uint16Array){gB=gL}else{gB=new Uint16Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_R4G4B4A4){gv=gE.RGBA;gw=gE.UNSIGNED_SHORT_4_4_4_4;gt=1;if(gL&&!gL.src){if(gL instanceof Uint16Array){gB=gL}else{gB=new Uint16Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_R8G8B8A8){gv=gE.RGBA;
gw=gE.UNSIGNED_BYTE;gt=4;if(gL&&!gL.src){if(gL instanceof Uint8Array){if(typeof Uint8ClampedArray!=="undefined"&&gL instanceof Uint8ClampedArray){gB=new Uint8Array(gL.buffer)}else{gB=gL}}else{gB=new Uint8Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_R8G8B8){gv=gE.RGB;gw=gE.UNSIGNED_BYTE;gt=3;if(gL&&!gL.src){if(gL instanceof Uint8Array){if(typeof Uint8ClampedArray!=="undefined"&&gL instanceof Uint8ClampedArray){gB=new Uint8Array(gL.buffer)}else{gB=gL}}else{gB=new Uint8Array(gL)}}}else{if(gF===gJ.PIXELFORMAT_D24S8){gv=gE.DEPTH_STENCIL;gw=gE.UNSIGNED_INT;gt=1;if(gL&&!gL.src){gB=new Uint32Array(gL)}}else{if(gF===gJ.PIXELFORMAT_DXT1||gF===gJ.PIXELFORMAT_DXT3||gF===gJ.PIXELFORMAT_DXT5){gI=gJ.compressedTexturesExtension;if(gI){if(gF===gJ.PIXELFORMAT_DXT1){gv=gI.COMPRESSED_RGBA_S3TC_DXT1_EXT;gt=8}else{if(gF===gJ.PIXELFORMAT_DXT3){gv=gI.COMPRESSED_RGBA_S3TC_DXT3_EXT;gt=16}else{gv=gI.COMPRESSED_RGBA_S3TC_DXT5_EXT;gt=16}}if(gv===undefined){return}if(gL&&!gL.src){if(gL instanceof Uint8Array){gB=gL}else{gB=new Uint8Array(gL)
}}}else{return}}else{return}}}}}}}}}}var gA=(gL&&0<this.numDataLevels?this.numDataLevels:1);var gy=this.width,gG=this.height,gu=0,gK,gC,gr,gx;if(this.cubemap){if(gL&&gL instanceof eX){return}gK=gE.TEXTURE_CUBE_MAP;for(var gH=0;gH<6;gH+=1){var gD=(gE.TEXTURE_CUBE_MAP_POSITIVE_X+gH);for(gC=0;gC<gA;gC+=1){if(gI){gr=(Math.floor((gy+3)/4)*Math.floor((gG+3)/4)*gt);if(gB){if(gA===1){gx=gB}else{gx=gB.subarray(gu,(gu+gr))}}else{gx=new Uint8Array(gr)}if(gJ.WEBGL_compressed_texture_s3tc){gE.compressedTexImage2D(gD,gC,gv,gy,gG,0,gx)}else{gI.compressedTexImage2D(gD,gC,gv,gy,gG,0,gx)}}else{gr=(gy*gG*gt);if(gB){if(gA===1){gx=gB}else{gx=gB.subarray(gu,(gu+gr))}gE.texImage2D(gD,gC,gv,gy,gG,0,gv,gw,gx)}else{if(gL){gE.texImage2D(gD,gC,gv,gv,gw,gL)}else{if(gw===gE.UNSIGNED_SHORT_5_6_5||gw===gE.UNSIGNED_SHORT_5_5_5_1||gw===gE.UNSIGNED_SHORT_4_4_4_4){gx=new Uint16Array(gr)}else{gx=new Uint8Array(gr)}gE.texImage2D(gD,gC,gv,gy,gG,0,gv,gw,gx)}}}gu+=gr;gy=(gy>1?Math.floor(gy/2):1);gG=(gG>1?Math.floor(gG/2):1)}gy=this.width;
gG=this.height}}else{if(gL&&gL instanceof eX){gK=gE.TEXTURE_2D;gE.texImage2D(gK,0,gv,gv,gw,gL.video)}else{gK=gE.TEXTURE_2D;for(gC=0;gC<gA;gC+=1){if(gI){gr=(Math.floor((gy+3)/4)*Math.floor((gG+3)/4)*gt);if(gB){if(gA===1){gx=gB}else{gx=gB.subarray(gu,(gu+gr))}}else{gx=new Uint8Array(gr)}if(gJ.WEBGL_compressed_texture_s3tc){gE.compressedTexImage2D(gK,gC,gv,gy,gG,0,gx)}else{gI.compressedTexImage2D(gK,gC,gv,gy,gG,0,gx)}}else{gr=(gy*gG*gt);if(gB){if(gA===1){gx=gB}else{gx=gB.subarray(gu,(gu+gr))}gE.texImage2D(gK,gC,gv,gy,gG,0,gv,gw,gx)}else{if(gL){gE.texImage2D(gK,gC,gv,gv,gw,gL)}else{if(gw===gE.UNSIGNED_SHORT_5_6_5||gw===gE.UNSIGNED_SHORT_5_5_5_1||gw===gE.UNSIGNED_SHORT_4_4_4_4){gx=new Uint16Array(gr)}else{gx=new Uint8Array(gr)}gE.texImage2D(gK,gC,gv,gy,gG,0,gv,gw,gx)}}}gu+=gr;gy=(gy>1?Math.floor(gy/2):1);gG=(gG>1?Math.floor(gG/2):1)}}}if(gs){gE.generateMipmap(gK)}};gq.prototype.updateSubData=function(gt,gy,gr,gA,gz,gD,gv){var gC=this.gd;var gu=gC.gl;var gB=this.format;var gE,gF,gx;var gs;if(gB===gC.PIXELFORMAT_A8){gE=gu.ALPHA;
gF=gu.UNSIGNED_BYTE;if(gt instanceof Uint8Array){gx=gt}else{gx=new Uint8Array(gt)}}else{if(gB===gC.PIXELFORMAT_L8){gE=gu.LUMINANCE;gF=gu.UNSIGNED_BYTE;if(gt instanceof Uint8Array){gx=gt}else{gx=new Uint8Array(gt)}}else{if(gB===gC.PIXELFORMAT_L8A8){gE=gu.LUMINANCE_ALPHA;gF=gu.UNSIGNED_BYTE;if(gt instanceof Uint8Array){gx=gt}else{gx=new Uint8Array(gt)}}else{if(gB===gC.PIXELFORMAT_R5G5B5A1){gE=gu.RGBA;gF=gu.UNSIGNED_SHORT_5_5_5_1;if(gt instanceof Uint16Array){gx=gt}else{gx=new Uint16Array(gt)}}else{if(gB===gC.PIXELFORMAT_R5G6B5){gE=gu.RGB;gF=gu.UNSIGNED_SHORT_5_6_5;if(gt instanceof Uint16Array){gx=gt}else{gx=new Uint16Array(gt)}}else{if(gB===gC.PIXELFORMAT_R4G4B4A4){gE=gu.RGBA;gF=gu.UNSIGNED_SHORT_4_4_4_4;if(gt instanceof Uint16Array){gx=gt}else{gx=new Uint16Array(gt)}}else{if(gB===gC.PIXELFORMAT_R8G8B8A8){gE=gu.RGBA;gF=gu.UNSIGNED_BYTE;if(gt instanceof Uint8Array){if(typeof Uint8ClampedArray!=="undefined"&&gt instanceof Uint8ClampedArray){gx=new Uint8Array(gt.buffer)}else{gx=gt}}else{gx=new Uint8Array(gt)
}}else{if(gB===gC.PIXELFORMAT_R8G8B8){gE=gu.RGB;gF=gu.UNSIGNED_BYTE;if(gt instanceof Uint8Array){if(typeof Uint8ClampedArray!=="undefined"&&gt instanceof Uint8ClampedArray){gx=new Uint8Array(gt.buffer)}else{gx=gt}}else{gx=new Uint8Array(gt)}}else{if(gB===gC.PIXELFORMAT_DXT1||gB===gC.PIXELFORMAT_DXT3||gB===gC.PIXELFORMAT_DXT5){gs=gC.compressedTexturesExtension;if(gs){if(gB===gC.PIXELFORMAT_DXT1){gE=gs.COMPRESSED_RGBA_S3TC_DXT1_EXT}else{if(gB===gC.PIXELFORMAT_DXT3){gE=gs.COMPRESSED_RGBA_S3TC_DXT3_EXT}else{gE=gs.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(gt instanceof Uint8Array){gx=gt}else{gx=new Uint8Array(gt)}}else{return}}else{return}}}}}}}}}var gw;if(this.cubemap){if(gt instanceof eX){return}gw=(gu.TEXTURE_CUBE_MAP_POSITIVE_X+gy)}else{if(gt instanceof eX){gw=gu.TEXTURE_2D;gu.texSubImage2D(gw,gr,gA,gz,gE,gF,gt.video);return}else{gw=gu.TEXTURE_2D}}if(gs){if(gC.WEBGL_compressed_texture_s3tc){gu.compressedTexSubImage2D(gw,gr,gA,gz,gD,gv,gE,gx)}else{gs.compressedTexSubImage2D(gw,gr,gA,gz,gD,gv,gE,gx)
}}else{gu.texSubImage2D(gw,gr,gA,gz,gD,gv,gE,gF,gx)}};gq.prototype.updateMipmaps=function(gs){if(this.mipmaps){if(this.depth>1){(TurbulenzEngine).callOnError("3D texture mipmap generation unsupported");return}if(this.cubemap&&gs!==5){return}var gr=this.gd;var gu=gr.gl;var gt=this.target;gr.bindTexture(gt,this.glTexture);gu.generateMipmap(gt);gr.bindTexture(gt,null)}};gq.prototype.destroy=function(){var gs=this.gd;if(gs){var gr=this.glTexture;if(gr){var gt=gs.gl;if(gt){gs.unbindTexture(gr);gt.deleteTexture(gr)}delete this.glTexture}delete this.sampler;delete this.gd}};gq.prototype.typedArrayIsValid=function(gt){var gr=this.gd;var gs=this.format;if(gr){if((gs===gr.PIXELFORMAT_A8)||(gs===gr.PIXELFORMAT_L8)||(gs===gr.PIXELFORMAT_S8)){return((gt instanceof Uint8Array)||(typeof Uint8ClampedArray!=="undefined"&&gt instanceof Uint8ClampedArray))&&(gt.length===this.width*this.height*this.depth)}if(gs===gr.PIXELFORMAT_L8A8){return((gt instanceof Uint8Array)||(typeof Uint8ClampedArray!=="undefined"&&gt instanceof Uint8ClampedArray))&&(gt.length===2*this.width*this.height*this.depth)
}if(gs===gr.PIXELFORMAT_R8G8B8){return((gt instanceof Uint8Array)||(typeof Uint8ClampedArray!=="undefined"&&gt instanceof Uint8ClampedArray))&&(gt.length===3*this.width*this.height*this.depth)}if(gs===gr.PIXELFORMAT_R8G8B8A8){return((gt instanceof Uint8Array)||(typeof Uint8ClampedArray!=="undefined"&&gt instanceof Uint8ClampedArray))&&(gt.length===4*this.width*this.height*this.depth)}if((gs===gr.PIXELFORMAT_R5G5B5A1)||(gs===gr.PIXELFORMAT_R5G6B5)||(gs===gr.PIXELFORMAT_R4G4B4A4)){return(gt instanceof Uint16Array)&&(gt.length===this.width*this.height*this.depth)}}return false};gq.create=function(gI,gH){var gK=new gq();gK.gd=gI;gK.mipmaps=gH.mipmaps;gK.dynamic=gH.dynamic;gK.renderable=gH.renderable;gK.numDataLevels=0;gK.id=++gI.counters.textures;var gw=gH.src;if(gw){gK.name=gH.name||gw;var gz;var gJ=gH.data;if(gJ){if(gJ[0]===137&&gJ[1]===80&&gJ[2]===78&&gJ[3]===71){gz=".png"}else{if(gJ[0]===255&&gJ[1]===216&&gJ[2]===255&&(gJ[3]===224||gJ[3]===225)){gz=".jpg"}else{if(gJ[0]===68&&gJ[1]===68&&gJ[2]===83&&gJ[3]===32){gz=".dds"
}else{gz=gw.slice(-4)}}}}else{gz=gw.slice(-4)}if(gz===".dds"||gz===".tga"){if(gz===".tga"&&typeof cd!=="undefined"){var gv={gd:gI,onload:function gu(gQ,gP,gN,gR,gO){gK.width=gP;gK.height=gN;gK.depth=1;gK.format=gR;gK.cubemap=false;var gM=gK.createGLTexture(gQ);if(gH.onload){gH.onload(gM?gK:null,gO)}},onerror:function gr(gM){gK.failed=true;if(gH.onload){gH.onload(null,gM)}},data:undefined,src:undefined};if(gJ){gv.data=gJ}else{gv.src=gw}cd.create(gv);return gK}else{if(gz===".dds"&&typeof E!=="undefined"){var gA={gd:gI,onload:function gt(gP,gM,gT,gQ,gR,gS,gO,gN){gK.width=gM;gK.height=gT;gK.format=gQ;gK.cubemap=gS;gK.depth=gO;gK.numDataLevels=gR;var gU=gK.createGLTexture(gP);if(gH.onload){gH.onload(gU?gK:null,gN)}},onerror:function gD(gM){gK.failed=true;if(gH.onload){gH.onload(null,gM)}},data:undefined,src:undefined};if(gJ){gA.data=gJ}else{gA.src=gw}E.create(gA);return gK}else{(TurbulenzEngine).callOnError("Missing image loader required for "+gw);gK=gq.create(gI,{name:(gH.name||gw),width:2,height:2,depth:1,format:"R8G8B8A8",cubemap:false,mipmaps:gH.mipmaps,dynamic:gH.dynamic,renderable:gH.renderable,data:[255,20,147,255,255,0,0,255,255,255,255,255,255,20,147,255]});
if(gH.onload){if(TurbulenzEngine){TurbulenzEngine.setTimeout(function(){gH.onload(gK,200)},0)}else{window.setTimeout(function(){gH.onload(gK,200)},0)}}return gK}}}var gL=new Image();var gs=function gC(){gK.width=gL.width;gK.height=gL.height;gK.depth=1;gK.format=gI.PIXELFORMAT_R8G8B8A8;gK.cubemap=false;var gM=gK.createGLTexture(gL);if(gH.onload){gH.onload(gM?gK:null,200)}};gL.onload=gs;gL.onerror=function gG(){gK.failed=true;if(gH.onload){gH.onload(null)}};if(gJ){if(typeof Blob!=="undefined"&&typeof URL!=="undefined"&&URL.createObjectURL){var gE;if(gz===".jpg"||gz===".jpeg"){gE=new Blob([gJ],{type:"image/jpeg"})}else{if(gz===".png"){gE=new Blob([gJ],{type:"image/png"})}}gL.onload=function gy(){gs();URL.revokeObjectURL(gL.src)};gw=URL.createObjectURL(gE)}else{if(gz===".jpg"||gz===".jpeg"){gw="data:image/jpeg;base64,"+(TurbulenzEngine).base64Encode(gJ)}else{if(gz===".png"){gw="data:image/png;base64,"+(TurbulenzEngine).base64Encode(gJ)}}}gL.src=gw}else{if(typeof URL!=="undefined"&&URL.createObjectURL){var gx=new XMLHttpRequest();
gx.onreadystatechange=function(){if(gx.readyState===4){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){var gN=gx.status;if(gN===0&&(window.location.protocol==="file:"||window.location.protocol==="chrome-extension:")){gN=200}if(gx.getAllResponseHeaders()===""&&!gx.response){if(gH.onload){gH.onload(null,0)}}else{if(gN===200||gN===0){gL.onload=function gM(){gs();URL.revokeObjectURL(gL.src)};gL.src=URL.createObjectURL(gx.response)}else{gH.onload(null,gN)}}gx.onreadystatechange=null;gx=null}return gK}};gx.open("GET",gw,true);gx.responseType="blob";gx.send()}else{gL.crossOrigin="anonymous";gL.src=gw}}}else{if(""===gw&&gH.onload){return null}var gF=gH.format;if(typeof gF==="string"){gF=gI["PIXELFORMAT_"+gF]}gK.width=gH.width;gK.height=gH.height;gK.depth=gH.depth;gK.format=gF;gK.cubemap=gH.cubemap;gK.name=gH.name;var gB=gK.createGLTexture(gH.data);if(!gB){gK=null}if(gH.renderable){if(gI.PIXELFORMAT_D16===gF){gK.glDepthAttachment=gI.gl.DEPTH_ATTACHMENT}else{if(gI.PIXELFORMAT_D24S8===gF){gK.glDepthAttachment=gI.gl.DEPTH_STENCIL_ATTACHMENT
}}}if(gH.onload){gH.onload(gK,200)}}return gK};gq.version=1;return gq})();var eX=(function(){function gq(){}gq.prototype.play=function(gr){var gs=this.video;if(!this.playing){this.playing=true;this.paused=false}if(gr===undefined){gr=0}if(0.01<Math.abs(gs.currentTime-gr)){try{gs.currentTime=gr}catch(gt){}}gs.play();return true};gq.prototype.stop=function(){var gr=this.playing;if(gr){this.playing=false;this.paused=false;var gs=this.video;gs.pause();gs.currentTime=0}return gr};gq.prototype.pause=function(){if(this.playing){if(!this.paused){this.paused=true;this.video.pause()}return true}return false};gq.prototype.resume=function(gr){if(this.paused){this.paused=false;var gs=this.video;if(gr!==undefined){if(0.01<Math.abs(gs.currentTime-gr)){try{gs.currentTime=gr}catch(gt){}}}gs.play();return true}return false};gq.prototype.rewind=function(){if(this.playing){this.video.currentTime=0;return true}return false};gq.prototype.destroy=function(){this.stop();if(this.video){if(this.elementAdded){this.elementAdded=false;
TurbulenzEngine.canvas.parentElement.removeChild(this.video)}this.video=null}};gq.create=function(gw){var gE=new gq();var gx=gw.onload;var gH=gw.looping;var gs=gw.src;var gG=navigator.userAgent.toLowerCase();var gt=(document.createElement("video"));gt.preload="auto";gt.autobuffer=true;gt.muted=true;if(gH){if(gt.loop!==undefined&&!gG.match(/firefox/)){gt.loop=true}else{gt.onended=function(){gt.src=gs;gt.play()}}}else{gt.onended=function(){gE.playing=false}}gE.video=gt;gE.src=gs;gE.playing=false;gE.paused=false;if(gG.match(/safari/)&&!gG.match(/chrome/)){gt.setAttribute("style","visibility: hidden;");TurbulenzEngine.canvas.parentElement.appendChild(gt);gE.elementAdded=true}if(gt.webkitDecodedFrameCount!==undefined){var gv=-1,gy=0;Object.defineProperty(gE,"tell",{get:function gF(){if(gv!==this.video.webkitDecodedFrameCount){gv=this.video.webkitDecodedFrameCount;gy=this.video.currentTime}return gy},enumerable:true,configurable:false})}else{Object.defineProperty(gE,"tell",{get:function gF(){return this.video.currentTime
},enumerable:true,configurable:false})}Object.defineProperty(gE,"looping",{get:function gB(){return gH},enumerable:true,configurable:false});var gA=function gD(){if(gx){gx(null);gx=null}gt.removeEventListener("error",gA);gt=null;gE.video=null;gE.playing=false};gt.addEventListener("error",gA,false);var gr=function gz(){gE.length=gt.duration;gE.width=gt.videoWidth;gE.height=gt.videoHeight;if(gx){gx(gE,200);gx=null}gt.removeEventListener("progress",gu);gt.removeEventListener("canplaythrough",gr)};var gu=function gC(){if(0<gt.buffered.length&&gt.buffered.end(0)>=gt.duration){gr()}};gt.addEventListener("progress",gu,false);gt.addEventListener("canplaythrough",gr,false);gt.crossorigin="anonymous";gt.src=gs;return gE};gq.version=1;return gq})();var c8=(function(){function gq(){}gq.prototype.destroy=function(){var gs=this.gd;if(gs){var gr=this.glBuffer;if(gr){var gt=gs.gl;if(gt){gt.deleteRenderbuffer(gr)}delete this.glBuffer}delete this.gd}};gq.create=function(gz,gu){var gs=new gq();var gr=gu.width;
var gA=gu.height;var gy=gu.format;if(typeof gy==="string"){gy=gz["PIXELFORMAT_"+gy]}if(gy!==gz.PIXELFORMAT_D24S8&&gy!==gz.PIXELFORMAT_D16){return null}var gw=gz.gl;var gx=gw.createRenderbuffer();gw.bindRenderbuffer(gw.RENDERBUFFER,gx);var gt;var gv;if(gz.PIXELFORMAT_D16===gy){gt=gw.DEPTH_COMPONENT16;gv=gw.DEPTH_ATTACHMENT}else{gt=gw.DEPTH_STENCIL;gv=gw.DEPTH_STENCIL_ATTACHMENT}gw.renderbufferStorage(gw.RENDERBUFFER,gt,gr,gA);gs.width=gw.getRenderbufferParameter(gw.RENDERBUFFER,gw.RENDERBUFFER_WIDTH);gs.height=gw.getRenderbufferParameter(gw.RENDERBUFFER,gw.RENDERBUFFER_HEIGHT);gw.bindRenderbuffer(gw.RENDERBUFFER,null);if(gs.width<gr||gs.height<gA){gw.deleteRenderbuffer(gx);return null}gs.gd=gz;gs.format=gy;gs.glDepthAttachment=gv;gs.glBuffer=gx;gs.id=++gz.counters.renderBuffers;return gs};gq.version=1;return gq})();var gk=(function(){function gq(){}gq.prototype.copyBox=function(gs,gr){gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3]};gq.prototype.bind=function(){var gr=this.gd;var gu=gr.gl;
if(this.colorTexture0){gr.unbindTexture(this.colorTexture0.glTexture);if(this.colorTexture1){gr.unbindTexture(this.colorTexture1.glTexture);if(this.colorTexture2){gr.unbindTexture(this.colorTexture2.glTexture);if(this.colorTexture3){gr.unbindTexture(this.colorTexture3.glTexture)}}}}if(this.depthTexture){gr.unbindTexture(this.depthTexture.glTexture)}gu.bindFramebuffer(gu.FRAMEBUFFER,this.glObject);var gt=gr.drawBuffersExtension;if(gt){if(gr.WEBGL_draw_buffers){gt.drawBuffersWEBGL(this.buffers)}else{gt.drawBuffersEXT(this.buffers)}}var gs=gr.state;this.copyBox(this.oldViewportBox,gs.viewportBox);this.copyBox(this.oldScissorBox,gs.scissorBox);gr.setViewport(0,0,this.width,this.height);gr.setScissor(0,0,this.width,this.height);return true};gq.prototype.unbind=function(){var gs=this.gd;var gu=gs.gl;gu.bindFramebuffer(gu.FRAMEBUFFER,null);var gt=gs.drawBuffersExtension;if(gt){var gr=[gu.BACK];if(gs.WEBGL_draw_buffers){gt.drawBuffersWEBGL(gr)}else{gt.drawBuffersEXT(gr)}}gs.setViewport.apply(gs,this.oldViewportBox);
gs.setScissor.apply(gs,this.oldScissorBox);if(this.colorTexture0){this.colorTexture0.updateMipmaps(this.face);if(this.colorTexture1){this.colorTexture1.updateMipmaps(this.face);if(this.colorTexture2){this.colorTexture2.updateMipmaps(this.face);if(this.colorTexture3){this.colorTexture3.updateMipmaps(this.face)}}}}if(this.depthTexture){this.depthTexture.updateMipmaps(this.face)}};gq.prototype.destroy=function(){var gs=this.gd;if(gs){var gr=this.glObject;if(gr){var gt=gs.gl;if(gt){gt.deleteFramebuffer(gr)}delete this.glObject}delete this.colorTexture0;delete this.colorTexture1;delete this.colorTexture2;delete this.colorTexture3;delete this.depthBuffer;delete this.depthTexture;delete this.gd}};gq.create=function(gJ,gI){var gr=new gq();var gw=(gI.colorTexture0);var gu=(gw?(gI.colorTexture1||null):null);var gt=(gu?(gI.colorTexture2||null):null);var gs=(gt?(gI.colorTexture3||null):null);var gF=(gI.depthBuffer||null);var gy=(gI.depthTexture||null);var gz=gI.face;var gx=gJ.maxSupported("RENDERTARGET_COLOR_TEXTURES");
if(gu&&gx<2){return null}if(gt&&gx<3){return null}if(gs&&gx<4){return null}var gE=gJ.gl;var gv=gE.COLOR_ATTACHMENT0;var gG=gE.createFramebuffer();gE.bindFramebuffer(gE.FRAMEBUFFER,gG);var gC,gB;if(gw){gC=gw.width;gB=gw.height;var gA=gw.glTexture;if(gA===undefined){(TurbulenzEngine).callOnError("Color texture is not a Texture");gE.bindFramebuffer(gE.FRAMEBUFFER,null);gE.deleteFramebuffer(gG);return null}if(gw.cubemap){gE.framebufferTexture2D(gE.FRAMEBUFFER,gv,(gE.TEXTURE_CUBE_MAP_POSITIVE_X+gz),gA,0)}else{gE.framebufferTexture2D(gE.FRAMEBUFFER,gv,gE.TEXTURE_2D,gA,0)}if(gu){gA=gu.glTexture;if(gu.cubemap){gE.framebufferTexture2D(gE.FRAMEBUFFER,(gv+1),(gE.TEXTURE_CUBE_MAP_POSITIVE_X+gz),gA,0)}else{gE.framebufferTexture2D(gE.FRAMEBUFFER,(gv+1),gE.TEXTURE_2D,gA,0)}if(gt){gA=gt.glTexture;if(gu.cubemap){gE.framebufferTexture2D(gE.FRAMEBUFFER,(gv+2),(gE.TEXTURE_CUBE_MAP_POSITIVE_X+gz),gA,0)}else{gE.framebufferTexture2D(gE.FRAMEBUFFER,(gv+2),gE.TEXTURE_2D,gA,0)}if(gs){gA=gs.glTexture;if(gu.cubemap){gE.framebufferTexture2D(gE.FRAMEBUFFER,(gv+3),(gE.TEXTURE_CUBE_MAP_POSITIVE_X+gz),gA,0)
}else{gE.framebufferTexture2D(gE.FRAMEBUFFER,(gv+3),gE.TEXTURE_2D,gA,0)}}}}}else{if(gy){gC=gy.width;gB=gy.height}else{if(gF){gC=gF.width;gB=gF.height}else{(TurbulenzEngine).callOnError("No RenderBuffers or Textures specified for this RenderTarget");gE.bindFramebuffer(gE.FRAMEBUFFER,null);gE.deleteFramebuffer(gG);return null}}}if(gy){gE.framebufferTexture2D(gE.FRAMEBUFFER,gy.glDepthAttachment,gE.TEXTURE_2D,gy.glTexture,0)}else{if(gF){gE.framebufferRenderbuffer(gE.FRAMEBUFFER,gF.glDepthAttachment,gE.RENDERBUFFER,gF.glBuffer)}}var gD=gE.checkFramebufferStatus(gE.FRAMEBUFFER);gE.bindFramebuffer(gE.FRAMEBUFFER,null);if(gD!==gE.FRAMEBUFFER_COMPLETE){gE.deleteFramebuffer(gG);return null}gr.gd=gJ;gr.glObject=gG;gr.colorTexture0=gw;gr.colorTexture1=gu;gr.colorTexture2=gt;gr.colorTexture3=gs;gr.depthBuffer=gF;gr.depthTexture=gy;gr.width=gC;gr.height=gB;gr.face=gz;if(gJ.drawBuffersExtension){var gH;if(gw){gH=[gv];if(gu){gH.push(gv+1);if(gt){gH.push(gv+2);if(gs){gH.push(gv+3)}}}}else{gH=[gE.NONE]}gr.buffers=gH
}gr.id=++gJ.counters.renderTargets;return gr};gq.version=1;return gq})();gk.prototype.oldViewportBox=[];gk.prototype.oldScissorBox=[];var eM=(function(){function gq(){}gq.prototype.map=function(gt,gz){if(gt===undefined){gt=0}if(gz===undefined){gz=this.numIndices}var gy=this.gd;var gv=gy.gl;var gx=this.format;var gu;if(gx===gv.UNSIGNED_BYTE){gu=new Uint8Array(gz)}else{if(gx===gv.UNSIGNED_SHORT){gu=new Uint16Array(gz)}else{gu=new Uint32Array(gz)}}var gw=0;var gs=function gA(){var gB=arguments.length;for(var gC=0;gC<gB;gC+=1){gu[gw]=arguments[gC];gw+=1}};gs.write=gs;gs.data=gu;gs.offset=gt;gs.getNumWrittenIndices=function gr(){return gw};gs.write=gs;return gs};gq.prototype.unmap=function(gt){if(gt){var gr=this.gd;var gw=gr.gl;var gs=gt.data;delete gt.data;var gv=gt.offset;delete gt.write;var gu=gt.getNumWrittenIndices();if(!gu){return}if(gu<gs.length){gs=gs.subarray(0,gu)}gr.setIndexBuffer(this);if(gu<this.numIndices){gw.bufferSubData(gw.ELEMENT_ARRAY_BUFFER,gv,gs)}else{gw.bufferData(gw.ELEMENT_ARRAY_BUFFER,gs,this.usage)
}}};gq.prototype.setData=function(gt,gx,gw){if(gx===undefined){gx=0}if(gw===undefined){gw=this.numIndices}var gs=this.gd;var gv=gs.gl;var gr;var gu=this.format;if(gu===gv.UNSIGNED_BYTE){if(gt instanceof Uint8Array){gr=gt}else{gr=new Uint8Array(gt)}}else{if(gu===gv.UNSIGNED_SHORT){if(gt instanceof Uint16Array){gr=gt}else{gr=new Uint16Array(gt)}gx*=2}else{if(gu===gv.UNSIGNED_INT){if(gt instanceof Uint32Array){gr=gt}else{gr=new Uint32Array(gt)}gx*=4}}}gt=undefined;if(gw<gr.length){gr=gr.subarray(0,gw)}gs.setIndexBuffer(this);if(gw<this.numIndices){gv.bufferSubData(gv.ELEMENT_ARRAY_BUFFER,gx,gr)}else{gv.bufferData(gv.ELEMENT_ARRAY_BUFFER,gr,this.usage)}};gq.prototype.destroy=function(){var gs=this.gd;if(gs){var gr=this.glBuffer;if(gr){var gt=gs.gl;if(gt){gs.unsetIndexBuffer(this);gt.deleteBuffer(gr)}delete this.glBuffer}delete this.gd}};gq.create=function(gs,gx){var gw=gs.gl;var gr=new gq();gr.gd=gs;var gv=gx.numIndices;gr.numIndices=gv;var gu=gx.format;if(typeof gu==="string"){gu=gs["INDEXFORMAT_"+gu]
}gr.format=gu;var gt;if(gu===gw.UNSIGNED_BYTE){gt=1}else{if(gu===gw.UNSIGNED_SHORT){gt=2}else{gt=4}}gr.stride=gt;gr["transient"]=(gx["transient"]||false);gr.dynamic=(gx.dynamic||gr["transient"]);gr.usage=(gr["transient"]?gw.STREAM_DRAW:(gr.dynamic?gw.DYNAMIC_DRAW:gw.STATIC_DRAW));gr.glBuffer=gw.createBuffer();if(gx.data){gr.setData(gx.data,0,gv)}else{gs.setIndexBuffer(gr);gw.bufferData(gw.ELEMENT_ARRAY_BUFFER,(gv*gt),gr.usage)}gr.id=++gs.counters.indexBuffers;return gr};gq.version=1;return gq})();var bv=(function(){function gq(){}gq.create=function(gv,gr){var gt=new gq();var gw=gr.length;gt.length=gw;for(var gs=0;gs<gw;gs+=1){var gu=gr[gs];if(typeof gu==="string"){gt[gs]=gv["SEMANTIC_"+gu]}else{gt[gs]=gu}}return gt};gq.version=1;return gq})();var bi=(function(){function gq(){}gq.prototype.map=function(gv,gC){if(gv===undefined){gv=0}if(gC===undefined){gC=this.numVertices}var gI=this.gd;var gE=gI.gl;var gA=this.stride;var gz=this.attributes;var gx=gz.length;var gJ,gD;var gy=0;if(this.hasSingleFormat){var gK=(gC*gA);
var gF=gz[0].format;if(gF===gE.FLOAT){gJ=new Float32Array(gK)}else{if(gF===gE.BYTE){gJ=new Int8Array(gK)}else{if(gF===gE.UNSIGNED_BYTE){gJ=new Uint8Array(gK)}else{if(gF===gE.SHORT){gJ=new Int16Array(gK)}else{if(gF===gE.UNSIGNED_SHORT){gJ=new Uint16Array(gK)}else{if(gF===gE.INT){gJ=new Int32Array(gK)}else{if(gF===gE.UNSIGNED_INT){gJ=new Uint32Array(gK)}}}}}}}gD=function gB(){var gR=arguments.length;var gU=0;for(var gS=0;gS<gx;gS+=1){var gM=gz[gS];var gN=gM.numComponents;var gO=0,gQ;do{if(gU<gR){var gT=arguments[gU];gU+=1;if(typeof gT==="number"){if(gM.normalized){gT*=gM.normalizationScale}gJ[gy]=gT;gy+=1;gO+=1}else{if(gO===0){var gL=gT.length;if(gL>gN){gL=gN}if(gM.normalized){var gP=gM.normalizationScale;for(gQ=0;gQ<gL;gQ+=1){gJ[gy]=(gT[gQ]*gP);gy+=1;gO+=1}}else{for(gQ=0;gQ<gL;gQ+=1){gJ[gy]=gT[gQ];gy+=1;gO+=1}}while(gO<gN){gy+=1;gO+=1}break}else{(TurbulenzEngine).callOnError("Missing values for attribute "+gS);return null}}}else{gy+=1;gO+=1}}while(gO<gN)}}}else{var gs=0;var gu=(gC*this.strideInBytes);
gJ=new ArrayBuffer(gu);if(typeof DataView!=="undefined"&&"setFloat32" in DataView.prototype){var gr=new DataView(gJ);gD=function gH(){var gT=arguments.length;var gW=0;for(var gU=0;gU<gx;gU+=1){var gN=gz[gU];var gO=gN.numComponents;var gR=gN.typedSetter;var gL=gN.componentStride;var gP=0,gS;do{if(gW<gT){var gV=arguments[gW];gW+=1;if(typeof gV==="number"){if(gN.normalized){gV*=gN.normalizationScale}gR.call(gr,gs,gV,true);gs+=gL;gP+=1;gy+=1}else{if(gP===0){var gM=gV.length;if(gM>gO){gM=gO}if(gN.normalized){var gQ=gN.normalizationScale;for(gS=0;gS<gM;gS+=1){gR.call(gr,gs,(gV[gS]*gQ),true);gs+=gL;gP+=1;gy+=1}}else{for(gS=0;gS<gM;gS+=1){gR.call(gr,gs,gV[gS],true);gs+=gL;gP+=1;gy+=1}}while(gP<gO){gy+=1;gP+=1}break}else{(TurbulenzEngine).callOnError("Missing values for attribute "+gU);return null}}}else{gy+=1;gP+=1}}while(gP<gO)}}}else{gD=function gt(){var gR=arguments.length;var gV=0;var gU;for(var gS=0;gS<gx;gS+=1){var gM=gz[gS];var gN=gM.numComponents;gU=new gM.typedArray(gJ,gs,gN);gs+=gM.stride;
var gO=0,gQ;do{if(gV<gR){var gT=arguments[gV];gV+=1;if(typeof gT==="number"){if(gM.normalized){gT*=gM.normalizationScale}gU[gO]=gT;gO+=1;gy+=1}else{if(gO===0){var gL=gT.length;if(gL>gN){gL=gN}if(gM.normalized){var gP=gM.normalizationScale;for(gQ=0;gQ<gL;gQ+=1){gU[gO]=(gT[gQ]*gP);gO+=1;gy+=1}}else{for(gQ=0;gQ<gL;gQ+=1){gU[gO]=gT[gQ];gO+=1;gy+=1}}while(gO<gN){gO+=1;gy+=1}break}else{(TurbulenzEngine).callOnError("Missing values for attribute "+gS);return null}}}else{gO+=1;gy+=1}}while(gO<gN)}}}}gD.data=gJ;gD.offset=gv;gD.getNumWrittenVertices=function gG(){return Math.floor(gy/gA)};gD.getNumWrittenValues=function gw(){return gy};gD.write=gD;return gD};gq.prototype.unmap=function(gt){if(gt){var gv=gt.data;delete gt.data;delete gt.write;var gx=gt.getNumWrittenVertices();if(!gx){return}var gu=gt.offset;var gs=this.strideInBytes;if(this.hasSingleFormat){var gy=gt.getNumWrittenValues();if(gy<gv.length){gv=gv.subarray(0,gy)}}else{var gr=(gx*gs);if(gr<gv.byteLength){gv=gv.slice(0,gr)}}var gz=this.gd;
var gw=gz.gl;gz.bindVertexBuffer(this.glBuffer);if(gx<this.numVertices){gw.bufferSubData(gw.ARRAY_BUFFER,(gu*gs),gv)}else{gw.bufferData(gw.ARRAY_BUFFER,gv,this.usage)}}};gq.prototype.setData=function(gQ,gv,gG){if(gv===undefined){gv=0}if(gG===undefined){gG=this.numVertices}var gN=this.gd;var gH=gN.gl;var gu=this.strideInBytes;if(gQ.constructor===ArrayBuffer){gN.bindVertexBuffer(this.glBuffer);if(gG<this.numVertices){gH.bufferSubData(gH.ARRAY_BUFFER,(gv*gu),gQ)}else{gH.bufferData(gH.ARRAY_BUFFER,gQ,this.usage)}return}var gy=this.attributes;var gw=this.numAttributes;var gC,gI,gE,gB;if(this.hasSingleFormat){gC=gy[0];gI=gC.format;if(gI===gH.FLOAT){if(!(gQ instanceof Float32Array)){gB=Float32Array}}else{if(gI===gH.BYTE){if(!(gQ instanceof Int8Array)){gB=Int8Array}}else{if(gI===gH.UNSIGNED_BYTE){if(!(gQ instanceof Uint8Array)){gB=Uint8Array}}else{if(gI===gH.SHORT){if(!(gQ instanceof Int16Array)){gB=Int16Array}}else{if(gI===gH.UNSIGNED_SHORT){if(!(gQ instanceof Uint16Array)){gB=Uint16Array}}else{if(gI===gH.INT){if(!(gQ instanceof Int32Array)){gB=Int32Array
}}else{if(gI===gH.UNSIGNED_INT){if(!(gQ instanceof Uint32Array)){gB=Uint32Array}}}}}}}}var gF=this.stride;var gx=(gG*gF);if(gB){if(gC.normalized){gQ=this.scaleValues(gQ,gC.normalizationScale,gx)}gE=new gB(gQ);if(gx<gE.length){gE=gE.subarray(0,gx)}}else{gE=gQ}if(gx<gQ.length){gE=gE.subarray(0,gx)}}else{var gt=(gG*gu);gE=new ArrayBuffer(gt);var gD=0,gs=0,gA,gK,gM,gL,gO,gP;if(typeof DataView!=="undefined"&&"setFloat32" in DataView.prototype){var gr=new DataView(gE);for(gA=0;gA<gG;gA+=1){for(gM=0;gM<gw;gM+=1){gC=gy[gM];gL=gC.numComponents;gO=gC.componentStride;var gJ=gC.typedSetter;if(gC.normalized){gP=gC.normalizationScale;for(gK=0;gK<gL;gK+=1){gJ.call(gr,gs,(gQ[gD]*gP),true);gs+=gO;gD+=1}}else{for(gK=0;gK<gL;gK+=1){gJ.call(gr,gs,gQ[gD],true);gs+=gO;gD+=1}}}}}else{for(gA=0;gA<gG;gA+=1){for(gM=0;gM<gw;gM+=1){gC=gy[gM];gL=gC.numComponents;var gz=new gC.typedArray(gE,gs,gL);gs+=gC.stride;if(gC.normalized){gP=gC.normalizationScale;for(gK=0;gK<gL;gK+=1){gz[gK]=(gQ[gD]*gP);gD+=1}}else{for(gK=0;gK<gL;
gK+=1){gz[gK]=gQ[gD];gD+=1}}}}}}gQ=undefined;gN.bindVertexBuffer(this.glBuffer);if(gG<this.numVertices){gH.bufferSubData(gH.ARRAY_BUFFER,(gv*gu),gE)}else{gH.bufferData(gH.ARRAY_BUFFER,gE,this.usage)}};gq.prototype.scaleValues=function(gs,gu,gr){if(gr===undefined){gr=gs.length}var gt=new gs.constructor(gr);for(var gv=0;gv<gr;gv+=1){gt[gv]=(gs[gv]*gu)}return gt};gq.prototype.bindAttributes=function(gA,gw,gv){var gB=this.gd;var gx=gB.gl;var gz=this.attributes;var gs=this.strideInBytes;var gy=0;for(var gu=0;gu<gA;gu+=1){var gr=gz[gu];var gt=gw[gu];gy|=(1<<gt);gx.vertexAttribPointer(gt,gr.numComponents,gr.format,gr.normalized,gs,gv);gv+=gr.stride}return gy};gq.prototype.setAttributes=function(gr){var gt=this.gd;var gy=gr.length;this.numAttributes=gy;this.attributes=[];var gw=0,gv=0,gu=true;for(var gs=0;gs<gy;gs+=1){var gx=gr[gs];if(typeof gx==="string"){gx=gt["VERTEXFORMAT_"+gx]}this.attributes[gs]=gx;gw+=gx.stride;gv+=gx.numComponents;if(gu&&gs){if(gx.format!==this.attributes[gs-1].format){gu=false
}}}this.strideInBytes=gw;this.stride=gv;this.hasSingleFormat=gu;return gw};gq.prototype.resize=function(gs){if(gs!==(this.strideInBytes*this.numVertices)){var gt=this.gd;var gu=gt.gl;gt.bindVertexBuffer(this.glBuffer);var gr=gu.ARRAY_BUFFER;gu.bufferData(gr,gs,this.usage);var gv=gu.getBufferParameter(gr,gu.BUFFER_SIZE);this.numVertices=Math.floor(gv/this.strideInBytes)}};gq.prototype.destroy=function(){var gs=this.gd;if(gs){var gr=this.glBuffer;if(gr){var gt=gs.gl;if(gt){gs.unbindVertexBuffer(gr);gt.deleteBuffer(gr)}delete this.glBuffer}delete this.gd}};gq.create=function(gt,gv){var gu=gt.gl;var gs=new gq();gs.gd=gt;var gr=gv.numVertices;gs.numVertices=gr;var gx=gs.setAttributes(gv.attributes);gs["transient"]=(gv["transient"]||false);gs.dynamic=(gv.dynamic||gs["transient"]);gs.usage=(gs["transient"]?gu.STREAM_DRAW:(gs.dynamic?gu.DYNAMIC_DRAW:gu.STATIC_DRAW));gs.glBuffer=gu.createBuffer();var gw=(gr*gx);if(gv.data){gs.setData(gv.data,0,gr)}else{gt.bindVertexBuffer(gs.glBuffer);gu.bufferData(gu.ARRAY_BUFFER,gw,gs.usage)
}gs.id=++gt.counters.vertexBuffers;return gs};gq.version=1;return gq})();var cJ=(function(){function gq(){}gq.prototype.updateParametersData=function(gx){var gu=gx.gl;this.dirty=false;var gz=this.parameters;for(var gr in gz){if(gz.hasOwnProperty(gr)){var gw=gz[gr];if(gw.dirty){gw.dirty=0;var gv=gw.info;var gy=gw.location;if(gv&&null!==gy){var gt=gv.values;var gs;if(gv.type==="float"){gs=gv.columns;if(4===gs){gu.uniform4fv(gy,gt)}else{if(3===gs){gu.uniform3fv(gy,gt)}else{if(2===gs){gu.uniform2fv(gy,gt)}else{if(1===gv.rows){gu.uniform1f(gy,gt[0])}else{gu.uniform1fv(gy,gt)}}}}}else{if(gv.sampler!==undefined){gx.setTexture(gw.textureUnit,gt,gv.sampler)}else{gs=gv.columns;if(4===gs){gu.uniform4iv(gy,gt)}else{if(3===gs){gu.uniform3iv(gy,gt)}else{if(2===gs){gu.uniform2iv(gy,gt)}else{if(1===gv.rows){gu.uniform1i(gy,gt[0])}else{gu.uniform1iv(gy,gt)}}}}}}}}}}};gq.prototype.initializeParameters=function(gz){var gw=gz.gl;var gv=this.glProgram;gz.setProgram(gv);var gs=this.parameters;for(var gr in gs){if(gs.hasOwnProperty(gr)){var gy=gs[gr];
var gx=gy.info;if(gx){var gA=gw.getUniformLocation(gv,gr);if(null!==gA){gy.location=gA;if(gx.sampler){gw.uniform1i(gA,gy.textureUnit)}else{var gu=gx.values;var gt;if(gx.type==="float"){gt=gx.columns;if(4===gt){gw.uniform4fv(gA,gu)}else{if(3===gt){gw.uniform3fv(gA,gu)}else{if(2===gt){gw.uniform2fv(gA,gu)}else{if(1===gx.rows){gw.uniform1f(gA,gu[0])}else{gw.uniform1fv(gA,gu)}}}}}else{gt=gx.columns;if(4===gt){gw.uniform4iv(gA,gu)}else{if(3===gt){gw.uniform3iv(gA,gu)}else{if(2===gt){gw.uniform2iv(gA,gu)}else{if(1===gx.rows){gw.uniform1i(gA,gu[0])}else{gw.uniform1iv(gA,gu)}}}}}}}}}}};gq.prototype.destroy=function(){delete this.glProgram;delete this.semanticsMask;delete this.parameters;delete this.states;delete this.statesSet};gq.create=function(gW,gr,gR){var gP=gW.gl;var gt=new gq();gt.name=(gR.name||null);var gu=gr.programs;var gE=gr.parameters;var gv=gR.parameters;var gF=gR.programs;var gQ=gR.semantics;var gC=gR.states;var gS=gF.join(":");var gL=gr.linkedPrograms[gS];var gH,gY,gN,gM;if(gL===undefined){gH=gP.createProgram();
var gV=gF.length;for(gN=0;gN<gV;gN+=1){var gU=gu[gF[gN]];if(gU){gP.attachShader(gH,gU)}}var gI=gQ.length;gY=0;for(gM=0;gM<gI;gM+=1){var gK=gQ[gM];var gJ=gW["SEMANTIC_"+gK];if(gJ!==undefined){gY|=(1<<gJ);gP.bindAttribLocation(gH,gJ,("ATTR"+gJ))}}gP.linkProgram(gH);gr.linkedPrograms[gS]={glProgram:gH,semanticsMask:gY}}else{gH=gL.glProgram;gY=gL.semanticsMask}gt.glProgram=gH;gt.semanticsMask=gY;var gO=0;var gG={};gt.parameters=gG;var gB=gv?gv.length:0;for(gN=0;gN<gB;gN+=1){var gT=gv[gN];var gz={};gG[gT]=gz;var gy=gE[gT];gz.info=gy;if(gy){gz.location=null;if(gy.sampler){gz.textureUnit=gO;gO+=1}else{gz.textureUnit=undefined}}}gt.numTextureUnits=gO;gt.numParameters=gB;function gs(g2,gZ){var g0=g2.length;var g1;for(g1=0;g1<g0;g1+=1){if(g2[g1]!==gZ[g1]){return false}}return true}var gA=gW.stateHandlers;var gx=[];var gD={};gt.states=gx;gt.statesSet=gD;for(gM in gC){if(gC.hasOwnProperty(gM)){var gX=gA[gM];if(gX){var gw=gX.parse(gC[gM]);if(gw!==null){if(gs(gX.defaultValues,gw)){continue}gx.push({name:gM,set:gX.set,reset:gX.reset,values:gw});
gD[gM]=true}else{(TurbulenzEngine).callOnError("Unknown value for state "+gM+": "+gC[gM])}}}}return gt};gq.version=1;return gq})();var B=(function(){function gq(){}gq.prototype.getPass=function(gv){var gt=this.passes;var gs=gt.length;if(typeof gv==="string"){for(var gu=0;gu<gs;gu+=1){var gr=gt[gu];if(gr.name===gv){return gr}}}else{gv=(gv|0);if(gv<gs){return gt[gv]}}return null};gq.prototype.activate=function(gr){this.device=gr;if(!this.initialized){this.shader.initialize(gr);this.initialize(gr)}};gq.prototype.deactivate=function(){this.device=null};gq.prototype.checkProperties=function(gs){var gu={},gt;for(gt in this){if(gt!=="version"&&gt!=="name"&&gt!=="id"&&gt!=="passes"&&gt!=="numPasses"&&gt!=="device"&&gt!=="numParameters"){gu[gt]=this[gt]}}if(gu){var gr=this.passes;if(gr.length===1){gs.setParametersImmediate(gr[0].parameters,gu)}else{gs.setParametersDeferred(gs,gr,gu)}for(gt in gu){if(gu.hasOwnProperty(gt)){delete this[gt]}}}};gq.prototype.initialize=function(gt){if(this.initialized){return
}var gs=this.passes;if(gs){var gr=gs.length;var gu;for(gu=0;gu<gr;gu+=1){gs[gu].initializeParameters(gt)}}if(Object.defineProperty){this.initializeParametersSetters(gt)}this.initialized=true};gq.prototype.initializeParametersSetters=function(gA){var gt=gA.gl;function gD(gE,gF){return function(gG){if(this.device){gA.setTexture(gF.textureUnit,gG,gF.info.sampler)}else{gE.dirty=true;gF.dirty=1;gF.info.values=gG}}}function gz(gG,gI){var gF=gI.info;var gE=gI.location;function gH(gM){if(typeof gM!=="number"){var gL=gF.values;var gK=Math.min(gF.numValues,gM.length);for(var gJ=0;gJ<gK;gJ+=1){gL[gJ]=gM[gJ]}gI.dirty=Math.max(gK,(gI.dirty||0))}else{gF.values[0]=gM;gI.dirty=(gI.dirty||1)}gG.dirty=true}switch(gF.columns){case 1:if(1===gF.numValues){return function(gJ){if(this.device){gt.uniform1f(gE,gJ)}else{gH(gJ)}}}return function(gJ){if(this.device){gt.uniform1fv(gE,gJ)}else{gH(gJ)}};case 2:return function(gJ){if(this.device){gt.uniform2fv(gE,gJ)}else{gH(gJ)}};case 3:return function(gJ){if(this.device){gt.uniform3fv(gE,gJ)
}else{gH(gJ)}};case 4:return function(gJ){if(this.device){gt.uniform4fv(gE,gJ)}else{gH(gJ)}};default:return null}}function gu(gG,gI){var gF=gI.info;var gE=gI.location;function gH(gM){if(typeof gM!=="number"){var gL=gF.values;var gK=Math.min(gF.numValues,gM.length);for(var gJ=0;gJ<gK;gJ+=1){gL[gJ]=gM[gJ]}gI.dirty=Math.max(gK,(gI.dirty||0))}else{gF.values[0]=gM;gI.dirty=(gI.dirty||1)}gG.dirty=true}switch(gF.columns){case 1:if(1===gF.numValues){return function(gJ){if(this.device){gt.uniform1i(gE,gJ)}else{gH(gJ)}}}return function(gJ){if(this.device){gt.uniform1iv(gE,gJ)}else{gH(gJ)}};case 2:return function(gJ){if(this.device){gt.uniform2iv(gE,gJ)}else{gH(gJ)}};case 3:return function(gJ){if(this.device){gt.uniform3iv(gE,gJ)}else{gH(gJ)}};case 4:return function(gJ){if(this.device){gt.uniform4iv(gE,gJ)}else{gH(gJ)}};default:return null}}var gx=this.passes;var gw=gx.length;var gB,gC,gr,gy,gv,gs;if(gw===1){gB=gx[0];gC=gB.parameters;for(gr in gC){if(gC.hasOwnProperty(gr)){gy=gC[gr];gv=gy.info;if(gv){if(undefined!==gy.location){if(gv.sampler){gs=gD(gB,gy)
}else{if(gv.type==="float"){gs=gz(gB,gy)}else{gs=gu(gB,gy)}}Object.defineProperty(this,gr,{set:gs,enumerable:false,configurable:false})}}}}this.checkProperties=null}else{Object.defineProperty(this,"device",{writable:true,enumerable:false,configurable:false});Object.defineProperty(this,"version",{writable:false,enumerable:false,configurable:false});Object.defineProperty(this,"name",{writable:false,enumerable:false,configurable:false});Object.defineProperty(this,"id",{writable:false,enumerable:false,configurable:false});Object.defineProperty(this,"passes",{writable:false,enumerable:false,configurable:false});Object.defineProperty(this,"numParameters",{writable:false,enumerable:false,configurable:false})}};gq.prototype.destroy=function(){var gs=this.passes;if(gs){var gr=gs.length;var gt;for(gt=0;gt<gr;gt+=1){gs[gt].destroy()}gs.length=0;delete this.passes}delete this.device};gq.create=function(gz,gw,gr,gy){var gs=new gq();gs.initialized=false;gs.shader=gw;gs.name=gr;var gx=gy.length,gt;var gu=0;
gs.passes=[];gs.numPasses=gx;for(gt=0;gt<gx;gt+=1){var gv=gy[gt];if(gv.parameters){gu+=gv.parameters.length}gs.passes[gt]=cJ.create(gz,gw,gv)}gs.numParameters=gu;gs.device=null;gs.id=++gz.counters.techniques;if(1<gx){if(gz.drawArray!==gz.drawArrayMultiPass){gz.drawArray=gz.drawArrayMultiPass}}return gs};gq.version=1;return gq})();var a6=(function(){function gq(){}gq.prototype.getTechnique=function(gr){if(typeof gr==="string"){return this.techniques[gr]}else{var gt=this.techniques;for(var gs in gt){if(gt.hasOwnProperty(gs)){if(gr===0){return gt[gs]}else{gr-=1}}}return null}};gq.prototype.getParameter=function(gr){if(typeof gr==="string"){return this.parameters[gr]}else{gr=(gr|0);var gs=this.parameters;for(var gt in gs){if(gs.hasOwnProperty(gt)){if(gr===0){return gs[gt]}else{gr-=1}}}return null}};gq.prototype.initialize=function(gC){if(this.initialized){return}var gv=gC.gl;var gs;var gx=this.programs;for(gs in gx){if(gx.hasOwnProperty(gs)){var gy=gx[gs];var gA=gv.getShaderParameter(gy,gv.COMPILE_STATUS);
if(!gA){var gu=gv.getShaderInfoLog(gy);(TurbulenzEngine).callOnError('Program "'+gs+'" failed to compile: '+gu)}}}var gw=this.linkedPrograms;for(gs in gw){if(gw.hasOwnProperty(gs)){var gB=gw[gs];var gt=gB.glProgram;if(gt){var gr=gv.getProgramParameter(gt,gv.LINK_STATUS);if(!gr){var gz=gv.getProgramInfoLog(gt);(TurbulenzEngine).callOnError('Program "'+gs+'" failed to link: '+gz)}}}}this.initialized=true};gq.prototype.destroy=function(){var gs=this.gd;if(gs){var gw=gs.gl;var gv;var gu=this.techniques;if(gu){for(gv in gu){if(gu.hasOwnProperty(gv)){gu[gv].destroy()}}delete this.techniques}var gr=this.linkedPrograms;if(gr){if(gw){for(gv in gr){if(gr.hasOwnProperty(gv)){var gy=gr[gv];var gx=gy.glProgram;if(gx){gw.deleteProgram(gx);delete gy.glProgram}}}}delete this.linkedPrograms}var gt=this.programs;if(gt){if(gw){for(gv in gt){if(gt.hasOwnProperty(gv)){gw.deleteShader(gt[gv])}}}delete this.programs}delete this.samplers;delete this.parameters;delete this.gd}};gq.create=function(gM,gK){var gI=gM.gl;
var gr=new gq();gr.initialized=false;var gE=gK.techniques;var gA=gK.parameters;var gs=gK.programs;var gN=gK.samplers;var gG;gr.gd=gM;gr.name=gK.name;var gJ={};gr.programs=gJ;for(gG in gs){if(gs.hasOwnProperty(gG)){var gC=gs[gG];var gO;if(gC.type==="fragment"){gO=gI.FRAGMENT_SHADER}else{if(gC.type==="vertex"){gO=gI.VERTEX_SHADER}}var gL=gI.createShader(gO);gI.shaderSource(gL,gC.code);gI.compileShader(gL);gJ[gG]=gL}}var gH={};gr.linkedPrograms=gH;var gx=gM.DEFAULT_SAMPLER;var gu=gM.maxAnisotropy;gr.samplers={};var gF;for(gG in gN){if(gN.hasOwnProperty(gG)){gF=gN[gG];var gz=gF.MaxAnisotropy;if(gz){if(gz>gu){gz=gu}}else{gz=gx.maxAnisotropy}gF={minFilter:(gF.MinFilter||gx.minFilter),magFilter:(gF.MagFilter||gx.magFilter),wrapS:(gF.WrapS||gx.wrapS),wrapT:(gF.WrapT||gx.wrapT),wrapR:(gF.WrapR||gx.wrapR),maxAnisotropy:gz};if(gF.wrapS===10496){gF.wrapS=gI.CLAMP_TO_EDGE}if(gF.wrapT===10496){gF.wrapT=gI.CLAMP_TO_EDGE}if(gF.wrapR===10496){gF.wrapR=gI.CLAMP_TO_EDGE}gr.samplers[gG]=gM.createSampler(gF)
}}var gw=0;gr.parameters={};for(gG in gA){if(gA.hasOwnProperty(gG)){var gv=gA[gG];if(!gv.columns){gv.columns=1}if(!gv.rows){gv.rows=1}gv.numValues=(gv.columns*gv.rows);var gt=gv.type;if(gt==="float"||gt==="int"||gt==="bool"){var gy=gv.values;if(gy){if(gt==="float"){gv.values=new Float32Array(gy)}else{gv.values=new Int32Array(gy)}}else{if(gt==="float"){gv.values=new Float32Array(gv.numValues)}else{gv.values=new Int32Array(gv.numValues)}}gv.sampler=undefined}else{gF=gr.samplers[gG];if(!gF){gF=gx;gr.samplers[gG]=gx}gv.sampler=gF;gv.values=null}gv.name=gG;gr.parameters[gG]=gv;gw+=1}}gr.numParameters=gw;var gB={};var gD=0;gr.techniques=gB;for(gG in gE){if(gE.hasOwnProperty(gG)){gB[gG]=B.create(gM,gr,gG,gE[gG]);gD+=1}}gr.numTechniques=gD;gr.id=++gM.counters.shaders;return gr};gq.version=1;return gq})();var bO=(function(){function gq(){}gq.create=function(gt){var gr=new gq();if(gt){for(var gs in gt){if(gt.hasOwnProperty(gs)){gr[gs]=gt[gs]}}}return gr};return gq})();var fk=function fZ(gs){if(Float32Array.prototype.map===undefined){Float32Array.prototype.map=function gq(gx,gw){if(gx===undefined){gx=0
}var gu=this;if(gw===undefined){gw=this.length}function gv(){var gz=arguments.length;for(var gy=0;gy<gz;gy+=1){var gA=arguments[gy];if(typeof gA==="number"){gu[gx]=gA;gx+=1}else{gu.setData(gA,gx,gA.length);gx+=gA.length}}}return gv};Float32Array.prototype.unmap=function gr(gu){};Float32Array.prototype.setData=function gt(gv,gw,gu){if(gw===undefined){gw=0}if(gu===undefined){gu=this.length}for(var gx=0;gx<gu;gx+=1,gw+=1){this[gw]=gv[gx]}}}return new Float32Array(gs.numFloats)};var av=(function(){function gq(){this.endStreams=0;this.endTechniqueParameters=(16*3);this.endInstances=((16*3)+8);this.firstIndex=0;this.count=0;this.sortKey=0;this.technique=null;this.indexBuffer=null;this.primitive=-1;this.userData=null;this[0]=null;this[1]=null;this[2]=0;this[(16*3)+0]=null;this[(16*3)+1]=null;return this}gq.prototype.setTechniqueParameters=function(gs,gr){if(gs<8){gs+=(16*3);this[gs]=gr;var gt=this.endTechniqueParameters;if(gr){if(gt<=gs){this.endTechniqueParameters=(gs+1)}}else{while((16*3)<gt&&!this[gt-1]){gt-=1
}this.endTechniqueParameters=gt}}};gq.prototype.setVertexBuffer=function(gs,gr){if(gs<16){gs*=3;this[gs]=gr;var gt=this.endStreams;if(gr){if(gt<=gs){this.endStreams=(gs+3)}}else{while(0<gt&&!this[gt-3]){gt-=3}this.endStreams=gt}}};gq.prototype.setSemantics=function(gs,gr){if(gs<16){this[(gs*3)+1]=gr}};gq.prototype.setOffset=function(gr,gs){if(gr<16){this[(gr*3)+2]=gs}};gq.prototype.getTechniqueParameters=function(gr){if(gr<8){return this[gr+(16*3)]}else{return undefined}};gq.prototype.getVertexBuffer=function(gr){if(gr<16){return this[(gr*3)+0]}else{return undefined}};gq.prototype.getSemantics=function(gr){if(gr<16){return this[(gr*3)+1]}else{return undefined}};gq.prototype.getOffset=function(gr){if(gr<16){return this[(gr*3)+2]}else{return undefined}};gq.prototype.addInstance=function(gs){if(gs){var gr=this.endInstances;this.endInstances=(gr+1);this[gr]=gs}};gq.prototype.removeInstances=function(){this.endInstances=((16*3)+8)};gq.prototype.getNumInstances=function(){return(this.endInstances-((16*3)+8))
};gq.create=function(){return new gq()};gq.version=1;return gq})();var d8=(function(){function gq(){}gq.prototype.drawIndexed=function(gw,gD,gu){var gv=this.gl;var gx=this.activeIndexBuffer;var gt;if(gu){gt=(gu*gx.stride)}else{gt=0}var gB=gx.format;var gy=this.attributeMask;var gs=this.activeTechnique;var gA=gs.passes;var gz=gA.length;var gE;if(gs.checkProperties){gs.checkProperties(this)}if(1===gz){gE=(gA[0].semanticsMask&gy);if(gE!==this.clientStateMask){this.enableClientState(gE)}gv.drawElements(gw,gD,gB,gt)}else{for(var gr=0;gr<gz;gr+=1){var gC=gA[gr];gE=(gC.semanticsMask&gy);if(gE!==this.clientStateMask){this.enableClientState(gE)}this.setPass(gC);gv.drawElements(gw,gD,gB,gt)}}};gq.prototype.draw=function(gv,gy,gt){var gu=this.gl;var gw=this.attributeMask;var gs=this.activeTechnique;var gz=gs.passes;var gx=gz.length;var gB;if(gs.checkProperties){gs.checkProperties(this)}if(1===gx){gB=(gz[0].semanticsMask&gw);if(gB!==this.clientStateMask){this.enableClientState(gB)}gu.drawArrays(gv,gt,gy)
}else{for(var gr=0;gr<gx;gr+=1){var gA=gz[gr];gB=(gA.semanticsMask&gw);if(gB!==this.clientStateMask){this.enableClientState(gB)}this.setPass(gA);gu.drawArrays(gv,gt,gy)}}};gq.prototype.setTechniqueParameters=function(){var gs=this.activeTechnique;var gv=gs.passes;var gr=arguments.length;if(1===gv.length){var gu=gv[0].parameters;for(var gt=0;gt<gr;gt+=1){this.setParametersImmediate(gu,arguments[gt])}}else{for(var gt=0;gt<gr;gt+=1){this.setParametersDeferred(this,gv,arguments[gt])}}};gq.prototype.setParametersImmediate=function(gz,gy){var gu=this.gl;for(var gr in gy){var gx=gz[gr];if(gx!==undefined){var gs=gy[gr];if(gs!==undefined){var gv=gx.info;var gt,gw;if(gv.type==="float"){gt=gv.columns;gw=gx.location;if(4===gt){gu.uniform4fv(gw,gs)}else{if(3===gt){gu.uniform3fv(gw,gs)}else{if(2===gt){gu.uniform2fv(gw,gs)}else{if(1===gv.rows){gu.uniform1f(gw,gs)}else{gu.uniform1fv(gw,gs)}}}}}else{if(gv.sampler!==undefined){this.setTexture(gx.textureUnit,gs,gv.sampler)}else{gt=gv.columns;gw=gx.location;
if(4===gt){gu.uniform4iv(gw,gs)}else{if(3===gt){gu.uniform3iv(gw,gs)}else{if(2===gt){gu.uniform2iv(gw,gs)}else{if(1===gv.rows){gu.uniform1i(gw,gs)}else{gu.uniform1iv(gw,gs)}}}}}}}else{delete gy[gr]}}}};gq.prototype.setParametersCaching=function(gz,gy){var gu=this.gl;for(var gr in gy){var gx=gz[gr];if(gx!==undefined){var gs=gy[gr];if(gx.value!==gs){if(gs!==undefined){gx.value=gs;var gv=gx.info;var gt,gw;if(gv.type==="float"){gt=gv.columns;gw=gx.location;if(4===gt){gu.uniform4fv(gw,gs)}else{if(3===gt){gu.uniform3fv(gw,gs)}else{if(2===gt){gu.uniform2fv(gw,gs)}else{if(1===gv.rows){gu.uniform1f(gw,gs)}else{gu.uniform1fv(gw,gs)}}}}}else{if(gv.sampler!==undefined){this.setTexture(gx.textureUnit,gs,gv.sampler)}else{gt=gv.columns;gw=gx.location;if(4===gt){gu.uniform4iv(gw,gs)}else{if(3===gt){gu.uniform3iv(gw,gs)}else{if(2===gt){gu.uniform2iv(gw,gs)}else{if(1===gv.rows){gu.uniform1i(gw,gs)}else{gu.uniform1iv(gw,gs)}}}}}}}else{delete gy[gr]}}}}};gq.prototype.setParametersCachingMultiPass=function(gt,gs,gr){gt.setParametersCaching(gs[0].parameters,gr)
};gq.prototype.setParametersDeferred=function(gB,gz,gC){var gw=gz.length;var gu=Math.min;var gy=Math.max;for(var gs=0;gs<gw;gs+=1){var gF=gz[gs];var gG=gF.parameters;gF.dirty=true;for(var gr in gC){var gA=gG[gr];if(gA){var gt=gC[gr];if(gt!==undefined){var gv=gA.info;if(gv.sampler){gv.values=gt;gA.dirty=1}else{if(typeof gt!=="number"){var gE=gv.values;var gx=gu(gv.numValues,gt.length);for(var gD=0;gD<gx;gD+=1){gE[gD]=gt[gD]}gA.dirty=gy(gx,(gA.dirty||0))}else{gv.values[0]=gt;gA.dirty=(gA.dirty||1)}}}else{delete gC[gr]}}}}};gq.prototype.setTechnique=function(gt){var gr=this.activeTechnique;if(gr!==gt){if(gr){gr.deactivate()}this.activeTechnique=gt;gt.activate(this);var gs=gt.passes;if(1===gs.length){this.setPass(gs[0])}}};gq.prototype.setTechniqueCaching=function(gv){var gt=gv.passes[0];var gr=this.activeTechnique;if(gr!==gv){if(gr){gr.deactivate()}this.activeTechnique=gv;gv.activate(this);this.setPass(gt)}var gs=gt.parameters;for(var gu in gs){if(gs.hasOwnProperty(gu)){gs[gu].value=null}}};
gq.prototype.setStream=function(gt,gs,gv){if(gv){gv*=(gt).strideInBytes}else{gv=0}this.bindVertexBuffer((gt).glBuffer);var gr=gs;var gu=gr.length;if(gu>(gt).numAttributes){gu=(gt).numAttributes}this.attributeMask|=(gt).bindAttributes(gu,gr,gv)};gq.prototype.setIndexBuffer=function(gr){if(this.activeIndexBuffer!==gr){this.activeIndexBuffer=gr;var gs;if(gr){gs=(gr).glBuffer}else{gs=null}var gt=this.gl;gt.bindBuffer(gt.ELEMENT_ARRAY_BUFFER,gs)}};gq.prototype.drawArray=function(gv,gB,gN){var gT=this.gl;var gu=gT.ELEMENT_ARRAY_BUFFER;var gV=gB.length;var gO=gv.length;if(gO>1&&gN){if(gN>0){gv.sort(this._drawArraySortPositive)}else{gv.sort(this._drawArraySortNegative)}}var gL=this.activeIndexBuffer;var gF=this.attributeMask;var gR=null;var gI=-1;var gD=null;var gW=null;var gH=0;var gU=false;var gX=null;var gr=null;var gE=null;var gM=null;var gz=0;var gt=0;var gS=0;var gK=0;if(gL){gz=gL.format;gt=gL.stride}for(var gP=0;gP<gO;gP+=1){var gw=gv[gP];var gA=gw.technique;var gG=gw.endTechniqueParameters;
var gQ=gw.endStreams;var gy=gw.endInstances;var gx=gw.indexBuffer;var gJ=gw.primitive;var gC=gw.count;var gs=gw.firstIndex;if(gR!==gA){gR=gA;this.setTechniqueCaching(gA);gr=gA.passes[0];gE=gr.parameters;gS=(gr.semanticsMask&gF);if(gS!==this.clientStateMask){this.enableClientState(gS)}if(gA.checkProperties){gA.checkProperties(this)}for(gK=0;gK<gV;gK+=1){this.setParametersCaching(gE,gB[gK])}}for(gK=(16*3);gK<gG;gK+=1){gW=gw[gK];if(gW){this.setParametersCaching(gE,gW)}}gU=(gI===gQ);for(gH=0;gU&&gH<gQ;gH+=3){gU=(gD[gH]===gw[gH]&&gD[gH+1]===gw[gH+1]&&gD[gH+2]===gw[gH+2])}if(!gU){gI=gQ;for(gH=0;gH<gQ;gH+=3){gX=gw[gH];if(gX){this.setStream(gX,gw[gH+1],gw[gH+2])}}gF=this.attributeMask;gS=(gr.semanticsMask&gF);if(gS!==this.clientStateMask){this.enableClientState(gS)}}gD=gw;if(gx){if(gL!==gx){gL=gx;gT.bindBuffer(gu,gx.glBuffer);gz=gx.format;gt=gx.stride}gs*=gt;gK=((16*3)+8);if(gK<gy){do{this.setParametersCaching(gE,gw[gK]);gT.drawElements(gJ,gC,gz,gs);gK+=1}while(gK<gy)}else{gT.drawElements(gJ,gC,gz,gs)
}}else{gK=((16*3)+8);if(gK<gy){do{this.setParametersCaching(gE,gw[gK]);gT.drawArrays(gJ,gs,gC);gK+=1}while(gK<gy)}else{gT.drawArrays(gJ,gs,gC)}}}this.activeIndexBuffer=gL};gq.prototype.drawArrayMultiPass=function(gK,gv,gB){var gx=this.gl;var gR=gx.ELEMENT_ARRAY_BUFFER;var gN=this.setParametersCachingMultiPass;var gu=this.setParametersDeferred;var gJ=gv.length;var gQ=gK.length;if(gQ>1&&gB){if(gB>0){gK.sort(this._drawArraySortPositive)}else{gK.sort(this._drawArraySortNegative)}}var gL=this.activeIndexBuffer;var gE=this.attributeMask;var gX=null;var gG=null;var gM=-1;var gw=null;var gI=null;var gP=0;var gC=false;var gZ=null;var g0=null;var gU=null;var gr=null;var gH=0;var gF=0;var gO=0;var gW=0;var gS=0;if(gL){gH=gL.format;gF=gL.stride}for(var gV=0;gV<gQ;gV+=1){var gy=(gK[gV]);var gY=gy.technique;var gt=gy.endTechniqueParameters;var g1=gy.endStreams;var gs=gy.endInstances;var gD=gy.indexBuffer;var gz=gy.primitive;var gT=gy.count;var gA=gy.firstIndex;if(gG!==gY){gG=gY;g0=gY.passes;gO=g0.length;
if(1===gO){this.setTechniqueCaching(gY);gX=gN;gW=(g0[0].semanticsMask&gE);if(gW!==this.clientStateMask){this.enableClientState(gW)}}else{this.setTechnique(gY);gX=gu}if(gY.checkProperties){gY.checkProperties(this)}for(gS=0;gS<gJ;gS+=1){gX(this,g0,gv[gS])}}for(gS=(16*3);gS<gt;gS+=1){gI=gy[gS];if(gI){gX(this,g0,gI)}}gC=(gM===g1);for(gP=0;gC&&gP<g1;gP+=3){gC=(gw[gP]===gy[gP]&&gw[gP+1]===gy[gP+1]&&gw[gP+2]===gy[gP+2])}if(!gC){gM=g1;for(gP=0;gP<g1;gP+=3){gZ=gy[gP];if(gZ){this.setStream(gZ,gy[gP+1],gy[gP+2])}}gE=this.attributeMask;if(1===gO){gW=(g0[0].semanticsMask&gE);if(gW!==this.clientStateMask){this.enableClientState(gW)}}}gw=gy;if(gD){if(gL!==gD){gL=gD;gx.bindBuffer(gR,gD.glBuffer);gH=gD.format;gF=gD.stride}gA*=gF;if(1===gO){gS=((16*3)+8);if(gS<gs){do{gX(this,g0,gy[gS]);gx.drawElements(gz,gT,gH,gA);gS+=1}while(gS<gs)}else{gx.drawElements(gz,gT,gH,gA)}}else{gS=((16*3)+8);if(gS<gs){do{gX(this,g0,gy[gS]);for(gU=0;gU<gO;gU+=1){gr=g0[gU];gW=(gr.semanticsMask&gE);if(gW!==this.clientStateMask){this.enableClientState(gW)
}this.setPass(gr);gx.drawElements(gz,gT,gH,gA)}gS+=1}while(gS<gs)}else{for(gU=0;gU<gO;gU+=1){gr=g0[gU];gW=(gr.semanticsMask&gE);if(gW!==this.clientStateMask){this.enableClientState(gW)}this.setPass(gr);gx.drawElements(gz,gT,gH,gA)}}}}else{if(1===gO){gS=((16*3)+8);if(gS<gs){do{gX(this,g0,gy[gS]);gx.drawArrays(gz,gA,gT);gS+=1}while(gS<gs)}else{gx.drawArrays(gz,gA,gT)}}else{gS=((16*3)+8);if(gS<gs){do{gX(this,g0,gy[gS]);for(gU=0;gU<gO;gU+=1){gr=g0[gU];gW=(gr.semanticsMask&gE);if(gW!==this.clientStateMask){this.enableClientState(gW)}this.setPass(gr);gx.drawArrays(gz,gA,gT)}gS+=1}while(gS<gs)}else{for(gU=0;gU<gO;gU+=1){gr=g0[gU];gW=(gr.semanticsMask&gE);if(gW!==this.clientStateMask){this.enableClientState(gW)}this.setPass(gr);gx.drawArrays(gz,gA,gT)}}}}}this.activeIndexBuffer=gL};gq.prototype.beginDraw=function(gz,gA,gC,gs){this.immediatePrimitive=gz;if(gA){var gw;var gx=this.immediateSemantics;var gy=gs;var gD=gy.length;gx.length=gD;for(gw=0;gw<gD;gw+=1){var gv=gy[gw];if(typeof gv==="string"){gv=this["SEMANTIC_"+gv]
}gx[gw]=gv}var gB=this.immediateVertexBuffer;var gu=gB.strideInBytes;var gr=(gu*gB.numVertices);var gt=gB.setAttributes(gC);if(gt!==gu){gB.numVertices=Math.floor(gr/gt)}var gE=(gt*gA);if(gE>gr){gB.resize(gE)}return gB.map(0,gA)}return null};gq.prototype.endDraw=function(gx){var gA=this.immediateVertexBuffer;var gD=gx.getNumWrittenVertices();gA.unmap(gx);if(gD){var gz=this.gl;var gt=gA.strideInBytes;var gy=0;var gB=gA.attributes;var gr=this.immediateSemantics;var gC=gr.length;var gu=0;for(var gw=0;gw<gC;gw+=1){var gs=gB[gw];var gv=gr[gw];gu|=(1<<gv);gz.vertexAttribPointer(gv,gs.numComponents,gs.format,gs.normalized,gt,gy);gy+=gs.stride}this.attributeMask|=gu;this.draw(this.immediatePrimitive,gD,0)}};gq.prototype.setViewport=function(gs,gv,gt,gu){var gr=this.state.viewportBox;if(gr[0]!==gs||gr[1]!==gv||gr[2]!==gt||gr[3]!==gu){gr[0]=gs;gr[1]=gv;gr[2]=gt;gr[3]=gu;this.gl.viewport(gs,gv,gt,gu)}};gq.prototype.setScissor=function(gs,gv,gt,gu){var gr=this.state.scissorBox;if(gr[0]!==gs||gr[1]!==gv||gr[2]!==gt||gr[3]!==gu){gr[0]=gs;
gr[1]=gv;gr[2]=gt;gr[3]=gu;this.gl.scissor(gs,gv,gt,gu)}};gq.prototype.clear=function(gs,gv,gE){var gx=this.gl;var gr=this.state;var gw=0;if(gs){gw+=gx.COLOR_BUFFER_BIT;var gt=gr.clearColor;var gF=gs[0];var gD=gs[1];var gC=gs[2];var gA=gs[3];if(gt[0]!==gF||gt[1]!==gD||gt[2]!==gC||gt[3]!==gA){gt[0]=gF;gt[1]=gD;gt[2]=gC;gt[3]=gA;gx.clearColor(gF,gD,gC,gA)}}if(typeof gv==="number"){gw+=gx.DEPTH_BUFFER_BIT;if(gr.clearDepth!==gv){gr.clearDepth=gv;gx.clearDepth(gv)}if(typeof gE==="number"){gw+=gx.STENCIL_BUFFER_BIT;if(gr.clearStencil!==gE){gr.clearStencil=gE;gx.clearStencil(gE)}}}if(gw){var gB=gr.colorMask;var gz=(gB[0]||gB[1]||gB[2]||gB[3]);var gy=gr.depthMask;var gu=gr.program;if(gs){if(!gz){gx.colorMask(true,true,true,true)}}if(typeof gv==="number"){if(!gy){gx.depthMask(true)}}if(gu){gx.useProgram(null)}gx.clear(gw);if(gs){if(!gz){gx.colorMask(false,false,false,false)}}if(typeof gv==="number"){if(!gy){gx.depthMask(false)}}if(gu){gx.useProgram(gu)}}};gq.prototype.beginFrame=function(){var gs=this.gl;
this.attributeMask=0;var gr=this.clientStateMask;var gt;if(gr){for(gt=0;gt<16;gt+=1){if(gr&(1<<gt)){gs.disableVertexAttribArray(gt)}}this.clientStateMask=0}this.resetStates();this.setScissor(0,0,this.width,this.height);this.setViewport(0,0,this.width,this.height);return !(document.hidden||document.webkitHidden)};gq.prototype.beginRenderTarget=function(gr){this.activeRenderTarget=gr;return(gr).bind()};gq.prototype.endRenderTarget=function(){this.activeRenderTarget.unbind();this.activeRenderTarget=null};gq.prototype.beginOcclusionQuery=function(){return false};gq.prototype.endOcclusionQuery=function(){};gq.prototype.endFrame=function(){var gx=this.gl;if(this.activeTechnique){this.activeTechnique.deactivate();this.activeTechnique=null}if(this.activeIndexBuffer){this.setIndexBuffer(null)}var gw=this.state;if(gw.program){gw.program=null;gx.useProgram(null)}this.numFrames+=1;var gv=TurbulenzEngine.getTime();var gu=(gv-this.previousFrameTime);if(gu>=1000){this.fps=(this.numFrames/(gu*0.001));this.numFrames=0;
this.previousFrameTime=gv}var gs=gx.canvas;var gt=(gx.drawingBufferWidth||gs.width);var gr=(gx.drawingBufferHeight||gs.height);if(this.width!==gt||this.height!==gr){this.width=gt;this.height=gr;this.setViewport(0,0,gt,gr);this.setScissor(0,0,gt,gr)}this.checkFullScreen()};gq.prototype.createTechniqueParameters=function(gr){return bO.create(gr)};gq.prototype.createSemantics=function(gr){return bv.create(this,gr)};gq.prototype.createVertexBuffer=function(gr){return bi.create(this,gr)};gq.prototype.createIndexBuffer=function(gr){return eM.create(this,gr)};gq.prototype.createTexture=function(gr){return eD.create(this,gr)};gq.prototype.createVideo=function(gr){return eX.create(gr)};gq.prototype.createShader=function(gr){return a6.create(this,gr)};gq.prototype.createTechniqueParameterBuffer=function(gr){return fk(gr)};gq.prototype.createRenderBuffer=function(gr){return c8.create(this,gr)};gq.prototype.createRenderTarget=function(gr){return gk.create(this,gr)};gq.prototype.createOcclusionQuery=function(){return null
};gq.prototype.createDrawParameters=function(){return av.create()};gq.prototype.isSupported=function(gu){var gw=this.gl;if("OCCLUSION_QUERIES"===gu){return false}else{if("NPOT_MIPMAPPED_TEXTURES"===gu){return false}else{if("TEXTURE_DXT1"===gu||"TEXTURE_DXT3"===gu||"TEXTURE_DXT5"===gu){var gv=this.compressedTexturesExtension;if(gv){var gs=gw.getParameter(gw.COMPRESSED_TEXTURE_FORMATS);if(gs){var gr;if("TEXTURE_DXT1"===gu){gr=gv.COMPRESSED_RGBA_S3TC_DXT1_EXT}else{if("TEXTURE_DXT3"===gu){gr=gv.COMPRESSED_RGBA_S3TC_DXT3_EXT}else{gr=gv.COMPRESSED_RGBA_S3TC_DXT5_EXT}}var gt=gs.length;for(var gx=0;gx<gt;gx+=1){if(gs[gx]===gr){return true}}}}return false}else{if("TEXTURE_ETC1"===gu){return false}else{if("INDEXFORMAT_UINT"===gu){if(gw.getExtension("OES_element_index_uint")){return true}return false}else{if("FILEFORMAT_WEBM"===gu){return("webm" in this.supportedVideoExtensions)}else{if("FILEFORMAT_MP4"===gu){return("mp4" in this.supportedVideoExtensions)}else{if("FILEFORMAT_JPG"===gu){return true
}else{if("FILEFORMAT_PNG"===gu){return true}else{if("FILEFORMAT_DDS"===gu){return typeof E!=="undefined"}else{if("FILEFORMAT_TGA"===gu){return typeof cd!=="undefined"}}}}}}}}}}}return undefined};gq.prototype.maxSupported=function(gr){var gu=this.gl;if("ANISOTROPY"===gr){return this.maxAnisotropy}else{if("TEXTURE_SIZE"===gr){return gu.getParameter(gu.MAX_TEXTURE_SIZE)}else{if("CUBEMAP_TEXTURE_SIZE"===gr){return gu.getParameter(gu.MAX_CUBE_MAP_TEXTURE_SIZE)}else{if("3D_TEXTURE_SIZE"===gr){return 0}else{if("RENDERTARGET_COLOR_TEXTURES"===gr){if(this.drawBuffersExtension){if(this.WEBGL_draw_buffers){return gu.getParameter(this.drawBuffersExtension.MAX_COLOR_ATTACHMENTS_WEBGL)}else{return gu.getParameter(this.drawBuffersExtension.MAX_COLOR_ATTACHMENTS_EXT)}}return 1}else{if("RENDERBUFFER_SIZE"===gr){return gu.getParameter(gu.MAX_RENDERBUFFER_SIZE)}else{if("TEXTURE_UNITS"===gr){return gu.getParameter(gu.MAX_TEXTURE_IMAGE_UNITS)}else{if("VERTEX_TEXTURE_UNITS"===gr){return gu.getParameter(gu.MAX_VERTEX_TEXTURE_IMAGE_UNITS)
}else{if("VERTEX_SHADER_PRECISION"===gr||"FRAGMENT_SHADER_PRECISION"===gr){var gt;if("VERTEX_SHADER_PRECISION"===gr){gt=gu.VERTEX_SHADER}else{gt=gu.FRAGMENT_SHADER}if(!gu.getShaderPrecisionFormat){return 0}var gs=gu.getShaderPrecisionFormat(gt,gu.HIGH_FLOAT);if(!gs||!gs.precision){gs=gu.getShaderPrecisionFormat(gt,gu.MEDIUM_FLOAT);if(!gs||!gs.precision){gs=gu.getShaderPrecisionFormat(gt,gu.LOW_FLOAT);if(!gs||!gs.precision){return 0}}}return gs.precision}}}}}}}}}return 0};gq.prototype.loadTexturesArchive=function(gv){var gu=gv.src;if(typeof b!=="undefined"){b.create({gd:this,src:gu,mipmaps:gv.mipmaps,ontextureload:function gt(gw){gv.ontextureload(gw)},onload:function gs(gx,gw){if(gv.onload){gv.onload(gx,gw)}},onerror:function gr(gw){if(gv.onload){gv.onload(false,gw)}}});return true}else{(TurbulenzEngine).callOnError("Missing archive loader required for "+gu);return false}};gq.prototype.getScreenshot=function(gu,gy,gx,gr,gz){var gv=this.gl;var gs=gv.canvas;if(gu){return gs.toDataURL("image/jpeg")
}else{if(gy===undefined){gy=0}if(gx===undefined){gx=0}var gw=this.activeRenderTarget;if(!gw){gw=gs}if(gr===undefined){gr=gw.width}if(gz===undefined){gz=gw.height}var gt=new Uint8Array(4*gr*gz);gv.readPixels(gy,gx,gr,gz,gv.RGBA,gv.UNSIGNED_BYTE,gt);return gt}};gq.prototype.flush=function(){this.gl.flush()};gq.prototype.finish=function(){this.gl.finish()};gq.prototype._drawArraySortPositive=function(gs,gr){return(gr.sortKey-gs.sortKey)};gq.prototype._drawArraySortNegative=function(gs,gr){return(gs.sortKey-gr.sortKey)};gq.prototype.checkFullScreen=function(){var gr=this.fullscreen;if(this.oldFullscreen!==gr){this.oldFullscreen=gr;this.requestFullScreen(gr)}};gq.prototype.requestFullScreen=function(gs){if(gs){var gr=this.gl.canvas;if(gr.webkitRequestFullScreenWithKeys){gr.webkitRequestFullScreenWithKeys()}else{if(gr.requestFullScreenWithKeys){gr.requestFullScreenWithKeys()}else{if(gr.webkitRequestFullScreen){gr.webkitRequestFullScreen(gr.ALLOW_KEYBOARD_INPUT)}else{if(gr.mozRequestFullScreen){gr.mozRequestFullScreen()
}else{if(gr.requestFullScreen){gr.requestFullScreen()}else{if(gr.requestFullscreen){gr.requestFullscreen()}}}}}}}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.exitFullscreen){document.exitFullscreen()}}}}return true};gq.prototype.createSampler=function(gu){var gs=gu.minFilter.toString()+":"+gu.magFilter.toString()+":"+gu.wrapS.toString()+":"+gu.wrapT.toString()+":"+gu.wrapR.toString()+":"+gu.maxAnisotropy.toString();var gt=this.cachedSamplers;var gr=gt[gs];if(!gr){gt[gs]=gu;return gu}return gr};gq.prototype.unsetIndexBuffer=function(gr){if(this.activeIndexBuffer===gr){this.activeIndexBuffer=null;var gs=this.gl;gs.bindBuffer(gs.ELEMENT_ARRAY_BUFFER,null)}};gq.prototype.bindVertexBuffer=function(gr){if(this.bindedVertexBuffer!==gr){this.bindedVertexBuffer=gr;var gs=this.gl;gs.bindBuffer(gs.ARRAY_BUFFER,gr)}};gq.prototype.unbindVertexBuffer=function(gr){if(this.bindedVertexBuffer===gr){this.bindedVertexBuffer=null;
var gs=this.gl;gs.bindBuffer(gs.ARRAY_BUFFER,null)}};gq.prototype.bindTextureUnit=function(gs,gu,gr){var gt=this.state;var gv=this.gl;if(gt.activeTextureUnit!==gs){gt.activeTextureUnit=gs;gv.activeTexture(gv.TEXTURE0+gs)}gv.bindTexture(gu,gr)};gq.prototype.bindTexture=function(gu,gs){var gt=this.state;var gv=this.gl;var gr=(gt.maxTextureUnit-1);if(gt.activeTextureUnit!==gr){gt.activeTextureUnit=gr;gv.activeTexture(gv.TEXTURE0+gr)}gv.bindTexture(gu,gs)};gq.prototype.unbindTexture=function(gu){var gv=this.state;var gt=gv.lastMaxTextureUnit;var gw=gv.textureUnits;for(var gr=0;gr<gt;gr+=1){var gs=gw[gr];if(gs.texture===gu){gs.texture=null;this.bindTextureUnit(gr,gs.target,null)}}};gq.prototype.setSampler=function(gr,gs){if(gr){var gt=this.gl;gt.texParameteri(gs,gt.TEXTURE_MIN_FILTER,gr.minFilter);gt.texParameteri(gs,gt.TEXTURE_MAG_FILTER,gr.magFilter);gt.texParameteri(gs,gt.TEXTURE_WRAP_S,gr.wrapS);gt.texParameteri(gs,gt.TEXTURE_WRAP_T,gr.wrapT);if(this.TEXTURE_MAX_ANISOTROPY_EXT){gt.texParameteri(gs,this.TEXTURE_MAX_ANISOTROPY_EXT,gr.maxAnisotropy)
}}};gq.prototype.setPass=function(gB){var gw=this.gl;var gs=this.state;var gy=gB.statesSet;var gA=gB.states;var gv=gA.length;var gr,gG;for(gr=0;gr<gv;gr+=1){gG=gA[gr];gG.set.apply(gG,gG.values)}var gz=gs.renderStatesToReset;var gx=gz.length;for(gr=0;gr<gx;gr+=1){gG=gz[gr];if(!(gG.name in gy)){gG.reset()}}gs.renderStatesToReset=gA;var gF=gs.lastMaxTextureUnit;var gE=gs.textureUnits;var gt=gB.numTextureUnits;if(gt<gF){var gC=gt;do{var gD=gE[gC];if(gD.texture){gD.texture=null;this.bindTextureUnit(gC,gD.target,null)}gC+=1}while(gC<gF)}gs.lastMaxTextureUnit=gt;var gu=gB.glProgram;if(gs.program!==gu){gs.program=gu;gw.useProgram(gu)}if(gB.dirty){gB.updateParametersData(this)}};gq.prototype.enableClientState=function(gs){var gv=this.gl;var gt=this.clientStateMask;this.clientStateMask=gs;var gr=(gt&(~gs));var gu=((~gt)&gs);var gw;if(gr){if((gr&255)===0){gr>>=8;gw=8}else{gw=0}do{if(0!==(1&gr)){gv.disableVertexAttribArray(gw)}gw+=1;gr>>=1}while(gr)}if(gu){if((gu&255)===0){gu>>=8;gw=8}else{gw=0}do{if(0!==(1&gu)){gv.enableVertexAttribArray(gw)
}gw+=1;gu>>=1}while(gu)}};gq.prototype.setTexture=function(gs,gx,gy){var gr=this.state;var gv=this.gl;var gA=gr.textureUnits[gs];var gt=gA.target;var gz=gA.texture;if(gx){var gw=gx.target;var gu=gx.glTexture;if(gz!==gu||gt!==gw){gA.target=gw;gA.texture=gu;if(gr.activeTextureUnit!==gs){gr.activeTextureUnit=gs;gv.activeTexture(gv.TEXTURE0+gs)}if(gt!==gw&&gz){gv.bindTexture(gt,null)}gv.bindTexture(gw,gu);if(gx.sampler!==gy){gx.sampler=gy;this.setSampler(gy,gw)}}}else{if(gt&&gz){gA.target=0;gA.texture=null;if(gr.activeTextureUnit!==gs){gr.activeTextureUnit=gs;gv.activeTexture(gv.TEXTURE0+gs)}gv.bindTexture(gt,null)}}};gq.prototype.setProgram=function(gr){var gs=this.state;if(gs.program!==gr){gs.program=gr;this.gl.useProgram(gr)}};gq.prototype.syncState=function(){var gt=this.state;var gv=this.gl;if(gt.depthTestEnable){gv.enable(gv.DEPTH_TEST)}else{gv.disable(gv.DEPTH_TEST)}gv.depthFunc(gt.depthFunc);gv.depthMask(gt.depthMask);if(gt.blendEnable){gv.enable(gv.BLEND)}else{gv.disable(gv.BLEND)}gv.blendFunc(gt.blendSrc,gt.blendDst);
if(gt.cullFaceEnable){gv.enable(gv.CULL_FACE)}else{gv.disable(gv.CULL_FACE)}gv.cullFace(gt.cullFace);gv.frontFace(gt.frontFace);var gu=gt.colorMask;gv.colorMask(gu[0],gu[1],gu[2],gu[3]);if(gt.stencilTestEnable){gv.enable(gv.STENCIL_TEST)}else{gv.disable(gv.STENCIL_TEST)}gv.stencilFunc(gt.stencilFunc,gt.stencilRef,gt.stencilMask);gv.stencilOp(gt.stencilFail,gt.stencilZFail,gt.stencilZPass);if(gt.polygonOffsetFillEnable){gv.enable(gv.POLYGON_OFFSET_FILL)}else{gv.disable(gv.POLYGON_OFFSET_FILL)}gv.polygonOffset(gt.polygonOffsetFactor,gt.polygonOffsetUnits);gv.lineWidth(gt.lineWidth);gv.activeTexture(gv.TEXTURE0+gt.activeTextureUnit);var gs=this.state.viewportBox;gv.viewport(gs[0],gs[1],gs[2],gs[3]);gs=this.state.scissorBox;gv.scissor(gs[0],gs[1],gs[2],gs[3]);var gr=gt.clearColor;gv.clearColor(gr[0],gr[1],gr[2],gr[3]);gv.clearDepth(gt.clearDepth);gv.clearStencil(gt.clearStencil)};gq.prototype.resetStates=function(){var gu=this.state;var gt=gu.lastMaxTextureUnit;var gv=gu.textureUnits;for(var gr=0;
gr<gt;gr+=1){var gs=gv[gr];if(gs.texture){this.bindTextureUnit(gr,gs.target,null);gs.texture=null;gs.target=0}}};gq.prototype.destroy=function(){delete this.activeTechnique;delete this.activeIndexBuffer;delete this.bindedVertexBuffer;if(this.immediateVertexBuffer){this.immediateVertexBuffer.destroy();delete this.immediateVertexBuffer}delete this.gl;if(typeof E!=="undefined"){E.destroy()}};gq.create=function(gF,gt){var hq=function hc(hB,hD,hI){if(hB.getContext){var hJ={alpha:false,stencil:true,antialias:false};var hC=hD.multisample;if(hC!==undefined&&1<hC){hJ.antialias=true}var hE=hD.alpha;if(hE){hJ.alpha=true}var hH=hI.length,hF;for(hF=0;hF<hH;hF+=1){try{var hA=hB.getContext(hI[hF],hJ);if(hA){return hA}}catch(hG){}}}return null};var gJ=hq(gF,gt,["webgl","experimental-webgl"]);if(!gJ){return null}var gr=(gJ.drawingBufferWidth||gF.width);var gu=(gJ.drawingBufferHeight||gF.height);gJ.enable(gJ.SCISSOR_TEST);gJ.depthRange(0,1);gJ.pixelStorei(gJ.UNPACK_ALIGNMENT,1);var gQ=new gq();gQ.gl=gJ;gQ.width=gr;
gQ.height=gu;var hu=gJ.getSupportedExtensions();if(hu){hu=hu.join(" ")}else{hu=""}gQ.extensions=hu;gQ.shadingLanguageVersion=gJ.getParameter(gJ.SHADING_LANGUAGE_VERSION);gQ.rendererVersion=gJ.getParameter(gJ.VERSION);gQ.renderer=gJ.getParameter(gJ.RENDERER);gQ.vendor=gJ.getParameter(gJ.VENDOR);if(hu.indexOf("WEBGL_compressed_texture_s3tc")!==-1){gQ.WEBGL_compressed_texture_s3tc=true;if(hu.indexOf("WEBKIT_WEBGL_compressed_texture_s3tc")!==-1){gQ.compressedTexturesExtension=gJ.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")}else{if(hu.indexOf("MOZ_WEBGL_compressed_texture_s3tc")!==-1){gQ.compressedTexturesExtension=gJ.getExtension("MOZ_WEBGL_compressed_texture_s3tc")}else{gQ.compressedTexturesExtension=gJ.getExtension("WEBGL_compressed_texture_s3tc")}}}else{if(hu.indexOf("WEBKIT_WEBGL_compressed_textures")!==-1){gQ.compressedTexturesExtension=gJ.getExtension("WEBKIT_WEBGL_compressed_textures")}}var g3;if(hu.indexOf("EXT_texture_filter_anisotropic")!==-1){if(hu.indexOf("MOZ_EXT_texture_filter_anisotropic")!==-1){g3=gJ.getExtension("MOZ_EXT_texture_filter_anisotropic")
}else{if(hu.indexOf("WEBKIT_EXT_texture_filter_anisotropic")!==-1){g3=gJ.getExtension("WEBKIT_EXT_texture_filter_anisotropic")}else{g3=gJ.getExtension("EXT_texture_filter_anisotropic")}}}if(g3){gQ.TEXTURE_MAX_ANISOTROPY_EXT=g3.TEXTURE_MAX_ANISOTROPY_EXT;gQ.maxAnisotropy=gJ.getParameter(g3.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{gQ.maxAnisotropy=1}gJ.getExtension("OES_element_index_uint");if(hu.indexOf("WEBGL_draw_buffers")!==-1){gQ.WEBGL_draw_buffers=true;gQ.drawBuffersExtension=gJ.getExtension("WEBGL_draw_buffers")}else{if(hu.indexOf("EXT_draw_buffers")!==-1){gQ.drawBuffersExtension=gJ.getExtension("EXT_draw_buffers")}}gQ.PRIMITIVE_POINTS=gJ.POINTS;gQ.PRIMITIVE_LINES=gJ.LINES;gQ.PRIMITIVE_LINE_LOOP=gJ.LINE_LOOP;gQ.PRIMITIVE_LINE_STRIP=gJ.LINE_STRIP;gQ.PRIMITIVE_TRIANGLES=gJ.TRIANGLES;gQ.PRIMITIVE_TRIANGLE_STRIP=gJ.TRIANGLE_STRIP;gQ.PRIMITIVE_TRIANGLE_FAN=gJ.TRIANGLE_FAN;gQ.INDEXFORMAT_UBYTE=gJ.UNSIGNED_BYTE;gQ.INDEXFORMAT_USHORT=gJ.UNSIGNED_SHORT;gQ.INDEXFORMAT_UINT=gJ.UNSIGNED_INT;var hp=function ho(hA){if(hA===gJ.BYTE){return 127
}else{if(hA===gJ.UNSIGNED_BYTE){return 255}else{if(hA===gJ.SHORT){return 32767}else{if(hA===gJ.UNSIGNED_SHORT){return 65535}else{if(hA===gJ.INT){return 2147483647}else{if(hA===gJ.UNSIGNED_INT){return 4294967295}else{return 1}}}}}}};var gI=function gA(hF,hE,hC,hD,hB){var hA={numComponents:hE,stride:hC,componentStride:(hC/hE),format:hD,name:hB,normalized:undefined,normalizationScale:undefined,typedSetter:undefined,typedArray:undefined};if(hF){hA.normalized=true;hA.normalizationScale=hp(hD)}else{hA.normalized=false;hA.normalizationScale=1}if(typeof DataView!=="undefined"&&"setFloat32" in DataView.prototype){if(hD===gJ.BYTE){hA.typedSetter=DataView.prototype.setInt8}else{if(hD===gJ.UNSIGNED_BYTE){hA.typedSetter=DataView.prototype.setUint8}else{if(hD===gJ.SHORT){hA.typedSetter=DataView.prototype.setInt16}else{if(hD===gJ.UNSIGNED_SHORT){hA.typedSetter=DataView.prototype.setUint16}else{if(hD===gJ.INT){hA.typedSetter=DataView.prototype.setInt32}else{if(hD===gJ.UNSIGNED_INT){hA.typedSetter=DataView.prototype.setUint32
}else{hA.typedSetter=DataView.prototype.setFloat32}}}}}}}else{if(hD===gJ.BYTE){hA.typedArray=Int8Array}else{if(hD===gJ.UNSIGNED_BYTE){hA.typedArray=Uint8Array}else{if(hD===gJ.SHORT){hA.typedArray=Int16Array}else{if(hD===gJ.UNSIGNED_SHORT){hA.typedArray=Uint16Array}else{if(hD===gJ.INT){hA.typedArray=Int32Array}else{if(hD===gJ.UNSIGNED_INT){hA.typedArray=Uint32Array}else{hA.typedArray=Float32Array}}}}}}}return hA};gQ.VERTEXFORMAT_BYTE4=gI(0,4,4,gJ.BYTE,"BYTE4");gQ.VERTEXFORMAT_BYTE4N=gI(1,4,4,gJ.BYTE,"BYTE4N");gQ.VERTEXFORMAT_UBYTE4=gI(0,4,4,gJ.UNSIGNED_BYTE,"UBYTE4");gQ.VERTEXFORMAT_UBYTE4N=gI(1,4,4,gJ.UNSIGNED_BYTE,"UBYTE4N");gQ.VERTEXFORMAT_SHORT2=gI(0,2,4,gJ.SHORT,"SHORT2");gQ.VERTEXFORMAT_SHORT2N=gI(1,2,4,gJ.SHORT,"SHORT2N");gQ.VERTEXFORMAT_SHORT4=gI(0,4,8,gJ.SHORT,"SHORT4");gQ.VERTEXFORMAT_SHORT4N=gI(1,4,8,gJ.SHORT,"SHORT4N");gQ.VERTEXFORMAT_USHORT2=gI(0,2,4,gJ.UNSIGNED_SHORT,"USHORT2");gQ.VERTEXFORMAT_USHORT2N=gI(1,2,4,gJ.UNSIGNED_SHORT,"USHORT2N");gQ.VERTEXFORMAT_USHORT4=gI(0,4,8,gJ.UNSIGNED_SHORT,"USHORT4");
gQ.VERTEXFORMAT_USHORT4N=gI(1,4,8,gJ.UNSIGNED_SHORT,"USHORT4N");gQ.VERTEXFORMAT_FLOAT1=gI(0,1,4,gJ.FLOAT,"FLOAT1");gQ.VERTEXFORMAT_FLOAT2=gI(0,2,8,gJ.FLOAT,"FLOAT2");gQ.VERTEXFORMAT_FLOAT3=gI(0,3,12,gJ.FLOAT,"FLOAT3");gQ.VERTEXFORMAT_FLOAT4=gI(0,4,16,gJ.FLOAT,"FLOAT4");gQ.DEFAULT_SAMPLER={minFilter:gJ.LINEAR_MIPMAP_LINEAR,magFilter:gJ.LINEAR,wrapS:gJ.REPEAT,wrapT:gJ.REPEAT,wrapR:gJ.REPEAT,maxAnisotropy:1};gQ.cachedSamplers={};var gB=1;var gE=gJ.getParameter(gJ.MAX_TEXTURE_IMAGE_UNITS);if(gB<gE){gB=gE}gE=gJ.getParameter(gJ.MAX_COMBINED_TEXTURE_IMAGE_UNITS);if(gB<gE){gB=gE}var gH=[];gH.length=gB;for(var hm=0;hm<gB;hm+=1){gH[hm]={texture:null,target:0}}var gR=gJ.LEQUAL;var hr=gJ.SRC_ALPHA;var gv=gJ.ONE_MINUS_SRC_ALPHA;var gV=gJ.BACK;var hh=gJ.CCW;var gX=gJ.ALWAYS;var g8=gJ.KEEP;var g4={depthTestEnable:true,blendEnable:false,cullFaceEnable:true,stencilTestEnable:false,polygonOffsetFillEnable:false,depthMask:true,depthFunc:gR,blendSrc:hr,blendDst:gv,cullFace:gV,frontFace:hh,colorMask:[true,true,true,true],stencilFunc:gX,stencilRef:0,stencilMask:4294967295,stencilFail:g8,stencilZFail:g8,stencilZPass:g8,polygonOffsetFactor:0,polygonOffsetUnits:0,lineWidth:1,renderStatesToReset:[],viewportBox:[0,0,gr,gu],scissorBox:[0,0,gr,gu],clearColor:[0,0,0,1],clearDepth:1,clearStencil:0,activeTextureUnit:0,maxTextureUnit:gB,lastMaxTextureUnit:0,textureUnits:gH,program:null};
gQ.state=g4;gQ.counters={textures:0,vertexBuffers:0,indexBuffers:0,renderTargets:0,renderBuffers:0,shaders:0,techniques:0};function g9(hA){if(g4.depthTestEnable!==hA){g4.depthTestEnable=hA;if(hA){gJ.enable(gJ.DEPTH_TEST)}else{gJ.disable(gJ.DEPTH_TEST)}}}function hy(hA){if(g4.depthFunc!==hA){g4.depthFunc=hA;gJ.depthFunc(hA)}}function g1(hA){if(g4.depthMask!==hA){g4.depthMask=hA;gJ.depthMask(hA)}}function hz(hA){if(g4.blendEnable!==hA){g4.blendEnable=hA;if(hA){gJ.enable(gJ.BLEND)}else{gJ.disable(gJ.BLEND)}}}function hf(hA,hB){if(g4.blendSrc!==hA||g4.blendDst!==hB){g4.blendSrc=hA;g4.blendDst=hB;gJ.blendFunc(hA,hB)}}function gZ(hA){if(g4.cullFaceEnable!==hA){g4.cullFaceEnable=hA;if(hA){gJ.enable(gJ.CULL_FACE)}else{gJ.disable(gJ.CULL_FACE)}}}function g5(hA){if(g4.cullFace!==hA){g4.cullFace=hA;gJ.cullFace(hA)}}function gP(hA){if(g4.frontFace!==hA){g4.frontFace=hA;gJ.frontFace(hA)}}function g2(hC,hB,hA,hE){var hD=g4.colorMask;if(hD[0]!==hC||hD[1]!==hB||hD[2]!==hA||hD[3]!==hE){hD[0]=hC;hD[1]=hB;
hD[2]=hA;hD[3]=hE;gJ.colorMask(hC,hB,hA,hE)}}function hl(hA){if(g4.stencilTestEnable!==hA){g4.stencilTestEnable=hA;if(hA){gJ.enable(gJ.STENCIL_TEST)}else{gJ.disable(gJ.STENCIL_TEST)}}}function gK(hC,hB,hA){if(g4.stencilFunc!==hC||g4.stencilRef!==hB||g4.stencilMask!==hA){g4.stencilFunc=hC;g4.stencilRef=hB;g4.stencilMask=hA;gJ.stencilFunc(hC,hB,hA)}}function gD(hB,hA,hC){if(g4.stencilFail!==hB||g4.stencilZFail!==hA||g4.stencilZPass!==hC){g4.stencilFail=hB;g4.stencilZFail=hA;g4.stencilZPass=hC;gJ.stencilOp(hB,hA,hC)}}function ht(hA){if(g4.polygonOffsetFillEnable!==hA){g4.polygonOffsetFillEnable=hA;if(hA){gJ.enable(gJ.POLYGON_OFFSET_FILL)}else{gJ.disable(gJ.POLYGON_OFFSET_FILL)}}}function gz(hB,hA){if(g4.polygonOffsetFactor!==hB||g4.polygonOffsetUnits!==hA){g4.polygonOffsetFactor=hB;g4.polygonOffsetUnits=hA;gJ.polygonOffset(hB,hA)}}function hx(hA){if(g4.lineWidth!==hA){g4.lineWidth=hA;gJ.lineWidth(hA)}}function gC(){if(!g4.depthTestEnable){g4.depthTestEnable=true;gJ.enable(gJ.DEPTH_TEST)}}function hw(){var hA=gR;
if(g4.depthFunc!==hA){g4.depthFunc=hA;gJ.depthFunc(hA)}}function gT(){if(!g4.depthMask){g4.depthMask=true;gJ.depthMask(true)}}function gN(){if(g4.blendEnable){g4.blendEnable=false;gJ.disable(gJ.BLEND)}}function hb(){var hA=hr;var hB=gv;if(g4.blendSrc!==hA||g4.blendDst!==hB){g4.blendSrc=hA;g4.blendDst=hB;gJ.blendFunc(hA,hB)}}function g0(){if(!g4.cullFaceEnable){g4.cullFaceEnable=true;gJ.enable(gJ.CULL_FACE)}}function hn(){var hA=gV;if(g4.cullFace!==hA){g4.cullFace=hA;gJ.cullFace(hA)}}function gM(){var hA=hh;if(g4.frontFace!==hA){g4.frontFace=hA;gJ.frontFace(hA)}}function gY(){var hA=g4.colorMask;if(hA[0]!==true||hA[1]!==true||hA[2]!==true||hA[3]!==true){hA[0]=true;hA[1]=true;hA[2]=true;hA[3]=true;gJ.colorMask(true,true,true,true)}}function hi(){if(g4.stencilTestEnable){g4.stencilTestEnable=false;gJ.disable(gJ.STENCIL_TEST)}}function hd(){var hA=gX;if(g4.stencilFunc!==hA||g4.stencilRef!==0||g4.stencilMask!==4294967295){g4.stencilFunc=hA;g4.stencilRef=0;g4.stencilMask=4294967295;gJ.stencilFunc(hA,0,4294967295)
}}function gy(){var hA=g8;if(g4.stencilFail!==hA||g4.stencilZFail!==hA||g4.stencilZPass!==hA){g4.stencilFail=hA;g4.stencilZFail=hA;g4.stencilZPass=hA;gJ.stencilOp(hA,hA,hA)}}function gs(){if(g4.polygonOffsetFillEnable){g4.polygonOffsetFillEnable=false;gJ.disable(gJ.POLYGON_OFFSET_FILL)}}function hg(){if(g4.polygonOffsetFactor!==0||g4.polygonOffsetUnits!==0){g4.polygonOffsetFactor=0;g4.polygonOffsetUnits=0;gJ.polygonOffset(0,0)}}function hs(){if(g4.lineWidth!==1){g4.lineWidth=1;gJ.lineWidth(1)}}function gG(hA){if(typeof hA!=="boolean"){return[(hA?true:false)]}return[hA]}function ha(hA){if(typeof hA!=="number"){return null}return[hA]}function g7(hC){if(typeof hC==="object"){var hB=hC[0],hA=hC[1];if(typeof hB!=="number"){return null}if(typeof hA!=="number"){return null}return[hB,hA]}return null}function g6(hD){if(typeof hD==="object"){var hC=hD[0],hB=hD[1],hA=hD[2];if(typeof hC!=="number"){return null}if(typeof hB!=="number"){return null}if(typeof hA!=="number"){return null}return[hC,hB,hA]
}return null}function gS(hA){if(typeof hA!=="number"){return null}return[hA]}function gU(hC){if(typeof hC==="object"){var hB=hC[0],hA=hC[1];if(typeof hB!=="number"){return null}if(typeof hA!=="number"){return null}return[hB,hA]}return null}function he(hE){if(typeof hE==="object"){var hD=hE[0],hC=hE[1],hB=hE[2],hA=hE[3];if(typeof hD!=="number"){return null}if(typeof hC!=="number"){return null}if(typeof hB!=="number"){return null}if(typeof hA!=="number"){return null}return[hD,hC,hB,hA]}return null}var gw={};var hk=function gO(hB,hE,hD,hA,hC){gw[hB]={set:hE,reset:hD,parse:hA,defaultValues:hC}};hk("DepthTestEnable",g9,gC,gG,[true]);hk("DepthFunc",hy,hw,ha,[gR]);hk("DepthMask",g1,gT,gG,[true]);hk("BlendEnable",hz,gN,gG,[false]);hk("BlendFunc",hf,hb,g7,[hr,gv]);hk("CullFaceEnable",gZ,g0,gG,[true]);hk("CullFace",g5,hn,ha,[gV]);hk("FrontFace",gP,gM,ha,[hh]);hk("ColorMask",g2,gY,he,[true,true,true,true]);hk("StencilTestEnable",hl,hi,gG,[false]);hk("StencilFunc",gK,hd,g6,[gX,0,4294967295]);hk("StencilOp",gD,gy,g6,[g8,g8,g8]);
hk("PolygonOffsetFillEnable",ht,gs,gG,[false]);hk("PolygonOffset",gz,hg,gU,[0,0]);hk("LineWidth",hx,hs,gS,[1]);gQ.stateHandlers=gw;gQ.syncState();gQ.videoRam=0;gQ.desktopWidth=window.screen.width;gQ.desktopHeight=window.screen.height;if(Object.defineProperty){Object.defineProperty(gQ,"fullscreen",{get:function gW(){return(document.fullscreenEnabled||document.mozFullScreen||document.webkitIsFullScreen||false)},set:function hj(hA){gQ.requestFullScreen(hA)},enumerable:true,configurable:false});gQ.checkFullScreen=function gL(){}}else{gQ.fullscreen=false;gQ.oldFullscreen=false}gQ.clientStateMask=0;gQ.attributeMask=0;gQ.activeTechnique=null;gQ.activeIndexBuffer=null;gQ.bindedVertexBuffer=null;gQ.activeRenderTarget=null;gQ.immediateVertexBuffer=gQ.createVertexBuffer({numVertices:(256*1024/16),attributes:["FLOAT4"],dynamic:true,"transient":true});gQ.immediatePrimitive=-1;gQ.immediateSemantics=bv.create(gQ,[]);gQ.fps=0;gQ.numFrames=0;gQ.previousFrameTime=TurbulenzEngine.getTime();var gx=document.createElement("video");
var hv={};if(gx){if(gx.canPlayType("video/webm")){hv.webm=true}if(gx.canPlayType("video/mp4")){hv.mp4=true}}gQ.supportedVideoExtensions=hv;gx=null;return gQ};gq.version=1;return gq})();d8.prototype.SEMANTIC_POSITION=0;d8.prototype.SEMANTIC_POSITION0=0;d8.prototype.SEMANTIC_BLENDWEIGHT=1;d8.prototype.SEMANTIC_BLENDWEIGHT0=1;d8.prototype.SEMANTIC_NORMAL=2;d8.prototype.SEMANTIC_NORMAL0=2;d8.prototype.SEMANTIC_COLOR=3;d8.prototype.SEMANTIC_COLOR0=3;d8.prototype.SEMANTIC_COLOR1=4;d8.prototype.SEMANTIC_SPECULAR=4;d8.prototype.SEMANTIC_FOGCOORD=5;d8.prototype.SEMANTIC_TESSFACTOR=5;d8.prototype.SEMANTIC_PSIZE0=6;d8.prototype.SEMANTIC_BLENDINDICES=7;d8.prototype.SEMANTIC_BLENDINDICES0=7;d8.prototype.SEMANTIC_TEXCOORD=8;d8.prototype.SEMANTIC_TEXCOORD0=8;d8.prototype.SEMANTIC_TEXCOORD1=9;d8.prototype.SEMANTIC_TEXCOORD2=10;d8.prototype.SEMANTIC_TEXCOORD3=11;d8.prototype.SEMANTIC_TEXCOORD4=12;d8.prototype.SEMANTIC_TEXCOORD5=13;d8.prototype.SEMANTIC_TEXCOORD6=14;d8.prototype.SEMANTIC_TEXCOORD7=15;d8.prototype.SEMANTIC_TANGENT=14;
d8.prototype.SEMANTIC_TANGENT0=14;d8.prototype.SEMANTIC_BINORMAL0=15;d8.prototype.SEMANTIC_BINORMAL=15;d8.prototype.SEMANTIC_PSIZE=6;d8.prototype.SEMANTIC_ATTR0=0;d8.prototype.SEMANTIC_ATTR1=1;d8.prototype.SEMANTIC_ATTR2=2;d8.prototype.SEMANTIC_ATTR3=3;d8.prototype.SEMANTIC_ATTR4=4;d8.prototype.SEMANTIC_ATTR5=5;d8.prototype.SEMANTIC_ATTR6=6;d8.prototype.SEMANTIC_ATTR7=7;d8.prototype.SEMANTIC_ATTR8=8;d8.prototype.SEMANTIC_ATTR9=9;d8.prototype.SEMANTIC_ATTR10=10;d8.prototype.SEMANTIC_ATTR11=11;d8.prototype.SEMANTIC_ATTR12=12;d8.prototype.SEMANTIC_ATTR13=13;d8.prototype.SEMANTIC_ATTR14=14;d8.prototype.SEMANTIC_ATTR15=15;d8.prototype.PIXELFORMAT_A8=0;d8.prototype.PIXELFORMAT_L8=1;d8.prototype.PIXELFORMAT_L8A8=2;d8.prototype.PIXELFORMAT_R5G5B5A1=3;d8.prototype.PIXELFORMAT_R5G6B5=4;d8.prototype.PIXELFORMAT_R4G4B4A4=5;d8.prototype.PIXELFORMAT_R8G8B8A8=6;d8.prototype.PIXELFORMAT_R8G8B8=7;d8.prototype.PIXELFORMAT_D24S8=8;d8.prototype.PIXELFORMAT_D16=9;d8.prototype.PIXELFORMAT_DXT1=10;d8.prototype.PIXELFORMAT_DXT3=11;
d8.prototype.PIXELFORMAT_DXT5=12;var y=(function(){function gq(){}gq.prototype.update=function(){if(!this.isWindowFocused){return}this.updateGamePad()};gq.prototype.addEventListener=function(gt,gr){var gs;var gu;var gv;if(this.handlers.hasOwnProperty(gt)){gv=this.handlers[gt];if(gr){gu=gv.length;for(gs=0;gs<gu;gs+=1){if(gv[gs]===gr){return}}gv.push(gr)}}};gq.prototype.removeEventListener=function(gt,gr){var gs;var gu;var gv;if(this.handlers.hasOwnProperty(gt)){gv=this.handlers[gt];if(gr){gu=gv.length;for(gs=0;gs<gu;gs+=1){if(gv[gs]===gr){gv.splice(gs,1);break}}}}};gq.prototype.lockMouse=function(){if(this.isHovering&&this.isWindowFocused){this.isMouseLocked=true;this.hideMouse();this.requestBrowserLock();this.setEventHandlersLock();return true}else{return false}};gq.prototype.unlockMouse=function(){if(this.isMouseLocked){this.isMouseLocked=false;this.showMouse();this.requestBrowserUnlock();this.setEventHandlersUnlock();if(this.isOutsideEngine){this.isOutsideEngine=false;this.isHovering=false;
this.setEventHandlersMouseLeave();this.sendEventToHandlers(this.handlers.mouseleave)}this.sendEventToHandlers(this.handlers.mouselocklost);return true}else{return false}};gq.prototype.isLocked=function(){return this.isMouseLocked};gq.prototype.hideMouse=function(){if(this.isHovering){if(!this.isCursorHidden){this.isCursorHidden=true;this.previousCursor=document.body.style.cursor;document.body.style.cursor="none";if(this.webkit){this.ignoreNextMouseMoves=2}}return true}else{return false}};gq.prototype.showMouse=function(){if(this.isCursorHidden&&!this.isMouseLocked){this.isCursorHidden=false;document.body.style.cursor=this.previousCursor;return true}else{return false}};gq.prototype.isHidden=function(){return this.isCursorHidden};gq.prototype.isFocused=function(){return this.isWindowFocused};gq.prototype.convertToUnicode=function(gw){var gu=this.keyCodeToUnicode;var gr={};var gt=gw.length;var gs;var gv;for(gs=0;gs<gt;gs+=1){gv=gw[gs];gr[gv]=gu[gv]||""}return gr};gq.prototype.sendEventToHandlers=function(gr,gz,gy,gx,gw,gu,gt){var gv;
var gs=gr.length;if(gs){for(gv=0;gv<gs;gv+=1){gr[gv](gz,gy,gx,gw,gu,gt)}}};gq.prototype.sendEventToHandlersASync=function(gw,gv,gu,gt,gs,gz,gy){var gx=gq.prototype.sendEventToHandlers;TurbulenzEngine.setTimeout(function gr(){gx(gw,gv,gu,gt,gs,gz,gy)},0)};gq.prototype.updateGamePad=function(){var gu;var gM;var gr=(navigator.gamepads||navigator.webkitGamepads||(navigator.webkitGetGamepads&&navigator.webkitGetGamepads()));if(gr){var gv=this.padAxisDeadZone;var gJ=this.maxAxisRange;var gs=this.sendEventToHandlersASync;var gz=this.handlers;var gE=this.padButtons;var gB=this.padMap;var gH=0;var gG=0;var gL=0;var gI=0;var gQ=gr.length;for(var gD=0;gD<gQ;gD+=1){var gt=gr[gD];if(gt){var gF=gt.buttons;if(this.padTimestampUpdate<gt.timestamp){this.padTimestampUpdate=gt.timestamp;var gx=gF.length;for(var gy=0;gy<gx;gy+=1){var gA=gF[gy];if(gE[gy]!==gA){gE[gy]=gA;var gw=gB[gy];if(gw!==undefined){if(gA){gs(gz.paddown,gw)}else{gs(gz.padup,gw)}}}}}var gC=gt.axes;if(gC.length<=4){var gN=gC[0];var gK=-gC[1];
gu=((gN*gN)+(gK*gK));if(gu>(gv*gv)){gu=Math.sqrt(gu);gN=(gN/gu);gK=(gK/gu);if(gu>gJ){gu=gJ}gu-=gv;gM=(gu/(gJ-gv));gH=(gN*gM);gG=(gK*gM)}var gP=gC[2];var gO=-gC[3];gu=((gP*gP)+(gO*gO));if(gu>(gv*gv)){gu=Math.sqrt(gu);gP=(gP/gu);gO=(gO/gu);if(gu>gJ){gu=gJ}gu-=gv;gM=(gu/(gJ-gv));gL=(gP*gM);gI=(gO*gM)}gs(gz.padmove,gH,gG,gF[6],gL,gI,gF[7])}break}}}};gq.prototype.getLocale=function(){return""};gq.prototype.getCanvasPosition=function(gs,gr){if(gs.offsetX!==undefined){gr.x=gs.offsetX;gr.y=gs.offsetY}else{if(gs.layerX!==undefined){gr.x=gs.layerX;gr.y=gs.layerY}}};gq.prototype.resetKeyStates=function(){var gr;var gt=this.pressedKeys;var gs=this.handlers.keyup;for(gr in gt){if(gt.hasOwnProperty(gr)&&gt[gr]){gr=parseInt(gr,10);gt[gr]=false;this.sendEventToHandlers(gs,gr)}}};gq.prototype.onMouseOver=function(gt){var gr={};var gs=this.handlers.mouseover;gt.stopPropagation();gt.preventDefault();this.getCanvasPosition(gt,gr);this.lastX=gt.screenX;this.lastY=gt.screenY;this.sendEventToHandlers(gs,gr.x,gr.y)
};gq.prototype.onMouseMove=function(gu){var gt=this.handlers.mousemove;var gs,gr;gu.stopPropagation();gu.preventDefault();if(this.ignoreNextMouseMoves){this.ignoreNextMouseMoves-=1;return}if(gu.movementX!==undefined){gs=gu.movementX;gr=gu.movementY}else{if(gu.mozMovementX!==undefined){gs=gu.mozMovementX;gr=gu.mozMovementY}else{if(gu.webkitMovementX!==undefined){gs=gu.webkitMovementX;gr=gu.webkitMovementY}else{gs=(gu.screenX-this.lastX);gr=(gu.screenY-this.lastY);if(0===gs&&0===gr){return}}}}this.lastX=gu.screenX;this.lastY=gu.screenY;this.sendEventToHandlers(gt,gs,gr)};gq.prototype.onWheel=function(gs){var gr=this.handlers.mousewheel;var gt;gs.stopPropagation();gs.preventDefault();if(gs.wheelDelta){if(window.opera){gt=gs.wheelDelta<0?1:-1}else{gt=gs.wheelDelta>0?1:-1}}else{gt=gs.detail<0?1:-1}this.sendEventToHandlers(gr,gt)};gq.prototype.emptyEvent=function(gr){gr.stopPropagation();gr.preventDefault()};gq.prototype.onWindowFocus=function(){if(this.isHovering&&window.document.activeElement===this.canvas){this.addInternalEventListener(window,"mousedown",this.onMouseDown)
}};gq.prototype.onFocus=function(){var gs=this.canvas;var gr=this.handlers;var gt=gr.focus;if(!this.isWindowFocused){this.isWindowFocused=true;window.focus();gs.focus();this.setEventHandlersFocus();gs.oncontextmenu=function(){return false};this.sendEventToHandlers(gt)}};gq.prototype.onBlur=function(){if(this.ignoreNextBlur){this.ignoreNextBlur=false;return}var gt=this.canvas;var gs=this.handlers;var gr=gs.blur;if(this.isMouseLocked){this.unlockMouse()}if(this.isWindowFocused){this.isWindowFocused=false;this.resetKeyStates();this.setEventHandlersBlur();gt.oncontextmenu=null;this.sendEventToHandlers(gr)}};gq.prototype.onMouseDown=function(gu){var gs=this.handlers;if(this.isHovering){var gv=gs.mousedown;var gt=gu.button;var gr={};this.onFocus();gu.stopPropagation();gu.preventDefault();if(gt<3){gt=this.mouseMap[gt]}this.getCanvasPosition(gu,gr);this.sendEventToHandlers(gv,gt,gr.x,gr.y)}else{this.onBlur()}};gq.prototype.onMouseUp=function(gu){var gs=this.handlers.mouseup;if(this.isHovering){var gt=gu.button;
var gr={};gu.stopPropagation();gu.preventDefault();if(gt<3){gt=this.mouseMap[gt]}this.getCanvasPosition(gu,gr);this.sendEventToHandlers(gs,gt,gr.x,gr.y)}};gq.prototype.onKeyDown=function(gt){var gw=this.handlers.keydown;var gs=this.pressedKeys;var gr=this.keyCodes;gt.stopPropagation();gt.preventDefault();var gv=gt.keyCode;gv=this.keyMap[gv];var gu=gt.keyLocation||gt.location;if(undefined!==gv&&(gr.ESCAPE!==gv)){if(2===gu){gv=gv+1}if(!gs[gv]){gs[gv]=true;this.sendEventToHandlers(gw,gv)}}};gq.prototype.onKeyUp=function(gu){var gs=this.handlers.keyup;var gt=this.pressedKeys;var gr=this.keyCodes;gu.stopPropagation();gu.preventDefault();var gw=gu.keyCode;gw=this.keyMap[gw];var gv=gu.keyLocation||gu.location;if(gw===gr.ESCAPE){this.unlockMouse();if(document.fullscreenEnabled||document.mozFullScreen||document.webkitIsFullScreen){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.exitFullscreen){document.exitFullscreen()
}}}}}else{if(undefined!==gw){if(2===gv){gw=gw+1}if(gt[gw]){gt[gw]=false;this.sendEventToHandlers(gs,gw);if((627===gw||628===gw)&&(this.macosx)){this.resetKeyStates()}}}}};gq.prototype.onTouchStart=function(gr){var gs=this.handlers.touchstart;gr.preventDefault();this.addTouches(gr.changedTouches);gr=this.convertW3TouchEventToTurbulenzTouchEvent(gr);this.sendEventToHandlers(gs,gr)};gq.prototype.onTouchEnd=function(gr){var gs=this.handlers.touchend;gr.preventDefault();gr=this.convertW3TouchEventToTurbulenzTouchEvent(gr);this.removeTouches(gr.changedTouches);this.sendEventToHandlers(gs,gr)};gq.prototype.onTouchMove=function(gr){var gs=this.handlers.touchmove;gr.preventDefault();this.addTouches(gr.changedTouches);gr=this.convertW3TouchEventToTurbulenzTouchEvent(gr);this.sendEventToHandlers(gs,gr)};gq.prototype.onTouchEnter=function(gr){var gs=this.handlers.touchenter;gr.preventDefault();gr=this.convertW3TouchEventToTurbulenzTouchEvent(gr);this.sendEventToHandlers(gs,gr)};gq.prototype.onTouchLeave=function(gr){var gs=this.handlers.touchleave;
gr.preventDefault();gr=this.convertW3TouchEventToTurbulenzTouchEvent(gr);this.sendEventToHandlers(gs,gr)};gq.prototype.onTouchCancel=function(gr){var gs=this.handlers.touchcancel;gr.preventDefault();gr=this.convertW3TouchEventToTurbulenzTouchEvent(gr);this.removeTouches(gr.changedTouches);this.sendEventToHandlers(gs,gr)};gq.prototype.convertW3TouchEventToTurbulenzTouchEvent=function(gs){var gr=this.convertW3TouchListToTurbulenzTouchList(gs.changedTouches);var gt=this.convertW3TouchListToTurbulenzTouchList(gs.targetTouches);var gv=this.convertW3TouchListToTurbulenzTouchList(gs.touches);var gu={changedTouches:gr,gameTouches:gt,touches:gv};return cx.create(gu)};gq.prototype.convertW3TouchListToTurbulenzTouchList=function(gr){var gt=gr.length;var gs=[];var gv;var gu;gs.length=gt;for(gu=0;gu<gt;gu+=1){gv=this.getTouchById(gr[gu].identifier);gs[gu]=gv}return gs};gq.prototype.convertW3TouchToTurbulenzTouch=function(gu){var gs=this.canvas;var gt=gs.getBoundingClientRect();var gr={force:(gu.force||gu.webkitForce||0),identifier:gu.identifier,isGameTouch:(gu.target===gs),positionX:(gu.pageX-gt.left),positionY:(gu.pageY-gt.top),radiusX:(gu.radiusX||gu.webkitRadiusX||1),radiusY:(gu.radiusY||gu.webkitRadiusY||1),rotationAngle:(gu.rotationAngle||gu.webkitRotationAngle||0)};
return ai.create(gr)};gq.prototype.addTouches=function(gr){var gs=gr.length;var gt;var gu;for(gt=0;gt<gs;gt+=1){gu=this.convertW3TouchToTurbulenzTouch(gr[gt]);this.addTouch(gu)}};gq.prototype.removeTouches=function(gs){var gt=gs.length;var gu;var gr;for(gu=0;gu<gt;gu+=1){gr=gs[gu].identifier;this.removeTouchById(gr)}};gq.prototype.addTouch=function(gr){this.touches[gr.identifier]=gr};gq.prototype.getTouchById=function(gr){return this.touches[gr]};gq.prototype.removeTouchById=function(gr){delete this.touches[gr]};gq.prototype.canvasOnMouseOver=function(gs){var gr=this.handlers.mouseenter;if(!this.isMouseLocked){this.isHovering=true;this.lastX=gs.screenX;this.lastY=gs.screenY;this.setEventHandlersMouseEnter();this.sendEventToHandlers(gr)}else{this.isOutsideEngine=false}};gq.prototype.canvasOnMouseOut=function(){var gr=this.handlers.mouseleave;if(!this.isMouseLocked){this.isHovering=false;if(this.isCursorHidden){this.showMouse()}this.setEventHandlersMouseLeave();this.sendEventToHandlers(gr)
}else{this.isOutsideEngine=true}};gq.prototype.canvasOnMouseDown=function(gs){var gr=this.handlers.mouseenter;this.canvas.onmousedown=null;if(!this.isHovering){this.isHovering=true;this.lastX=gs.screenX;this.lastY=gs.screenY;this.setEventHandlersMouseEnter();this.sendEventToHandlers(gr);this.onMouseDown(gs)}return false};gq.prototype.onFullscreenChanged=function(){if(this.isMouseLocked){if(document.fullscreenEnabled||document.mozFullScreen||document.webkitIsFullScreen){this.ignoreNextMouseMoves=2;this.requestBrowserLock()}else{this.unlockMouse()}}};gq.prototype.setEventHandlersMouseEnter=function(){if(!this.isFocused()){this.addInternalEventListener(window,"mousedown",this.onMouseDown)}this.addInternalEventListener(window,"mouseup",this.onMouseUp);this.addInternalEventListener(window,"mousemove",this.onMouseOver);this.addInternalEventListener(window,"DOMMouseScroll",this.onWheel);this.addInternalEventListener(window,"mousewheel",this.onWheel);this.addInternalEventListener(window,"click",this.emptyEvent)
};gq.prototype.setEventHandlersMouseLeave=function(){if(!this.isFocused()){this.removeInternalEventListener(window,"mousedown",this.onMouseDown)}this.removeInternalEventListener(window,"mouseup",this.onMouseUp);this.removeInternalEventListener(window,"mousemove",this.onMouseOver);this.removeInternalEventListener(window,"DOMMouseScroll",this.onWheel);this.removeInternalEventListener(window,"mousewheel",this.onWheel);this.removeInternalEventListener(window,"click",this.emptyEvent)};gq.prototype.setEventHandlersFocus=function(){this.addInternalEventListener(window,"keydown",this.onKeyDown);this.addInternalEventListener(window,"keyup",this.onKeyUp)};gq.prototype.setEventHandlersBlur=function(){this.removeInternalEventListener(window,"keydown",this.onKeyDown);this.removeInternalEventListener(window,"keyup",this.onKeyUp);this.removeInternalEventListener(window,"mousedown",this.onMouseDown)};gq.prototype.setEventHandlersLock=function(){this.removeInternalEventListener(window,"mousemove",this.onMouseOver);
this.addInternalEventListener(window,"mousemove",this.onMouseMove);this.addInternalEventListener(document,"fullscreenchange",this.onFullscreenChanged);this.addInternalEventListener(document,"mozfullscreenchange",this.onFullscreenChanged);this.addInternalEventListener(document,"webkitfullscreenchange",this.onFullscreenChanged)};gq.prototype.setEventHandlersUnlock=function(){this.removeInternalEventListener(document,"webkitfullscreenchange",this.onFullscreenChanged);this.removeInternalEventListener(document,"mozfullscreenchange",this.onFullscreenChanged);this.removeInternalEventListener(document,"fullscreenchange",this.onFullscreenChanged);this.removeInternalEventListener(window,"mousemove",this.onMouseMove);this.addInternalEventListener(window,"mousemove",this.onMouseOver)};gq.prototype.setEventHandlersCanvas=function(){var gr=this.canvas;this.addInternalEventListener(gr,"mouseover",this.canvasOnMouseOver);this.addInternalEventListener(gr,"mouseout",this.canvasOnMouseOut);this.addInternalEventListener(gr,"mousedown",this.canvasOnMouseDown)
};gq.prototype.setEventHandlersWindow=function(){this.addInternalEventListener(window,"blur",this.onBlur);this.addInternalEventListener(window,"focus",this.onWindowFocus)};gq.prototype.removeEventHandlersWindow=function(){this.removeInternalEventListener(window,"blur",this.onBlur);this.removeInternalEventListener(window,"focus",this.onWindowFocus)};gq.prototype.setEventHandlersTouch=function(){var gr=this.canvas;this.addInternalEventListener(gr,"touchstart",this.onTouchStart);this.addInternalEventListener(gr,"touchend",this.onTouchEnd);this.addInternalEventListener(gr,"touchenter",this.onTouchEnter);this.addInternalEventListener(gr,"touchleave",this.onTouchLeave);this.addInternalEventListener(gr,"touchmove",this.onTouchMove);this.addInternalEventListener(gr,"touchcancel",this.onTouchCancel)};gq.prototype.addInternalEventListener=function(gv,gt,gu){var gr=this.elementEventFlags[gv];if(!gr){this.elementEventFlags[gv]=gr={}}if(!gr[gt]){gr[gt]=true;var gs=this.boundFunctions[gu];if(!gs){this.boundFunctions[gu]=gs=gu.bind(this)
}gv.addEventListener(gt,gs,false)}};gq.prototype.removeInternalEventListener=function(gv,gt,gu){var gr=this.elementEventFlags[gv];if(gr){if(gr[gt]){gr[gt]=false;var gs=this.boundFunctions[gu];gv.removeEventListener(gt,gs,false)}}};gq.prototype.destroy=function(){if(this.isLocked()){this.setEventHandlersUnlock()}if(this.isHovering){this.setEventHandlersMouseLeave()}if(this.isWindowFocused){this.setEventHandlersBlur()}this.removeEventHandlersWindow();var gr=this.canvas;gr.onmouseover=null;gr.onmouseout=null;gr.onmousedown=null};gq.prototype.isSupported=function(gt){var gs=this.canvas;if((gs)&&(gt==="POINTER_LOCK")){var gr=("pointerLockElement" in document)||("mozPointerLockElement" in document)||("webkitPointerLockElement" in document);var gu=(gs.requestPointerLock||gs.mozRequestPointerLock||gs.webkitRequestPointerLock);if(gr&&gu){return true}}return false};gq.create=function(gs){var gD=new gq();gD.lastX=0;gD.lastY=0;gD.touches={};gD.boundFunctions={};gD.elementEventFlags={};gD.canvas=gs;
gD.isMouseLocked=false;gD.isHovering=false;gD.isWindowFocused=false;gD.isCursorHidden=false;gD.isOutsideEngine=false;gD.previousCursor="";gD.ignoreNextMouseMoves=0;gD.ignoreNextBlur=false;gD.pressedKeys={};gD.handlers={keydown:[],keyup:[],mousedown:[],mouseup:[],mousewheel:[],mouseover:[],mousemove:[],paddown:[],padup:[],padmove:[],mouseenter:[],mouseleave:[],focus:[],blur:[],mouselocklost:[],touchstart:[],touchend:[],touchenter:[],touchleave:[],touchmove:[],touchcancel:[]};var gu={};var gJ=gD.keyCodes;for(var gH in gJ){if(gJ.hasOwnProperty(gH)){var gr=gJ[gH];gu[gr]=gH}}gu[gJ.SPACE]=" ";gu[gJ.NUMBER_0]="0";gu[gJ.NUMBER_1]="1";gu[gJ.NUMBER_2]="2";gu[gJ.NUMBER_3]="3";gu[gJ.NUMBER_4]="4";gu[gJ.NUMBER_5]="5";gu[gJ.NUMBER_6]="6";gu[gJ.NUMBER_7]="7";gu[gJ.NUMBER_8]="8";gu[gJ.NUMBER_9]="9";gu[gJ.GRAVE]="`";gu[gJ.MINUS]="-";gu[gJ.EQUALS]="=";gu[gJ.LEFT_BRACKET]="[";gu[gJ.RIGHT_BRACKET]="]";gu[gJ.SEMI_COLON]=";";gu[gJ.APOSTROPHE]="'";gu[gJ.COMMA]=",";gu[gJ.PERIOD]=".";gu[gJ.SLASH]="/";gu[gJ.BACKSLASH]="\\";
var gE={};gE[65]=0;gE[66]=1;gE[67]=2;gE[68]=3;gE[69]=4;gE[70]=5;gE[71]=6;gE[72]=7;gE[73]=8;gE[74]=9;gE[75]=10;gE[76]=11;gE[77]=12;gE[78]=13;gE[79]=14;gE[80]=15;gE[81]=16;gE[82]=17;gE[83]=18;gE[84]=19;gE[85]=20;gE[86]=21;gE[87]=22;gE[88]=23;gE[89]=24;gE[90]=25;gE[48]=100;gE[49]=101;gE[50]=102;gE[51]=103;gE[52]=104;gE[53]=105;gE[54]=106;gE[55]=107;gE[56]=108;gE[57]=109;gE[37]=200;gE[39]=201;gE[38]=202;gE[40]=203;gE[16]=300;gE[17]=302;gE[18]=304;gE[0]=305;gE[27]=400;gE[9]=401;gE[32]=402;gE[8]=403;gE[13]=404;gE[223]=500;gE[173]=501;gE[189]=501;gE[61]=502;gE[187]=502;gE[219]=503;gE[221]=504;gE[59]=505;gE[186]=505;gE[192]=500;gE[188]=507;gE[190]=508;gE[222]=506;if(navigator.appVersion.indexOf("Mac")!==-1){gE[0]=500}gE[112]=600;gE[113]=601;gE[114]=602;gE[115]=603;gE[116]=604;gE[117]=605;gE[118]=606;gE[119]=607;gE[120]=608;gE[121]=609;gE[122]=610;gE[123]=611;gE[96]=612;gE[97]=613;gE[98]=614;gE[99]=615;gE[100]=616;gE[12]=617;gE[101]=617;gE[144]=617;gE[102]=618;gE[103]=619;gE[104]=620;gE[105]=621;
gE[111]=623;gE[191]=623;gE[106]=624;gE[107]=625;gE[109]=626;gE[91]=627;gE[224]=627;gE[92]=628;gE[93]=628;gE[20]=631;gE[45]=632;gE[46]=633;gE[36]=634;gE[35]=635;gE[33]=636;gE[34]=637;gD.keyMap=gE;var gw={0:0,1:2,2:1};gD.mouseMap=gw;var gG={0:4,1:5,2:6,3:7,4:10,5:11,8:19,9:18,10:12,11:15,12:0,13:2,14:1,15:3};gD.padMap=gG;gD.keyCodeToUnicode=gu;gD.padButtons=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];gD.padMap=gG;gD.padAxisDeadZone=0.26;gD.maxAxisRange=1;gD.padTimestampUpdate=0;var gx=(gs.requestPointerLock||gs.mozRequestPointerLock||gs.webkitRequestPointerLock);if(gx){var gy=(document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock);gD.onPointerLockChanged=function gB(){var gK=(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement);if(gK!==gD.canvas){gD.unlockMouse()}};gD.onPointerLockError=function gz(){gD.unlockMouse()};if("mozPointerLockElement" in document){gD.setEventHandlersPointerLock=function gI(){this.ignoreNextBlur=true;
document.addEventListener("mozpointerlockchange",this.onPointerLockChanged,false);document.addEventListener("mozpointerlockerror",this.onPointerLockError,false)};gD.setEventHandlersPointerUnlock=function gC(){this.ignoreNextBlur=false;document.removeEventListener("mozpointerlockchange",this.onPointerLockChanged,false);document.removeEventListener("mozpointerlockerror",this.onPointerLockError,false)}}else{if("webkitPointerLockElement" in document){gD.setEventHandlersPointerLock=function gI(){document.addEventListener("webkitpointerlockchange",this.onPointerLockChanged,false);document.addEventListener("webkitpointerlockerror",this.onPointerLockError,false)};gD.setEventHandlersPointerUnlock=function gC(){document.removeEventListener("webkitpointerlockchange",this.onPointerLockChanged,false);document.removeEventListener("webkitpointerlockerror",this.onPointerLockError,false)}}else{if("pointerLockElement" in document){gD.setEventHandlersPointerLock=function gI(){document.addEventListener("pointerlockchange",this.onPointerLockChanged,false);
document.addEventListener("pointerlockerror",this.onPointerLockError,false)};gD.setEventHandlersPointerUnlock=function gC(){document.removeEventListener("pointerlockchange",this.onPointerLockChanged,false);document.removeEventListener("pointerlockerror",this.onPointerLockError,false)}}}}gD.requestBrowserLock=function gt(){var gK=(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement);if(gK!==gs){this.setEventHandlersPointerLock();gx.call(gs)}};gD.requestBrowserUnlock=function gv(){this.setEventHandlersPointerUnlock();var gK=(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement);if(gK===gs){gy.call(document)}}}else{var gF=(navigator.pointer||navigator.webkitPointer);if(gF){gD.requestBrowserLock=function gt(){if(!gF.isLocked){gF.lock(gs)}};gD.requestBrowserUnlock=function gv(){if(gF.isLocked){gF.unlock()}}}else{gD.requestBrowserLock=function gt(){};gD.requestBrowserUnlock=function gv(){}}}gD.setEventHandlersCanvas();
gD.setEventHandlersWindow();gD.setEventHandlersTouch();var gA=TurbulenzEngine.getSystemInfo();gD.macosx=("Darwin"===gA.osName);gD.webkit=(/WebKit/.test(navigator.userAgent));return gD};gq.version=1;return gq})();y.prototype.keyCodes={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,NUMBER_0:100,NUMBER_1:101,NUMBER_2:102,NUMBER_3:103,NUMBER_4:104,NUMBER_5:105,NUMBER_6:106,NUMBER_7:107,NUMBER_8:108,NUMBER_9:109,LEFT:200,RIGHT:201,UP:202,DOWN:203,LEFT_SHIFT:300,RIGHT_SHIFT:301,LEFT_CONTROL:302,RIGHT_CONTROL:303,LEFT_ALT:304,RIGHT_ALT:305,ESCAPE:400,TAB:401,SPACE:402,BACKSPACE:403,RETURN:404,GRAVE:500,MINUS:501,EQUALS:502,LEFT_BRACKET:503,RIGHT_BRACKET:504,SEMI_COLON:505,APOSTROPHE:506,COMMA:507,PERIOD:508,SLASH:509,BACKSLASH:510,F1:600,F2:601,F3:602,F4:603,F5:604,F6:605,F7:606,F8:607,F9:608,F10:609,F11:610,F12:611,NUMPAD_0:612,NUMPAD_1:613,NUMPAD_2:614,NUMPAD_3:615,NUMPAD_4:616,NUMPAD_5:617,NUMPAD_6:618,NUMPAD_7:619,NUMPAD_8:620,NUMPAD_9:621,NUMPAD_ENTER:622,NUMPAD_DIVIDE:623,NUMPAD_MULTIPLY:624,NUMPAD_ADD:625,NUMPAD_SUBTRACT:626,LEFT_WIN:627,RIGHT_WIN:628,LEFT_OPTION:629,RIGHT_OPTION:630,CAPS_LOCK:631,INSERT:632,DELETE:633,HOME:634,END:635,PAGE_UP:636,PAGE_DOWN:637,BACK:638};
y.prototype.mouseCodes={BUTTON_0:0,BUTTON_1:1,BUTTON_2:2,DELTA_X:100,DELTA_Y:101,MOUSE_WHEEL:102};y.prototype.padCodes={UP:0,LEFT:1,DOWN:2,RIGHT:3,A:4,B:5,X:6,Y:7,LEFT_TRIGGER:8,RIGHT_TRIGGER:9,LEFT_SHOULDER:10,RIGHT_SHOULDER:11,LEFT_THUMB:12,LEFT_THUMB_X:13,LEFT_THUMB_Y:14,RIGHT_THUMB:15,RIGHT_THUMB_X:16,RIGHT_THUMB_Y:17,START:18,BACK:19};WebGLMathDevice=f2;var aa=(function(){function gq(){}gq.prototype.createWebSocket=function(gt,gv){var gu=this.WebSocketConstructor;if(gu){var gs;if(gv){gs=new gu(gt,gv)}else{gs=new gu(gt)}if(typeof gs.destroy==="undefined"){gs.destroy=function gr(){this.onopen=null;this.onerror=null;this.onclose=null;this.onmessage=null;this.close()}}return gs}else{return null}};gq.prototype.update=function(){};gq.create=function(gs){var gr=new gq();return gr};gq.version=1;return gq})();aa.prototype.WebSocketConstructor=(window.WebSocket?window.WebSocket:window.MozWebSocket);var ar=(function(){function gq(){}gq.version=1;return gq})();var bp={CONTACT_SLOP:0.015,CONTACT_BAUMGRAUTE:0.35,CONTACT_STATIC_BAUMGRAUTE:0.65,CONTACT_MAX_Y_SEPERATION:0.05,CONTACT_MAX_SQ_XZ_SEPERATION:2*(0.245*0.245),CONTACT_INHERIT_SQ_SEPERATION:3*(0.75*0.75),CONTACT_EQUAL_SQ_SEPERATION:3*(0.001*0.001),GJK_EPA_DISTANCE_THRESHOLD:0.0001,GJK_FRACTIONAL_THRESHOLD:0.0001,CONTINUOUS_LINEAR_SQ:0.35,CONTINUOUS_ANGULAR_SQ:0.25,CONTINUOUS_LINEAR_BULLET:0.75,CONTINUOUS_ANGULAR_BULLET:0.5,CONTINUOUS_SLOP:0.015,SLEEP_LINEAR_SQ:0.01,SLEEP_ANGULAR_SQ:0.1,SLEEP_DELAY:60,MAX_ANGULAR:Math.PI,QUADRATIC_THRESHOLD:1e-8,DONT_NORMALIZE_THRESHOLD:1e-8,COLLINEAR_THRESHOLD:1e-10,COPLANAR_THRESHOLD:1e-16};
var f4=function ac(gt,gs){for(var gr in gs){if(gs.hasOwnProperty(gr)){var gq=gs[gr];if(gq===null||gq===undefined){continue}if(typeof gq==="object"&&gr!=="shape"&&gr!=="userData"&&gr!=="world"&&gr!=="object"&&gr!=="arbiters"&&gr!=="islandRoot"&&gr!=="island"&&gr!=="bodyA"&&gr!=="bodyB"&&gr!=="triangleArray"){if("slice" in gq){gq=gq.slice()}else{gq=f4({},gq)}}gt[gr]=gq}}return gt};var ei=function eI(gv,gu,gt){if(!gt){Object.defineProperty(gv,"margin",{get:function gx(){return this._private.collisionRadius},set:function gq(gy){var gz=this._private;gz.halfExtents[0]+=(gy-gz.collisionRadius);gz.halfExtents[1]+=(gy-gz.collisionRadius);gz.halfExtents[2]+=(gy-gz.collisionRadius);gz.radius+=(gy-gz.collisionRadius);gz.collisionRadius=gy},enumerable:true})}Object.defineProperty(gv,"halfExtents",{get:function gs(){return f2.v3Copy(this._private.halfExtents)},enumerable:true});Object.defineProperty(gv,"inertia",{get:function gw(){return f2.v3Copy(this._private.inertia)},enumerable:true});Object.defineProperty(gv,"radius",{get:function gr(){return this._private.radius
},enumerable:true});Object.defineProperty(gv,"type",{value:gu,enumerable:true})};var e5=(function(){function gq(){}gq.prototype.rayTest=function(gx){var gy=gx.direction;var gG=gx.origin;var gE=gy[0];var gC=gy[1];var gA=gy[2];var gF=gG[0];var gD=gG[1];var gB=gG[2];var gH=this.normal;var gw=gH[0];var gv=gH[1];var gu=gH[2];var gz=((gE*gw)+(gC*gv)+(gA*gu));if((gz*gz)<bp.COPLANAR_THRESHOLD){return null}var gt=((this.distance-((gF*gw)+(gD*gv)+(gB*gu)))/gz);if(0<=gt&&gt<=gx.maxFactor){if(gz>0){gw=-gw;gv=-gv;gu=-gu}var gs=(gF+(gE*gt));var gr=(gD+(gC*gt));var gI=(gB+(gA*gt));return{factor:gt,hitPoint:f2.v3Build(gs,gr,gI),hitNormal:f2.v3Build(gw,gv,gu)}}else{return null}};gq.create=function(gw){var gs=new ar();var gv=new gq();gs._private=gv;gv._public=gs;gv.collisionRadius=(gw.margin!==undefined)?gw.margin:0.04;gv.distance=gw.distance;var gu=gv.normal=f2.v3Copy(gw.normal);var gr=Math.abs;var gt=Number.MAX_VALUE;gv.radius=gt;if(gr(gu[0])===1){gv.halfExtents=f2.v3Build(gr(gv.distance),gt,gt)}else{if(gr(gu[1])===1){gv.halfExtents=f2.v3Build(gt,gr(gv.distance),gt)
}else{if(gr(gu[2])===1){gv.halfExtents=f2.v3Build(gt,gt,gr(gv.distance))}}}gv.center=undefined;gv.inertia=f2.v3BuildZero();ei(gs,"PLANE");return gs};gq.version=1;return gq})();e5.prototype.type="PLANE";var aZ=(function(){function gq(){}gq.prototype.rayTestCap=function(gz,gA,gO){var gN=gz.origin;var gK=gz.direction;var gH=gN[0];var gF=gN[1];var gD=gN[2];var gG=gK[0];var gE=gK[1];var gC=gK[2];var gu=this.capsuleRadius;var gM=((gG*gG)+(gE*gE)+(gC*gC));var gx=(gF-gA);var gL=(2*((gG*gH)+(gE*gx)+(gC*gD)));var gJ=((gH*gH)+(gx*gx)+(gD*gD)-(gu*gu));var gI=((gL*gL)-(4*gM*gJ));if(gI<0){return null}var gt;var gy=1;var gr;var gw=(1/(2*gM));var gv=Math.sqrt(gI);gt=((-gL-gv)*gw);gr=(gF+(gE*gt));if(gt<0||(gO*(gr-gA)<0)){gt+=(2*gv*gw);gr=(gF+(gE*gt));gy=-1}if((gO*(gr-gA)>=0)&&(0<=gt&&gt<=gz.maxFactor)){var gs=(gH+(gG*gt));var gP=(gD+(gC*gt));var gB=(gy/gu);return{factor:gt,hitPoint:f2.v3Build(gs,gr,gP),hitNormal:f2.v3Build((gs*gB),((gr-gA)*gB),(gP*gB))}}else{return null}};gq.prototype.rayTest=function(gy){var gO=gy.origin;
var gL=gy.direction;var gH=gO[0];var gF=gO[1];var gD=gO[2];var gG=gL[0];var gE=gL[1];var gC=gL[2];var gB=gy.maxFactor;var gv=this.capsuleRadius;var gA=this.halfHeight;var gt=(gv*gv);var gu;var gz=1;var gs;var gr;var gP;var gM=((gG*gG)+(gC*gC));if(gM>=bp.QUADRATIC_THRESHOLD){var gK=(2*((gH*gG)+(gD*gC)));var gJ=((gH*gH)+(gD*gD)-gt);var gI=((gK*gK)-(4*gM*gJ));var gx=(1/(2*gM));if(gI<bp.QUADRATIC_THRESHOLD){gu=(-gK*gx)}else{if(gI>0){var gw=Math.sqrt(gI);gu=((-gK-gw)*gx);if(gu<0){gu+=(gw*2*gx);gz=-1}}}var gN;gr=(gF+(gE*gu));if(-gA<=gr&&gr<=gA){if(0<=gu&&gu<=gB){gs=(gH+(gG*gu));gP=(gD+(gC*gu));gN=(gz/gv);return{factor:gu,hitPoint:f2.v3Build(gs,gr,gP),hitNormal:f2.v3Build((gs*gN),0,(gP*gN))}}else{return null}}}return this.rayTestCap(gy,gA,1)||this.rayTestCap(gy,-gA,-1)};gq.prototype.localSupportWithoutMargin=function(gr,gs){gs[0]=0;gs[1]=(gr[1]>=0)?this.halfHeight:(-this.halfHeight);gs[2]=0};gq.create=function(gu){var gx=new ar();var gD=new gq();gx._private=gD;gD._public=gx;var gv=(gu.margin!==undefined)?gu.margin:0.04;
var gy=gu.radius;var gG=gu.height;var gB=(0.5*gG);var gw=(gy+gB);var gE=(gy+gv);var gC=(gw+gv);var gA=(gy+gv);var gt=(2*gE);var gs=(2*gC);var gr=(2*gA);gt*=gt;gs*=gs;gr*=gr;var gH=(1/12);gD.radius=gw+gv;gD.capsuleRadius=gy;gD.halfHeight=gB;gD.halfExtents=f2.v3Build(gE,gC,gA);gD.inertia=f2.v3Build(gH*(gs+gr),gH*(gt+gr),gH*(gt+gs));gD.collisionRadius=gy+gv;gD.center=undefined;Object.defineProperty(gx,"margin",{get:function gz(){return(this._private.collisionRadius-this._private.capsuleRadius)},set:function gF(gI){var gJ=this._private;gJ.collisionRadius=(gJ.capsuleRadius+gI);gJ.halfExtents[0]=gJ.capsuleRadius+gI;gJ.halfExtents[1]=(gJ.capsuleRadius+gJ.halfHeight)+gI;gJ.halfExtents[2]=gJ.capsuleRadius+gI;gJ.radius=(gJ.capsuleRadius+gJ.halfHeight)+gI},enumerable:true});ei(gx,"CAPSULE",true);return gx};gq.version=1;return gq})();ar.prototype.type="CAPSULE";var d=(function(){function gq(){}gq.prototype.rayTest=function(gx){var gL=gx.origin;var gH=gx.direction;var gu=this.sphereRadius;var gD=gH[0];
var gB=gH[1];var gz=gH[2];var gE=gL[0];var gC=gL[1];var gA=gL[2];var gJ=((gD*gD)+(gB*gB)+(gz*gz));var gI=(2*((gE*gD)+(gC*gB)+(gA*gz)));var gG=(((gE*gE)+(gC*gC)+(gA*gA))-(gu*gu));var gt;var gF=((gI*gI)-(4*gJ*gG));if(gF<=0){return null}var gy=1;var gw=(1/(2*gJ));var gv=Math.sqrt(gF);gt=((-gI-gv)*gw);if(gt<0){gt+=(gv*2*gw);gy=-1}if(0<=gt&&gt<gx.maxFactor){var gs=(gE+(gD*gt));var gr=(gC+(gB*gt));var gM=(gA+(gz*gt));var gK=(gy/gu);return{factor:gt,hitPoint:f2.v3Build(gs,gr,gM),hitNormal:f2.v3Build((gs*gK),(gr*gK),(gM*gK))}}else{return null}};gq.prototype.localSupportWithoutMargin=function(gr,gs){gs[0]=gs[1]=gs[2]=0};gq.create=function(gy){var gx=new ar();var gu=new gq();gx._private=gu;gu._public=gx;var gw=(gy.margin!==undefined)?gy.margin:0.04;var gr=gy.radius;var gt=(0.4*gr*gr);gu.sphereRadius=gr;gu.radius=gu.sphereRadius+gw;gu.collisionRadius=gr+gw;gu.halfExtents=f2.v3Build(gr+gw,gr+gw,gr+gw);gu.inertia=f2.v3Build(gt,gt,gt);gu.center=undefined;Object.defineProperty(gx,"margin",{get:function gs(){return(this._private.collisionRadius-this._private.radius)
},set:function gv(gz){var gA=this._private;gA.collisionRadius=(gA.radius+gz);gA.halfExtents[0]=gA.collisionRadius;gA.halfExtents[1]=gA.collisionRadius;gA.halfExtents[2]=gA.collisionRadius;gA.radius=gA.collisionRadius},enumerable:true});ei(gx,"SPHERE",true);return gx};gq.version=1;return gq})();d.prototype.type="SPHERE";var cs=(function(){function gq(){}gq.prototype.rayTest=function(gw){var gH=gw.origin;var gG=gw.direction;var gB=gH[0];var gA=gH[1];var gz=gH[2];var gr=gG[0];var gJ=gG[1];var gI=gG[2];var gF=this.halfExtents;var gv=gF[0];var gu=gF[1];var gt=gF[2];var gy;var gs;var gx,gD,gE,gC;if(gr!==0&&((gr>0&&gB<=-gv)||(gr<0&&gB>=gv))){gD=(gr>0?(gB>=-gv?gv:-gv):(gB<=gv?-gv:gv));gx=(gD-gB)/gr;if(gy===undefined||gx<gy){gE=gA+(gJ*gx);gC=gz+(gI*gx);if((-gu<=gE&&gE<=gu)&&(-gt<=gC&&gC<=gt)){gy=gx;gs=0}}}if(gJ!==0&&((gJ>0&&gA<=-gu)||(gJ<0&&gA>=gu))){gD=(gJ>0?(gA>=-gu?gu:-gu):(gA<=gu?-gu:gu));gx=(gD-gA)/gJ;if(gy===undefined||gx<gy){gE=gB+(gr*gx);gC=gz+(gI*gx);if((-gv<=gE&&gE<=gv)&&(-gt<=gC&&gC<=gt)){gy=gx;
gs=1}}}if(gI!==0&&((gI>0&&gz<=-gt)||(gI<0&&gz>=gt))){gD=(gI>0?(gz>=-gt?gt:-gt):(gz<=gt?-gt:gt));gx=(gD-gz)/gI;if(gy===undefined||gx<gy){gE=gA+(gJ*gx);gC=gB+(gr*gx);if((-gu<=gE&&gE<=gu)&&(-gv<=gC&&gC<=gv)){gy=gx;gs=2}}}if(gy!==undefined&&gy<gw.maxFactor){return{hitPoint:f2.v3Build(gB+gr*gy,gA+gJ*gy,gz+gI*gy),hitNormal:f2.v3Build(gs===0?(gr>0?-1:1):0,gs===1?(gJ>0?-1:1):0,gs===2?(gI>0?-1:1):0),factor:gy}}else{return null}};gq.prototype.localSupportWithoutMargin=function(gr,gu){var gz=gr[0];var gy=gr[1];var gx=gr[2];var gs=this.halfExtents;var gw=gs[0];var gv=gs[1];var gt=gs[2];gu[0]=((gz<0)?-gw:gw);gu[1]=((gy<0)?-gv:gv);gu[2]=((gx<0)?-gt:gt)};gq.create=function(gu){var gx=new ar();var gB=new gq();gx._private=gB;gB._public=gx;var gv=(gu.margin!==undefined)?gu.margin:0.04;var gw=gu.halfExtents;var gA=(gw[0]+gv);var gz=(gw[1]+gv);var gy=(gw[2]+gv);var gt=(2*gA);var gs=(2*gz);var gr=(2*gy);gt*=gt;gs*=gs;gr*=gr;gB.center=undefined;gB.radius=Math.sqrt((gA*gA)+(gz*gz)+(gy*gy));gB.halfExtents=f2.v3Build(gA,gz,gy);
gB.inertia=f2.v3Build((1/12)*(gs+gr),(1/12)*(gt+gr),(1/12)*(gt+gs));gB.collisionRadius=gv;ei(gx,"BOX");return gx};gq.version=1;return gq})();cs.prototype.type="BOX";var f8=(function(){function gq(){}gq.prototype.rayTest=function(gz){var gO=gz.origin;var gK=gz.direction;var gH=gO[0];var gF=gO[1];var gD=gO[2];var gG=gK[0];var gE=gK[1];var gC=gK[2];var gB=gz.maxFactor;var gv=this.cylinderRadius;var gA=this.halfHeight;var gt=gv*gv;var gM=((gG*gG)+(gC*gC));var gL=(2*((gH*gG)+(gD*gC)));var gJ=((gH*gH)+(gD*gD)-gt);var gu;var gy=1;var gs,gr,gP;var gN,gx;var gI=((gL*gL)-(4*gM*gJ));if(gI>=0){gx=(1/(2*gM));var gw=Math.sqrt(gI);gu=((-gL-gw)*gx);if(gu<0){gu+=(gw*2*gx);gy=-1}gr=(gF+(gE*gu));if(-gA<=gr&&gr<=gA){if(0<=gu&&gu<=gB){gs=(gH+(gG*gu));gP=(gD+(gC*gu));gN=(gy/gv);return{factor:gu,hitPoint:f2.v3Build(gs,gr,gP),hitNormal:f2.v3Build((gs*gN),0,(gP*gN))}}else{return null}}}if((gE*gE)>=bp.COPLANAR_THRESHOLD){gN=((gE<0)?-1:1);gr=(-gN*gA);gx=(1/gE);gu=((gr-gF)*gx);if(gu<0){gr=(gN*gA);gu=((gr-gF)*gx)}if(0<=gu&&gu<=gB){gs=(gH+(gG*gu));
gP=(gD+(gC*gu));if(((gs*gs)+(gP*gP))<=gt){return{factor:gu,hitPoint:f2.v3Build(gs,gr,gP),hitNormal:f2.v3Build(0,-gN,0)}}}}return null};gq.prototype.localSupportWithoutMargin=function(gs,gw){var gr=gs[0];var gv=gs[2];var gt=((gr*gr)+(gv*gv));if(gt===0){if(gs[1]>0){gw[0]=this.cylinderRadius;gw[1]=this.halfHeight;gw[2]=0}else{gw[0]=0;gw[1]=-this.halfHeight;gw[2]=-this.cylinderRadius}return}var gu=(this.cylinderRadius/Math.sqrt(gt));gw[0]=(gr*gu);gw[1]=((gs[1]>0?1:-1)*this.halfHeight);gw[2]=(gv*gu)};gq.create=function(gr){var gx=new ar();var gz=new gq();gx._private=gz;gz._public=gx;var gs=(gr.margin!==undefined)?gr.margin:0.04;var gw=gr.halfExtents;var gB=(gw[0]+gs);var gA=(gw[1]+gs);var gy=(gw[2]+gs);var gC=(gB*gB);var gv=(4*gA*gA);var gu=(((1/12)*gv)+((1/4)*gC));var gt=((1/2)*gC);gz.center=undefined;gz.radius=Math.sqrt((gB*gB)+(gA*gA)+(gy*gy));gz.halfExtents=f2.v3Build(gB,gA,gy);gz.cylinderRadius=gw[0];gz.halfHeight=gw[1];gz.inertia=f2.v3Build(gu,gt,gu);gz.collisionRadius=gs;ei(gx,"CYLINDER");
return gx};gq.version=1;return gq})();f8.prototype.type="CYLINDER";var S=(function(){function gq(){}gq.prototype.rayTest=function(gA){var gQ=gA.origin;var gM=gA.direction;var gJ=gQ[0];var gH=gQ[1];var gF=gQ[2];var gI=gM[0];var gG=gM[1];var gE=gM[2];var gD=gA.maxFactor;var gv=this.coneRadius;var gC=this.halfHeight;var gt=(gv/(2*gC));gt*=gt;var gS=gH-gC;var gO=(gI*gI)+(gE*gE)-(gt*gG*gG);var gN=2*((gJ*gI)+(gF*gE)-(gt*gS*gG));var gL=(gJ*gJ)+(gF*gF)-(gt*gS*gS);var gu;var gz=1;var gs,gr,gR;var gK=((gN*gN)-(4*gO*gL));if(gK>=0){var gx=(1/(2*gO));var gw=Math.sqrt(gK);gu=((-gN-gw)*gx);gr=(gH+(gG*gu));if(gu<0||gr<-gC||gr>gC){gu+=(2*gw*gx);gz=-1;gr=(gH+(gG*gu));if(gu<0||gr<-gC||gr>gC){gu=undefined}}}var gB;if(gG!==0){gB=(-gC-gH)/gG;gs=(gJ+(gI*gB));gR=(gF+(gE*gB));if(gB<0||((gs*gs)+(gR*gR))>(gv*gv)){gB=undefined}}if(gB===undefined&&gu===undefined){return null}if(gB===undefined||(gu!==undefined&&gu<gB)){if(gu>=gD){return null}gs=(gJ+(gI*gu));gr=(gH+(gG*gu));gR=(gF+(gE*gu));var gy=gt*(gr-gC);var gP=gz/Math.sqrt((gs*gs)+(gy*gy)+(gR*gR));
return{hitPoint:f2.v3Build(gs,gr,gR),hitNormal:f2.v3Build(gP*gs,gP*gy,gP*gR),factor:gu}}else{if(gB>=gD){return null}gs=(gJ+(gI*gB));gr=(gH+(gG*gB));gR=(gF+(gE*gB));return{hitPoint:f2.v3Build(gs,gr,gR),hitNormal:f2.v3Build(0,((gH<-gC)?-1:1),0),factor:gB}}};gq.prototype.localSupportWithoutMargin=function(gs,gw){var gr=gs[0];var gv=gs[1];var gu=gs[2];var gt=Math.sqrt((gr*gr)+(gu*gu));if(((-this.coneRadius*gt)+(2*this.halfHeight*gv))>0){gw[0]=gw[2]=0;gw[1]=this.halfHeight}else{if(gt===0){gw[0]=this.coneRadius;gw[2]=0}else{gw[0]=(gr*this.coneRadius/gt);gw[2]=(gu*this.coneRadius/gt)}gw[1]=-this.halfHeight}};gq.create=function(gu){var gw=new ar();var gB=new gq();gw._private=gB;gB._public=gw;var gv=(gu.margin!==undefined)?gu.margin:0.04;var gx=gu.radius;var gD=gu.height;var gz=(0.5*gD);var gC=(gx+gv);var gA=(gz+gv);var gy=(gx+gv);var gt=(2*gC);var gs=(2*gA);var gr=(2*gy);gt*=gt;gs*=gs;gr*=gr;var gE=(1/12);gB.halfHeight=gz;gB.coneRadius=gx;gB.radius=Math.sqrt((gC*gC)+(gA*gA)+(gy*gy));gB.halfExtents=f2.v3Build(gC,gA,gy);
gB.inertia=f2.v3Build(gE*(gs+gr),gE*(gt+gr),gE*(gt+gs));gB.collisionRadius=gv;gB.center=undefined;ei(gw,"CONE");return gw};gq.version=1;return gq})();S.prototype.type="CONE";var e2=(function(){function gq(){}gq.create=function(gt){var gs=new gq();var g1=new bW();gs._private=g1;g1._public=gs;var gu=gt.vertices;var gM=(gu.length/3);var gw=gt.indices;var gV=(gw.length/3);var gS=gt.minExtent;var hb=gt.maxExtent;var hf;var he;var hd;if(!gS||!hb){var gD=gu[0];var gC=gu[1];var gz=gu[2];var g8=gD;var g6=gC;var g4=gz;var gW=gu.length;for(var g7=3;g7<gW;g7+=3){hf=gu[g7];he=gu[g7+1];hd=gu[g7+2];if(gD>hf){gD=hf}else{if(g8<hf){g8=hf}}if(gC>he){gC=he}else{if(g6<he){g6=he}}if(gz>hd){gz=hd}else{if(g4<hd){g4=hd}}}gS=[gD,gC,gz];hb=[g8,g6,g4]}var gv=new Float32Array(6);gv[0]=gS[0];gv[1]=gS[1];gv[2]=gS[2];gv[3]=hb[0];gv[4]=hb[1];gv[5]=hb[2];g1.vertices=(gt.dontCopy?gu:new Float32Array(gu));g1.numVertices=gM;g1.indices=(gt.dontCopy?gw:(gM<65536?new Uint16Array(gw):new Uint32Array(gw)));g1.numTriangles=gV;g1.extents=gv;
Object.defineProperty(gs,"vertices",{value:g1.vertices,enumerable:true});Object.defineProperty(gs,"indices",{value:g1.indices,enumerable:true});var gA=new Float32Array(bW.prototype.TRIANGLE_SIZE*gV);var g0=null;if(gV>=8){g0=af.create(true)}var ha;for(ha=0;ha<gV;ha=ha+1){var gE=(ha*3);var gP=(ha*bW.prototype.TRIANGLE_SIZE);var gI=(gw[gE]*3);var gH=(gw[gE+1]*3);var gF=(gw[gE+2]*3);var gB=gu[gI];var gy=gu[gI+1];var gx=gu[gI+2];var g5=gu[gH];var g3=gu[gH+1];var g2=gu[gH+2];var gU=gu[gF];var gT=gu[gF+1];var gR=gu[gF+2];var gL=(g5-gB);var gK=(g3-gy);var gJ=(g2-gx);hf=(gU-gB);he=(gT-gy);hd=(gR-gx);var gZ=((gK*hd)-(gJ*he));var gY=((gJ*hf)-(gL*hd));var gX=((gL*he)-(gK*hf));var hc=(1/Math.sqrt((gZ*gZ)+(gY*gY)+(gX*gX)));var gQ=(((gZ*gB)+(gY*gy)+(gX*gx))*hc);var gN=((gL*hf)+(gK*he)+(gJ*hd));var gO=((gL*gL)+(gK*gK)+(gJ*gJ));var gr=((hf*hf)+(he*he)+(hd*hd));var gG=((gN*gN)-(gO*gr));gA[gP]=(gZ*hc);gA[gP+1]=(gY*hc);gA[gP+2]=(gX*hc);gA[gP+3]=gB;gA[gP+4]=gy;gA[gP+5]=gx;gA[gP+6]=gL;gA[gP+7]=gK;gA[gP+8]=gJ;
gA[gP+9]=hf;gA[gP+10]=he;gA[gP+11]=hd;gA[gP+12]=gO;gA[gP+13]=gr;gA[gP+14]=gN;gA[gP+15]=gG;gA[gP+16]=gQ;if(g0){gv=new Float32Array(6);gv[0]=Math.min(gB,g5,gU);gv[1]=Math.min(gy,g3,gT);gv[2]=Math.min(gx,g2,gR);gv[3]=Math.max(gB,g5,gU);gv[4]=Math.max(gy,g3,gT);gv[5]=Math.max(gx,g2,gR);var g9={index:gP};g0.add(g9,gv)}}if(g0){g0.finalize()}g1.triangles=gA;g1.spatialMap=g0;return gs};gq.version=1;return gq})();var bW=(function(){function gq(){}gq.prototype.rayTest=function(gy){var gt=this.triangles;var gA=this.spatialMap;function gr(gU,hb,g5,gZ,g7){var hd=g5.direction;var gK=hd[0];var gI=hd[1];var gF=hd[2];var g3=g5.origin;var gO=g3[0];var gN=g3[1];var gM=g3[2];var g9=hb.index;var gY=gt[g9];var gX=gt[g9+1];var gW=gt[g9+2];var hg=((gK*gY)+(gI*gX)+(gF*gW));if((hg*hg)<bp.COPLANAR_THRESHOLD){return null}var hc=gt[g9+16];var gG=gt[g9+3];var gE=gt[g9+4];var gC=gt[g9+5];var gV=((hc-((gO*gY)+(gN*gX)+(gM*gW)))/hg);if(gV<0||gV>=g7){return null}if(hg>0){gY=-gY;gX=-gX;gW=-gW;hg=-hg}var gJ=(gO+(gK*gV));var gH=(gN+(gI*gV));
var gD=(gM+(gF*gV));var ha=(gJ-gG);var g8=(gH-gE);var g6=(gD-gC);var gT=gt[g9+12];var gB=gt[g9+13];var gS=gt[g9+14];var gL=gt[g9+15];var gR=gt[g9+6];var gQ=gt[g9+7];var gP=gt[g9+8];var hh=gt[g9+9];var hf=gt[g9+10];var he=gt[g9+11];var g2=(ha*gR)+(g8*gQ)+(g6*gP);var g1=(ha*hh)+(g8*hf)+(g6*he);var g4=((gS*g1)-(gB*g2));if(g4>0||g4<gL){return null}var g0=((gS*g2)-(gT*g1));if(g0>0||(g4+g0)<gL){return null}return{factor:gV,hitPoint:f2.v3Build(gJ,gH,gD),hitNormal:f2.v3Build(gY,gX,gW)}}if(gA){return af.rayTest([gA],gy,gr)}else{var gs=null;var gu=gy.maxFactor;var gv={index:0};var gw;var gx=this.numTriangles*gq.prototype.TRIANGLE_SIZE;for(gw=0;gw<gx;gw+=gq.prototype.TRIANGLE_SIZE){gv.index=gw;var gz=gr(null,gv,gy,0,gu);if(gz){gs=gz;gu=gs.factor}}return gs}};gq.version=1;return gq})();bW.prototype.TRIANGLE_SIZE=17;var dJ={isPlanar:function a8(gC){var gE=bp.COPLANAR_THRESHOLD;var gu=gC[0];var gt=gC[1];var gs=gC[2];var gB=(gC[3]-gu);var gz=(gC[4]-gt);var gy=(gC[5]-gs);var gH=(gC[6]-gu);var gG=(gC[7]-gt);
var gF=(gC[8]-gs);var gx=(gz*gF)-(gy*gG);var gw=(gy*gH)-(gB*gF);var gv=(gB*gG)-(gz*gH);var gA=1/Math.sqrt((gx*gx)+(gw*gw)+(gv*gv));gx*=gA;gw*=gA;gv*=gA;var gI=-((gu*gx)+(gt*gw)+(gs*gv));var gD;var gq=gC.length;for(gD=0;gD<gq;gD+=3){var gr=(gC[gD]*gx)+(gC[gD+1]*gw)+(gC[gD+2]*gv)+gI;if((gr*gr)>gE){return false}}return true},makePlanarConvexHull:function bz(gM){var gt=0.000001;var gW=gM[0];var gV=gM[1];var gT=gM[2];var gR=(gM[3]-gW);var gQ=(gM[4]-gV);var gP=(gM[5]-gT);var gH=(gM[6]-gW);var gG=(gM[7]-gV);var gF=(gM[8]-gT);var gv=(gQ*gF)-(gP*gG);var gs=(gP*gH)-(gR*gF);var gr=(gR*gG)-(gQ*gH);var gA,gz,gy;if((gv*gv)+(gr*gr)<gt){gA=1;gz=gy=0}else{gA=-gr;gz=0;gy=gv}var gD=(gs*gy)-(gr*gz);var gC=(gr*gA)-(gv*gy);var gB=(gv*gz)-(gs*gA);var gJ=gM.length/3;var gI=new Float32Array(gJ*2);var g0,gZ,gY;var gX;for(gX=0;gX<gJ;gX+=1){g0=gM[gX*3];gZ=gM[(gX*3)+1];gY=gM[(gX*3)+2];gI[gX*2]=(g0*gA)+(gZ*gz)+(gY*gy);gI[(gX*2)+1]=(g0*gD)+(gZ*gC)+(gY*gB)}var gx=0;gW=gI[0];gV=gI[1];for(gX=2;gX<(gJ*2);gX+=2){g0=gI[gX];
gZ=gI[gX+1];if(g0<gW||(g0===gW&&gZ<gV)){gx=(gX/2);gW=g0;gV=gZ}}var gu={};gu[gx]=0;var gE=1;var gq=[];var gK=gx;for(;;){var gU,gS,gO;var gw=-1;for(gX=0;gX<(gJ*2);gX+=2){if(gX===(gx*2)){continue}g0=gI[gX];gZ=gI[gX+1];var gN=(((g0-gW)*(g0-gW))+((gZ-gV)*(gZ-gV)));if(gw===-1){gw=(gX/2);gU=g0;gS=gZ;gO=gN;continue}var gL=((gU-gW)*(gZ-gV))-((gS-gV)*(g0-gW));if(gL<0||(gL===0&&gN>gO)){gw=(gX/2);gU=g0;gS=gZ;gO=gN}}if(gw in gu){break}gu[gw]=gE;gE+=1;if(gx!==gK){gq.push(gK);gq.push(gx);gq.push(gw)}gx=gw;gW=gI[gw*2];gV=gI[(gw*2)+1]}return this.createArray(gM,gq,gu,gE)},makeConvexHull:function ah(gO){var gy=0;var gZ=gO[0];var gY=gO[1];var gW=gO[2];var g3;var g6,g5,g4;var gG=(gO.length/3);for(g3=3;g3<(gG*3);g3+=3){g6=gO[g3];g5=gO[g3+1];g4=gO[g3+2];if(g6<gZ||(g6===gZ&&(g5<gY||(g5===gY&&g4<gW)))){gy=(g3/3);gZ=g6;gY=g5;gW=g4}}var gx=-1;var gP=-2;var gM=0;var g0,gX;for(g3=0;g3<(gG*3);g3+=3){if(g3===(gy*3)){continue}g6=gO[g3];g5=gO[g3+1];g0=g6-gZ;gX=g5-gY;var gS=((g0*g0)+(gX*gX));if(gS===0){if(gx===-1){gx=(g3/3)
}continue}var gu=gX/Math.sqrt(gS);if(gu>gP||(gu===gP&&gS>gM)){gP=gu;gM=gS;gx=(g3/3)}}var g1={};var gU=[gy,gx,gx,gy];var gt={};gt[gy]=0;gt[gx]=1;var gA=2;var gs=[];while(gU.length>0){gx=gU.pop();gy=gU.pop();if((gy+":"+gx) in g1){continue}var gw=-1;var gE,gC,gB;var gT,gz;gZ=gO[gy*3];gY=gO[(gy*3)+1];gW=gO[(gy*3)+2];var gr=(gO[gx*3]-gZ);var gq=(gO[(gx*3)+1]-gY);var g8=(gO[(gx*3)+2]-gW);var gv=1/((gr*gr)+(gq*gq)*(g8*g8));for(g3=0;g3<(gG*3);g3+=3){if(g3===(gy*3)||g3===(gx*3)){continue}g6=gO[g3];g5=gO[g3+1];g4=gO[g3+2];var gR=(((g6-gZ)*gr)+((g5-gY)*gq)+((g4-gW)*g8))*gv;var gL=(g6-(gZ+(gr*gR)));var gK=(g5-(gY+(gq*gR)));var gJ=(g4-(gW+(g8*gR)));var gQ=((gL*gL)+(gK*gK)+(gJ*gJ));if(gQ<=bp.COLLINEAR_THRESHOLD){continue}if(gw===-1){gw=(g3/3);gE=gL;gC=gK;gB=gJ;gT=gQ;gz=gR;continue}var gI=((gK*gB)-(gJ*gC));var gH=((gJ*gE)-(gL*gB));var gF=((gL*gC)-(gK*gE));var gD=(gL*((gq*gB)-(g8*gC))+gK*((g8*gE)-(gr*gB))+gJ*((gr*gC)-(gq*gE)));if((gD*gD)<bp.COPLANAR_THRESHOLD){if(((gL*gE)+(gK*gC)+(gJ*gB))>=0){if(gQ>gT||(gQ===gT&&gR>gz)){gw=(g3/3);
gE=gL;gC=gK;gB=gJ;gT=gQ;gz=gR}}else{g0=(g6-gZ);gX=(g5-gY);var gV=(g4-gW);gI=((gX*g8)-(gV*gq));gH=((gV*gr)-(g0*g8));gF=((g0*gq)-(gX*gr));var g7=true;var g2;for(g2=0;g2<(gG*3);g2+=3){if(((gI*(gO[g2]-gZ))+(gH*(gO[g2+1]-gY))+(gF*(gO[g2+2]-gW)))<0){g7=false;break}}if(g7){gw=(g3/3);gE=gL;gC=gK;gB=gJ;gT=gQ;gz=gR}}}else{var gN=(gI*gr)+(gH*gq)+(gF*g8);if(gN<0||(gN<=bp.COLLINEAR_THRESHOLD&&gQ>gT)){gw=(g3/3);gE=gL;gC=gK;gB=gJ;gT=gQ;gz=gR}}}if(!(gw in gt)){gt[gw]=gA;gA+=1}if(!((gy+":"+gx) in g1||(gx+":"+gw) in g1||(gw+":"+gy) in g1)){gs.push(gy);gs.push(gx);gs.push(gw);g1[gy+":"+gx]=true;g1[gx+":"+gw]=true;g1[gw+":"+gy]=true;gU.push(gw);gU.push(gx);gU.push(gy);gU.push(gw)}}return this.createArray(gO,gs,gt,gA)},createArray:function bw(gx,gy,gr,gq){var gz=new Float32Array(gq*3);var gu=gy.length;var gs=(gq<65536?new Uint16Array(gu):new Uint32Array(gu));var gv=(gx.length/3);var gt;for(gt=0;gt<gv;gt+=1){if(!(gt in gr)){continue}var gw=(gr[gt]*3);gz[gw]=gx[gt*3];gz[gw+1]=gx[(gt*3)+1];gz[gw+2]=gx[(gt*3)+2]
}for(gt=0;gt<gu;gt+=1){gs[gt]=gr[gy[gt]]}return e2.create({vertices:gz,indices:gs,dontCopy:true})._private}};var aT=(function(){function gq(){}gq.prototype.rayTest=function(gr){return this.triangleArray.rayTest(gr)};gq.create=function(gJ){var gI=new ar();var gB=new gq();gI._private=gB;gB._public=gI;var gC=(gJ.margin!==undefined)?gJ.margin:0.04;var gH=gJ.triangleArray._private;var gG=gH.extents;var gy=gG[0];var gw=gG[1];var gv=gG[2];var gu=gG[3];var gt=gG[4];var gs=gG[5];var gA=((0.5*(gu-gy))+gC);var gz=((0.5*(gt-gw))+gC);var gx=((0.5*(gs-gv))+gC);var gF=(0.5*(gy+gu));var gE=(0.5*(gw+gt));var gD=(0.5*(gv+gs));gB.triangleArray=gH;gB.radius=Math.sqrt((gA*gA)+(gz*gz)+(gx*gx));gB.halfExtents=f2.v3Build(gA,gz,gx);if(gF!==0||gE!==0||gD!==0){gB.center=f2.v3Build(gF,gE,gD)}else{gB.center=undefined}gB.inertia=f2.v3Build(0,0,0);gB.collisionRadius=gC;ei(gI,"TRIANGLE_MESH");Object.defineProperty(gI,"triangleArray",{get:function gr(){return this._private.triangleArray},enumerable:true});return gI};gq.version=1;
return gq})();aT.prototype.type="TRIANGLE_MESH";var bg=(function(){function gq(){}gq.prototype.rayTest=function(gr){var gs=this.triangleArray;if(gs===undefined){return null}return gs.rayTest(gr)};gq.prototype.localSupportWithoutMargin=function(gt,gx){var gE=gt[0];var gB=gt[1];var gz=gt[2];var gF=this.supportTopology;var gD=this.triangleArray.vertices;if(this.lastSupport===undefined){this.lastSupport=0}var gA=this.lastSupport;var gs=gF[gA];var gy=(gD[gs]*gE)+(gD[gs+1]*gB)+(gD[gs+2]*gz);for(;;){var gv=-1;var gr;var gw=gF[gA+1];for(gr=0;gr<gw;gr+=1){var gC=gF[gA+2+gr];gs=gF[gC];var gu=(gD[gs]*gE)+(gD[gs+1]*gB)+(gD[gs+2]*gz);if(gu>gy){gy=gu;gv=gC}}if(gv!==-1){gA=gv;continue}else{break}}this.lastSupport=gA;gs=gF[gA];gx[0]=gD[gs];gx[1]=gD[gs+1];gx[2]=gD[gs+2]};gq.create=function(gr){var gD=new ar();var gY=new gq();gD._private=gY;gY._public=gD;var gs=(gr.margin!==undefined)?gr.margin:0.04;var gS=gr.points;var gz=gS[0];var gx=gS[1];var gt=gS[2];var gW=gz;var gU=gx;var gT=gt;var gN=gS.length;var gV;
var g4,g3,g0;for(gV=3;gV<gN;gV+=3){g4=gS[gV];g3=gS[gV+1];g0=gS[gV+2];if(gz>g4){gz=g4}else{if(gW<g4){gW=g4}}if(gx>g3){gx=g3}else{if(gU<g3){gU=g3}}if(gt>g0){gt=g0}else{if(gT<g0){gT=g0}}}var gQ=((0.5*(gW-gz))+gs);var gP=((0.5*(gU-gx))+gs);var gM=((0.5*(gT-gt))+gs);var gA=(0.5*(gz+gW));var gy=(0.5*(gx+gU));var gv=(0.5*(gt+gT));var gK=(2*gQ);var gJ=(2*gP);var gI=(2*gM);gK*=gK;gJ*=gJ;gI*=gI;var gB=(1/12);gY.points=new Float32Array(gS);gY.radius=Math.sqrt((gQ*gQ)+(gP*gP)+(gM*gM));gY.halfExtents=f2.v3Build(gQ,gP,gM);if(gA!==0||gy!==0||gv!==0){gY.center=f2.v3Build(gA,gy,gv)}else{gY.center=undefined}gY.inertia=f2.v3Build(gB*(gJ+gI),gB*(gK+gI),gB*(gK+gJ));gY.collisionRadius=gs;if(gS.length<9){throw"At present time, WebGL PhysicsDevice does not permit a convex hull to contain less than 3 vertices"}else{var gH=dJ.isPlanar(gS);if(gH){gY.triangleArray=dJ.makePlanarConvexHull(gS)}else{gY.triangleArray=dJ.makeConvexHull(gS)}var g2=[];gS=gY.triangleArray.vertices;gN=gS.length;for(gV=0;gV<gN;gV+=3){g2[gV/3]=[]
}var gX;if(gH){for(gV=0;gV<(gN/3);gV+=1){gX=(gV+1)%(gN/3);g2[gV].push(gX);g2[gX].push(gV)}}else{var gu=gY.triangleArray.indices;gN=gu.length;for(gV=0;gV<gN;gV+=3){var gF=gu[gV];var gE=gu[gV+1];var gC=gu[gV+2];g2[gF].push(gE);g2[gE].push(gC);g2[gC].push(gF)}}gN=gS.length;if((gH&&gN>=(3*6))||(!gH&&gN>=(3*10))){for(gV=0;gV<gN;gV+=3){var gZ=Number.MAX_VALUE;g4=gS[gV];g3=gS[gV+1];g0=gS[gV+2];var gO;for(gX=0;gX<gN;gX+=3){var g1=(g4*gS[gX])+(g3*gS[gX+1])+(g0*gS[gX+2]);if(g1<gZ){gZ=g1;gO=gX}}g2[gV/3].push(gO/3)}}var gL=[];var gw=0;for(gV=0;gV<(gN/3);gV+=1){gL.push(gw);gw+=g2[gV].length+2}gY.supportTopology=(gw>65536)?new Int32Array(gw):new Int16Array(gw);var gR=0;for(gV=0;gV<(gN/3);gV+=1){gY.supportTopology[gR]=(gV*3);gR+=1;var gG=g2[gV];gY.supportTopology[gR]=gG.length;gR+=1;for(gX=0;gX<gG.length;gX+=1){gY.supportTopology[gR]=gL[gG[gX]];gR+=1}}}ei(gD,"CONVEX_HULL");return gD};gq.version=1;return gq})();bg.prototype.type="CONVEX_HULL";var eN=(function(){function gq(gt,gu){this._public=gu;this.id=gq.uniqueId;
gq.uniqueId+=1;this.world=null;this.shape=gt.shape._private;this.friction=(gt.friction!==undefined)?gt.friction:0.5;this.restitution=(gt.restitution!==undefined)?gt.restitution:0;var gr=gt.transform;this.transform=(gr?f2.m43Copy(gr):f2.m43BuildIdentity());this.arbiters=[];this.constraints=[];this.velocity=new Float32Array(12);var gs=gt.linearVelocity;if(gs){this.velocity[0]=gs[0];this.velocity[1]=gs[1];this.velocity[2]=gs[2]}gs=gt.angularVelocity;if(gs){this.velocity[3]=gs[0];this.velocity[4]=gs[1];this.velocity[5]=gs[2]}this.linearDamping=(gt.linearDamping!==undefined)?gt.linearDamping:0;this.angularDamping=(gt.angularDamping!==undefined)?gt.angularDamping:0;this.extents=new Float32Array(6);this.startTransform=f2.m43BuildIdentity();this.endTransform=f2.m43BuildIdentity();this.prevTransform=f2.m43Copy(this.transform);this.newTransform=f2.m43BuildIdentity();this.island=null;this.islandRoot=this;this.islandRank=0;this.delaySleep=true;this.group=0;this.mask=0;this.kinematic=false;this.fixedRotation=false;
this.mass=0;this.inverseMass=0;this.inverseInertiaLocal=null;this.inverseInertia=null;this.collisionObject=false;this.permitSleep=false;this.sweepFrozen=false;this.active=false;this.contactCallbacks=null}gq.prototype.computeDeltaVelocity=function(gz,gG,gx,gs){var gB=gs||this.velocity;var gy=false;gB[0]=(gx[9]-gG[9]);gB[1]=(gx[10]-gG[10]);gB[2]=(gx[11]-gG[11]);if(gB[0]!==0||gB[1]!==0||gB[2]!==0){gy=true}gB[0]/=gz;gB[1]/=gz;gB[2]/=gz;var gw=(gG[0]*gx[0])+(gG[3]*gx[3])+(gG[6]*gx[6]);var gv=(gG[0]*gx[1])+(gG[3]*gx[4])+(gG[6]*gx[7]);var gt=(gG[0]*gx[2])+(gG[3]*gx[5])+(gG[6]*gx[8]);var gr=(gG[1]*gx[0])+(gG[4]*gx[3])+(gG[7]*gx[6]);var gO=(gG[1]*gx[1])+(gG[4]*gx[4])+(gG[7]*gx[7]);var gN=(gG[1]*gx[2])+(gG[4]*gx[5])+(gG[7]*gx[8]);var gL=(gG[2]*gx[0])+(gG[5]*gx[3])+(gG[8]*gx[6]);var gK=(gG[2]*gx[1])+(gG[5]*gx[4])+(gG[8]*gx[7]);var gJ=(gG[2]*gx[2])+(gG[5]*gx[5])+(gG[8]*gx[8]);var gD,gC,gA,gE,gF;var gH=gw+gO+gJ+1;if(gH>f2.precision){gE=Math.sqrt(gH)/2;gD=(gN-gK)/(4*gE);gC=(gL-gt)/(4*gE);gA=(gv-gr)/(4*gE)
}else{if((gw>gO)&&(gw>gJ)){gF=Math.sqrt(1+gw-gO-gJ)*2;gE=(gN-gK)/gF;gD=0.25*gF;gC=(gr+gv)/gF;gA=(gL+gt)/gF}else{if(gO>gJ){gF=Math.sqrt(1+gO-gw-gJ)*2;gE=(gL-gt)/gF;gD=(gr+gv)/gF;gC=0.25*gF;gA=(gK+gN)/gF}else{gF=Math.sqrt(1+gJ-gw-gO)*2;gE=(gv-gr)/gF;gD=(gL+gt)/gF;gC=(gK+gN)/gF;gA=0.25*gF}}}var gI=Math.acos(gE)*2;var gu=1-(gE*gE);if(gu<f2.precision||gI===0){gB[3]=gB[4]=gB[5]=0}else{var gM=gI/(gz*Math.sqrt(gu));gB[3]=gD*gM;gB[4]=gC*gM;gB[5]=gA*gM;gy=true}return gy};gq.prototype.calculateSweptExtents=function(gB){var gy=this.shape;var gx=gy.radius;var gv=this.startTransform;var gt=gv[9];var gs=gv[10];var gr=gv[11];var gu=this.transform;var gC=gu[9];var gA=gu[10];var gz=gu[11];var gw;if(gt>gC){gw=gt;gt=gC;gC=gw}if(gs>gA){gw=gs;gs=gA;gA=gw}if(gr>gz){gw=gr;gr=gz;gz=gw}gB[0]=gt-gx;gB[1]=gs-gx;gB[2]=gr-gx;gB[3]=gC+gx;gB[4]=gA+gx;gB[5]=gz+gx};gq.prototype.calculateExtents=function(gG){var gv=this.shape;var gJ=gv.center;var gH=gv.halfExtents;var gB=gH[0];var gA=gH[1];var gz=gH[2];var gC=this.transform;
var gu=gC[0];var gt=gC[1];var gs=gC[2];var gr=gC[3];var gQ=gC[4];var gO=gC[5];var gM=gC[6];var gK=gC[7];var gI=gC[8];var gy=gC[9];var gx=gC[10];var gw=gC[11];if(gJ){var gF=gJ[0];var gE=gJ[1];var gD=gJ[2];if(gF!==0||gE!==0||gD!==0){gy+=(gu*gF+gr*gE+gM*gD);gx+=(gt*gF+gQ*gE+gK*gD);gw+=(gs*gF+gO*gE+gI*gD)}}var gP=((gu<0?-gu*gB:gu>0?gu*gB:0)+(gr<0?-gr*gA:gr>0?gr*gA:0)+(gM<0?-gM*gz:gM>0?gM*gz:0));var gN=((gt<0?-gt*gB:gt>0?gt*gB:0)+(gQ<0?-gQ*gA:gQ>0?gQ*gA:0)+(gK<0?-gK*gz:gK>0?gK*gz:0));var gL=((gs<0?-gs*gB:gs>0?gs*gB:0)+(gO<0?-gO*gA:gO>0?gO*gA:0)+(gI<0?-gI*gz:gI>0?gI*gz:0));gG[0]=(gy-gP);gG[1]=(gx-gN);gG[2]=(gw-gL);gG[3]=(gy+gP);gG[4]=(gx+gN);gG[5]=(gw+gL)};gq.prototype.rayTest=function(gs){var gt=this.transform;var gu={origin:br.prototype.m43InverseOrthonormalTransformPoint(gt,gs.origin),direction:br.prototype.m43InverseOrthonormalTransformVector(gt,gs.direction),maxFactor:gs.maxFactor};var gr=this.shape.rayTest(gu);if(gr!==null){gr.hitPoint=f2.m43TransformPoint(gt,gr.hitPoint,gr.hitPoint);gr.hitNormal=f2.m43TransformVector(gt,gr.hitNormal,gr.hitNormal)
}return gr};gq.prototype.integratePositionWithVelocities=function(gM,gK,gB,gx){var gF=this.velocity;var gQ=Math.sqrt;gK[9]=gM[9]+(gB*gF[gx]);gK[10]=gM[10]+(gB*gF[gx+1]);gK[11]=gM[11]+(gB*gF[gx+2]);var gL=gF[gx+3]*gB;var gJ=gF[gx+4]*gB;var gI=gF[gx+5]*gB;var gv=gM[0];var gu=gM[1];var gt=gM[2];var gs=gM[3];var gr=gM[4];var gS=gM[5];var gR=gM[6];var gO=gM[7];var gN=gM[8];var gH=gv-(gI*gu)+(gJ*gt);var gG=gu+(gI*gv)-(gL*gt);var gE=gt-(gJ*gv)+(gL*gu);var gD=gs-(gI*gr)+(gJ*gS);var gC=gr+(gI*gs)-(gL*gS);var gA=gS-(gJ*gs)+(gL*gr);var gz=gR-(gI*gO)+(gJ*gN);var gy=gO+(gI*gR)-(gL*gN);var gw=gN-(gJ*gR)+(gL*gO);var gP=1/gQ((gH*gH)+(gG*gG)+(gE*gE));gH*=gP;gG*=gP;gE*=gP;gP=-((gH*gD)+(gG*gC)+(gE*gA));gD+=gH*gP;gC+=gG*gP;gA+=gE*gP;gP=1/gQ((gD*gD)+(gC*gC)+(gA*gA));gD*=gP;gC*=gP;gA*=gP;gP=-((gH*gz)+(gG*gy)+(gE*gw));gz+=gH*gP;gy+=gG*gP;gw+=gE*gP;gP=-((gD*gz)+(gC*gy)+(gA*gw));gz+=gD*gP;gy+=gC*gP;gw+=gA*gP;gP=1/gQ((gz*gz)+(gy*gy)+(gw*gw));gz*=gP;gy*=gP;gw*=gP;gK[0]=gH;gK[1]=gG;gK[2]=gE;gK[3]=gD;gK[4]=gC;gK[5]=gA;
gK[6]=gz;gK[7]=gy;gK[8]=gw};gq.prototype.applyBiasVelocities=function(gs){var gr=this.velocity;this.integratePositionWithVelocities(this.transform,this.startTransform,gs,6);gr[6]=gr[7]=gr[8]=0;gr[9]=gr[10]=gr[11]=0};gq.prototype.integratePosition=function(gr){this.integratePositionWithVelocities(this.startTransform,this.transform,gr,0)};gq.prototype.refreshInertiaTensor=function(){var gv=this.transform;var gC=this.inverseInertiaLocal;var gB=gC[0];var gA=gC[1];var gy=gC[2];var gz=gv[0];var gx=gv[1];var gw=gv[2];var gu=gv[3];var gt=gv[4];var gs=gv[5];var gr=gv[6];var gF=gv[7];var gE=gv[8];var gD=this.inverseInertia;gD[0]=(gz*gz*gB)+(gu*gu*gA)+(gr*gr*gy);gD[1]=(gz*gx*gB)+(gu*gt*gA)+(gr*gF*gy);gD[2]=(gz*gw*gB)+(gu*gs*gA)+(gr*gE*gy);gD[3]=(gx*gz*gB)+(gt*gu*gA)+(gF*gr*gy);gD[4]=(gx*gx*gB)+(gt*gt*gA)+(gF*gF*gy);gD[5]=(gx*gw*gB)+(gt*gs*gA)+(gF*gE*gy);gD[6]=(gw*gz*gB)+(gs*gu*gA)+(gE*gr*gy);gD[7]=(gw*gx*gB)+(gs*gt*gA)+(gE*gF*gy);gD[8]=(gw*gw*gB)+(gs*gs*gA)+(gE*gE*gy)};gq.prototype.integrateVelocity=function(gC,gw){var gu=this.velocity;
var gA=Math.pow;var gr=gA(1-this.linearDamping,gw);gu[0]=(gu[0]+(gw*gC[0]))*gr;gu[1]=(gu[1]+(gw*gC[1]))*gr;gu[2]=(gu[2]+(gw*gC[2]))*gr;var gs=gA(1-this.angularDamping,gw);var gz=gu[3]*gs;var gx=gu[4]*gs;var gv=gu[5]*gs;var gB=bp.MAX_ANGULAR/gw;var gy=((gz*gz)+(gx*gx)+(gv*gv));if(gy>(gB*gB)){var gt=gB/Math.sqrt(gy);gz*=gt;gx*=gt;gv*=gt}gu[3]=gz;gu[4]=gx;gu[5]=gv};gq.prototype.isActiveVelocity=function(gs,gt){var gw=this.shape.radius;var gv=this.velocity;var gr=gv[0];var gy=gv[1];var gx=gv[2];var gu=((gr*gr)+(gy*gy)+(gx*gx));if(gu>(gs*gw*gw)){return true}gr=gv[3];gy=gv[4];gx=gv[5];if(((gr*gr)+(gy*gy)+(gx*gx))>gt){return true}return false};gq.prototype.isActive=function(){if(!this.permitSleep){return true}if(this.isActiveVelocity(bp.SLEEP_LINEAR_SQ,bp.SLEEP_ANGULAR_SQ)){this.wakeTimeStamp=this.world.timeStamp;return true}return((this.wakeTimeStamp+bp.SLEEP_DELAY)>this.world.timeStamp)};gq.version=1;gq.uniqueId=0;return gq})();var et=(function(){function gq(){}gq.prototype.calculateExtents=function(gr){this._private.calculateExtents(gr)
};gq.prototype.calculateTransform=function(gs,gr){var gt=this._private.transform;if(gr){f2.m43NegOffset(gt,gr,gs)}else{gs[0]=gt[0];gs[1]=gt[1];gs[2]=gt[2];gs[3]=gt[3];gs[4]=gt[4];gs[5]=gt[5];gs[6]=gt[6];gs[7]=gt[7];gs[8]=gt[8];gs[9]=gt[9];gs[10]=gt[10];gs[11]=gt[11]}};gq.prototype.clone=function(){return gq.create(this)};gq.create=function(gu){var gw=new gq();var gy=new eN(gu,gw);gw._private=gy;gw.userData=("userData" in gu)?gu.userData:null;Object.defineProperty(gw,"shape",{value:gu.shape,enumerable:true});var gv=(gu.kinematic!==undefined)?gu.kinematic:false;Object.defineProperty(gw,"transform",{get:function gt(){return f2.m43Copy(this._private.transform)},set:function gz(gB){var gC=this._private;if(gC.kinematic||!gC.world){f2.m43Copy(gB,gC.transform);if(gC.world){gC.world.wakeBody(gC)}}},enumerable:true});var gx=(gu.group!==undefined)?gu.group:dq.prototype.FILTER_STATIC;Object.defineProperty(gw,"group",{value:gx,enumerable:true});var gA=(gu.mask!==undefined)?gu.mask:(dq.prototype.FILTER_ALL^dq.prototype.FILTER_STATIC);
Object.defineProperty(gw,"mask",{value:gA,enumerable:true});Object.defineProperty(gw,"friction",{get:function gs(){return this._private.friction},set:function gr(gE){var gF=this._private;gF.friction=gE;var gD=gF.arbiters;var gC;var gB=gD.length;for(gC=0;gC<gB;gC+=1){gD[gC].invalidateParameters()}},enumerable:true});Object.defineProperty(gw,"restitution",{get:function gs(){return this._private.restitution},set:function gr(gE){var gF=this._private;gF.restitution=gE;var gD=gF.arbiters;var gC;var gB=gD.length;for(gC=0;gC<gB;gC+=1){gD[gC].invalidateParameters()}},enumerable:true});Object.defineProperty(gw,"kinematic",{value:gv,enumerable:true});gy.group=gx;gy.mask=gA;gy.kinematic=gv;gy.fixedRotation=!gv;gy.mass=0;gy.inverseMass=0;gy.inverseInertiaLocal=gq.sharedInverseInertiaLocal;gy.inverseInertia=gq.sharedInverseInertia;gy.collisionObject=true;gy.permitSleep=false;gy.sweepFrozen=true;gy.active=gv;if(gu.onPreSolveContact||gu.onAddedContacts||gu.onProcessedContacts||gu.onRemovedContacts){gy.contactCallbacks=new bN(gu,gA)
}else{gy.contactCallbacks=null}return gw};gq.version=1;gq.sharedInverseInertiaLocal=f2.v3BuildZero();gq.sharedInverseInertia=new Float32Array([0,0,0,0,0,0,0,0,0]);return gq})();var bN=(function(){function gq(gs,gr){this.mask=(gs.contactCallbacksMask!==undefined?gs.contactCallbacksMask:gr);this.added=false;this.deferred=(gs.onAddedContacts||gs.onProcessedContacts||gs.onRemovedContacts);this.onPreSolveContact=gs.onPreSolveContact||null;this.onAddedContacts=gs.onAddedContacts||null;this.onProcessedContacts=gs.onProcessedContacts||null;this.onRemovedContacts=gs.onRemovedContacts||null;this.trigger=gs.trigger||false;return this}return gq})();var a1=(function(){function gq(){this.calculateExtents=et.prototype.calculateExtents;this.calculateTransform=et.prototype.calculateTransform}gq.prototype.clone=function(){return gq.create(this)};gq.create=function(gH){var gI=new gq();var gA=new eN(gH,gI);gI._private=gA;gI.userData=("userData" in gH)?gH.userData:null;Object.defineProperty(gI,"shape",{value:gH.shape,enumerable:true});
Object.defineProperty(gI,"linearVelocity",{get:function gD(){var gM=this._private.velocity;return f2.v3Build(gM[0],gM[1],gM[2])},set:function gL(gM){var gN=this._private.velocity;gN[0]=gM[0];gN[1]=gM[1];gN[2]=gM[2]},enumerable:true});Object.defineProperty(gI,"angularVelocity",{get:function gD(){var gM=this._private.velocity;return f2.v3Build(gM[3],gM[4],gM[5])},set:function gL(gN){var gM=this._private.velocity;gM[3]=gN[0];gM[4]=gN[1];gM[5]=gN[2]},enumerable:true});Object.defineProperty(gI,"transform",{get:function gv(){return f2.m43Copy(this._private.transform)},set:function gF(gN){var gQ=this._private;f2.m43Copy(gN,gQ.transform);var gP=gQ.arbiters;var gO;var gM=gP.length;for(gO=0;gO<gM;gO+=1){gP[gO].skipDiscreteCollisions=false}},enumerable:true});Object.defineProperty(gI,"active",{get:function gK(){return this._private.active},set:function gC(gR){var gT=this._private;if(gR===gT.active){if(gT.world&&gR){gT.wakeTimeStamp=gT.world.timeStamp}}else{if(gT.world){if(gR){gT.world.wakeBody(gT)
}else{var gQ=gT.world.activeBodies;gQ[gQ.indexOf(gT)]=gQ[gQ.length-1];gQ.pop();gT.active=false;var gN=gT.arbiters;var gS;var gP=gN.length;for(gS=0;gS<gP;gS+=1){var gO=gN[gS];if(!gO.active){continue}gO.active=false;var gM=gT.world.activeArbiters;gM[gM.indexOf(gO)]=gM[gM.length-1];gM.pop()}gT.world.syncBody(gT)}}else{gT.active=gR}}},enumerable:true});var gy=(gH.group!==undefined)?gH.group:dq.prototype.FILTER_DYNAMIC;Object.defineProperty(gI,"group",{value:gy,enumerable:true});var gE=(gH.mask!==undefined)?gH.mask:dq.prototype.FILTER_ALL;Object.defineProperty(gI,"mask",{value:gE,enumerable:true});Object.defineProperty(gI,"friction",{get:function gu(){return this._private.friction},set:function gz(gP){var gQ=this._private;gQ.friction=gP;var gO=gQ.arbiters;var gN;var gM=gO.length;for(gN=0;gN<gM;gN+=1){gO[gN].invalidateParameters()}},enumerable:true});Object.defineProperty(gI,"restitution",{get:function gw(){return this._private.restitution},set:function gG(gP){var gQ=this._private;gQ.restitution=gP;
var gO=gQ.arbiters;var gN;var gM=gO.length;for(gN=0;gN<gM;gN+=1){gO[gN].invalidateParameters()}},enumerable:true});Object.defineProperty(gI,"linearDamping",{get:function gJ(){return this._private.linearDamping},set:function gt(gM){this._private.linearDamping=gM},enumerable:true});Object.defineProperty(gI,"angularDamping",{get:function gJ(){return this._private.angularDamping},set:function gt(gM){this._private.angularDamping=gM},enumerable:true});var gs=(gH.kinematic!==undefined)?gH.kinematic:false;Object.defineProperty(gI,"kinematic",{value:gs,enumerable:true});var gB=(gH.mass!==undefined)?gH.mass:1;Object.defineProperty(gI,"mass",{value:gB,enumerable:true});var gx=(gH.inertia?f2.v3Copy(gH.inertia):f2.v3ScalarMul(gH.shape.inertia,gB));Object.defineProperty(gI,"inertia",{get:function gr(){return f2.v3Copy(gx)},enumerable:true});gA.group=gy;gA.mask=gE;gA.active=(gH.active!==undefined)?gH.active:(gH.frozen!==undefined)?(!gH.frozen):true;gA.kinematic=gs;gA.fixedRotation=gs||((gH.fixedRotation!==undefined)?gH.fixedRotation:false);
gA.inverseInertiaLocal=(gA.fixedRotation?f2.v3BuildZero():f2.v3Build(1/gx[0],1/gx[1],1/gx[2]));gA.inverseInertia=f2.m33BuildIdentity();gA.mass=gB;gA.inverseMass=(gs?0:(1/gA.mass));gA.collisionObject=false;gA.permitSleep=(gH.permitSleep!==undefined)?gH.permitSleep:(!gs);gA.sweepFrozen=gs;if(gH.onPreSolveContact||gH.onAddedContacts||gH.onProcessedContacts||gH.onRemovedContacts){gA.contactCallbacks=new bN(gH,gE)}else{gA.contactCallbacks=null}return gI};gq.version=1;return gq})();var dW=(function(){function gq(){}gq.prototype.preStep=function(gr,gs){};gq.prototype.applyCachedImpulses=function(){};gq.prototype.computeAndApplyImpulses=function(){};gq.create=function(gs,gt){var gr=new gq();gr.world=null;gr.userData=null;f4(gr,gt);gr.type=gs;return gr};gq.version=1;return gq})();var a0=function W(gu,gt){gu.userData=gt.userData;var gr=gu._private;gr.world=null;gr.bodyA=gt.bodyA._private;Object.defineProperty(gu,"bodyA",{value:gt.bodyA,enumerable:true});gr.bodyB=gt.bodyB?gt.bodyB._private:null;Object.defineProperty(gu,"bodyB",{value:gt.bodyB,enumerable:true});
gr.active=(gt.active!==undefined)?gt.active:true;Object.defineProperty(gu,"active",{get:function gq(){return this._private.active},set:function gs(gx){var gv=this._private;if(gx===gv.active){if(gv.world&&gx){gv.wakeTimeStamp=gv.world.timeStamp}}else{if(gv.world){if(gx){gv.world.wakeConstraint(gv)}else{var gw=gv.world.activeConstraints;gw[gw.indexOf(gv)]=gw[gw.length-1];gw.pop();gv.active=false}}else{gv.active=gx}}},enumerable:true})};var Q=(function(){function gq(){}gq.create=function(gr){var gA=new gq();var gB=new K();gA._private=gB;a0(gA,gr);var gv=gB.data;gv[0]=gr.pivotA[0];gv[1]=gr.pivotA[1];gv[2]=gr.pivotA[2];Object.defineProperty(gA,"pivotA",{get:function gu(){var gC=this._private.data;return f2.v3Build(gC[0],gC[1],gC[2])},set:function gz(gD){var gC=this._private.data;gC[0]=gD[0];gC[1]=gD[1];gC[2]=gD[2]},enumerable:true});if(gr.pivotB){gv[3]=gr.pivotB[0];gv[4]=gr.pivotB[1];gv[5]=gr.pivotB[2]}else{var gs=f2.m43TransformPoint(gB.bodyA.transform,gr.pivotA);gv[3]=gs[0];gv[4]=gs[1];gv[5]=gs[2]
}Object.defineProperty(gA,"pivotB",{get:function gt(){var gC=this._private.data;return f2.v3Build(gC[3],gC[4],gC[5])},set:function gy(gD){var gC=this._private.data;gC[3]=gD[0];gC[4]=gD[1];gC[5]=gD[2]},enumerable:true});gv[30]=(gr.force!==undefined)?gr.force:0.3;Object.defineProperty(gA,"force",{get:function gx(){return this._private.data[30]},set:function gw(gC){this._private.data[30]=gC},enumerable:true});gv[31]=(gr.damping!==undefined)?gr.damping:1;Object.defineProperty(gA,"damping",{get:function gx(){return this._private.data[31]},set:function gw(gC){this._private.data[31]=gC},enumerable:true});gv[32]=(gr.impulseClamp!==undefined)?gr.impulseClamp:0;Object.defineProperty(gA,"impulseClamp",{get:function gx(){return this._private.data[32]},set:function gw(gC){this._private.data[32]=gC},enumerable:true});return gA};gq.version=1;return gq})();Q.prototype.type="POINT2POINT";var K=(function(){function gq(){this.bodyA=null;this.bodyB=null;this.data=new Float32Array(46);return this}gq.prototype.preStep=function(gH,gI){var g3=this.bodyA;
var g1=this.bodyB;var gX=this.data;var gW=gX[0];var gV=gX[1];var gU=gX[2];var gL=gX[3];var gK=gX[4];var gJ=gX[5];var gE=g3.transform;var gS=gX[6]=(gE[0]*gW)+(gE[3]*gV)+(gE[6]*gU);var gR=gX[7]=(gE[1]*gW)+(gE[4]*gV)+(gE[7]*gU);var gO=gX[8]=(gE[2]*gW)+(gE[5]*gV)+(gE[8]*gU);var gF,gD,gB,gC;if(g1){gC=g1.transform;gF=gX[9]=(gC[0]*gL)+(gC[3]*gK)+(gC[6]*gJ);gD=gX[10]=(gC[1]*gL)+(gC[4]*gK)+(gC[7]*gJ);gB=gX[11]=(gC[2]*gL)+(gC[5]*gK)+(gC[8]*gJ)}var gz=g3.inverseInertia;gX[12]=(-gO*gz[3])+(gR*gz[6]);gX[13]=(-gO*gz[4])+(gR*gz[7]);gX[14]=(-gO*gz[5])+(gR*gz[8]);gX[15]=(gO*gz[0])+(-gS*gz[6]);gX[16]=(gO*gz[1])+(-gS*gz[7]);gX[17]=(gO*gz[2])+(-gS*gz[8]);gX[18]=(-gR*gz[0])+(gS*gz[3]);gX[19]=(-gR*gz[1])+(gS*gz[4]);gX[20]=(-gR*gz[2])+(gS*gz[5]);var gs=g3.inverseMass+(g1?g1.inverseMass:0);var gt=gs+(gX[13]*-gO)+(gX[14]*gR);var g0=gs+(gX[15]*gO)+(gX[17]*-gS);var gY=gs+(gX[18]*-gR)+(gX[19]*gS);var gr=(gX[12]*gO)+(gX[14]*-gS);var g2=(gX[12]*-gR)+(gX[13]*gS);var gZ=(gX[15]*-gR)+(gX[16]*gS);if(g1){gz=g1.inverseInertia;
gX[21]=(-gB*gz[3])+(gD*gz[6]);gX[22]=(-gB*gz[4])+(gD*gz[7]);gX[23]=(-gB*gz[5])+(gD*gz[8]);gX[24]=(gB*gz[0])+(-gF*gz[6]);gX[25]=(gB*gz[1])+(-gF*gz[7]);gX[26]=(gB*gz[2])+(-gF*gz[8]);gX[27]=(-gD*gz[0])+(gF*gz[3]);gX[28]=(-gD*gz[1])+(gF*gz[4]);gX[29]=(-gD*gz[2])+(gF*gz[5]);gt+=(gX[22]*-gB)+(gX[23]*gD);g0+=(gX[24]*gB)+(gX[26]*-gF);gY+=(gX[27]*-gD)+(gX[28]*gF);gr+=(gX[21]*gB)+(gX[23]*-gF);g2+=(gX[21]*-gD)+(gX[22]*gF);gZ+=(gX[24]*-gD)+(gX[25]*gF)}var gv=gX[30];var gu=(2/gI*gv*gX[31])/(1-gv);var gA=gv/(gu*gu);var gT=1/(1+gA);gX[33]=1-(gA*gT);var gy=((g0*gY)-(gZ*gZ));var gx=((g2*gZ)-(gr*gY));var gw=((gr*gZ)-(g2*g0));var gG=gT/((gt*gy)+(gr*gx)+(g2*gw));gX[34]=(gG*gy);gX[35]=(gG*gx);gX[36]=(gG*gw);gX[37]=(gG*((gt*gY)-(g2*g2)));gX[38]=(gG*((gr*g2)-(gt*gZ)));gX[39]=(gG*((gt*g0)-(gr*gr)));var gQ=gS+gE[9];var gN=gR+gE[10];var gM=gO+gE[11];if(g1){gQ-=gF+gC[9];gN-=gD+gC[10];gM-=gB+gC[11]}else{gQ-=gL;gN-=gK;gM-=gJ}var gP=-gv/gI;gX[43]=(gQ*gP);gX[44]=(gN*gP);gX[45]=(gM*gP);gX[40]*=gH;gX[41]*=gH;gX[42]*=gH
};gq.prototype.applyCachedImpulses=function(){var gu=this.data;var gy=gu[40];var gw=gu[41];var gt=gu[42];var gx=this.bodyA;var gr=gx.velocity;var gs=gx.inverseMass;gr[0]+=(gy*gs);gr[1]+=(gw*gs);gr[2]+=(gt*gs);gr[3]-=((gu[12]*gy)+(gu[15]*gw)+(gu[18]*gt));gr[4]-=((gu[13]*gy)+(gu[16]*gw)+(gu[19]*gt));gr[5]-=((gu[14]*gy)+(gu[17]*gw)+(gu[20]*gt));var gv=this.bodyB;if(gv){gr=gv.velocity;gs=gv.inverseMass;gr[0]-=(gy*gs);gr[1]-=(gw*gs);gr[2]-=(gt*gs);gr[3]+=((gu[21]*gy)+(gu[24]*gw)+(gu[27]*gt));gr[4]+=((gu[22]*gy)+(gu[25]*gw)+(gu[28]*gt));gr[5]+=((gu[23]*gy)+(gu[26]*gw)+(gu[29]*gt))}};gq.prototype.computeAndApplyImpulses=function(){var gv=this.bodyA;var gu=this.bodyB;var gI=this.data;var gD=gI[40];var gC=gI[41];var gB=gI[42];var gx=gv.velocity;var gH=gI[43]-(gx[0]+(gx[4]*gI[8])-(gx[5]*gI[7]));var gG=gI[44]-(gx[1]+(gx[5]*gI[6])-(gx[3]*gI[8]));var gF=gI[45]-(gx[2]+(gx[3]*gI[7])-(gx[4]*gI[6]));var gw;if(gu){gw=gu.velocity;gH+=(gw[0]+(gw[4]*gI[11])-(gw[5]*gI[10]));gG+=(gw[1]+(gw[5]*gI[9])-(gw[3]*gI[11]));
gF+=(gw[2]+(gw[3]*gI[10])-(gw[4]*gI[9]))}var gz=gI[33];gD=(gD*gz)+(gI[34]*gH)+(gI[35]*gG)+(gI[36]*gF);gC=(gC*gz)+(gI[35]*gH)+(gI[37]*gG)+(gI[38]*gF);gB=(gB*gz)+(gI[36]*gH)+(gI[38]*gG)+(gI[39]*gF);var gE=gI[32];if(gE!==0){var gy=(gD*gD)+(gC*gC)+(gB*gB);if(gy>gE*gE){gy=gE/Math.sqrt(gy);gD*=gy;gC*=gy;gB*=gy}}var gt=gD-gI[40];var gs=gC-gI[41];var gr=gB-gI[42];gI[40]=gD;gI[41]=gC;gI[42]=gB;var gA=gv.inverseMass;gx[0]+=(gt*gA);gx[1]+=(gs*gA);gx[2]+=(gr*gA);gx[3]-=((gI[12]*gt)+(gI[15]*gs)+(gI[18]*gr));gx[4]-=((gI[13]*gt)+(gI[16]*gs)+(gI[19]*gr));gx[5]-=((gI[14]*gt)+(gI[17]*gs)+(gI[20]*gr));if(gu){gA=gu.inverseMass;gw[0]-=(gt*gA);gw[1]-=(gs*gA);gw[2]-=(gr*gA);gw[3]+=((gI[21]*gt)+(gI[24]*gs)+(gI[27]*gr));gw[4]+=((gI[22]*gt)+(gI[25]*gs)+(gI[28]*gr));gw[5]+=((gI[23]*gt)+(gI[26]*gs)+(gI[29]*gr))}};return gq})();var dP=(function(){function gq(){}gq.prototype.jump=function(){var gr=this._private;var gt=gr.rigidBody._private;var gs=gt.world;if(gs){gt.velocity[1]=Math.sqrt(-2*(this.maxJumpHeight-this.stepHeight)*gs.gravity[1]);
gt.transform[10]+=this.stepHeight;gs.wakeBody(gt)}};gq.prototype.calculateExtents=function(gr){this._private.rigidBody.calculateExtents(gr)};gq.prototype.calculateTransform=function(gs,gr){this._private.rigidBody.calculateTransform(gs,gr)};gq.create=function(gs){var gu=new gq();var gy=new d3();gu._private=gy;gu.userData=(gs.userData!==undefined)?gs.userData:null;Object.defineProperty(gu,"crouch",{get:function gF(){return this._private.crouch},set:function gD(gH){var gI=this._private;if(!gI.dead&&gH!==gI.crouch){var gK=gI.rigidBody._private;var gJ=gK.shape;gI.crouch=gH;if(gH){gJ.halfHeight=((this.crouchHeight*0.5)-this.radius);gK.transform[10]-=((this.height-this.crouchHeight)*0.5)}else{gJ.halfHeight=((this.height*0.5)-this.radius);gK.transform[10]+=((this.height-this.crouchHeight)*0.5)}if(gK.world){gK.world.wakeBody(gK)}}},enumerable:true});Object.defineProperty(gu,"dead",{get:function gt(){return this._private.dead},set:function gG(gJ){var gH=this._private;if(gH.dead!==gJ){var gK=gH.rigidBody._private;
var gI=gK.shape;gH.dead=gJ;if(gJ){gI.halfHeight=0;gK.transform[10]-=((this.height-this.radius)*0.5)}else{gI.halfHeight=((this.height*0.5)-this.radius);gK.transform[10]+=((this.height-this.radius)*0.5)}if(gK.world){gK.world.wakeBody(gK)}}},enumerable:true});Object.defineProperty(gu,"height",{value:gs.height,enumerable:true});Object.defineProperty(gu,"radius",{value:gs.radius,enumerable:true});Object.defineProperty(gu,"stepHeight",{value:(gs.stepHeight!==undefined)?gs.stepHeight:0.35,enumerable:true});gu.maxJumpHeight=(gs.maxJumpHeight!==undefined)?gs.maxJumpHeight:1;Object.defineProperty(gu,"crouchHeight",{value:(gs.crouchHeight!==undefined)?gs.crouchHeight:(0.5*gs.height),enumerable:true});Object.defineProperty(gu,"onGround",{get:function gv(){var gJ=this._private;var gK=gJ.rigidBody._private;if(gK.world){var gM=gK.transform;var gL=gJ.start;var gI=gJ.end;gL[9]=gM[9];gL[10]=gM[10];gL[11]=gM[11];gI[9]=gM[9];gI[10]=(gM[10]-(this.stepHeight*0.5));gI[11]=gM[11];var gH=gK.world.convexSweepTest({shape:gK.shape._public,from:gL,to:gI,group:dq.prototype.FILTER_CHARACTER},this.onGroundConvexCallback);
return(gH!==null)}else{return false}},enumerable:true});Object.defineProperty(gu,"position",{get:function gx(){var gH=this._private.rigidBody;return f2.m43Pos(gH._private.transform)},set:function gC(gH){var gJ=this._private.rigidBody;var gI=gJ._private.transform;gI[9]=gH[0];gI[10]=gH[1];gI[11]=gH[2];gJ.transform=gJ._private.transform;gJ.active=true},enumerable:true});Object.defineProperty(gu,"velocity",{get:function gB(){var gH=this._private.rigidBody;return gH.linearVelocity},set:function gw(gH){var gI=this._private.rigidBody;gI.linearVelocity=gH;gI.active=true},enumerable:true});var gA=(gs.group!==undefined)?gs.group:dq.prototype.FILTER_CHARACTER;Object.defineProperty(gu,"group",{value:gA,enumerable:true});var gE=(gs.mask!==undefined)?gs.mask:dq.prototype.FILTER_ALL;Object.defineProperty(gu,"mask",{value:gE,enumerable:true});var gr=aZ.create({radius:gu.radius,height:(2*((gu.height*0.5)-gu.radius)),margin:0});var gz=a1.create({shape:gr,mass:gs.mass,transform:gs.transform,linearVelocity:gs.velocity,group:gA,mask:gE,friction:gs.friction,restitution:gs.restitution,linearDamping:gs.linearDamping,angularDamping:gs.angularDamping,fixedRotation:true});
gy.rigidBody=gz;gz._private._public=gu;return gu};gq.version=1;return gq})();var d3=(function(){function gq(){this.crouch=false;this.dead=false;this.start=f2.m43BuildIdentity();this.end=f2.m43BuildIdentity();this.rigidBody=null;return this}gq.prototype.onGroundConvexCallback=function(gr){return gr.hitNormal[1]>=0.26};gq.version=1;return gq})();var b5=(function(){function gq(){}gq.prototype.removeVertex=function(gt){this.numVertices-=1;var gr=this.simplex;var gu=(gt*9);var gs=(this.numVertices*9);gr[gu]=gr[gs];gr[gu+1]=gr[gs+1];gr[gu+2]=gr[gs+2];gr[gu+3]=gr[gs+3];gr[gu+4]=gr[gs+4];gr[gu+5]=gr[gs+5];gr[gu+6]=gr[gs+6];gr[gu+7]=gr[gs+7];gr[gu+8]=gr[gs+8]};gq.prototype.reduceVertices=function(gt){if(this.numVertices>=4&&gt[3]===0){this.numVertices-=1}var gr=this.simplex;var gs;if(this.numVertices>=3&&gt[2]===0){this.numVertices-=1;gs=(this.numVertices*9);gr[18]=gr[gs];gr[19]=gr[gs+1];gr[20]=gr[gs+2];gr[21]=gr[gs+3];gr[22]=gr[gs+4];gr[23]=gr[gs+5];gr[24]=gr[gs+6];gr[25]=gr[gs+7];gr[26]=gr[gs+8]
}if(this.numVertices>=2&&gt[1]===0){this.numVertices-=1;gs=(this.numVertices*9);gr[9]=gr[gs];gr[10]=gr[gs+1];gr[11]=gr[gs+2];gr[12]=gr[gs+3];gr[13]=gr[gs+4];gr[14]=gr[gs+5];gr[15]=gr[gs+6];gr[16]=gr[gs+7];gr[17]=gr[gs+8]}if(this.numVertices>=1&&gt[0]===0){this.numVertices-=1;gs=(this.numVertices*9);gr[0]=gr[gs];gr[1]=gr[gs+1];gr[2]=gr[gs+2];gr[3]=gr[gs+3];gr[4]=gr[gs+4];gr[5]=gr[gs+5];gr[6]=gr[gs+6];gr[7]=gr[gs+7];gr[8]=gr[gs+8]}};gq.prototype.updateClosestPoints=function(){var gD=this.numVertices;if(gD===0){return false}var gy=this.simplex;var gB=this.closest;var gG;if(gD===1){gB[0]=gy[3];gB[1]=gy[4];gB[2]=gy[5];gB[3]=gy[6];gB[4]=gy[7];gB[5]=gy[8];return true}var gM=gy[0];var gL=gy[1];var gK=gy[2];var gw=gy[9];var gu=gy[10];var gt=gy[11];if(gD===2){var gA=(gM-gw);var gz=(gL-gu);var gx=(gK-gt);var gC=((gM*gA)+(gL*gz)+(gK*gx));if(gC>0){var gr=((gA*gA)+(gz*gz)+(gx*gx));if(gC<gr){gC/=gr;var gE=(1-gC);gB[0]=((gy[3]*gE)+(gy[12]*gC));gB[1]=((gy[4]*gE)+(gy[13]*gC));gB[2]=((gy[5]*gE)+(gy[14]*gC));
gB[3]=((gy[6]*gE)+(gy[15]*gC));gB[4]=((gy[7]*gE)+(gy[16]*gC));gB[5]=((gy[8]*gE)+(gy[17]*gC));return true}else{this.removeVertex(0)}}else{this.removeVertex(1)}for(gG=0;gG<6;gG+=1){gB[gG]=gy[gG+3]}return true}var gF=this.cachedCoords;var gs,gI,gv;if(gD===3){this.closestPointTriangle(0,9,18,gF);this.reduceVertices(gF);gs=gF[0];gI=gF[1];gv=gF[2];gB[0]=((gs*gy[3])+(gI*gy[12])+(gv*gy[21]));gB[1]=((gs*gy[4])+(gI*gy[13])+(gv*gy[22]));gB[2]=((gs*gy[5])+(gI*gy[14])+(gv*gy[23]));gB[3]=((gs*gy[6])+(gI*gy[15])+(gv*gy[24]));gB[4]=((gs*gy[7])+(gI*gy[16])+(gv*gy[25]));gB[5]=((gs*gy[8])+(gI*gy[17])+(gv*gy[26]));return true}if(gD===4){var gH=this.closestPointTetrahedron(gF);if(gH){this.reduceVertices(gF);gs=gF[0];gI=gF[1];gv=gF[2];var gJ=gF[3];gB[0]=((gs*gy[3])+(gI*gy[12])+(gv*gy[21])+(gJ*gy[30]));gB[1]=((gs*gy[4])+(gI*gy[13])+(gv*gy[22])+(gJ*gy[31]));gB[2]=((gs*gy[5])+(gI*gy[14])+(gv*gy[23])+(gJ*gy[32]));gB[3]=((gs*gy[6])+(gI*gy[15])+(gv*gy[24])+(gJ*gy[33]));gB[4]=((gs*gy[7])+(gI*gy[16])+(gv*gy[25])+(gJ*gy[34]));
gB[5]=((gs*gy[8])+(gI*gy[17])+(gv*gy[26])+(gJ*gy[35]));return true}else{return false}}return false};gq.prototype.closestPointTetrahedron=function(gx){var g2=this.simplex;var gW=g2[0];var gU=g2[1];var gS=g2[2];var gI=g2[9];var gG=g2[10];var gE=g2[11];var gw=g2[18];var gv=g2[19];var gu=g2[20];var g1=g2[27];var gZ=g2[28];var gX=g2[29];var gA=(gI-gW);var gz=(gG-gU);var gy=(gE-gS);var g5=(gw-gW);var g4=(gv-gU);var g3=(gu-gS);var gP=(g1-gW);var gO=(gZ-gU);var gN=(gX-gS);var gY=(gw-gI);var gV=(gv-gG);var gT=(gu-gE);var gJ=(g1-gI);var gH=(gZ-gG);var gF=(gX-gE);var gM,gL,gK,gs,gB;gM=((gz*g3)-(gy*g4));gL=((gy*g5)-(gA*g3));gK=((gA*g4)-(gz*g5));gs=((gP*gM)+(gO*gL)+(gN*gK));gB=-((gW*gM)+(gU*gL)+(gS*gK));var gR=((gB*gs)<=0);gM=((g4*gN)-(g3*gO));gL=((g3*gP)-(g5*gN));gK=((g5*gO)-(g4*gP));gs=((gA*gM)+(gz*gL)+(gy*gK));gB=-((gW*gM)+(gU*gL)+(gS*gK));var gD=((gB*gs)<=0);gM=((gO*gy)-(gN*gz));gL=((gN*gA)-(gP*gy));gK=((gP*gz)-(gO*gA));gs=((g5*gM)+(g4*gL)+(g3*gK));gB=-((gW*gM)+(gU*gL)+(gS*gK));var gt=((gB*gs)<=0);
gM=((gH*gT)-(gF*gV));gL=((gF*gY)-(gJ*gT));gK=((gJ*gV)-(gH*gY));gs=((gA*gM)+(gz*gL)+(gy*gK));gB=((gI*gM)+(gG*gL)+(gE*gK));var gr=((gB*gs)<=0);gx[0]=gx[1]=gx[2]=gx[3]=0;if(!gR&&!gD&&!gt&&!gr){return false}var gQ=this.tempCoords;var g0=Number.MAX_VALUE;var gC;if(gR){gC=this.closestPointTriangle(0,9,18,gQ,true);if(gC<g0){g0=gC;gx[0]=gQ[0];gx[1]=gQ[1];gx[2]=gQ[2];gx[3]=0}}if(gD){gC=this.closestPointTriangle(0,18,27,gQ,true);if(gC<g0){g0=gC;gx[0]=gQ[0];gx[1]=0;gx[2]=gQ[1];gx[3]=gQ[2]}}if(gt){gC=this.closestPointTriangle(0,27,9,gQ,true);if(gC<g0){g0=gC;gx[0]=gQ[0];gx[1]=gQ[2];gx[2]=0;gx[3]=gQ[1]}}if(gr){gC=this.closestPointTriangle(9,27,18,gQ,true);if(gC<g0){g0=gC;gx[0]=0;gx[1]=gQ[0];gx[2]=gQ[2];gx[3]=gQ[1]}}return true};gq.prototype.closestPointTriangle=function(gZ,gY,gX,gu,gx){var gW=this.simplex;var gS=gW[gZ];var gQ=gW[gZ+1];var gO=gW[gZ+2];var gH=gW[gY];var gG=gW[gY+1];var gE=gW[gY+2];var gt=gW[gX];var gs=gW[gX+1];var gr=gW[gX+2];var gF=(gS-gH);var gD=(gQ-gG);var gB=(gO-gE);var gy=(gS-gt);
var gw=(gQ-gs);var gv=(gO-gr);var gR=((gS*gF)+(gQ*gD)+(gO*gB));var gP=((gS*gy)+(gQ*gw)+(gO*gv));if(gR<=0&&gP<=0){gu[0]=1;gu[1]=gu[2]=0;if(gx){return((gS*gS)+(gQ*gQ)+(gO*gO))}else{return undefined}}var gN=((gH*gF)+(gG*gD)+(gE*gB));var gM=((gH*gy)+(gG*gw)+(gE*gv));if(gN>=0&&gM<=gN){gu[1]=1;gu[0]=gu[2]=0;if(gx){return((gH*gH)+(gG*gG)+(gE*gE))}else{return undefined}}var gJ;var gV,gU,gT;var gz=((gR*gM)-(gN*gP));if(gz<=0&&gR>=0&&gN<=0){gJ=(gR/(gR-gN));gu[0]=(1-gJ);gu[1]=gJ;gu[2]=0;if(gx){gV=(gS-(gJ*gF));gU=(gQ-(gJ*gD));gT=(gO-(gJ*gB));return((gV*gV)+(gU*gU)+(gT*gT))}else{return undefined}}var gL=((gt*gF)+(gs*gD)+(gr*gB));var gK=((gt*gy)+(gs*gw)+(gr*gv));if(gK>=0&&gL<=gK){gu[0]=gu[1]=0;gu[2]=1;if(gx){return((gt*gt)+(gs*gs)+(gr*gr))}else{return undefined}}var gA=((gL*gP)-(gR*gK));if(gA<=0&&gP>=0&&gK<=0){gJ=(gP/(gP-gK));gu[0]=(1-gJ);gu[1]=0;gu[2]=gJ;if(gx){gV=(gS-(gJ*gy));gU=(gQ-(gJ*gw));gT=(gO-(gJ*gv));return((gV*gV)+(gU*gU)+(gT*gT))}else{return undefined}}var gC=((gN*gK)-(gL*gM));if(gC<=0&&(gM-gN)>=0&&(gL-gK)>=0){gJ=((gM-gN)/((gM-gN)+(gL-gK)));
gu[0]=0;gu[1]=(1-gJ);gu[2]=gJ;if(gx){gV=((gH*(1-gJ))+(gt*gJ));gU=((gG*(1-gJ))+(gs*gJ));gT=((gE*(1-gJ))+(gr*gJ));return((gV*gV)+(gU*gU)+(gT*gT))}else{return undefined}}var g0=(1/(gC+gA+gz));gJ=(gA*g0);var gI=(gz*g0);gu[0]=(1-gJ-gI);gu[1]=gJ;gu[2]=gI;if(gx){gV=(gS-(gF*gJ)-(gy*gI));gU=(gQ-(gD*gJ)-(gw*gI));gT=(gO-(gB*gJ)-(gv*gI));return((gV*gV)+(gU*gU)+(gT*gT))}else{return undefined}};gq.prototype.evaluate=function(gK,gy,gx){var gT=gK.axis;var gw=gK.shapeA;var gu=gK.shapeB;this.numVertices=0;var gt,gs,gr;gt=gs=gr=Number.MAX_VALUE;var g8=0;var hf=100;var gU=false;var gQ=Number.MAX_VALUE;var gP=gy[0];var gN=gy[1];var gL=gy[2];var gJ=gy[3];var gI=gy[4];var gH=gy[5];var gG=gy[6];var gF=gy[7];var gE=gy[8];var gC=gy[9];var hs=gy[10];var hr=gy[11];var hq=gx[0];var hp=gx[1];var ho=gx[2];var hn=gx[3];var hm=gx[4];var hl=gx[5];var hk=gx[6];var hi=gx[7];var hg=gx[8];var he=gx[9];var hd=gx[10];var hb=gx[11];var g0=gT[0];var gY=gT[1];var gW=gT[2];var gS;var gO=gK.closestA;var gM=gK.closestB;var gR=this.closest;
var hh=this.simplex;var g1=0.0001;for(;;){g8+=1;gO[0]=-((gP*g0)+(gN*gY)+(gL*gW));gO[1]=-((gJ*g0)+(gI*gY)+(gH*gW));gO[2]=-((gG*g0)+(gF*gY)+(gE*gW));gM[0]=((hq*g0)+(hp*gY)+(ho*gW));gM[1]=((hn*g0)+(hm*gY)+(hl*gW));gM[2]=((hk*g0)+(hi*gY)+(hg*gW));gw.localSupportWithoutMargin(gO,gO);gu.localSupportWithoutMargin(gM,gM);var hc=gO[0];var ha=gO[1];var g9=gO[2];var gZ=gO[0]=((gP*hc)+(gJ*ha)+(gG*g9)+gC);var gX=gO[1]=((gN*hc)+(gI*ha)+(gF*g9)+hs);var gV=gO[2]=((gL*hc)+(gH*ha)+(gE*g9)+hr);hc=gM[0];ha=gM[1];g9=gM[2];var gD=gM[0]=((hq*hc)+(hn*ha)+(hk*g9)+he);var gB=gM[1]=((hp*hc)+(hm*ha)+(hi*g9)+hd);var gA=gM[2]=((ho*hc)+(hl*ha)+(hg*g9)+hb);var g6=gZ-gD;var g5=gX-gB;var g4=gV-gA;var gz=false;var g2=this.numVertices*9;var hj;for(hj=0;hj<g2;hj+=9){hc=(g6-hh[hj]);ha=(g5-hh[hj+1]);g9=(g4-hh[hj+2]);if(((hc*hc)+(ha*ha)+(g9*g9))<g1){gz=true}}if(!gz){hc=(g6-gt);ha=(g5-gs);g9=(g4-gr);gz=((hc*hc)+(ha*ha)+(g9*g9))<g1}if(gz){gU=true;break}var g7=(g0*g6)+(gY*g5)+(gW*g4);if((gQ-g7)<=(gQ*bp.GJK_FRACTIONAL_THRESHOLD)){gU=true;
break}gt=hh[g2]=g6;gs=hh[g2+1]=g5;gr=hh[g2+2]=g4;hh[g2+3]=gZ;hh[g2+4]=gX;hh[g2+5]=gV;hh[g2+6]=gD;hh[g2+7]=gB;hh[g2+8]=gA;this.numVertices+=1;if(!this.updateClosestPoints()){gU=false;break}hc=(gR[0]-gR[3]);ha=(gR[1]-gR[4]);g9=(gR[2]-gR[5]);gS=((hc*hc)+(ha*ha)+(g9*g9));if(gS<=bp.GJK_EPA_DISTANCE_THRESHOLD){gU=true;break}g0=hc;gY=ha;gW=g9;var gv=gQ;gQ=gS;if((gv-gQ)<=(bp.GJK_FRACTIONAL_THRESHOLD*gv)){gU=true;break}if(g8>=hf){gU=true;break}if(this.numVertices===4){break}}gS=((g0*g0)+(gY*gY)+(gW*gW));if(gS<bp.DONT_NORMALIZE_THRESHOLD){gT[0]=g0;gT[1]=gY;gT[2]=gW;return undefined}var g3=1/Math.sqrt(gS);gT[0]=g0*g3;gT[1]=gY*g3;gT[2]=gW*g3;if(gU){gO[0]=gR[0];gO[1]=gR[1];gO[2]=gR[2];gM[0]=gR[3];gM[1]=gR[4];gM[2]=gR[5];return Math.sqrt(gQ)}else{return undefined}};gq.create=function(){var gr=new gq();gr.simplex=new Float32Array(36);gr.numVertices=0;gr.closest=new Float32Array(6);gr.cachedCoords=new Float32Array(4);gr.tempCoords=new Float32Array(4);return gr};gq.version=1;return gq})();var cb=(function(){function gq(){}gq.prototype.bind=function(gs,gu,gr,gt){gs.edge[gu]=gt;
gs.adjFace[gu]=gr;gr.edge[gt]=gu;gr.adjFace[gt]=gs};gq.prototype.append=function(gs,gr){gr.leaf0=null;gr.leaf1=gs.root;if(gs.root){gs.root.leaf0=gr}gs.root=gr;gs.count+=1};gq.prototype.remove=function(gu,gt){var gs=gt.leaf0;var gr=gt.leaf1;if(gr){gr.leaf0=gs}if(gs){gs.leaf1=gr}if(gt===gu.root){gu.root=gr}gu.count-=1};gq.prototype.findBest=function(){var gr=this.hull.root;var gu=gr.distance*gr.distance;var gt;for(gt=gr.leaf1;gt!==null;gt=gt.leaf1){var gs=gt.distance*gt.distance;if(gs<gu){gr=gt;gu=gs}}return gr};gq.prototype.getEdgeDistance=function(gF,gN,gM){var gx=this.vertex_store;var gQ=gx[gN];var gP=gx[gN+1];var gO=gx[gN+2];var gz=gx[gM];var gy=gx[gM+1];var gw=gx[gM+2];var gv=(gz-gQ);var gu=(gy-gP);var gt=(gw-gO);var gC=gF.normal;var gL=gC[0];var gK=gC[1];var gJ=gC[2];var gH=((gu*gJ)-(gt*gK));var gE=((gt*gL)-(gv*gJ));var gB=((gv*gK)-(gu*gL));var gI=((gQ*gH)+(gP*gE)+(gO*gB));if(gI<=0){var gG=((gv*gv)+(gu*gu)+(gt*gt));var gD=((gQ*gv)+(gP*gu)+(gO*gt));var gA=((gz*gv)+(gy*gt)+(gw*gt));if(gD>=0){return Math.sqrt((gQ*gQ)+(gP*gP)+(gO*gO))
}else{if(gA<=0){return Math.sqrt((gz*gz)+(gy*gy)+(gw*gw))}else{var gr=((gQ*gz)+(gP*gy)+(gO*gw));var gs=(((gQ*gQ)+(gP*gP)+(gO*gO))*((gz*gz)+(gy*gy)+(gw*gw)))-(gr*gr);return gs>=0?Math.sqrt(gs/gG):0}}}else{return undefined}};gq.prototype.buildNewFace=function(gM,gL,gK,gN){var gA=this.stock.root;if(gA===null){return null}gA.pass=0;gA.vertex[0]=gM;gA.vertex[1]=gL;gA.vertex[2]=gK;var gw=this.vertex_store;var gR=gw[gM];var gQ=gw[gM+1];var gO=gw[gM+2];var gy=gw[gL];var gx=gw[gL+1];var gv=gw[gL+2];var gD=gw[gK];var gC=gw[gK+1];var gB=gw[gK+2];var gu=(gy-gR);var gt=(gx-gQ);var gr=(gv-gO);var gG=(gD-gR);var gF=(gC-gQ);var gE=(gB-gO);var gz=gA.normal;var gJ=gz[0]=((gt*gE)-(gr*gF));var gI=gz[1]=((gr*gG)-(gu*gE));var gH=gz[2]=((gu*gF)-(gt*gG));var gs=((gJ*gJ)+(gI*gI)+(gH*gH));if(gs>bp.DONT_NORMALIZE_THRESHOLD){gA.distance=this.getEdgeDistance(gA,gM,gL);if(gA.distance===undefined){gA.distance=this.getEdgeDistance(gA,gL,gK)}if(gA.distance===undefined){gA.distance=this.getEdgeDistance(gA,gK,gM)}var gP=1/Math.sqrt(gs);
if(gA.distance===undefined){gA.distance=((gR*gJ)+(gQ*gI)+(gO*gH))*gP}if(gN||(gA.distance>=-0.000001)){gz[0]*=gP;gz[1]*=gP;gz[2]*=gP;this.remove(this.stock,gA);this.append(this.hull,gA);return gA}}return null};gq.prototype.expandFace=function(gG,gF,gA,gr,gv){if(gA.pass!==gG){var gC=gA.normal;var gE=gC[0];var gD=gC[1];var gB=gC[2];var gz=this.vertex_store;var gy=gz[gF];var gx=gz[gF+1];var gw=gz[gF+2];var gu=(gr+1)%3;if((((gE*gy)+(gD*gx)+(gB*gw))-gA.distance)<-0.000001){var gt=this.buildNewFace(gA.vertex[gu],gA.vertex[gr],gF,false);if(gt){this.bind(gt,0,gA,gr);if(gv.cf){this.bind(gv.cf,1,gt,2)}else{gv.ff=gt}gv.cf=gt;gv.numFaces+=1;return true}}else{var gs=(gr+2)%3;gA.pass=gG;if(this.expandFace(gG,gF,gA.adjFace[gu],gA.edge[gu],gv)&&this.expandFace(gG,gF,gA.adjFace[gs],gA.edge[gs],gv)){this.remove(this.hull,gA);this.append(this.stock,gA);return true}}}return false};gq.prototype.evaluate=function(hn,gX,hv,hu){var hi=gX.shapeA;var hh=gX.shapeB;var hM=this.hull;var gQ=this.stock;while(hM.root){var gx=hM.root;
this.remove(hM,gx);this.append(gQ,gx)}var g7=hn[27];var g6=hn[28];var g5=hn[29];var hy,hw;var gs=hn[0]-g7;var hR=hn[1]-g6;var hP=hn[2]-g5;var hB=hn[9]-g7;var hA=hn[10]-g6;var hz=hn[11]-g5;var hm=hn[18]-g7;var hl=hn[19]-g6;var hk=hn[20]-g5;if(((gs*((hA*hk)-(hz*hl)))+(hR*((hz*hm)-(hB*hk)))+(hP*((hB*hl)-(hA*hm))))<0){hy=9;hw=0}else{hy=0;hw=9}var hb=this.vertex_store;var g3;for(g3=0;g3<9;g3+=1){hb[g3]=hn[hy+g3];hb[9+g3]=hn[hw+g3];hb[18+g3]=hn[18+g3];hb[27+g3]=hn[27+g3]}var hI=this.buildNewFace(0,9,18,true);var hH=this.buildNewFace(9,0,27,true);var hG=this.buildNewFace(18,9,27,true);var hF=this.buildNewFace(0,18,27,true);var g9=36;if(hM.count!==4){f2.v3Build(hn[3],hn[4],hn[5],gX.closestA);f2.v3Build(hn[6],hn[7],hn[8],gX.closestB);return 0}var gE=this.findBest();var hg=0;var hq=0;this.bind(hI,0,hH,0);this.bind(hI,1,hG,0);this.bind(hI,2,hF,0);this.bind(hH,1,hF,2);this.bind(hH,2,hG,1);this.bind(hG,2,hF,1);var gP=hv[0];var gO=hv[1];var gN=hv[2];var gM=hv[3];var gL=hv[4];var gK=hv[5];var gJ=hv[6];
var gI=hv[7];var gH=hv[8];var gG=hv[9];var hs=hv[10];var hr=hv[11];var gz=hu[0];var gy=hu[1];var gw=hu[2];var gv=hu[3];var gu=hu[4];var gt=hu[5];var gr=hu[6];var hQ=hu[7];var hO=hu[8];var hN=hu[9];var hp=hu[10];var ho=hu[11];var gV=gX.closestA;var gU=gX.closestB;var hf=this.horizon;var g8,hE,hD,hC;for(;hq<100;hq+=1){if(g9>=this.MAX_VERTICES*9){break}hf.cf=hf.ff=null;hf.numFaces=0;var gY=g9;g9+=9;hg+=1;gE.pass=hg;g8=gE.normal;hE=g8[0];hD=g8[1];hC=g8[2];gV[0]=((gP*hE)+(gO*hD)+(gN*hC));gV[1]=((gM*hE)+(gL*hD)+(gK*hC));gV[2]=((gJ*hE)+(gI*hD)+(gH*hC));gU[0]=-((gz*hE)+(gy*hD)+(gw*hC));gU[1]=-((gv*hE)+(gu*hD)+(gt*hC));gU[2]=-((gr*hE)+(hQ*hD)+(hO*hC));hi.localSupportWithoutMargin(gV,gV);hh.localSupportWithoutMargin(gU,gU);g7=gV[0];g6=gV[1];g5=gV[2];gs=((gP*g7)+(gM*g6)+(gJ*g5)+gG);hR=((gO*g7)+(gL*g6)+(gI*g5)+hs);hP=((gN*g7)+(gK*g6)+(gH*g5)+hr);g7=gU[0];g6=gU[1];g5=gU[2];hB=((gz*g7)+(gv*g6)+(gr*g5)+hN);hA=((gy*g7)+(gu*g6)+(hQ*g5)+hp);hz=((gw*g7)+(gt*g6)+(hO*g5)+ho);var g1,g0,gZ;hb[gY+3]=gs;hb[gY+4]=hR;
hb[gY+5]=hP;hb[gY+6]=hB;hb[gY+7]=hA;hb[gY+8]=hz;hb[gY]=g1=(gs-hB);hb[gY+1]=g0=(hR-hA);hb[gY+2]=gZ=(hP-hz);var ht=((hE*g1)+(hD*g0)+(hC*gZ))-gE.distance;if(ht>bp.GJK_EPA_DISTANCE_THRESHOLD){var g2;var gW=true;for(g2=0;(g2<3&&gW);g2+=1){gW=gW&&this.expandFace(hg,gY,gE.adjFace[g2],gE.edge[g2],hf)}if(gW&&(hf.numFaces>=3)){this.bind(hf.cf,1,hf.ff,2);this.remove(hM,gE);this.append(gQ,gE);gE=this.findBest()}else{break}}else{break}}g8=gE.normal;hE=g8[0];hD=g8[1];hC=g8[2];var he=gE.distance;var hd=hE*he;var hc=hD*he;var ha=hC*he;hm=gE.vertex[0];hl=gE.vertex[1];hk=gE.vertex[2];var gT=hb[hm]-hd;var gS=hb[hm+1]-hc;var gR=hb[hm+2]-ha;var gD=hb[hl]-hd;var gC=hb[hl+1]-hc;var gB=hb[hl+2]-ha;var hL=hb[hk]-hd;var hK=hb[hk+1]-hc;var hJ=hb[hk+2]-ha;g7=((gC*hJ)-(gB*hK));g6=((gB*hL)-(gD*hJ));g5=((gD*hK)-(gC*hL));var hj=Math.sqrt((g7*g7)+(g6*g6)+(g5*g5));g7=((hK*gR)-(hJ*gS));g6=((hJ*gT)-(hL*gR));g5=((hL*gS)-(hK*gT));var gA=Math.sqrt((g7*g7)+(g6*g6)+(g5*g5));g7=((gS*gB)-(gR*gC));g6=((gR*gD)-(gT*gB));g5=((gT*gC)-(gS*gD));
var g4=Math.sqrt((g7*g7)+(g6*g6)+(g5*g5));var hx=1/(hj+gA+g4);hj*=hx;gA*=hx;g4*=hx;gV[0]=gV[1]=gV[2]=0;gU[0]=gU[1]=gU[2]=0;for(g3=0;g3<3;g3+=1){gV[g3]+=(hj*hb[hm+3+g3])+(gA*hb[hl+3+g3])+(g4*hb[hk+3+g3]);gU[g3]+=(hj*hb[hm+6+g3])+(gA*hb[hl+6+g3])+(g4*hb[hk+6+g3])}var gF=gX.axis;gF[0]=-hE;gF[1]=-hD;gF[2]=-hC;return(-gE.distance)};gq.create=function(){var gs=new gq();var gr;gs.vertex_store=new Float32Array(gs.MAX_VERTICES*9);var gt=[];for(gr=0;gr<gs.MAX_FACES;gr+=1){gt[gr]={normal:f2.v3BuildZero(),distance:0,vertex:new Int16Array(3),adjFace:[null,null,null],edge:new Int16Array(3),leaf0:null,leaf1:null,pass:0}}gs.hull={root:null,count:0};gs.stock={root:null,count:0};gs.horizon={cf:null,ff:null,numFaces:0};for(gr=0;gr<gs.MAX_FACES;gr+=1){gs.append(gs.stock,gt[gs.MAX_FACES-gr-1])}return gs};gq.version=1;return gq})();cb.prototype.MAX_VERTICES=64;cb.prototype.MAX_FACES=128;var aF=(function(){function gq(){this._private=null;return this}gq.create=function(){var gs=new gq();Object.defineProperty(gs,"localPointOnA",{get:function gz(){var gA=this._private;
return f2.v3Build(gA[0],gA[1],gA[2])},set:function gx(gA){var gB=this._private;gB[0]=gA[0];gB[1]=gA[1];gB[2]=gA[2]},enumerable:true});Object.defineProperty(gs,"localPointOnB",{get:function gy(){var gA=this._private;return f2.v3Build(gA[3],gA[4],gA[5])},set:function gv(gA){var gB=this._private;gB[3]=gA[0];gB[4]=gA[1];gB[5]=gA[2]},enumerable:true});Object.defineProperty(gs,"worldNormalOnB",{get:function gr(){var gA=this._private;return f2.v3Build(gA[12],gA[13],gA[14])},set:function gu(gA){var gB=this._private;gB[12]=gA[0];gB[13]=gA[1];gB[14]=gA[2]},enumerable:true});Object.defineProperty(gs,"added",{get:function gt(){var gA=this._private;return(0<gA[51])},enumerable:true});Object.defineProperty(gs,"distance",{get:function gw(){var gA=this._private;return gA[21]},enumerable:true});return gs};return gq})();var fY={contactPool:[],contactPoolSize:0,publicContacts:[aF.create(),aF.create(),aF.create()],callbackContacts:[],allocate:function ek(){var gq;if(this.contactPoolSize===0){gq=new Float32Array(52)
}else{this.contactPoolSize-=1;gq=this.contactPool[this.contactPoolSize]}gq[51]=1;return gq},deallocate:function gi(gq){this.contactPool[this.contactPoolSize]=gq;this.contactPoolSize+=1;gq[40]=0}};var bf=(function(){function gq(){this.objectA=null;this.objectB=null;this.shapeA=null;this.shapeB=null;this.friction=0;this.restitution=0;this.contacts=[];this.activeContacts=[];this.active=true;this.skipDiscreteCollisions=false;this.contactFlags=0;this.trigger=false;return this}gq.prototype.insertContact=function(gr,hy,hh,gY,gI){var gy=hh[0];var gw=hh[1];var gv=hh[2];var gX=((gy*gy)+(gw*gw)+(gv*gv));if(gX<bp.DONT_NORMALIZE_THRESHOLD){return}var he=1/Math.sqrt(gX);gy*=he;gw*=he;gv*=he;var gO=this.objectA;var gM=this.objectB;var gx=gO.transform;var gu=gM.transform;var gL=gr[0]-gx[9];var gK=gr[1]-gx[10];var gH=gr[2]-gx[11];var gV=(gx[0]*gL)+(gx[1]*gK)+(gx[2]*gH);var gT=(gx[3]*gL)+(gx[4]*gK)+(gx[5]*gH);var gR=(gx[6]*gL)+(gx[7]*gK)+(gx[8]*gH);var gs=0;var hr=0;var hw=Number.MAX_VALUE;var gP=this.contacts;
var hq,hp,ho;while(hr<gP.length){var gN=gP[hr];if((!gI)&&((gy*gN[12])+(gw*gN[13])+(gv*gN[14]))<0.9){gP[hr]=gP[gP.length-1];gP.pop();fY.deallocate(gN);this.contactFlags|=4;continue}hq=(gV-gN[0]);hp=(gT-gN[1]);ho=(gR-gN[2]);var g7=(hq*hq)+(hp*hp)+(ho*ho);if(g7<bp.CONTACT_EQUAL_SQ_SEPERATION){gs=gN[40];gP[hr]=gP[gP.length-1];gP.pop();fY.deallocate(gN);this.contactFlags|=4;hw=g7;continue}if(g7<bp.CONTACT_INHERIT_SQ_SEPERATION&&g7<hw){gs=gN[40];hw=g7}hr+=1}var hu=fY.allocate();hu[0]=gV;hu[1]=gT;hu[2]=gR;hu[6]=gL;hu[7]=gK;hu[8]=gH;hu[9]=gL=hy[0]-gu[9];hu[10]=gK=hy[1]-gu[10];hu[11]=gH=hy[2]-gu[11];hu[3]=(gu[0]*gL)+(gu[1]*gK)+(gu[2]*gH);hu[4]=(gu[3]*gL)+(gu[4]*gK)+(gu[5]*gH);hu[5]=(gu[6]*gL)+(gu[7]*gK)+(gu[8]*gH);hu[21]=gY;hu[12]=gy;hu[13]=gw;hu[14]=gv;var gD,gz;gX=((gy*gy)+(gv*gv));if(gX<bp.DONT_NORMALIZE_THRESHOLD){hu[15]=gD=1;hu[16]=0;hu[17]=gz=0}else{he=1/Math.sqrt(gX);hu[15]=gD=(-gv*he);hu[16]=0;hu[17]=gz=(gy*he)}hu[18]=((gw*gz));hu[19]=((gv*gD)-(gy*gz));hu[20]=(-(gw*gD));hu[40]=gs;var hg,gZ;
hg=gO.contactCallbacks;if(null!==hg&&0!==(hg.mask&gM.group)){if(hg.onPreSolveContact){gZ=fY.publicContacts[0];gZ._private=hu;hg.onPreSolveContact(gO._public,gM._public,gZ)}if(!hg.added&&hg.deferred){hg.added=true;gO.world.contactCallbackObjects.push(gO)}if(hg.trigger){this.trigger=true;gO.sweepFrozen=false;gM.sweepFrozen=false}}hg=gM.contactCallbacks;if(null!==hg&&0!==(hg.mask&gO.group)){if(hg.onPreSolveContact){gZ=fY.publicContacts[0];gZ._private=hu;hg.onPreSolveContact(gO._public,gM._public,gZ)}if(!hg.added&&hg.deferred){hg.added=true;gM.world.contactCallbackObjects.push(gM)}if(hg.trigger){this.trigger=true;gO.sweepFrozen=false;gM.sweepFrozen=false}}this.contactFlags|=1;gP.push(hu);if(gP.length===4){var gB=gP[0][21];var g6=0;for(hr=1;hr<4;hr+=1){hu=gP[hr];if(hu[21]<gB){gB=hu[21];g6=hr}}var gt;var hx=-Number.MAX_VALUE;var gW=gP[0];var gU=gP[1];var gS=gP[2];var gQ=gP[3];var hn=gW[6]+gW[9];var hl=gW[7]+gW[10];var hj=gW[8]+gW[11];var g5=gU[6]+gU[9];var g3=gU[7]+gU[10];var g1=gU[8]+gU[11];
var gE=gS[6]+gS[9];var gC=gS[7]+gS[10];var gA=gS[8]+gS[11];hq=gQ[6]+gQ[9];hp=gQ[7]+gQ[10];ho=gQ[8]+gQ[11];var gJ=(g5-hn);var gG=(g3-hl);var gF=(g1-hj);var hv=(gE-hn);var ht=(gC-hl);var hs=(gA-hj);var hd=(hq-hn);var hc=(hp-hl);var hb=(ho-hj);var ha,g9,g8;var hf;if(g6!==1){ha=((ht*hb)-(hs*hc));g9=((hs*hd)-(hv*hb));g8=((hv*hc)-(ht*hd));hf=(ha*ha)+(g9*g9)+(g8*g8);if(hf>hx){hx=hf;gt=1}}if(g6!==2){ha=((gG*hb)-(gF*hc));g9=((gF*hd)-(gJ*hb));g8=((gJ*hc)-(gG*hd));hf=(ha*ha)+(g9*g9)+(g8*g8);if(hf>hx){hx=hf;gt=2}}if(g6!==3){ha=((gG*hs)-(gF*ht));g9=((gF*hv)-(gJ*hs));g8=((gJ*ht)-(gG*hv));hf=(ha*ha)+(g9*g9)+(g8*g8);if(hf>hx){hx=hf;gt=3}}if(g6!==0){var hm=(gE-g5);var hk=(gC-g3);var hi=(gA-g1);var g4=(hq-g5);var g2=(hp-g3);var g0=(ho-g1);ha=((hk*g0)-(hi*g2));g9=((hi*g4)-(hm*g0));g8=((hm*g2)-(hk*g4));hf=(ha*ha)+(g9*g9)+(g8*g8);if(hf>hx){hx=hf;gt=0}}hu=gP[gt];gP[gt]=gP[3];gP.pop();fY.deallocate(hu);this.contactFlags|=4}};gq.prototype.refreshContacts=function(){var gI=this.contacts;var gH=this.objectA;var gF=this.objectB;
var gs=gH.transform;var gr=gF.transform;var gC=gs[0];var gB=gs[1];var gA=gs[2];var gz=gs[3];var gy=gs[4];var gx=gs[5];var gw=gs[6];var gv=gs[7];var gu=gs[8];var gt=gs[9];var g6=gs[10];var g4=gs[11];var g3=gr[0];var g2=gr[1];var g0=gr[2];var gZ=gr[3];var gY=gr[4];var gX=gr[5];var gW=gr[6];var gU=gr[7];var gT=gr[8];var gR=gr[9];var gS=gr[10];var gQ=gr[11];var g1;var gV=0;while(gV<gI.length){g1=gI[gV];var g8=g1[0];var g7=g1[1];var g5=g1[2];var gP=g1[6]=((gC*g8)+(gz*g7)+(gw*g5));var gO=g1[7]=((gB*g8)+(gy*g7)+(gv*g5));var gN=g1[8]=((gA*g8)+(gx*g7)+(gu*g5));g8=g1[3];g7=g1[4];g5=g1[5];var gG=g1[9]=((g3*g8)+(gZ*g7)+(gW*g5));var gE=g1[10]=((g2*g8)+(gY*g7)+(gU*g5));var gD=g1[11]=((g0*g8)+(gX*g7)+(gT*g5));g8=(gP+gt)-(gG+gR);g7=(gO+g6)-(gE+gS);g5=(gN+g4)-(gD+gQ);var gM=g1[12];var gL=g1[13];var gK=g1[14];var gJ=g1[21]=((gM*g8)+(gL*g7)+(gK*g5));if(gJ>bp.CONTACT_MAX_Y_SEPERATION){gI[gV]=gI[gI.length-1];gI.pop();fY.deallocate(g1);this.contactFlags|=4;continue}g8-=(gM*gJ);g7-=(gL*gJ);g5-=(gK*gJ);if(((g8*g8)+(g7*g7)+(g5*g5))>bp.CONTACT_MAX_SQ_XZ_SEPERATION){gI[gV]=gI[gI.length-1];
gI.pop();fY.deallocate(g1);this.contactFlags|=4;continue}gV+=1}this.contactFlags|=2;return(gI.length===0)};gq.prototype.preStep=function(gU,gV){if(this.trigger){this.activeContacts.length=0;return}var gN=this.objectA;var gL=this.objectB;var gr=gN.inverseMass+gL.inverseMass;var g7=gN.velocity;var g6=gL.velocity;var gC=gN.inverseInertia;var gI=gC[0];var gH=gC[1];var gG=gC[2];var gE=gC[3];var gD=gC[4];var gB=gC[5];var gA=gC[6];var gz=gC[7];var gy=gC[8];gC=gL.inverseInertia;var hj=gC[0];var hi=gC[1];var hg=gC[2];var hf=gC[3];var he=gC[4];var hd=gC[5];var hc=gC[6];var ha=gC[7];var g9=gC[8];var g8=this.activeContacts;g8.length=0;var g5=((gN).collisionObject||(gL).collisionObject)?bp.CONTACT_STATIC_BAUMGRAUTE:bp.CONTACT_BAUMGRAUTE;var gO=this.contacts;var hb;var gT=gO.length;for(hb=0;hb<gT;hb+=1){var hh=gO[hb];if(hh[21]>0){continue}g8[g8.length]=hh;hh[41]=hh[42]=0;var gS,gR,gQ;var gu,gt,gs;var g1=hh[12];var g0=hh[13];var gZ=hh[14];var g4=hh[6];var g3=hh[7];var g2=hh[8];var gM=hh[9];var gK=hh[10];
var gJ=hh[11];var gY,gX,gW;var gF=gr;gS=((g3*gZ)-(g2*g0));gR=((g2*g1)-(g4*gZ));gQ=((g4*g0)-(g3*g1));hh[22]=gY=((gI*gS)+(gE*gR)+(gA*gQ));hh[23]=gX=((gH*gS)+(gD*gR)+(gz*gQ));hh[24]=gW=((gG*gS)+(gB*gR)+(gy*gQ));gF+=((gS*gY)+(gR*gX)+(gQ*gW));gu=((gK*gZ)-(gJ*g0));gt=((gJ*g1)-(gM*gZ));gs=((gM*g0)-(gK*g1));hh[25]=gY=-((hj*gu)+(hf*gt)+(hc*gs));hh[26]=gX=-((hi*gu)+(he*gt)+(ha*gs));hh[27]=gW=-((hg*gu)+(hd*gt)+(g9*gs));gF-=((gu*gY)+(gt*gX)+(gs*gW));hh[45]=1/gF;hh[43]=g5*Math.min(0,hh[21]+bp.CONTACT_SLOP)/gV;hh[44]=0;var hn=(g7[0]-g6[0]);var hm=(g7[1]-g6[1]);var hl=(g7[2]-g6[2]);hn+=((g7[4]*g2)-(g7[5]*g3));hm+=((g7[5]*g4)-(g7[3]*g2));hl+=((g7[3]*g3)-(g7[4]*g4));hn-=((g6[4]*gJ)-(g6[5]*gK));hm-=((g6[5]*gM)-(g6[3]*gJ));hl-=((g6[3]*gK)-(g6[4]*gM));var gv=((hn*g1)+(hm*g0)+(hl*gZ))*this.restitution;if(gv*gv<0.01){gv=0}hh[50]=gv;var gx=gr;g1=hh[15];g0=hh[16];gZ=hh[17];gS=((g3*gZ)-(g2*g0));gR=((g2*g1)-(g4*gZ));gQ=((g4*g0)-(g3*g1));hh[28]=gY=((gI*gS)+(gE*gR)+(gA*gQ));hh[29]=gX=((gH*gS)+(gD*gR)+(gz*gQ));hh[30]=gW=((gG*gS)+(gB*gR)+(gy*gQ));
gx+=((gS*gY)+(gR*gX)+(gQ*gW));gu=((gK*gZ)-(gJ*g0));gt=((gJ*g1)-(gM*gZ));gs=((gM*g0)-(gK*g1));hh[31]=gY=-((hj*gu)+(hf*gt)+(hc*gs));hh[32]=gX=-((hi*gu)+(he*gt)+(ha*gs));hh[33]=gW=-((hg*gu)+(hd*gt)+(g9*gs));gx-=((gu*gY)+(gt*gX)+(gs*gW));var gw=gr;g1=hh[18];g0=hh[19];gZ=hh[20];gS=((g3*gZ)-(g2*g0));gR=((g2*g1)-(g4*gZ));gQ=((g4*g0)-(g3*g1));hh[34]=gY=((gI*gS)+(gE*gR)+(gA*gQ));hh[35]=gX=((gH*gS)+(gD*gR)+(gz*gQ));hh[36]=gW=((gG*gS)+(gB*gR)+(gy*gQ));gw+=((gS*gY)+(gR*gX)+(gQ*gW));gu=((gK*gZ)-(gJ*g0));gt=((gJ*g1)-(gM*gZ));gs=((gM*g0)-(gK*g1));hh[37]=gY=-((hj*gu)+(hf*gt)+(hc*gs));hh[38]=gX=-((hi*gu)+(he*gt)+(ha*gs));hh[39]=gW=-((hg*gu)+(hd*gt)+(g9*gs));gw-=((gu*gY)+(gt*gX)+(gs*gW));var hk=0;hk+=((gS*hh[28])+(gR*hh[29])+(gQ*hh[30]));hk-=((gu*hh[31])+(gt*hh[32])+(gs*hh[33]));var gP=1/(gx*gw-hk*hk);hh[46]=gw*gP;hh[47]=-hk*gP;hh[48]=gx*gP;hh[40]*=gU}};gq.prototype.applyCachedImpulses=function(){if(this.trigger){return}var gu=this.objectA;var gt=this.objectB;var gC=gu.velocity;var gB=gt.velocity;var gs=gu.inverseMass;
var gr=gt.inverseMass;var gD=this.activeContacts;var gx;for(gx=0;gx<gD.length;gx+=1){var gw=gD[gx];var gv=gw[40];var gA=(gw[12]*gv);var gz=(gw[13]*gv);var gy=(gw[14]*gv);gC[0]+=(gA*gs);gC[1]+=(gz*gs);gC[2]+=(gy*gs);gB[0]-=(gA*gr);gB[1]-=(gz*gr);gB[2]-=(gy*gr);gC[3]+=(gw[22]*gv);gC[4]+=(gw[23]*gv);gC[5]+=(gw[24]*gv);gB[3]+=(gw[25]*gv);gB[4]+=(gw[26]*gv);gB[5]+=(gw[27]*gv)}};gq.prototype.computeAndApplyBiasImpulses=function(){if(this.trigger){return}var gx=this.objectA;var gv=this.objectB;var gK=gx.velocity;var gD=gK[6];var gC=gK[7];var gB=gK[8];var gU=gK[9];var gS=gK[10];var gQ=gK[11];gK=gv.velocity;var gO=gK[6];var gN=gK[7];var gL=gK[8];var gA=gK[9];var gz=gK[10];var gy=gK[11];var gT=gx.inverseMass;var gR=gv.inverseMass;var gw=this.activeContacts;var gV=gw.length;var gX;var gP;for(gP=0;gP<gV;gP+=1){gX=gw[gP];var gJ=gX[12];var gI=gX[13];var gG=gX[14];var gu=gX[6];var gt=gX[7];var gr=gX[8];var gH=gX[9];var gF=gX[10];var gE=gX[11];var gs=gX[45]*(gJ*((gO+((gz*gE)-(gy*gF)))-(gD+((gS*gr)-(gQ*gt))))+gI*((gN+((gy*gH)-(gA*gE)))-(gC+((gQ*gu)-(gU*gr))))+gG*((gL+((gA*gF)-(gz*gH)))-(gB+((gU*gt)-(gS*gu))))-gX[43]);
var gW=gX[44];var gM=gW+gs;if(gM<0){gM=0}gs=gM-gW;gX[44]=gM;gJ*=gs;gI*=gs;gG*=gs;gD+=(gJ*gT);gC+=(gI*gT);gB+=(gG*gT);gO-=(gJ*gR);gN-=(gI*gR);gL-=(gG*gR);gU+=(gX[22]*gs);gS+=(gX[23]*gs);gQ+=(gX[24]*gs);gA+=(gX[25]*gs);gz+=(gX[26]*gs);gy+=(gX[27]*gs)}gK=gx.velocity;gK[6]=gD;gK[7]=gC;gK[8]=gB;gK[9]=gU;gK[10]=gS;gK[11]=gQ;gK=gv.velocity;gK[6]=gO;gK[7]=gN;gK[8]=gL;gK[9]=gA;gK[10]=gz;gK[11]=gy};gq.prototype.computeAndApplyImpulses=function(){if(this.trigger){return}var gG=this.objectA;var gD=this.objectB;var gH=gG.velocity;var gw=gH[0];var gv=gH[1];var gu=gH[2];var gt=gH[3];var gs=gH[4];var gr=gH[5];gH=gD.velocity;var g4=gH[0];var g3=gH[1];var g2=gH[2];var gZ=gH[3];var gY=gH[4];var gX=gH[5];var gQ=gG.inverseMass;var gO=gD.inverseMass;var gK=this.friction;var gI=this.activeContacts;var gJ=gI.length;var g8;var g7;for(g7=0;g7<gJ;g7+=1){g8=gI[g7];var gS=g8[12];var gR=g8[13];var gP=g8[14];var gE=g8[15];var gC=g8[16];var gA=g8[17];var hb=g8[18];var ha=g8[19];var g9=g8[20];var gV=g8[6];var gU=g8[7];
var gT=g8[8];var gF=g8[9];var gB=g8[10];var gz=g8[11];var g6=g8[45]*(gS*((g4+((gY*gz)-(gX*gB)))-(gw+((gs*gT)-(gr*gU))))+gR*((g3+((gX*gF)-(gZ*gz)))-(gv+((gr*gV)-(gt*gT))))+gP*((g2+((gZ*gB)-(gY*gF)))-(gu+((gt*gU)-(gs*gV))))-g8[50]);var g1=g8[40];var gN=g1+g6;if(gN<0){gN=0;g6=-g1}g8[40]=gN;gS*=g6;gR*=g6;gP*=g6;gw+=(gS*gQ);gv+=(gR*gQ);gu+=(gP*gQ);g4-=(gS*gO);g3-=(gR*gO);g2-=(gP*gO);gt+=(g8[22]*g6);gs+=(g8[23]*g6);gr+=(g8[24]*g6);gZ+=(g8[25]*g6);gY+=(g8[26]*g6);gX+=(g8[27]*g6);gS=(g4-gw)+((gY*gz)-(gX*gB))-((gs*gT)-(gr*gU));gR=(g3-gv)+((gX*gF)-(gZ*gz))-((gr*gV)-(gt*gT));gP=(g2-gu)+((gZ*gB)-(gY*gF))-((gt*gU)-(gs*gV));var gy=((gE*gS)+(gC*gR)+(gA*gP));var gx=((hb*gS)+(ha*gR)+(g9*gP));g6=gy*g8[46]+gx*g8[47];var g5=gy*g8[47]+gx*g8[48];g1=g8[41];var g0=g8[42];gN=g1+g6;var gM=g0+g5;var gW=gK*g8[40];var gL=(gN*gN)+(gM*gM);if(gL>(gW*gW)){gL=gW/Math.sqrt(gL);gN*=gL;gM*=gL;g6=gN-g1;g5=gM-g0}g8[41]=gN;g8[42]=gM;gS=(gE*g6)+(hb*g5);gR=(gC*g6)+(ha*g5);gP=(gA*g6)+(g9*g5);gw+=(gS*gQ);gv+=(gR*gQ);gu+=(gP*gQ);g4-=(gS*gO);
g3-=(gR*gO);g2-=(gP*gO);gt+=(g8[28]*g6)+(g8[34]*g5);gs+=(g8[29]*g6)+(g8[35]*g5);gr+=(g8[30]*g6)+(g8[36]*g5);gZ+=(g8[31]*g6)+(g8[37]*g5);gY+=(g8[32]*g6)+(g8[38]*g5);gX+=(g8[33]*g6)+(g8[39]*g5)}gH=gG.velocity;gH[0]=gw;gH[1]=gv;gH[2]=gu;gH[3]=gt;gH[4]=gs;gH[5]=gr;gH=gD.velocity;gH[0]=g4;gH[1]=g3;gH[2]=g2;gH[3]=gZ;gH[4]=gY;gH[5]=gX};gq.prototype.invalidateParameters=function(){this.restitution=(this.objectA.restitution*this.objectB.restitution);this.friction=(this.objectA.friction*this.objectB.friction)};gq.allocate=function(gv,gu,gs,gr){var gt;if(this.arbiterPoolSize===0){gt=new gq()}else{gt=this.arbiterPool[this.arbiterPoolSize-1];this.arbiterPoolSize-=1}gt.active=true;gt.shapeA=gv;gt.shapeB=gu;gt.objectA=gs;gt.objectB=gr;gt.invalidateParameters();return gt};gq.deallocate=function(gr){gr.shapeA=null;gr.shapeB=null;gr.objectA=null;gr.objectB=null;gr.skipDiscreteCollisions=false;gr.activeContacts.length=0;gr.contactFlags=0;gr.trigger=false;this.arbiterPool[this.arbiterPoolSize]=gr;this.arbiterPoolSize+=1
};gq.version=1;gq.arbiterPool=[];gq.arbiterPoolSize=0;return gq})();var ft=(function(){function gq(){this.bodies=[];this.constraints=[];this.wakeTimeStamp=0;this.active=false;return this}gq.allocate=function(){var gr;if(this.islandPoolSize===0){gr=new gq()}else{gr=this.islandPool[this.islandPoolSize-1];this.islandPoolSize-=1}return gr};gq.deallocate=function(gr){this.islandPool[this.islandPoolSize]=gr;this.islandPoolSize+=1;gr.wakeTimeStamp=0};gq.version=1;gq.islandPool=[];gq.islandPoolSize=0;return gq})();var ec=(function(){function gq(){this.index=0;this.collisionRadius=0;this.triangleArray=null;return this}gq.prototype.localSupportWithoutMargin=function(gA,gI){var gv=gA[0];var gt=gA[1];var gr=gA[2];var gD=this.triangleArray.triangles;var gE=this.index;var gC=gD[gE+3];var gB=gD[gE+4];var gz=gD[gE+5];var gH=gD[gE+6];var gG=gD[gE+7];var gF=gD[gE+8];var gw=gD[gE+9];var gu=gD[gE+10];var gs=gD[gE+11];var gy=((gv*gH)+(gt*gG)+(gr*gF));var gx=((gv*gw)+(gt*gu)+(gr*gs));if(gy<=0&&gx<=0){gI[0]=gC;
gI[1]=gB;gI[2]=gz}else{if(gy>=gx){gI[0]=(gC+gH);gI[1]=(gB+gG);gI[2]=(gz+gF)}else{gI[0]=(gC+gw);gI[1]=(gB+gu);gI[2]=(gz+gs)}}};gq.allocate=function(){var gr;if(this.trianglePoolSize===0){gr=new gq()}else{gr=this.trianglePool[this.trianglePoolSize-1];this.trianglePoolSize-=1}return gr};gq.deallocate=function(gr){this.trianglePool[this.trianglePoolSize]=gr;this.trianglePoolSize+=1;gr.triangleArray=null};gq.version=1;gq.trianglePool=[];gq.trianglePoolSize=0;return gq})();ec.prototype.type="TRIANGLE_MESH_TRIANGLE";var ee=(function(){function gq(){this.objectA=null;this.objectB=null;this.shapeA=null;this.shapeB=null;this.closestA=f2.v3BuildZero();this.closestB=f2.v3BuildZero();this.axis=f2.v3BuildZero();this.distance=0;this.toi=0;this.frozenA=false;this.frozenB=false;this.concave=false;return this}gq.allocate=function(){var gr;if(this.eventPoolSize===0){gr=new gq()}else{gr=this.eventPool[this.eventPoolSize-1];this.eventPoolSize-=1}return gr};gq.deallocate=function(gr){this.eventPool[this.eventPoolSize]=gr;
this.eventPoolSize+=1;if(gr.concave){ec.deallocate(gr.shapeB);gr.concave=false}gr.objectA=null;gr.objectB=null;gr.shapeA=null;gr.shapeB=null};gq.version=1;gq.eventPool=[];gq.eventPoolSize=0;return gq})();var fe=(function(){function gq(){}gq.prototype.update=function(){this._private.update()};gq.prototype.rayTest=function(gr){return this._private.rayTest(gr)};gq.prototype.convexSweepTest=function(gr){return this._private.convexSweepTest(gr)};gq.prototype.addCollisionObject=function(gr){return this._private.addBody((gr)._private)};gq.prototype.removeCollisionObject=function(gr){return this._private.removeBody((gr)._private)};gq.prototype.addRigidBody=function(gr){return this._private.addBody((gr)._private)};gq.prototype.removeRigidBody=function(gr){return this._private.removeBody((gr)._private)};gq.prototype.addConstraint=function(gr){return this._private.addConstraint((gr)._private)};gq.prototype.removeConstraint=function(gr){return this._private.removeConstraint((gr)._private)};gq.prototype.addCharacter=function(gr){return this._private.addBody((gr)._private.rigidBody._private)
};gq.prototype.removeCharacter=function(gr){return this._private.removeBody((gr)._private.rigidBody._private)};gq.prototype.wakeBody=function(gr){this._private.wakeBody(gr)};gq.prototype.flush=function(){this._private.flush()};gq.create=function(gu){var gt=new gq();var gr=new br();gt._private=gr;gr._public=gt;gr.gravity=(gu.gravity!==undefined)?f2.v3Copy(gu.gravity):f2.v3Build(0,-10,0);gr.maxSubSteps=(gu.maxSubSteps!==undefined)?gu.maxSubSteps:10;gr.fixedTimeStep=(gu.fixedTimeStep!==undefined)?gu.fixedTimeStep:(1/60);gr.variableMinStep=(gu.minimumTimeStep!==undefined)?gu.minimumTimeStep:(1/70);gr.variableMaxStep=(gu.maximumTimeStep!==undefined)?gu.maximumTimeStep:(1/50);gr.variableStep=(gu.variableTimeSteps!==undefined)?gu.variableTimeSteps:false;gr.maxGiveUpTimeStep=(gu.maxGiveUpTimeStep!==undefined)?gu.maxGiveUpTimeStep:1/20;Object.defineProperty(gt,"maxSubSteps",{value:gr.maxSubSteps,enumerable:true});Object.defineProperty(gt,"maxGiveUpTimeStep",{value:gr.maxGiveUpTimeStep,enumerable:true});
if(!gr.variableStep){Object.defineProperty(gt,"fixedTimeStep",{value:gr.fixedTimeStep,enumerable:true})}else{Object.defineProperty(gt,"minimumTimeStep",{value:gr.variableMinStep,enumerable:true});Object.defineProperty(gt,"maximumTimeStep",{value:gr.variableMaxStep,enumerable:true})}Object.defineProperty(gt,"gravity",{get:function gs(){return f2.v3Copy(this._private.gravity)},enumerable:true});gr.staticSpatialMap=af.create(true);gr.dynamicSpatialMap=af.create();gr.collisionObjects=[];gr.rigidBodies=[];gr.constraints=[];gr.kinematicBodies=[];gr.activeArbiters=[];gr.activeBodies=[];gr.activeKinematics=[];gr.activeConstraints=[];gr.persistantObjectsList=[];gr.persistantObjectsList2=[];gr.persistantTrianglesList=[];gr.persistantTOIEventList=[];gr.timeStamp=0;gr.performanceData={discrete:0,sleepComputation:0,prestepContacts:0,prestepConstraints:0,integrateVelocities:0,warmstartContacts:0,warmstartConstraints:0,physicsIterations:0,integratePositions:0,continuous:0};Object.defineProperty(gt,"performanceData",{value:gr.performanceData,enumerable:true});
gr.syncExtents=new Float32Array(6);gr.contactCallbackObjects=[];gr.contactCallbackRemovedArbiters=[];return gt};gq.version=1;return gq})();var br=(function(){function gq(){}gq.prototype.m43InverseOrthonormalTransformVector=function(gs,gt,gw){if(gw===undefined){gw=new Float32Array(3)}var gr=gt[0];var gv=gt[1];var gu=gt[2];gw[0]=(gs[0]*gr+gs[1]*gv+gs[2]*gu);gw[1]=(gs[3]*gr+gs[4]*gv+gs[5]*gu);gw[2]=(gs[6]*gr+gs[7]*gv+gs[8]*gu);return gw};gq.prototype.m43InverseOrthonormalTransformPoint=function(gs,gt,gw){if(gw===undefined){gw=new Float32Array(3)}var gr=gt[0]-gs[9];var gv=gt[1]-gs[10];var gu=gt[2]-gs[11];gw[0]=(gs[0]*gr+gs[1]*gv+gs[2]*gu);gw[1]=(gs[3]*gr+gs[4]*gv+gs[5]*gu);gw[2]=(gs[6]*gr+gs[7]*gv+gs[8]*gu);return gw};gq.prototype.trianglePlaneDiscard=function(gu,gx,gO,gz,gC){if(this.planeAxis===undefined){this.planeAxis=f2.v3BuildZero();this.planeSA=f2.v3BuildZero();this.planeSB=f2.v3BuildZero()}var gy=this.planeAxis;var gR=this.planeSA;var gP=this.planeSB;var gK=gO.triangles;var gE=gK[gz];
var gD=gK[gz+1];var gB=gK[gz+2];var gA=gK[gz+16];var gw=gC[0];var gv=gC[1];var gt=gC[2];var gs=gC[3];var gr=gC[4];var gV=gC[5];var gU=gC[6];var gT=gC[7];var gS=gC[8];var gQ=gC[9];var gJ=gC[10];var gI=gC[11];var gH=(gE*gw)+(gD*gs)+(gB*gU);var gG=(gE*gv)+(gD*gr)+(gB*gT);var gF=(gE*gt)+(gD*gV)+(gB*gS);gw=gx[0];gv=gx[1];gt=gx[2];gs=gx[3];gr=gx[4];gV=gx[5];gU=gx[6];gT=gx[7];gS=gx[8];gQ-=gx[9];gJ-=gx[10];gI-=gx[11];gE=(gw*gH)+(gv*gG)+(gt*gF);gD=(gs*gH)+(gr*gG)+(gV*gF);gB=(gU*gH)+(gT*gG)+(gS*gF);gA+=(gH*gQ)+(gG*gJ)+(gF*gI);gy[0]=gE;gy[1]=gD;gy[2]=gB;gu.localSupportWithoutMargin(gy,gR);gy[0]=-gE;gy[1]=-gD;gy[2]=-gB;gu.localSupportWithoutMargin(gy,gP);var gN=(gR[0]*gE)+(gR[1]*gD)+(gR[2]*gB)-gA;var gM=(gP[0]*gE)+(gP[1]*gD)+(gP[2]*gB)-gA;if((gN*gM)<=0){return false}var gL;if((gN*gN)<(gM*gM)){gL=gN}else{gL=gM}if((gL<0)!==((gN*gM)<0)){gL=-gL}return(gL-gu.collisionRadius)>0};gq.prototype.filtered=function(gs,gr){if(gs===gr){return true}if((gs.collisionObject||gs.kinematic)&&(gr.collisionObject||gr.kinematic)){return true
}if((gs.mask&gr.group)===0||(gr.mask&gs.group)===0){return true}return false};gq.prototype.narrowPhase=function(gI,gH,gs,gr){if(this.narrowTriangle===undefined){this.narrowTriangle=ec.allocate();this.narrowCache={axis:f2.v3Build(1,0,0),shapeA:null,shapeB:null,closestA:f2.v3BuildZero(),closestB:f2.v3BuildZero()};this.narrowCache2={axis:this.narrowCache.axis,shapeA:null,shapeB:null,closestA:this.narrowCache.closestA,closestB:this.narrowCache.closestB};this.narrowFakeBody={transform:f2.m43BuildIdentity(),shape:null};this.narrowTransform=f2.m43BuildIdentity();this.narrowExtents=new Float32Array(6)}var gz=null;var gF=gs.arbiters;var gD=gr.arbiters;var gQ=(gF.length<=gD.length)?gF:gD;var gO=0;var gw=gQ.length;for(gO=0;gO<gw;gO+=1){var gu=gQ[gO];if(gu.shapeA===gI&&gu.shapeB===gH&&gu.objectA===gs&&gu.objectB===gr){gz=gu;break}}if(gz!==null&&gz.skipDiscreteCollisions){gz.skipDiscreteCollisions=false;return}var gJ=(gz===null);if(gJ){gz=bf.allocate(gI,gH,gs,gr)}var gE=this.narrowCache;gE.shapeA=gI;
gE.shapeB=gH;if(gz.contacts.length!==0){var gT=gz.contacts[0];gE.axis[0]=gT[12];gE.axis[1]=gT[13];gE.axis[2]=gT[14]}var gN;var gR=false;if(gI.type==="TRIANGLE_MESH"||gH.type==="TRIANGLE_MESH"){var gB,gS;var gM,gv;var gL=this.narrowTriangle;var gC=this.narrowCache2;if(gI.type==="TRIANGLE_MESH"){gB=gI;gM=gs.transform;gS=gH;gv=gr.transform;gC.shapeA=gL;gC.shapeB=gE.shapeB}else{gB=gH;gM=gr.transform;gS=gI;gv=gs.transform;gC.shapeA=gE.shapeA;gC.shapeB=gL}var gP=gB.triangleArray;gL.triangleArray=gP;gL.collisionRadius=gB.collisionRadius;var gt;if(gP.spatialMap){var gA=this.narrowTransform;var gx=this.narrowFakeBody;var gK=this.narrowExtents;f2.m43InverseOrthonormal(gM,gA);f2.m43Mul(gv,gA,gx.transform);gx.shape=gS;eN.prototype.calculateExtents.call(gx,gK);var gG=this.persistantTrianglesList;gt=gP.spatialMap.getOverlappingNodes(gK,gG,0);for(gO=0;gO<gt;gO+=1){var gy=gG[gO].index;gL.index=gy;gG[gO]=undefined;if(!this.trianglePlaneDiscard(gS,gv,gP,gy,gM)){gN=this.contactPairTest(gC,gs.transform,gr.transform);
if(gN<0){gz.insertContact(gC.closestA,gC.closestB,gC.axis,gN,true);gR=true}}}}else{gt=gP.numTriangles;for(gO=0;gO<gt;gO+=1){gL.index=(gO*bW.prototype.TRIANGLE_SIZE);if(!this.trianglePlaneDiscard(gS,gv,gP,gL.index,gM)){gN=this.contactPairTest(gC,gs.transform,gr.transform);if(gN<0){gz.insertContact(gC.closestA,gC.closestB,gC.axis,gN,true);gR=true}}}}}else{gN=this.contactPairTest(gE,gs.transform,gr.transform);if(gN<0){gz.insertContact(gE.closestA,gE.closestB,gE.axis,gN,false);gR=true}}if(gR){if(gJ){this.activeArbiters.push(gz);gz.active=true;gs.arbiters.push(gz);gr.arbiters.push(gz)}if(gs.permitSleep&&!gs.active){this.wakeBody(gs)}if(gr.permitSleep&&!gr.active){this.wakeBody(gr)}if(!gz.active){gz.active=true;this.activeArbiters.push(gz)}}else{if(gJ){bf.deallocate(gz)}}};gq.prototype.computeSleeping=function(gA){function gz(gH,gK){var gI=gy(gH);var gJ=gy(gK);if(gI!==gJ){if(gI.islandRank<gJ.islandRank){gI.islandRoot=gJ}else{if(gI.islandRank>gJ.islandRank){gJ.islandRoot=gI}else{gJ.islandRoot=gI;
gI.islandRank+=1}}}}function gy(gI){if(gI===gI.islandRoot){return gI}var gJ=gI;var gH=null;var gK;while(gJ!==gJ.islandRoot){gK=gJ.islandRoot;gJ.islandRoot=gH;gH=gJ;gJ=gK}while(gH!==null){gK=gH.islandRoot;gH.islandRoot=gJ;gH=gK}return gJ}var gu,gs;var gB=this.activeArbiters;var gr=this.activeBodies;var gx=this.activeConstraints;var gw;var gE=gB.length;for(gw=0;gw<gE;gw+=1){var gv=gB[gw];gu=gv.objectA;gs=gv.objectB;if(gu.permitSleep&&gs.permitSleep){gz(gu,gs)}}gE=gx.length;var gt;for(gw=0;gw<gE;gw+=1){gt=gx[gw];gu=gt.bodyA;gs=gt.bodyB;if(gu&&gu.permitSleep){gz(gu,gt)}if(gs&&gs.permitSleep){gz(gs,gt)}}var gF=[];var gD,gC,gG;while(gr.length>0){gC=gr.pop();gG=gy(gC);gD=gG.island;if(!gD){gD=gG.island=ft.allocate();gF.push(gD);gD.active=false}gC.island=gD;gD.bodies.push(gC);gD.active=gD.active||gC.isActive(gA);if(gC.wakeTimeStamp>gD.wakeTimeStamp){gD.wakeTimeStamp=gC.wakeTimeStamp}}while(gx.length>0){gt=gx.pop();gG=gy(gt);gD=gG.island;if(!gD){gD=gG.island=ft.allocate();gF.push(gD);gD.active=true
}gt.island=gD;gD.constraints.push(gt);if(gt.wakeTimeStamp>gD.wakeTimeStamp){gD.wakeTimeStamp=gt.wakeTimeStamp}}while(gF.length>0){gD=gF.pop();if(gD.active){while(gD.bodies.length>0){gC=gD.bodies.pop();gC.wakeTimeStamp=gD.wakeTimeStamp;gr.push(gC);gC.islandRoot=gC;gC.islandRank=0;gC.island=null}while(gD.constraints.length>0){gt=gD.constraints.pop();gt.wakeTimeStamp=gD.wakeTimeStamp;gx.push(gt);gt.islandRoot=gt;gt.islandRank=0;gt.island=null}ft.deallocate(gD)}else{gE=gD.bodies.length;for(gw=0;gw<gE;gw+=1){gC=gD.bodies[gw];gC.velocity[0]=gC.velocity[1]=gC.velocity[2]=0;gC.velocity[3]=gC.velocity[4]=gC.velocity[5]=0;gC.active=false;this.syncBody(gC);gC.islandRoot=gC;gC.islandRank=0}gE=gD.constraints.length;for(gw=0;gw<gE;gw+=1){gt=gD.constraints[gw];gt.active=false;gt.islandRoot=gt;gt.islandRank=0}}}};gq.prototype.wakeIsland=function(gu){while(gu.bodies.length>0){var gr=gu.bodies.pop();gr.wakeTimeStamp=this.timeStamp+(this.midStep?0:1);this.activeBodies.push(gr);var gx;var gs=gr.arbiters;var gv=gs.length;
for(gx=0;gx<gv;gx+=1){var gt=gs[gx];if(!gt.active){gt.active=true;this.activeArbiters.push(gt)}}gr.active=true;gr.island=null;this.syncBody(gr)}while(gu.constraints.length>0){var gw=gu.constraints.pop();gw.wakeTimeStamp=this.timeStamp+(this.midStep?0:1);this.activeConstraints.push(gw);gw.active=true;gw.island=null}ft.deallocate(gu)};gq.prototype.wakeRelated=function(gr){var gw=gr.constraints;var gv;var gu=gw.length;for(gv=0;gv<gu;gv+=1){this.wakeConstraint(gw[gv])}var gs=gr.arbiters;gu=gs.length;for(gv=0;gv<gu;gv+=1){var gt=gs[gv];if(!gt.active){gt.active=true;this.activeArbiters.push(gt)}if(gt.objectA.permitSleep&&!gt.objectA.active){this.wakeBody(gt.objectA)}if(gt.objectB.permitSleep&&!gt.objectB.active){this.wakeBody(gt.objectB)}}};gq.prototype.wakeBody=function(gr){if(gr.collisionObject&&!gr.kinematic){this.wakeRelated(gr);this.syncBody(gr)}else{if(gr.kinematic){gr.delaySleep=true;if(!gr.active){gr.active=true;this.activeKinematics.push(gr);this.wakeRelated(gr);this.syncBody(gr)}}else{gr.wakeTimeStamp=this.timeStamp+(this.midStep?0:1);
if(!gr.active){if(!gr.island){gr.active=true;this.activeBodies.push(gr);this.wakeRelated(gr);this.syncBody(gr)}else{this.wakeIsland(gr.island)}this.syncBody(gr)}}}};gq.prototype.syncBody=function(gr){var gs=this.syncExtents;gr.calculateExtents(gs);if(gr.collisionObject&&!gr.kinematic){this.staticSpatialMap.update(gr,gs)}else{if(gr.active){if(!gr.previouslyActive){this.staticSpatialMap.remove(gr);this.dynamicSpatialMap.add(gr,gs)}else{this.dynamicSpatialMap.update(gr,gs)}}else{if(gr.previouslyActive){this.dynamicSpatialMap.remove(gr);this.staticSpatialMap.add(gr,gs)}else{this.staticSpatialMap.update(gr,gs)}}gr.previouslyActive=gr.active}};gq.prototype.wakeConstraint=function(gr){gr.wakeTimeStamp=this.timeStamp+(this.midStep?0:1);if(!gr.active){if(!gr.island){gr.active=true;this.activeConstraints.push(gr);if(gr.bodyA){this.wakeBody(gr.bodyA)}if(gr.bodyB){this.wakeBody(gr.bodyB)}}else{this.wakeIsland(gr.island)}}};gq.prototype.dynamicSweep=function(gH,gD,gz,gB){var gu=gH.objectA;var gt=gH.objectB;
var gv=gH.axis;var gx=gu.velocity;var gQ=-gx[0];var gP=-gx[1];var gO=-gx[2];var gw=gt.velocity;gQ+=gw[0];gP+=gw[1];gO+=gw[2];if(((gQ*gQ)+(gP*gP)+(gO*gO))<bp.DONT_NORMALIZE_THRESHOLD){gH.toi=undefined;return}gv[0]=gQ;gv[1]=gP;gv[2]=gO;var gL=-gQ;var gJ=-gP;var gI=-gO;var gA=0;var gM,gK;if(!gu.fixedRotation){gM=gu.shape.radius;gA+=gM*Math.sqrt((gx[3]*gx[3])+(gx[4]*gx[4])+(gx[5]*gx[5]))}if(!gt.fixedRotation){gK=gt.shape.radius;gA+=gK*Math.sqrt((gw[3]*gw[3])+(gw[4]*gw[4])+(gw[5]*gw[5]))}if(gA<(bp.CONTINUOUS_ANGULAR_BULLET/gD)){var gy=(gM<gK)?gM:gK;gy*=bp.CONTINUOUS_LINEAR_BULLET/gD;if(((gL*gL)+(gJ*gJ)+(gI*gI))<(gy*gy)){gH.toi=undefined;return}}var gN=0;var gC=100;var gs=gz;for(;;){gu.integratePosition(gs*gD);gt.integratePosition(gs*gD);var gE=this.contactPairTest(gH,gu.transform,gt.transform);var gG=gE;if(gE!==undefined){gG+=gB}if(gG===undefined||gG<bp.GJK_EPA_DISTANCE_THRESHOLD){if(!this.seperatingTOI(gH)){gH.distance=gE}else{gs=undefined}break}var gF=(gv[0]*gL)+(gv[1]*gJ)+(gv[2]*gI);var gr=(gA-gF)*gD;
if(gr<=0){gs=undefined;break}gs+=gG/gr;if(gs>=1){gs=undefined;break}gN+=1;if(gN>gC){gs=undefined;break}}gH.toi=gs};gq.prototype.seperatingTOI=function(gE){var gs=gE.objectA;var gr=gE.objectB;var gI=gE.closestA;var gH=gE.closestB;var gG=gs.velocity;var gF=gr.velocity;var gz=gG[0]-gF[0];var gy=gG[1]-gF[1];var gx=gG[2]-gF[2];if(!gs.fixedRotation){var gw=gI[0]-gs.transform[9];var gv=gI[1]-gs.transform[10];var gu=gI[2]-gs.transform[11];gz+=(gG[4]*gu)-(gG[5]*gv);gy+=(gG[5]*gw)-(gG[3]*gu);gx+=(gG[3]*gv)-(gG[4]*gw)}if(!gr.fixedRotation){var gC=gH[0]-gr.transform[9];var gB=gH[1]-gr.transform[10];var gA=gH[2]-gr.transform[11];gz-=(gF[4]*gA)-(gF[5]*gB);gy-=(gF[5]*gC)-(gF[3]*gA);gx-=(gF[3]*gB)-(gF[4]*gC)}var gt=gE.axis;var gD=(gz*gt[0])+(gy*gt[1])+(gx*gt[2]);return gD>=0};gq.prototype.staticSweep=function(gF,gA,gw,gy){var gu=gF.objectA;var gt=gF.objectB;var gv=gF.axis;var gB=gu.velocity;var gM=-gB[0];var gL=-gB[1];var gK=-gB[2];if(((gM*gM)+(gL*gL)+(gK*gK))<bp.DONT_NORMALIZE_THRESHOLD){gF.toi=undefined;
return}gv[0]=gM;gv[1]=gL;gv[2]=gK;var gI=-gM;var gH=-gL;var gG=-gK;var gx=0;if(!gu.fixedRotationtype){gx+=gu.shape.radius*Math.sqrt((gB[3]*gB[3])+(gB[4]*gB[4])+(gB[5]*gB[5]))}var gJ=0;var gz=100;var gs=gw;for(;;){gu.integratePosition(gs*gA);var gC=this.contactPairTest(gF,gu.transform,gt.transform);var gE=gC;if(gC!==undefined){gE+=gy}if(gE===undefined||gE<bp.GJK_EPA_DISTANCE_THRESHOLD){if(!this.seperatingTOI(gF)){gF.distance=gC}else{gs=undefined}break}var gD=(gv[0]*gI)+(gv[1]*gH)+(gv[2]*gG);var gr=(gx-gD)*gA;if(gr<=0){gs=undefined;break}gs+=gE/gr;if(gs>=1){gs=undefined;break}gJ+=1;if(gJ>gz){gs=undefined;break}}gF.toi=gs};gq.prototype.performStaticTOIBase=function(gE,gy,gD,gB,gu,gt){var gw=this.persistantTrianglesList;if(this.continuousFakeBody===undefined){this.continuousFakeBody={shape:null,transform:f2.m43BuildIdentity(),startTransform:f2.m43BuildIdentity()};this.continuousInvTransform=f2.m43BuildIdentity();this.continuousExtents=new Float32Array(6)}var gv=this.continuousFakeBody;var gC=this.continuousInvTransform;
var gA=this.continuousExtents;var gr;if(gt.shape.type==="TRIANGLE_MESH"){var gz=gt.shape.triangleArray;var gs,gx;if(gz.spatialMap){gv.shape=gu.shape;f2.m43InverseOrthonormal(gt.transform,gC);f2.m43Mul(gu.startTransform,gC,gv.startTransform);f2.m43Mul(gu.endTransform,gC,gv.transform);eN.prototype.calculateSweptExtents.call(gv,gA);gs=gz.spatialMap.getOverlappingNodes(gA,gw,0);for(gx=0;gx<gs;gx+=1){gr=ee.allocate();gr.objectA=gu;gr.objectB=gt;gr.shapeA=gu.shape;gr.shapeB=ec.allocate();gr.shapeB.index=gw[gx].index;gw[gx]=undefined;gr.shapeB.triangleArray=gt.shape.triangleArray;gr.shapeB.collisionRadius=gt.shape.collisionRadius;gr.concave=true;this.staticSweep(gr,gy,0,gE);if(gr.toi===undefined){ee.deallocate(gr);continue}gr.frozenA=false;gr.frozenB=true;gD[gB]=gr;gB+=1}}else{gs=gz.numTriangles;for(gx=0;gx<gs;gx+=1){gr=ee.allocate();gr.objectA=gu;gr.objectB=gt;gr.shapeA=gu.shape;gr.shapeB=ec.allocate();gr.shapeB.index=gx*bW.prototype.TRIANGLE_SIZE;gr.shapeB.triangleArray=gt.shape.triangleArray;
gr.shapeB.collisionRadius=gt.shape.collisionRadius;gr.concave=true;this.staticSweep(gr,gy,0,gE);if(gr.toi===undefined){ee.deallocate(gr);continue}gr.frozenA=false;gr.frozenB=true;gD[gB]=gr;gB+=1}}}else{gr=ee.allocate();gr.objectA=gu;gr.objectB=gt;gr.shapeA=gu.shape;gr.shapeB=gt.shape;this.staticSweep(gr,gy,0,gE);if(gr.toi===undefined){ee.deallocate(gr);return gB}gr.frozenA=false;gr.frozenB=true;gD[gB]=gr;gB+=1}return gB};gq.prototype.update=function(){var g5=this.dynamicSpatialMap;var gO=this.staticSpatialMap;var gN=this.activeBodies;var gV=this.activeKinematics;var gr=this.activeConstraints;var gF=this.activeArbiters;var ha=this.gravity;var gS=this.performanceData;gS.discrete=0;gS.sleepComputation=0;gS.prestepContacts=0;gS.prestepConstraints=0;gS.integrateVelocities=0;gS.warmstartContacts=0;gS.warmstartConstraints=0;gS.physicsIterations=0;gS.integratePositions=0;gS.continuous=0;var g6=this.prevTimeStamp;if(g6===undefined){this.prevTimeStamp=TurbulenzEngine.getTime()*0.001;return}var gw=TurbulenzEngine.getTime()*0.001;
var g2=(gw-g6);var g8,gX;if(this.variableStep){var gC=this.variableMinStep;var hd=this.variableMaxStep;g8=Math.ceil(g2/hd);gX=(g2/g8);if(gX<gC){gX=gC;g8=Math.floor(g2/gX)}if(g8>this.maxSubSteps&&this.maxGiveUpTimeStep!==0){g8=Math.ceil(g2/this.maxGiveUpTimeStep);gX=(g2/g8)}}else{gX=this.fixedTimeStep;g8=Math.floor(g2/gX);if(g8>this.maxSubSteps&&this.maxGiveUpTimeStep!==0){g8=Math.ceil(g2/this.maxGiveUpTimeStep);gX=(g2/g8)}}if(g8<=0){return}this.prevTimeStamp+=(gX*g8);if(g8>this.maxSubSteps){g8=this.maxSubSteps}this.midStep=true;var gR,hg;var gW;gR=gV.length;for(hg=0;hg<gR;){gW=gV[hg];if(!gW.computeDeltaVelocity(gX*g8,gW.prevTransform,gW.transform)&&!gW.delaySleep){gW.active=false;gR-=1;gV[hg]=gV[gR];gV.pop();this.syncBody(gW)}else{f2.m43Copy(gW.transform,gW.newTransform);f2.m43Copy(gW.prevTransform,gW.transform);hg+=1}gW.delaySleep=false}var g0;for(g0=0;g0<g8;g0+=1){var hf,gu;this.timeStamp+=1;var gx;if(this.prevTimeStep===undefined){this.prevTimeStep=gX}var gT=gX/this.prevTimeStep;this.prevTimeStep=gX;
gR=gN.length;for(hg=0;hg<gR;hg+=1){gW=gN[hg];gu=gW.extents;gW.calculateExtents(gu);g5.update(gW,gu);gW.refreshInertiaTensor()}gR=gV.length;for(hg=0;hg<gR;hg+=1){gW=gV[hg];gu=gW.extents;gW.calculateExtents(gu);g5.update(gW,gu)}gx=TurbulenzEngine.getTime()*0.001;gO.finalize();g5.finalize();var hc=this.persistantObjectsList;var hi=g5.getOverlappingPairs(hc,0);var g7=hi;var g1;gR=gN.length;for(hg=0;hg<gR;hg+=1){gW=gN[hg];g1=gO.getOverlappingNodes(gW.extents,hc,g7+1);if(g1!==0){hc[g7]=gW;g7+=1+g1;hc[g7]=gW;g7+=1}}gR=gV.length;for(hg=0;hg<gR;hg+=1){gW=gV[hg];g1=gO.getOverlappingNodes(gW.extents,hc,g7+1);if(g1!==0){hc[g7]=gW;g7+=1+g1;hc[g7]=gW;g7+=1}}var gL,gK;for(hg=0;hg<hi;hg+=2){gL=hc[hg];gK=hc[hg+1];hc[hg]=undefined;hc[hg+1]=undefined;if(!this.filtered(gL,gK)){if(gL.id<gK.id){this.narrowPhase(gL.shape,gK.shape,gL,gK)}else{this.narrowPhase(gK.shape,gL.shape,gK,gL)}}}for(hg=hi;hg<g7;){gL=hc[hg];hc[hg]=undefined;hg+=1;for(;;){gK=hc[hg];hc[hg]=undefined;hg+=1;if(gL===gK){break}if(!this.filtered(gL,gK)){if(gL.id<gK.id){this.narrowPhase(gL.shape,gK.shape,gL,gK)
}else{this.narrowPhase(gK.shape,gL.shape,gK,gL)}}}}gS.discrete+=(TurbulenzEngine.getTime()*0.001-gx);gx=TurbulenzEngine.getTime()*0.001;this.computeSleeping(gX);gS.sleepComputation+=(TurbulenzEngine.getTime()*0.001-gx);gx=TurbulenzEngine.getTime()*0.001;hg=0;var g3;while(hg<gF.length){g3=gF[hg];if(!g3.objectA.active&&!g3.objectB.active){g3.active=false;gF[hg]=gF[gF.length-1];gF.pop();continue}if(g3.refreshContacts()){gF[hg]=gF[gF.length-1];gF.pop();gL=g3.objectA;gK=g3.objectB;var gM=gL.arbiters;gM[gM.indexOf(g3)]=gM[gM.length-1];gM.pop();gM=gK.arbiters;gM[gM.indexOf(g3)]=gM[gM.length-1];gM.pop();if((gL.contactCallbacks&&gL.contactCallbacks.onRemovedContacts)||(gK.contactCallbacks&&gK.contactCallbacks.onRemovedContacts)){this.contactCallbackRemovedArbiters.push(g3)}else{bf.deallocate(g3)}continue}g3.preStep(gT,gX);hg+=1}gS.prestepContacts+=(TurbulenzEngine.getTime()*0.001-gx);gx=TurbulenzEngine.getTime()*0.001;gR=gr.length;for(hg=0;hg<gR;hg+=1){gr[hg].preStep(gT,gX)}gS.prestepConstraints+=(TurbulenzEngine.getTime()*0.001-gx);
gx=TurbulenzEngine.getTime()*0.001;gR=gN.length;for(hg=0;hg<gR;hg+=1){gW=gN[hg];gW.integrateVelocity(ha,gX)}gS.integrateVelocities+=(TurbulenzEngine.getTime()*0.001-gx);gx=TurbulenzEngine.getTime()*0.001;gR=gF.length;for(hg=0;hg<gR;hg+=1){gF[hg].applyCachedImpulses()}gS.warmstartContacts+=(TurbulenzEngine.getTime()*0.001-gx);gx=TurbulenzEngine.getTime()*0.001;gR=gr.length;for(hg=0;hg<gR;hg+=1){gr[hg].applyCachedImpulses()}gS.warmstartConstraints+=(TurbulenzEngine.getTime()*0.001-gx);gx=TurbulenzEngine.getTime()*0.001;var hk=10;for(hg=0;hg<hk;hg+=1){gR=gF.length;for(hf=0;hf<gR;hf+=1){gF[hf].computeAndApplyImpulses()}gR=gr.length;for(hf=0;hf<gR;hf+=1){gr[hf].computeAndApplyImpulses()}}hk=3;gR=gF.length;for(hg=0;hg<hk;hg+=1){for(hf=0;hf<gR;hf+=1){gF[hf].computeAndApplyBiasImpulses()}}gS.physicsIterations+=(TurbulenzEngine.getTime()*0.001-gx);var gz=this.persistantObjectsList2;var gU=0;gx=TurbulenzEngine.getTime()*0.001;gR=gN.length;var hb;var hh=gX*gX;var gJ,gH;for(hg=0;hg<gR;hg+=1){gW=gN[hg];
gW.applyBiasVelocities(gX);gW.integratePosition(gX);if(!gW.isActiveVelocity(bp.CONTINUOUS_LINEAR_SQ/gX,bp.CONTINUOUS_ANGULAR_SQ/gX)){gW.sweepFrozen=true;gW.bullet=false;continue}gJ=gW.transform;gH=gW.endTransform;gH[0]=gJ[0];gH[1]=gJ[1];gH[2]=gJ[2];gH[3]=gJ[3];gH[4]=gJ[4];gH[5]=gJ[5];gH[6]=gJ[6];gH[7]=gJ[7];gH[8]=gJ[8];gH[9]=gJ[9];gH[10]=gJ[10];gH[11]=gJ[11];hb=gW.shape.radius*bp.CONTINUOUS_LINEAR_BULLET;var gE=gW.velocity;var gB=((gE[0]*gE[0])+(gE[1]*gE[1])+(gE[2]*gE[2]))*hh;var g9=((gE[3]*gE[3])+(gE[4]*gE[4])+(gE[5]*gE[5]))*hh;gW.bullet=gB>(hb*hb)||g9>bp.CONTINUOUS_ANGULAR_BULLET;gu=gW.extents;gW.calculateSweptExtents(gu);g5.update(gW,gu);gW.sweepFrozen=false;gz[gU]=gW;gU+=1}gR=gV.length;for(hg=0;hg<gR;hg+=1){gW=gV[hg];f2.m43Copy(gW.transform,gW.startTransform);gW.integratePosition(gX);gu=gW.extents;gW.calculateSweptExtents(gu);g5.update(gW,gu)}gS.integratePositions+=(TurbulenzEngine.getTime()*0.001-gx);gx=TurbulenzEngine.getTime()*0.001;gO.finalize();g5.finalize();var gI=bp.CONTINUOUS_SLOP+bp.CONTACT_SLOP;
var gZ=this.persistantTOIEventList;var gG=0;var gD;hi=g5.getOverlappingPairs(hc,0);for(hg=0;hg<hi;hg+=2){gL=hc[hg];gK=hc[hg+1];hc[hg]=undefined;hc[hg+1]=undefined;if(!((gL.bullet||gL.kinematic)||(gK.bullet||gK.kinematic))||(gL.sweepFrozen&&gK.sweepFrozen)||this.filtered(gL,gK)){continue}if(gL.kinematic||gK.kinematic){if(gL.kinematic){gG=this.performStaticTOIBase(gI,gX,gZ,gG,gK,gL)}else{gG=this.performStaticTOIBase(gI,gX,gZ,gG,gL,gK)}}else{gD=ee.allocate();gD.objectA=gL;gD.objectB=gK;gD.shapeA=gL.shape;gD.shapeB=gK.shape;this.dynamicSweep(gD,gX,0,gI);gD.frozenA=gL.sweepFrozen;gD.frozenB=gK.sweepFrozen;gZ[gG]=gD;gG+=1}}for(hg=0;hg<gU;hg+=1){gL=gz[hg];g1=gO.getOverlappingNodes(gL.extents,hc,0);for(hf=0;hf<g1;hf+=1){gK=hc[hf];hc[hf]=undefined;if(this.filtered(gL,gK)){continue}gG=this.performStaticTOIBase(gI,gX,gZ,gG,gL,gK)}}var gv=0;while(gv<1&&gG>0){var gP=null;var hj;for(hg=0;hg<gG;){gD=gZ[hg];gL=gD.objectA;gK=gD.objectB;if(gL.sweepFrozen&&gK.sweepFrozen){gG-=1;if(hg!==gG){gZ[hg]=gZ[gG];gZ[gG]=undefined
}ee.deallocate(gD);continue}if((gD.frozenA!==gL.sweepFrozen)||(gD.frozenB!==gK.sweepFrozen)){gD.frozenA=gL.sweepFrozen;gD.frozenB=gK.sweepFrozen;if(gD.frozenA){gD.objectA=gK;gD.objectB=gL;gD.shapeA=gK.shape;gD.shapeB=gL.shape;gD.frozenA=false;gD.frozenB=true}this.staticSweep(gD,gX,gv,gI);if(gD.toi===undefined){gG-=1;if(hg!==gG){gZ[hg]=gZ[gG];gZ[gG]=undefined}ee.deallocate(gD);continue}}if(gD.toi!==undefined&&(gP===null||(gD.toi<gP.toi))){gP=gD;hj=hg}hg+=1}if(gP===null){break}gG-=1;if(hj!==gG){gZ[hj]=gZ[gG];gZ[gG]=undefined}gv=gP.toi;gL=gP.objectA;gK=gP.objectB;if(!gL.collisionObject){if(!gL.sweepFrozen){gL.integratePosition(gX*gv);gL.sweepFrozen=true}if(gL.permitSleep&&!gL.active){this.wakeBody(gL)}}if(!gK.collisionObject){if(!gK.sweepFrozen){gK.integratePosition(gX*gv);gK.sweepFrozen=true}if(gK.permitSleep&&!gK.active){this.wakeBody(gK)}}if(gL.id>gK.id){var he=gL;gL=gK;gK=he;var gA=gP.closestA;gP.closestA=gP.closestB;gP.closestB=gA;gA=gP.axis;gA[0]=-gA[0];gA[1]=-gA[1];gA[2]=-gA[2]}var gt=gL.shape;
var gs=gK.shape;g3=null;var hm=gL.arbiters;var hl=gK.arbiters;var gQ=(hm.length<=hl.length)?hm:hl;var gY=gQ.length;for(hg=0;hg<gY;hg+=1){var gy=gQ[hg];if(gy.shapeA===gt&&gy.shapeB===gs&&gy.objectA===gL&&gy.objectB===gK){g3=gy;break}}var g4=(g3===null);if(g4){g3=bf.allocate(gt,gs,gL,gK)}g3.insertContact(gP.closestA,gP.closestB,gP.axis,gP.distance,gP.concave);if(g4){gF.push(g3);g3.active=true;gL.arbiters.push(g3);gK.arbiters.push(g3)}if(!((gL.kinematic&&gL.active)||(gK.kinematic&&gK.active))){g3.skipDiscreteCollisions=true}ee.deallocate(gP)}while(gG>0){gG-=1;ee.deallocate(gZ[gG]);gZ[gG]=undefined}while(gU>0){gU-=1;gL=gz[gU];gz[gU]=undefined;if(!gL.sweepFrozen){gL.integratePosition(gX)}}gS.continuous+=(TurbulenzEngine.getTime()*0.001-gx)}gR=gV.length;for(hg=0;hg<gR;hg+=1){gW=gV[hg];f2.m43Copy(gW.newTransform,gW.transform);f2.m43Copy(gW.newTransform,gW.prevTransform)}this.updateContactCallbacks();this.midStep=false};gq.prototype.rayTest=function(gs){var gx=gs.group;var gr=gs.mask;if(gx===undefined){gx=dq.prototype.FILTER_DYNAMIC
}if(gr===undefined){gr=dq.prototype.FILTER_ALL}var gv=gs.exclude;var gu={origin:gs.from,direction:f2.v3Sub(gs.to,gs.from),maxFactor:1};this.staticSpatialMap.finalize();this.dynamicSpatialMap.finalize();function gt(gy,gE,gA,gC,gD){var gz=gE._public;if(gz===gv||(gE.mask&gx)===0||(gE.group&gr)===0){return null}gA.maxFactor=gD;var gB=gE.rayTest(gA);if(gB!==null){if(gE.collisionObject){gB.collisionObject=gz;gB.body=null}else{gB.collisionObject=null;gB.body=gz}}return gB}var gw=af.rayTest([this.staticSpatialMap,this.dynamicSpatialMap],gu,gt);if(gw!==null){delete gw.factor}return gw};gq.prototype.contactPairTest=function(gJ,gx,gw){var gW=gJ.axis;var gv=gJ.shapeA;var gt=gJ.shapeB;var gN=gJ.closestA;var gL=gJ.closestB;if(this.contactGJK===undefined){this.contactGJK=b5.create();this.contactEPA=cb.create()}if(gv.type==="PLANE"||gt.type==="PLANE"){var gU,g9;var g6,gy;if(gv.type==="PLANE"){gU=gv;g6=gx;g9=gt;gy=gw}else{gU=gt;g6=gw;g9=gv;gy=gx}var gO=g6[0];var gM=g6[1];var gK=g6[2];var gI=g6[3];var gH=g6[4];
var gG=g6[5];var gF=g6[6];var gE=g6[7];var gD=g6[8];var gC=g6[9];var hl=g6[10];var hk=g6[11];var hd=gU.normal;var g2=hd[0];var g1=hd[1];var g0=hd[2];var gr=gU.distance;var g5=(g2*gO)+(g1*gI)+(g0*gF);var g4=(g2*gM)+(g1*gH)+(g0*gE);var g3=(g2*gK)+(g1*gG)+(g0*gD);gO=gy[0];gM=gy[1];gK=gy[2];gI=gy[3];gH=gy[4];gG=gy[5];gF=gy[6];gE=gy[7];gD=gy[8];var hf=gy[9];var hg=gy[10];var he=gy[11];g2=(gO*g5)+(gM*g4)+(gK*g3);g1=(gI*g5)+(gH*g4)+(gG*g3);g0=(gF*g5)+(gE*g4)+(gD*g3);gr+=(g5*(gC-hf))+(g4*(hl-hg))+(g3*(hk-he));gW[0]=g2;gW[1]=g1;gW[2]=g0;g9.localSupportWithoutMargin(gW,gN);gW[0]=-g2;gW[1]=-g1;gW[2]=-g0;g9.localSupportWithoutMargin(gW,gL);var hb=(gN[0]*g2)+(gN[1]*g1)+(gN[2]*g0)-gr;var g8=(gL[0]*g2)+(gL[1]*g1)+(gL[2]*g0)-gr;var gP,gB,gA,gz;if((hb*hb)<(g8*g8)){gB=gN[0];gA=gN[1];gz=gN[2];gP=hb}else{gB=gL[0];gA=gL[1];gz=gL[2];gP=g8}if((gP<0)!==((hb*g8)<0)){gP=-gP;g5=-g5;g4=-g4;g3=-g3}var gu=g9.collisionRadius;var gs=gU.collisionRadius;var hc=(gO*gB)+(gI*gA)+(gF*gz)+hf;var ha=(gM*gB)+(gH*gA)+(gE*gz)+hg;
var g7=(gK*gB)+(gG*gA)+(gD*gz)+he;var gS=gs-gP;var hj=hc+(g5*gS);var hi=ha+(g4*gS);var hh=g7+(g3*gS);hc-=(g5*gu);ha-=(g4*gu);g7-=(g3*gu);gP-=gu+gs;if(gv.type==="PLANE"){gW[0]=-g5;gW[1]=-g4;gW[2]=-g3;gN[0]=hj;gN[1]=hi;gN[2]=hh;gL[0]=hc;gL[1]=ha;gL[2]=g7}else{gW[0]=g5;gW[1]=g4;gW[2]=g3;gN[0]=hc;gN[1]=ha;gN[2]=g7;gL[0]=hj;gL[1]=hi;gL[2]=hh}return gP}else{var gT=this.contactGJK;var gV=gT.evaluate(gJ,gx,gw);if(gV===undefined){gV=this.contactEPA.evaluate(gT.simplex,gJ,gx,gw)}if(gV!==undefined){var gZ=gW[0];var gY=gW[1];var gX=gW[2];var gR=gv.collisionRadius;var gQ=gt.collisionRadius;gN[0]-=gZ*gR;gN[1]-=gY*gR;gN[2]-=gX*gR;gL[0]+=gZ*gQ;gL[1]+=gY*gQ;gL[2]+=gX*gQ;return(gV-gR-gQ)}else{return undefined}}};gq.prototype.convexSweepTest=function(gr,gO){if(this.sweepCache===undefined){this.sweepCache={axis:f2.v3BuildZero(),shapeA:null,shapeB:null,closestA:f2.v3BuildZero(),closestB:f2.v3BuildZero()};this.sweepTriangle=ec.allocate();this.sweepDelta=f2.v3BuildZero();this.sweepFromExtents=new Float32Array(6);
this.sweepToExtents=new Float32Array(6);this.sweepExtents=new Float32Array(6);this.sweepFakeBody={shape:null,transform:null};this.sweepTransform=f2.m43BuildIdentity();this.sweepTransform2=f2.m43BuildIdentity()}var gA=this.sweepCache;var gZ=this.sweepTriangle;var gN=this.sweepDelta;var gt=this.sweepFromExtents;var gv=this.sweepToExtents;var gu=this.sweepExtents;var gw=this.sweepFakeBody;var gJ=this.sweepTransform;var gz=this.sweepTransform2;var gM=this;function gC(hf,g3,hm,he,ha,g9){var hi=hm[0];var hh=hm[1];var hg=hm[2];var g4=gA.axis;var hn=gA.closestA;var hl=gA.closestB;g4[0]=-hi;g4[1]=-hh;g4[2]=-hg;gA.shapeA=hf;gA.shapeB=he;var g6=0;var hk=0;var g7=100;var g5;var hj=Number.MAX_VALUE;var hd=false;for(;;){var g8=gM.contactPairTest(gA,g3,ha);if(g8===undefined||g8<bp.GJK_EPA_DISTANCE_THRESHOLD){if(g5!==undefined||g8!==undefined){if(g5===undefined){g5=g8}hd=true}break}if((g8-hj)>=1){break}hj=g8;var g2=hl[0]-hn[0];var hp=hl[1]-hn[1];var ho=hl[2]-hn[2];var hc=(hi*g2)+(hh*hp)+(hg*ho);if(hc<=bp.COPLANAR_THRESHOLD){break
}var hb=(g8*g8)/hc;g6+=hb;if(g6>=g9){g5=undefined;break}g5=g8;g3[9]+=(hi*hb);g3[10]+=(hh*hb);g3[11]+=(hg*hb);if(g5<=bp.GJK_EPA_DISTANCE_THRESHOLD){hd=true;break}hk+=1;if(hk>g7){break}}if(g5===undefined||!hd){return null}else{return{hitPoint:f2.v3Copy(hl),hitNormal:f2.v3Copy(g4),distance:g6}}}var gD=gr.shape._private;var gB=gr.from;var g1=gr.to;var gV=(g1[9]-gB[9]);var gT=(g1[10]-gB[10]);var gS=(g1[11]-gB[11]);var gX=Math.sqrt((gV*gV)+(gT*gT)+(gS*gS));var gK=1/gX;gN[0]=gV*gK;gN[1]=gT*gK;gN[2]=gS*gK;var gF=(gr.group===undefined)?dq.prototype.FILTER_DYNAMIC:gr.group;var gU=(gr.mask===undefined)?dq.prototype.FILTER_ALL:gr.mask;var gy=gr.exclude;gw.shape=gD;gw.transform=gB;eN.prototype.calculateExtents.call(gw,gt);gw.transform=g1;eN.prototype.calculateExtents.call(gw,gv);gu[0]=(gt[0]<gv[0]?gt[0]:gv[0]);gu[1]=(gt[1]<gv[1]?gt[1]:gv[1]);gu[2]=(gt[2]<gv[2]?gt[2]:gv[2]);gu[3]=(gt[3]>gv[3]?gt[3]:gv[3]);gu[4]=(gt[4]>gv[4]?gt[4]:gv[4]);gu[5]=(gt[5]>gv[5]?gt[5]:gv[5]);this.staticSpatialMap.finalize();
this.dynamicSpatialMap.finalize();var gQ=this.persistantObjectsList;var gx=this.persistantTrianglesList;var gL=this.staticSpatialMap.getOverlappingNodes(gu,gQ,0);var gG=gL+this.dynamicSpatialMap.getOverlappingNodes(gu,gQ,gL);var gR=null;var gY,gW;for(gY=0;gY<gG;gY+=1){var gP=gQ[gY];gQ[gY]=undefined;var gs=(gP)._public;if(gs===gy||gP.shape===gD||(gP.mask&gF)===0||(gP.group&gU)===0){continue}var gE;var gI=gP.shape;if(gI.type==="TRIANGLE_MESH"){var g0=(gI).triangleArray;gZ.triangleArray=g0;gZ.collisionRadius=(gI).collisionRadius;var gH;if(g0.spatialMap){f2.m43InverseOrthonormal(gP.transform,gz);f2.m43Mul(gB,gz,gJ);gw.transform=gJ;eN.prototype.calculateExtents.call(gw,gt);f2.m43Mul(g1,gz,gJ);eN.prototype.calculateExtents.call(gw,gv);gu[0]=(gt[0]<gv[0]?gt[0]:gv[0]);gu[1]=(gt[1]<gv[1]?gt[1]:gv[1]);gu[2]=(gt[2]<gv[2]?gt[2]:gv[2]);gu[3]=(gt[3]>gv[3]?gt[3]:gv[3]);gu[4]=(gt[4]>gv[4]?gt[4]:gv[4]);gu[5]=(gt[5]>gv[5]?gt[5]:gv[5]);gH=g0.spatialMap.getOverlappingNodes(gu,gx,0);for(gW=0;gW<gH;gW+=1){gZ.index=gx[gW].index;
gx[gW]=undefined;f2.m43Copy(gB,gz);gE=gC(gD,gz,gN,gZ,gP.transform,gX);if(gE){gE.collisionObject=gs;gE.body=null;if(!gO||gO(gE)){gR=gE;gX=gE.distance}}}}else{gH=g0.numTriangles;for(gW=0;gW<gH;gW+=1){gZ.index=(gW*bW.prototype.TRIANGLE_SIZE);f2.m43Copy(gB,gz);gE=gC(gD,gz,gN,gZ,gP.transform,gX);if(gE){gE.collisionObject=gs;gE.body=null;if(!gO||gO(gE)){gR=gE;gX=gE.distance}}}}}else{f2.m43Copy(gB,gz);gE=gC(gD,gz,gN,gI,gP.transform,gX);if(gE){if((gP).collisionObject){gE.collisionObject=gs;gE.body=null}else{gE.collisionObject=null;gE.body=gs}if(!gO||gO(gE)){gR=gE;gX=gE.distance}}}if(gX<0.0001){for(gW=gY;gW<gG;gW+=1){gQ[gW]=undefined}break}}if(gR){delete gR.distance}return gR};gq.prototype.addBody=function(gr){if(gr.world){return false}gr.world=this;if(gr.collisionObject&&!gr.kinematic){this.collisionObjects.push(gr);this.syncBody(gr);return true}if(gr.kinematic){this.kinematicBodies.push(gr)}else{this.rigidBodies.push(gr)}var gs=!gr.active;gr.previouslyActive=true;gr.active=false;gr.islandRoot=gr;
gr.islandRank=0;if(!gs){this.wakeBody(gr)}else{this.syncBody(gr)}return true};gq.prototype.removeBody=function(gr){if(gr.world!==this){return false}var gu,gw;if(gr.collisionObject&&!gr.kinematic){gu=this.collisionObjects}else{if(gr.kinematic){gu=this.kinematicBodies;gw=this.activeKinematics}else{gu=this.rigidBodies;gw=this.activeBodies}}gr.world=null;gu[gu.indexOf(gr)]=gu[gu.length-1];gu.pop();if(gw&&gr.active){gw[gw.indexOf(gr)]=gw[gw.length-1];gw.pop();this.dynamicSpatialMap.remove(gr)}else{this.staticSpatialMap.remove(gr)}this.removeArbitersFromObject(gr);this.removeFromContactCallbacks(gr);var gt=gr.island;if(gt){var gs=gt.bodies;var gv=gs.indexOf(gr);if(gv!==-1){gs[gv]=gs[gs.length-1];gs.pop()}gr.island=null}return true};gq.prototype.addConstraint=function(gs){if(gs.world){return false}gs.world=this;this.constraints.push(gs);if(gs.bodyA){gs.bodyA.constraints.push(gs)}if(gs.bodyB){gs.bodyB.constraints.push(gs)}var gr=!gs.active;gs.active=false;gs.islandRoot=gs;gs.islandRank=0;if(!gr){this.wakeConstraint(gs)
}return true};gq.prototype.removeConstraint=function(gt){if(gt.world!==this){return false}gt.world=null;var gs=this.constraints;gs[gs.indexOf(gt)]=gs[gs.length-1];gs.pop();if(gt.bodyA){gs=gt.bodyA.constraints;gs[gs.indexOf(gt)]=gs[gs.length-1];gs.pop()}if(gt.bodyB){gs=gt.bodyA.constraints;gs[gs.indexOf(gt)]=gs[gs.length-1];gs.pop()}if(gt.active){gs=this.activeConstraints;gs[gs.indexOf(gt)]=gs[gs.length-1];gs.pop()}var gr=gt.island;if(gr){var gv=gr.constraints;var gu=gv.indexOf(gt);if(gu!==-1){gv[gu]=gv[gv.length-1];gv.pop()}gt.island=null}return true};gq.prototype.flush=function(){while(this.rigidBodies.length>0){this.removeBody(this.rigidBodies[0])}while(this.collisionObjects.length>0){this.removeBody(this.collisionObjects[0])}while(this.kinematicBodies.length>0){this.removeBody(this.kinematicBodies[0])}while(this.constraints.length>0){this.removeConstraint(this.constraints[0])}this.timeStamp=0};gq.prototype.removeArbitersFromObject=function(gt){var gu=gt.arbiters;var gs=this.activeArbiters;
while(gu.length>0){var gv=gu.pop();var gw=(gv.objectA===gt)?gv.objectB.arbiters:gv.objectA.arbiters;gw[gw.indexOf(gv)]=gw[gw.length-1];gw.pop();if(gv.active){gs[gs.indexOf(gv)]=gs[gs.length-1];gs.pop()}while(gv.contacts.length>0){var gr=gv.contacts.pop();fY.deallocate(gr)}bf.deallocate(gv)}};gq.prototype.removeFromContactCallbacks=function(gs){var gr=this.contactCallbackObjects;var gt=gr.length;var gu;for(gu=0;gu<gt;gu+=1){if(gr[gu]===gs){gt-=1;if(gu<gt){gr[gu]=gr[gt]}gr.length=gt;break}}gs.addedToContactCallbacks=false};gq.prototype.updateContactCallbacks=function(){var gF=this.contactCallbackObjects;var gG=gF.length;var gA=fY.publicContacts;var gx=fY.callbackContacts;var gH,gv,gt,gs,gr;var gz=0;while(gz<gG){var gI=gF[gz];var gE=gI.arbiters;var gw=gE.length;if(0===gw){gI.contactCallbacks.added=false;gG-=1;if(gz<gG){gF[gz]=gF[gG]}gF.length=gG}else{var gD,gB;for(gD=0;gD<gw;gD+=1){gH=gE[gD];if(0!==gH.contactFlags){var gu=gH.contacts;var gJ=gu.length;while(gA.length<gJ){gA[gA.length]=aF.create()
}gx.length=gJ;for(gB=0;gB<gJ;gB+=1){var gC=gA[gB];gC._private=gu[gB];gx[gB]=gC}gv=gH.objectA;gt=gH.objectB;gs=gv.contactCallbacks;gr=gt.contactCallbacks;if(gH.contactFlags&1){if(null!==gs&&gs.onAddedContacts){gs.onAddedContacts(gv._public,gt._public,gx)}if(null!==gr&&gr.onAddedContacts){gr.onAddedContacts(gv._public,gt._public,gx)}}if(gH.contactFlags&2){if(null!==gs&&gs.onProcessedContacts){gs.onProcessedContacts(gv._public,gt._public,gx)}if(null!==gr&&gr.onProcessedContacts){gr.onProcessedContacts(gv._public,gt._public,gx)}}if(gH.contactFlags&4){if(null!==gs&&gs.onRemovedContacts){gs.onRemovedContacts(gv._public,gt._public,gx)}if(null!==gr&&gr.onRemovedContacts){gr.onRemovedContacts(gv._public,gt._public,gx)}}gH.contactFlags=0;for(gB=0;gB<gJ;gB+=1){gu[gB][51]=0}}}gz+=1}}var gy=this.contactCallbackRemovedArbiters;gG=gy.length;gx.length=0;for(gz=0;gz<gG;gz+=1){gH=gy[gz];gv=gH.objectA;gt=gH.objectB;gs=gv.contactCallbacks;gr=gt.contactCallbacks;if(null!==gs&&gs.onRemovedContacts){gs.onRemovedContacts(gv._public,gt._public,gx)
}if(null!==gr&&gr.onRemovedContacts){gr.onRemovedContacts(gv._public,gt._public,gx)}bf.deallocate(gH)}gy.length=0};gq.version=1;return gq})();var dq=(function(){function gq(){this.vendor="Turbulenz";this.genObjectId=0}gq.create=function(){return new gq()};gq.prototype.createDynamicsWorld=function(gr){return fe.create(gr)};gq.prototype.createPlaneShape=function(gr){return e5.create(gr)};gq.prototype.createBoxShape=function(gr){return cs.create(gr)};gq.prototype.createSphereShape=function(gr){return d.create(gr)};gq.prototype.createCapsuleShape=function(gr){return aZ.create(gr)};gq.prototype.createCylinderShape=function(gr){return f8.create(gr)};gq.prototype.createConeShape=function(gr){return S.create(gr)};gq.prototype.createTriangleMeshShape=function(gr){return aT.create(gr)};gq.prototype.createConvexHullShape=function(gr){return bg.create(gr)};gq.prototype.createTriangleArray=function(gr){return e2.create(gr)};gq.prototype.createCollisionObject=function(gr){return et.create(gr)};gq.prototype.createRigidBody=function(gr){return a1.create(gr)
};gq.prototype.createPoint2PointConstraint=function(gr){return Q.create(gr)};gq.prototype.createHingeConstraint=function(gr){return(dW.create("HINGE",gr))};gq.prototype.createConeTwistConstraint=function(gr){return(dW.create("CONETWIST",gr))};gq.prototype.create6DOFConstraint=function(gr){return(dW.create("D6",gr))};gq.prototype.createSliderConstraint=function(gr){return(dW.create("SLIDER",gr))};gq.prototype.createCharacter=function(gr){return dP.create(gr)};gq.version=1;return gq})();dq.prototype.FILTER_DYNAMIC=1;dq.prototype.FILTER_STATIC=2;dq.prototype.FILTER_KINEMATIC=4;dq.prototype.FILTER_DEBRIS=8;dq.prototype.FILTER_TRIGGER=16;dq.prototype.FILTER_CHARACTER=32;dq.prototype.FILTER_PROJECTILE=64;dq.prototype.FILTER_USER_MIN=128;dq.prototype.FILTER_USER_MAX=32768;dq.prototype.FILTER_ALL=65535;var bM=(function(){function gq(){}gq.prototype.destroy=function(){var gr=this.audioContext;if(gr){delete this.audioContext;delete this.buffer}else{delete this.audio}};gq.create=function(gr,gN){var gB=new gq();
var gu=gN.src;gB.name=(gN.name||gu);gB.frequency=0;gB.channels=0;gB.bitrate=0;gB.length=0;gB.compressed=(!gN.uncompress);var gL=gN.onload;var gQ,gJ,gO,gA;var gE=gr.audioContext;if(gE){gB.audioContext=gE;var gF;if(gu){if(!gr.isResourceSupported(gu)){if(gL){gL(null)}return null}var gt=function gD(gT){if(gT){gB.buffer=gT;gB.frequency=gT.sampleRate;gB.channels=gT.numberOfChannels;gB.bitrate=(gB.frequency*gB.channels*2*8);gB.length=gT.duration;if(gL){gL(gB,200)}}else{if(gL){gL(null)}}};var gs=function gx(){if(gL){gL(null)}};gQ=gN.data;if(gQ){if(gE.decodeAudioData){gE.decodeAudioData(gQ,gt,gs)}else{gF=gE.createBuffer(gQ,false);gt(gF)}}else{var gy;if(window.XMLHttpRequest){gy=new window.XMLHttpRequest()}else{if(window.ActiveXObject){gy=new window.ActiveXObject("Microsoft.XMLHTTP")}else{if(gL){gL(null)}return null}}gy.onreadystatechange=function(){if(gy.readyState===4){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){var gW=gy.status;var gU=(gW!==0&&gy.statusText||"No connection");var gV=gy.response;
if(gy.getAllResponseHeaders()===""&&!gV){if(gL){gL(null,0)}}else{if(gW===200||gW===0){if(gE.decodeAudioData){gE.decodeAudioData(gV,gt,gs)}else{var gT=gE.createBuffer(gV,false);gt(gT)}}else{if(gL){gL(null,gW)}}}}gy.onreadystatechange=null;gy=null}};gy.open("GET",gu,true);gy.responseType="arraybuffer";gy.setRequestHeader("Content-Type","text/plain");gy.send(null)}return gB}else{gQ=gN.data;if(gQ){gJ=gQ.length;gO=(gN.channels||1);gA=gN.frequency;var gK=Math.min(gE.sampleRate,96000);var gM,gS,gH,gG;if(gK===gA){gF=gE.createBuffer(gO,(gJ/gO),gA);for(gM=0;gM<gO;gM+=1){gS=gF.getChannelData(gM);for(gH=gM,gG=0;gH<gJ;gH+=gO,gG+=1){gS[gG]=gQ[gH]}}}else{var gw=(gA/gK);var gv=((gJ/(gw*gO))|0);gF=gE.createBuffer(gO,gv,gK);for(gM=0;gM<gO;gM+=1){gS=gF.getChannelData(gM);for(gG=0;gG<gv;gG+=1){gS[gG]=gQ[gM+(((gG*gw)|0)*gO)]}}}if(gF){gB.buffer=gF;gB.frequency=gA;gB.channels=gO;gB.bitrate=(gA*gO*2*8);gB.length=(gJ/(gA*gO));if(gL){gL(gB,200)}return gB}}}}else{var gP;if(gu){var gz=gu.slice(-3);gQ=gN.data;if(gQ){var gR;
if(gQ instanceof Uint8Array){gR=gQ}else{gR=new Uint8Array(gQ)}if(gR[0]===79&&gR[1]===103&&gR[2]===103&&gR[3]===83){gz="ogg";gu="data:audio/ogg;base64,"}else{if(gR[0]===82&&gR[1]===73&&gR[2]===70&&gR[3]===70){gz="wav";gu="data:audio/wav;base64,"}else{gz="mp3";gu="data:audio/mpeg;base64,"}}gu=gu+(TurbulenzEngine).base64Encode(gR)}if(!gr.supportedExtensions[gz]){if(gL){gL(null)}return null}gP=new Audio();gP.preload="auto";gP.autobuffer=true;gP.src=gu;gP.onerror=function gI(){if(gL){gL(null);gL=null}};gr.addLoadingSound(function gC(){if(3<=gP.readyState){gB.frequency=(gP.sampleRate||gP.mozSampleRate);gB.channels=(gP.channels||gP.mozChannels);gB.bitrate=(gB.frequency*gB.channels*2*8);gB.length=gP.duration;if(gP.buffered&&gP.buffered.length&&0<gP.buffered.end(0)){if(isNaN(gB.length)||gB.length===Number.POSITIVE_INFINITY){gB.length=gP.buffered.end(0)}if(gL){gL(gB,200);gL=null}}else{var gT=function gU(){gP.pause();gP.removeEventListener("play",gT,false);if(gL){gL(gB,200);gL=null}};gP.addEventListener("play",gT,false);
gP.volume=0;gP.play()}return true}return false});gB.audio=gP;return gB}else{gQ=gN.data;if(gQ){gP=new Audio();if(gP.mozSetup){gJ=gQ.length;gO=(gN.channels||1);gA=gN.frequency;gP.mozSetup(gO,gA);gB.data=gQ;gB.frequency=gA;gB.channels=gO;gB.bitrate=(gA*gO*2*8);gB.length=(gJ/(gA*gO));gB.audio=gP;if(gL){gL(gB,200)}return gB}else{gP=null}}}}if(gL){gL(null)}return null};gq.version=1;return gq})();var bm=(function(){function gq(){}gq.prototype.play=function(gw,gt){var gx=this.audioContext;if(gx){var gs=this.bufferNode;if(this.sound!==gw){if(gs){gs.stop(0)}}else{if(gs){return this.seek(gt)}}gs=this.createBufferNode(gw);this.sound=gw;if(!this.playing){this.playing=true;this.paused=false;this.sd.addPlayingSource(this)}if(gt===undefined){gt=0}if(0<gt){var gr=(gw).buffer;if(gs.loop){gs.start(0,gt,gr.duration)}else{gs.start(0,gt,(gr.duration-gt))}this.playStart=(gx.currentTime-gt)}else{gs.start(0);this.playStart=gx.currentTime}}else{var gu;if(this.sound!==gw){this.stop();if((gw).data){gu=new Audio();
gu.mozSetup(gw.channels,gw.frequency)}else{gu=(gw).audio.cloneNode(true)}this.sound=gw;this.audio=gu;gu.loop=this.looping;gu.addEventListener("ended",this.loopAudio,false)}else{if(this.playing&&!this.paused){if(this.looping){return true}}gu=this.audio}if(!this.playing){this.playing=true;this.paused=false;this.sd.addPlayingSource(this)}if(gt===undefined){gt=0}if(0.05<Math.abs(gu.currentTime-gt)){try{gu.currentTime=gt}catch(gv){}}if((gw).data){gu.mozWriteAudio((gw).data)}else{gu.play()}}return true};gq.prototype.stop=function(){var gs=this.playing;if(gs){this.playing=false;this.paused=false;var gu=this.audioContext;if(gu){this.sound=null;var gr=this.bufferNode;if(gr){gr.stop(0);gr.disconnect();this.bufferNode=null}}else{var gt=this.audio;if(gt){this.sound=null;this.audio=null;gt.pause();gt.removeEventListener("ended",this.loopAudio,false);gt=null}}this.sd.removePlayingSource(this)}return gs};gq.prototype.pause=function(){if(this.playing){if(!this.paused){this.paused=true;var gr=this.audioContext;
if(gr){this.playPaused=gr.currentTime;this.bufferNode.stop(0);this.bufferNode.disconnect();this.bufferNode=null}else{this.audio.pause()}this.sd.removePlayingSource(this)}return true}return false};gq.prototype.resume=function(gt){if(this.paused){this.paused=false;var gw=this.audioContext;if(gw){if(gt===undefined){gt=(this.playPaused-this.playStart)}var gs=this.createBufferNode(this.sound);if(0<gt){var gr=this.sound.buffer;if(gs.loop){gs.start(0,gt,gr.duration)}else{gs.start(0,gt,(gr.duration-gt))}this.playStart=(gw.currentTime-gt)}else{gs.start(0);this.playStart=gw.currentTime}}else{var gu=this.audio;if(gt!==undefined){if(0.05<Math.abs(gu.currentTime-gt)){try{gu.currentTime=gt}catch(gv){}}}gu.play()}this.sd.addPlayingSource(this);return true}return false};gq.prototype.rewind=function(){if(this.playing){var gt=this.audioContext;if(gt){var gr=this.bufferNode;if(gr){gr.stop(0)}gr=this.createBufferNode(this.sound);gr.start(0);this.playStart=gt.currentTime;return true}else{var gs=this.audio;if(gs){gs.currentTime=0;
return true}}}return false};gq.prototype.seek=function(gt){if(this.playing){var gw=this.audioContext;if(gw){if(0.05<Math.abs((gw.currentTime-this.playStart)-gt)){var gs=this.bufferNode;if(gs){gs.stop(0)}gs=this.createBufferNode(this.sound);if(0<gt){var gr=this.sound.buffer;if(gs.loop){gs.start(0,gt,gr.duration)}else{gs.start(0,gt,(gr.duration-gt))}this.playStart=(gw.currentTime-gt)}else{gs.start(0);this.playStart=gw.currentTime}}return true}else{var gu=this.audio;if(gu){if(gu.currentTime>gt){try{gu.currentTime=gt}catch(gv){}}return true}}}return false};gq.prototype.clear=function(){this.stop()};gq.prototype.setAuxiliarySendFilter=function(gr,gt,gs){return false};gq.prototype.setDirectFilter=function(gr){return false};gq.prototype.destroy=function(){this.stop();var gs=this.audioContext;if(gs){var gr=this.pannerNode;if(gr){gr.disconnect();delete this.pannerNode}delete this.audioContext}};gq.create=function(gE,gO,gt){var gF=new gq();gF.sd=gE;gF.id=gO;gF.sound=null;gF.playing=false;gF.paused=false;
var gM=(typeof gt.gain==="number"?gt.gain:1);var gs=(gt.looping||false);var gL=(gt.pitch||1);var gR,gx,gw;var gG=gE.audioContext;if(gG){gF.audioContext=gG;gF.bufferNode=null;gF.playStart=-1;gF.playPaused=-1;var g1=gE.gainNode;var gX=gG.createPanner();gF.pannerNode=gX;gX.connect(g1);var gY=(gG.createGain?gG.createGain():gG.createGainNode());gF.gainNode=gY;if(gE.linearDistance){if(typeof gX.distanceModel==="string"){gX.distanceModel="linear"}else{if(typeof gX.LINEAR_DISTANCE==="number"){gX.distanceModel=gX.LINEAR_DISTANCE}}}if(typeof gX.panningModel==="string"){gX.panningModel="equalpower"}else{gX.panningModel=gX.EQUALPOWER}Object.defineProperty(gF,"position",{get:function gD(){return gR.slice()},set:function gU(g2){gR=f2.v3Copy(g2,gR);if(!gF.relative){this.pannerNode.setPosition(g2[0],g2[1],g2[2])}},enumerable:true,configurable:false});Object.defineProperty(gF,"direction",{get:function gJ(){return gx.slice()},set:function gB(g2){gx=f2.v3Copy(g2,gx);this.pannerNode.setOrientation(g2[0],g2[1],g2[2])
},enumerable:true,configurable:false});Object.defineProperty(gF,"velocity",{get:function gW(){return gw.slice()},set:function gz(g2){gw=f2.v3Copy(g2,gw);this.pannerNode.setVelocity(g2[0],g2[1],g2[2])},enumerable:true,configurable:false});Object.defineProperty(gF,"gain",{get:function gI(){return gM},set:function gN(g2){gM=g2;this.gainNode.gain.value=g2},enumerable:true,configurable:false});gF.createBufferNode=function gQ(g6){var g5=g6.buffer;var g4=gG.createBufferSource();g4.buffer=g5;g4.loop=gs;if(g4.playbackRate){g4.playbackRate.value=gL}g4.connect(gY);gY.disconnect();if(1<g6.channels){gY.connect(g1)}else{gY.connect(gX)}if(!g4.start){g4.start=function g3(g7,g9,g8){if(arguments.length<=1){this.noteOn(g7)}else{this.noteGrainOn(g7,g9,g8)}}}if(!g4.stop){g4.stop=function g2(g7){this.noteOff(g7)}}this.bufferNode=g4;return g4};gF.updateRelativePosition=function g0(g4,g3,g2){if(1>=this.sound.channels){gX.setPosition(gR[0]+g4,gR[1]+g3,gR[2]+g2)}};Object.defineProperty(gF,"looping",{get:function gA(){return gs
},set:function gV(g3){gs=g3;var g2=this.bufferNode;if(g2){g2.loop=g3}},enumerable:true,configurable:false});Object.defineProperty(gF,"pitch",{get:function gT(){return gL},set:function gy(g3){gL=g3;var g2=this.bufferNode;if(g2){if(g2.playbackRate){g2.playbackRate.value=g3}}},enumerable:true,configurable:false});Object.defineProperty(gF,"tell",{get:function gu(){if(this.playing){if(this.paused){return(this.playPaused-this.playStart)}else{return(gG.currentTime-this.playStart)}}else{return 0}},enumerable:true,configurable:false});Object.defineProperty(gF,"minDistance",{get:function gZ(){return gX.refDistance},set:function gH(g2){if(this.pannerNode.maxDistance===g2){g2=this.pannerNode.maxDistance*0.999}this.pannerNode.refDistance=g2},enumerable:true,configurable:false});Object.defineProperty(gF,"maxDistance",{get:function gv(){return gX.maxDistance},set:function gK(g2){if(this.pannerNode.refDistance===g2){g2=this.pannerNode.refDistance*1.001}this.pannerNode.maxDistance=g2},enumerable:true,configurable:false});
Object.defineProperty(gF,"rollOff",{get:function gS(){return gX.rolloffFactor},set:function gr(g2){this.pannerNode.rolloffFactor=g2},enumerable:true,configurable:false})}else{gF.audio=null;gF.gainFactor=1;gF.pitch=gL;gF.updateAudioVolume=function gC(){var g3=this.audio;if(g3){var g2=Math.min((this.gainFactor*gM),1);g3.volume=g2;if(0>=g2){g3.muted=true}else{g3.muted=false}}};Object.defineProperty(gF,"position",{get:function gD(){return gR.slice()},set:function gU(g2){gR=f2.v3Copy(g2,gR)},enumerable:true,configurable:false});Object.defineProperty(gF,"direction",{get:function gJ(){return gx.slice()},set:function gB(g2){gx=f2.v3Copy(g2,gx)},enumerable:true,configurable:false});Object.defineProperty(gF,"velocity",{get:function gW(){return gw.slice()},set:function gz(g2){gw=f2.v3Copy(g2,gw)},enumerable:true,configurable:false});Object.defineProperty(gF,"gain",{get:function gI(){return gM},set:function gN(g2){gM=g2;gF.gainFactor=-1},enumerable:true,configurable:false});if(gE.loopingSupported){Object.defineProperty(gF,"looping",{get:function gA(){return gs
},set:function gV(g3){gs=g3;var g2=gF.audio;if(g2){g2.loop=g3}},enumerable:true,configurable:false});gF.loopAudio=function gP(){var g2=gF.audio;if(g2){gF.playing=false;gF.sd.removePlayingSource(gF)}}}else{gF.looping=gs;gF.loopAudio=function gP(){var g2=gF.audio;if(g2){if(gF.looping){g2.currentTime=0;g2.play()}else{gF.playing=false;gF.sd.removePlayingSource(gF)}}}}Object.defineProperty(gF,"tell",{get:function gu(){var g2=gF.audio;if(g2){return g2.currentTime}else{return 0}},enumerable:true,configurable:false});gF.updateRelativePosition=function g0(g9,g7,g3){var he=this.minDistance;var g6=this.maxDistance;var hc=gR[0];var hb=gR[1];var ha=gR[2];var hd;if(this.relative){hd=((hc*hc)+(hb*hb)+(ha*ha))}else{var g8=(g9-hc);var g5=(g7-hb);var g2=(g3-ha);hd=((g8*g8)+(g5*g5)+(g2*g2))}var hf;if(hd<=(he*he)){hf=1}else{if(hd>=(g6*g6)){hf=0}else{var g4=Math.sqrt(hd);if(this.sd.linearDistance){hf=((g6-g4)/(g6-he))}else{hf=he/(he+(this.rollOff*(g4-he)))}}}hf*=this.sd.listenerGain;if(this.gainFactor!==hf){this.gainFactor=hf;
this.updateAudioVolume()}}}gF.relative=gt.relative;gF.position=(gt.position||f2.v3BuildZero());gF.direction=(gt.direction||f2.v3BuildZero());gF.velocity=(gt.velocity||f2.v3BuildZero());gF.minDistance=(gt.minDistance||1);gF.maxDistance=(gt.maxDistance||3.402823466e+38);gF.rollOff=(gt.rollOff||1);return gF};gq.version=1;return gq})();var c4=(function(){function gq(){}gq.prototype.createSource=function(gr){this.lastSourceID+=1;return bm.create(this,this.lastSourceID,gr)};gq.prototype.createSound=function(gr){return bM.create(this,gr)};gq.prototype.loadSoundsArchive=function(gv){var gu=gv.src;if(typeof bT!=="undefined"){bT.create({sd:this,src:gu,uncompress:gv.uncompress,onsoundload:function gs(gw){gv.onsoundload(gw)},onload:function gr(gx,gw){if(gv.onload){gv.onload(gx,gw)}},onerror:function gt(gw){if(gv.onload){gv.onload(false,gw)}}});return true}else{(TurbulenzEngine).callOnError("Missing archive loader required for "+gu);return false}};gq.prototype.createEffect=function(gr){return null};
gq.prototype.createEffectSlot=function(gr){return null};gq.prototype.createFilter=function(gr){return null};gq.prototype.update=function(){var gt=this.listenerTransform;var gv=gt[9];var gs=gt[10];var gr=gt[11];var gu=this.playingSources;var gx;for(gx in gu){if(gu.hasOwnProperty(gx)){var gw=gu[gx];gw.updateRelativePosition(gv,gs,gr)}}};gq.prototype.isSupported=function(gr){if("FILEFORMAT_OGG"===gr){return this.supportedExtensions.ogg}else{if("FILEFORMAT_MP3"===gr){return this.supportedExtensions.mp3}else{if("FILEFORMAT_WAV"===gr){return this.supportedExtensions.wav}}}return false};gq.prototype.addLoadingSound=function(gr){var gt=this.loadingSounds;gt[gt.length]=gr;var gv=this.loadingInterval;var gu=this;if(gv===null){this.loadingInterval=gv=window.setInterval(function gs(){var gw=gt.length;var gy=0;do{var gx=gt[gy];if(gx()){gw-=1;if(gy<gw){gt[gy]=gt[gw]}gt.length=gw}else{gy+=1}}while(gy<gw);if(gw===0){window.clearInterval(gv);gu.loadingInterval=null}},100)}};gq.prototype.addPlayingSource=function(gr){this.playingSources[gr.id]=gr
};gq.prototype.removePlayingSource=function(gr){delete this.playingSources[gr.id]};gq.prototype.isResourceSupported=function(gr){var gs=gr.slice(-3).toLowerCase();return this.supportedExtensions[gs]};gq.prototype.destroy=function(){var gt=this.loadingInterval;if(gt!==null){window.clearInterval(gt);this.loadingInterval=null}var gr=this.loadingSounds;if(gr){gr.length=0;this.loadingSounds=null}var gs=this.playingSources;var gv;if(gs){for(gv in gs){if(gs.hasOwnProperty(gv)){var gu=gs[gv];if(gu){gu.stop()}}}this.playingSources=null}};gq.create=function(gw){var gC=new gq();gC.extensions="";gC.renderer="HTML5 Audio";gC.alcVersion="0";gC.alcExtensions="";gC.alcEfxVersion="0";gC.alcMaxAuxiliarySends=0;gC.deviceSpecifier=(gw.deviceSpecifier||null);gC.frequency=(gw.frequency||44100);gC.dopplerFactor=(gw.dopplerFactor||1);gC.dopplerVelocity=(gw.dopplerVelocity||1);gC.speedOfSound=(gw.speedOfSound||343.29998779296875);gC.linearDistance=(gw.linearDistance!==undefined?gw.linearDistance:true);gC.loadingSounds=[];
gC.loadingInterval=null;gC.playingSources={};gC.lastSourceID=0;var gz=(window.AudioContext||window.webkitAudioContext);if(gz){var gA;try{gA=new gz()}catch(gE){(TurbulenzEngine).callOnError("Failed to create AudioContext:"+gE);return null}if(gA.sampleRate===0){return null}gC.renderer="WebAudio";gC.audioContext=gA;gC.frequency=gA.sampleRate;gC.gainNode=(gA.createGain?gA.createGain():gA.createGainNode());gC.gainNode.connect(gA.destination);var gv=gA.listener;gv.dopplerFactor=gC.dopplerFactor;gv.speedOfSound=gC.speedOfSound;var gF,gD;Object.defineProperty(gC,"listenerTransform",{get:function gu(){return gF.slice()},set:function gs(gK){gF=f2.m43Copy(gK,gF);var gJ=gK[9];var gI=gK[10];var gH=gK[11];gv.setPosition(gJ,gI,gH);gv.setOrientation(-gK[6],-gK[7],-gK[8],gK[3],gK[4],gK[5])},enumerable:true,configurable:false});Object.defineProperty(gC,"listenerVelocity",{get:function gx(){return gD.slice()},set:function gr(gH){gD=f2.v3Copy(gH,gD);gv.setVelocity(gH[0],gH[1],gH[2])},enumerable:true,configurable:false});
gC.update=function gt(){this.gainNode.gain.value=this.listenerGain;var gM=gF[9];var gK=gF[10];var gI=gF[11];var gP=this.playingSources;var gJ=[];var gL;for(gL in gP){if(gP.hasOwnProperty(gL)){var gH=gP[gL];var gO=(gA.currentTime-gH.playStart);if(gH.bufferNode.buffer.duration<gO){if(gH.looping){gH.playStart=(gA.currentTime-(gO-gH.bufferNode.buffer.duration))}else{gH.playing=false;gH.sound=null;gH.bufferNode.disconnect();gH.bufferNode=null;gJ[gJ.length]=gL;continue}}if(gH.relative){gH.updateRelativePosition(gM,gK,gI)}}}var gQ=gJ.length;var gN;for(gN=0;gN<gQ;gN+=1){delete gP[gJ[gN]]}}}gC.listenerTransform=(gw.listenerTransform||f2.m43BuildIdentity());gC.listenerVelocity=(gw.listenerVelocity||f2.v3BuildZero());gC.listenerGain=(typeof gw.listenerGain==="number"?gw.listenerGain:1);var gy=new Audio();if(gC.audioContext){gC.loopingSupported=true}else{if(gy.mozSetup){try{gy.mozSetup(1,22050)}catch(gB){return null}}gC.loopingSupported=(typeof gy.loop==="boolean")}var gG={ogg:false,mp3:false,wav:false};
if(gy.canPlayType("application/ogg")){gG.ogg=true}if(gy.canPlayType("audio/mp3")){gG.mp3=true}if(gy.canPlayType("audio/wav")){gG.wav=true}gC.supportedExtensions=gG;gy=null;return gC};gq.version=1;return gq})();c4.prototype.vendor="Turbulenz";if((typeof ArrayBuffer!=="undefined")&&(ArrayBuffer.prototype!==undefined)&&(ArrayBuffer.prototype.slice===undefined)){ArrayBuffer.prototype.slice=function dr(gq,gs){var gr=this.byteLength;if(gq===undefined){gq=0}else{if(gq<0){gq+=gr}}if(gs===undefined){gs=gr}else{if(gs<0){gs+=gr}}gr=(gs-gq);if(0<gr){var gt=new Uint8Array(this,gq,gr);var gu=new Uint8Array(gt);return gu.buffer}else{return new ArrayBuffer(0)}}}var bT=(function(){function gq(){}gq.prototype.processBytes=function(gF){var gv=0;var gB=gF.length;function gC(gG){gv+=gG}function gs(gG){var gJ=gv;var gI=(gJ+gG);var gM=gF[gJ];var gH;if(gM&&0<gG){gJ+=1;var gK=new Array(gG);var gL=0;do{gK[gL]=gM;gL+=1;gM=gF[gJ];gJ+=1}while(gM&&gL<gG);while(gK[gL-1]===32){gL-=1}gK.length=gL;gH=String.fromCharCode.apply(null,gK)
}else{gH=""}gv=gI;return gH}function gD(gG){gG=gG.replace(/[^\d]/g,"");return parseInt("0"+gG,8)}var gx={fileName:null,length:0,fileType:null,ustarSignature:null,fileNamePrefix:null};function gz(gG){gG.fileName=gs(100);gC(8);gC(8);gC(8);gG.length=gD(gs(12));gC(12);gC(8);gG.fileType=gs(1);gC(100);gG.ustarSignature=gs(6);gC(2);gC(32);gC(32);gC(8);gC(8);gG.fileNamePrefix=gs(155);gv+=12}var gA=this.sd;var gr=this.uncompress;var gw=this.onsoundload;var gE=true;this.soundsLoading=0;var gy=this;function gt(gG){gy.soundsLoading-=1;if(gG){gw(gG)}else{gE=false}}while((gv+512)<=gB){gz(gx);if(0<gx.length){var gu;if(gx.fileName==="././@LongLink"){gu=gs(256);gv+=256;gz(gx)}else{if(gx.fileNamePrefix&&gx.ustarSignature==="ustar"){gu=(gx.fileNamePrefix+gx.fileName)}else{gu=gx.fileName}}if(""===gx.fileType||"0"===gx.fileType){this.soundsLoading+=1;gA.createSound({src:gu,data:(gA.audioContext?gF.buffer.slice(gv,(gv+gx.length)):gF.subarray(gv,(gv+gx.length))),uncompress:gr,onload:gt})}gv+=(Math.floor((gx.length+511)/512)*512)
}}gF=null;return gE};gq.prototype.isValidHeader=function(gr){return true};gq.create=function(gu){var gr=new gq();gr.sd=gu.sd;gr.uncompress=gu.uncompress;gr.onsoundload=gu.onsoundload;gr.onload=gu.onload;gr.onerror=gu.onerror;gr.soundsLoading=0;var gt=gu.src;if(gt){gr.src=gt;var gs;if(window.XMLHttpRequest){gs=new window.XMLHttpRequest()}else{if(window.ActiveXObject){gs=new window.ActiveXObject("Microsoft.XMLHTTP")}else{if(gu.onerror){gu.onerror(0)}return null}}gs.onreadystatechange=function(){if(gs.readyState===4){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){var gz=gs.status;var gw=gs.status!==0&&gs.statusText||"No connection";if(gz===0&&(window.location.protocol==="file:"||window.location.protocol==="chrome-extension:")){gz=200}if(gs.getAllResponseHeaders()===""){var gE;if(gs.responseType==="arraybuffer"){gE=!gs.response}else{if(gs.mozResponseArrayBuffer){gE=!gs.mozResponseArrayBuffer}else{gE=!gs.responseText}}if(gE){if(gr.onerror){gr.onerror(0)}gs.onreadystatechange=null;gs=null;
return}}if(gz===200||gz===0){var gx;if(gs.responseType==="arraybuffer"){gx=gs.response}else{if(gs.mozResponseArrayBuffer){gx=gs.mozResponseArrayBuffer}else{var gD=gs.responseText;var gB=gD.length;var gy;gx=[];gx.length=gB;for(gy=0;gy<gB;gy+=1){gx[gy]=(gD.charCodeAt(gy)&255)}}}var gC=gr.processBytes(new Uint8Array(gx));if(gr.onload){var gv=function gA(){if(0<gr.soundsLoading){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){window.setTimeout(gv,100)}}else{gr.onload(gC,gz)}};gv()}}else{if(gr.onerror){gr.onerror(gz)}}}gs.onreadystatechange=null;gs=null}};gs.open("GET",gu.src,true);if(gs.hasOwnProperty&&gs.hasOwnProperty("responseType")){gs.responseType="arraybuffer"}else{if(gs.overrideMimeType){gs.overrideMimeType("text/plain; charset=x-user-defined")}else{gs.setRequestHeader("Content-Type","text/plain; charset=x-user-defined")}}gs.send(null)}return gr};gq.version=1;return gq})();var b=(function(){function gq(){}gq.prototype.processBytes=function(gF){var gw=0;var gB=gF.length;function gC(gG){gw+=gG
}function gr(gG){var gJ=gw;var gI=(gJ+gG);var gM=gF[gJ];var gH;if(gM&&0<gG){gJ+=1;var gK=new Array(gG);var gL=0;do{gK[gL]=gM;gL+=1;gM=gF[gJ];gJ+=1}while(gM&&gL<gG);while(gK[gL-1]===32){gL-=1}gK.length=gL;gH=String.fromCharCode.apply(null,gK)}else{gH=""}gw=gI;return gH}function gD(gG){gG=gG.replace(/[^\d]/g,"");return parseInt("0"+gG,8)}var gx={fileName:null,length:0,fileType:null,ustarSignature:null,fileNamePrefix:null};function gz(gG){gG.fileName=gr(100);gC(8);gC(8);gC(8);gG.length=gD(gr(12));gC(12);gC(8);gG.fileType=gr(1);gC(100);gG.ustarSignature=gr(6);gC(2);gC(32);gC(32);gC(8);gC(8);gG.fileNamePrefix=gr(155);gw+=12}var gA=this.gd;var gs=this.mipmaps;var gu=this.ontextureload;var gE=true;this.texturesLoading=0;var gy=this;function gt(gG){gy.texturesLoading-=1;if(gG){gu(gG)}else{gw=gB;gE=false}}while((gw+512)<=gB){gz(gx);if(0<gx.length){var gv;if(gx.fileName==="././@LongLink"){gv=gr(256);gw+=256;gz(gx)}else{if(gx.fileNamePrefix&&gx.ustarSignature==="ustar"){gv=(gx.fileNamePrefix+gx.fileName)
}else{gv=gx.fileName}}if(""===gx.fileType||"0"===gx.fileType){this.texturesLoading+=1;gA.createTexture({src:gv,data:gF.subarray(gw,(gw+gx.length)),mipmaps:gs,onload:gt})}gw+=(Math.floor((gx.length+511)/512)*512)}}gF=null;return gE};gq.prototype.isValidHeader=function(){return true};gq.create=function(gu){var gr=new gq();gr.gd=gu.gd;gr.mipmaps=gu.mipmaps;gr.ontextureload=gu.ontextureload;gr.onload=gu.onload;gr.onerror=gu.onerror;gr.texturesLoading=0;var gt=gu.src;if(gt){gr.src=gt;var gs;if(window.XMLHttpRequest){gs=new window.XMLHttpRequest()}else{if(window.ActiveXObject){gs=new window.ActiveXObject("Microsoft.XMLHTTP")}else{if(gu.onerror){gu.onerror(0)}return null}}gs.onreadystatechange=function(){if(gs.readyState===4){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){var gz=gs.status;var gw=gs.status!==0&&gs.statusText||"No connection";if(gz===0&&(window.location.protocol==="file:"||window.location.protocol==="chrome-extension:")){gz=200}if(gs.getAllResponseHeaders()===""){var gD;if(gs.responseType==="arraybuffer"){gD=!gs.response
}else{if(gs.mozResponseArrayBuffer){gD=!gs.mozResponseArrayBuffer}else{gD=!gs.responseText}}if(gD){if(gr.onerror){gr.onerror(0)}gs.onreadystatechange=null;gs=null;return}}if(gz===200||gz===0){var gx;if(gs.responseType==="arraybuffer"){gx=gs.response}else{if(gs.mozResponseArrayBuffer){gx=gs.mozResponseArrayBuffer}else{var gC=gs.responseText;var gB=gC.length;gx=[];gx.length=gB;for(var gy=0;gy<gB;gy+=1){gx[gy]=(gC.charCodeAt(gy)&255)}}}if(gr.processBytes(new Uint8Array(gx))){if(gr.onload){var gv=function gA(){if(0<gr.texturesLoading){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){window.setTimeout(gv,100)}}else{gr.onload(true,gz)}};gv()}}else{if(gr.onerror){gr.onerror(gz)}}}else{if(gr.onerror){gr.onerror(gz)}}}gs.onreadystatechange=null;gs=null}};gs.open("GET",gu.src,true);if(gs.hasOwnProperty&&gs.hasOwnProperty("responseType")){gs.responseType="arraybuffer"}else{if(gs.overrideMimeType){gs.overrideMimeType("text/plain; charset=x-user-defined")}else{gs.setRequestHeader("Content-Type","text/plain; charset=x-user-defined")
}}gs.send(null)}return gr};gq.version=1;return gq})();var cd=(function(){function gq(){}gq.prototype.processBytes=function(gE){var gx=this.parseHeader(gE);if(!this.isValidHeader(gx)){return}var gu=18;this.width=gx.width;this.height=gx.height;this.bytesPerPixel=Math.floor(gx.bpp/8);this.horzRev=(gx.descriptor&this.DESC_HORIZONTAL);this.vertRev=!(gx.descriptor&this.DESC_VERTICAL);var gz=false;var gA=this.gd;switch(gx.imageType){case this.TYPE_MAPPED_RLE:gz=true;if(gx.colorMapSize>24){this.format=gA.PIXELFORMAT_R8G8B8A8}else{if(gx.colorMapSize>16){this.format=gA.PIXELFORMAT_R8G8B8}else{this.format=gA.PIXELFORMAT_R5G5B5A1}}break;case this.TYPE_MAPPED:if(gx.colorMapSize>24){this.format=gA.PIXELFORMAT_R8G8B8A8}else{if(gx.colorMapSize>16){this.format=gA.PIXELFORMAT_R8G8B8}else{this.format=gA.PIXELFORMAT_R5G5B5A1}}break;case this.TYPE_GRAY_RLE:gz=true;this.format=gA.PIXELFORMAT_L8;break;case this.TYPE_GRAY:this.format=gA.PIXELFORMAT_L8;break;case this.TYPE_COLOR_RLE:gz=true;switch(this.bytesPerPixel){case 4:this.format=gA.PIXELFORMAT_R8G8B8A8;
break;case 3:this.format=gA.PIXELFORMAT_R8G8B8;break;case 2:this.format=gA.PIXELFORMAT_R5G5B5A1;break;default:return}break;case this.TYPE_COLOR:switch(this.bytesPerPixel){case 4:this.format=gA.PIXELFORMAT_R8G8B8A8;break;case 3:this.format=gA.PIXELFORMAT_R8G8B8;break;case 2:this.format=gA.PIXELFORMAT_R5G5B5A1;break;default:return}break;default:return}if(gx.idLength){gu+=gx.idLength;if(gu>gE.length){return}}if(this.TYPE_MAPPED_RLE===gx.imageType||this.TYPE_MAPPED===gx.imageType){if(gx.colorMapType!==1){return}}else{if(gx.colorMapType!==0){return}}if(gx.colorMapType===1){var gy=gx.colorMapIndex;var gr=gx.colorMapLength;if(gr===0){return}var gC=Math.floor(gx.colorMapSize/8);var gB=(gr+gy);var gs=[];gs.length=(gB*gC);this.colorMap=gs;this.colorMapBytesPerPixel=gC;var gt;for(gt=0;gt<(gy*gC);gt+=1){gs[gt]=0}for(gt=(gy*gC);gt<(gy*gC);gt+=1,gu+=1){gs[gt]=gE[gu]}gu+=(gr*gC);if(gu>gE.length){return}if(gC>=3){for(gt=(gy*gC);gt<(gr*gC);gt+=gC){var gw=gs[gt];gs[gt]=gs[gt+2];gs[gt+2]=gw}}}var gv=gE.subarray(gu);
gE=null;if(gz){gv=this.expandRLE(gv)}var gD=(this.width*this.height*this.bytesPerPixel);if(gv.length<gD){return}if(this.horzRev){this.flipHorz(gv)}if(this.vertRev){this.flipVert(gv)}if(this.colorMap){gv=this.expandColorMap(gv)}else{if(2<this.bytesPerPixel){this.convertBGR2RGB(gv)}else{if(2===this.bytesPerPixel){gv=this.convertARGB2RGBA(gv)}}}this.data=gv};gq.prototype.parseHeader=function(gr){var gs={idLength:gr[0],colorMapType:gr[1],imageType:gr[2],colorMapIndex:((gr[4]<<8)|gr[3]),colorMapLength:((gr[6]<<8)|gr[5]),colorMapSize:gr[7],xOrigin:((gr[9]<<8)|gr[8]),yOrigin:((gr[11]<<8)|gr[10]),width:((gr[13]<<8)|gr[12]),height:((gr[15]<<8)|gr[14]),bpp:gr[16],descriptor:gr[17]};return gs};gq.prototype.isValidHeader=function(gr){if(this.TYPE_MAPPED_RLE===gr.imageType||this.TYPE_MAPPED===gr.imageType){if(gr.colorMapType!==1){return false}}else{if(gr.colorMapType!==0){return false}}if(gr.colorMapType===1){if(gr.colorMapLength===0){return false}}switch(gr.imageType){case this.TYPE_MAPPED_RLE:case this.TYPE_MAPPED:break;
case this.TYPE_GRAY_RLE:case this.TYPE_GRAY:break;case this.TYPE_COLOR_RLE:case this.TYPE_COLOR:switch(Math.floor(gr.bpp/8)){case 4:case 3:case 2:break;default:return false}break;default:return false}if(16384<gr.width){return false}if(16384<gr.height){return false}return true};gq.prototype.expandRLE=function(gx){var gC=this.bytesPerPixel;var gt=this.width;var gD=this.height;var gA=gC;var gF=(gt*gD*gC);var gw=this.RLE_PACKETSIZE;var gz=new Uint8Array(gF);var gs=0,gB=0,gu,gv;do{var gy=gx[gs];gs+=1;var gE=(((gy&~gw)+1)*gA);if(gy&gw){if(gA===1){var gr=gx[gs];gs+=1;for(gu=0;gu<gE;gu+=1){gz[gB+gv]=gr}}else{for(gu=0;gu<gA;gu+=1){gz[gB+gu]=gx[gs+gu]}gs+=gA;for(gv=gA;gv<gE;gv+=gA){for(gu=0;gu<gA;gu+=1){gz[gB+gv+gu]=gz[gB+gu]}}}}else{for(gu=0;gu<gE;gu+=1){gz[gB+gu]=gx[gs+gu]}gs+=gE}gB+=gE}while(gB<gF);return gz};gq.prototype.expandColorMap=function(gv){var gz=this.bytesPerPixel;var gs=this.width;var gA=this.height;var gB=(gs*gA*gz);var gx=new Uint8Array(gB);var gy=0,gr=0;var gu=this.colorMap;delete this.colorMap;
if(gz===2||gz===3||gz===4){do{var gw=(gv[gr]*gz);gr+=1;for(var gt=0;gt<gz;gt+=1){gx[gy]=gu[gw+gt];gy+=1}}while(gy<gB)}if(gz===2){gx=this.convertARGB2RGBA(gx)}return gx};gq.prototype.flipHorz=function(gx){var gz=this.bytesPerPixel;var gs=this.width;var gA=this.height;var gw=Math.floor(gs/2);var gr=(gs*gz);for(var gy=0;gy<gA;gy+=1){for(var gu=0;gu<gw;gu+=1){for(var gt=0;gt<gz;gt+=1){var gv=gx[gu*gz+gt];gx[gu*gz+gt]=gx[(gs-gu-1)*gz+gt];gx[(gs-gu-1)*gz+gt]=gv}}gx+=gr}};gq.prototype.flipVert=function(gv){var gz=this.bytesPerPixel;var gs=this.width;var gA=this.height;var gy=Math.floor(gA/2);var gr=(gs*gz);for(var gw=0;gw<gy;gw+=1){var gx=(gw*gr);var gB=((gA-gw-1)*gr);for(var gt=0;gt<gr;gt+=1){var gu=gv[gx+gt];gv[gx+gt]=gv[gB+gt];gv[gB+gt]=gu}}};gq.prototype.convertBGR2RGB=function(gw){var gv=this.bytesPerPixel;var gu=this.width;var gr=this.height;var gt=(gu*gr*gv);var gx=0;do{var gs=gw[gx];gw[gx]=gw[gx+2];gw[gx+2]=gs;gx+=gv}while(gx<gt)};gq.prototype.convertARGB2RGBA=function(gv){var gD=this.bytesPerPixel;
if(gD===2){var gt=this.width;var gF=this.height;var gH=(gt*gF*gD);var gz=new Uint16Array(gt*gF);var gs=0,gE=0;var gr,gy,gA,gB;var gG=((1<<5)-1);var gu=gG;var gx=(gG<<5);var gw=(gG<<10);do{var gC=((gs[1]<<8)|gs[0]);gs+=2;gA=(gC&gu)<<1;gy=(gC&gx)<<1;gr=(gC&gw)<<1;gB=(gC>>15);gz[gE]=gr|gy|gA|gB;gE+=1}while(gs<gH);return gz}else{return gv}};gq.create=function(gu){var gr=new gq();gr.gd=gu.gd;gr.onload=gu.onload;gr.onerror=gu.onerror;var gt=gu.src;if(gt){gr.src=gt;var gs;if(window.XMLHttpRequest){gs=new window.XMLHttpRequest()}else{if(window.ActiveXObject){gs=new window.ActiveXObject("Microsoft.XMLHTTP")}else{if(gu.onerror){gu.onerror(0)}return null}}gs.onreadystatechange=function(){if(gs.readyState===4){if(!TurbulenzEngine||!TurbulenzEngine.isUnloading()){var gx=gs.status;var gw=gs.status!==0&&gs.statusText||"No connection";if(gx===0&&(window.location.protocol==="file:"||window.location.protocol==="chrome-extension:")){gx=200}if(gs.getAllResponseHeaders()===""){var gz;if(gs.responseType==="arraybuffer"){gz=!gs.response
}else{if(gs.mozResponseArrayBuffer){gz=!gs.mozResponseArrayBuffer}else{gz=!gs.responseText}}if(gz){if(gr.onerror){gr.onerror(0)}gs.onreadystatechange=null;gs=null;return}}if(gx===200||gx===0){var gv;if(gs.responseType==="arraybuffer"){gv=gs.response}else{if(gs.mozResponseArrayBuffer){gv=gs.mozResponseArrayBuffer}else{var gB=gs.responseText;var gA=gB.length;gv=[];gv.length=gA;for(var gy=0;gy<gA;gy+=1){gv[gy]=(gB.charCodeAt(gy)&255)}}}gr.processBytes(new Uint8Array(gv));if(gr.data){if(gr.onload){gr.onload(gr.data,gr.width,gr.height,gr.format,gx)}}else{if(gr.onerror){gr.onerror(gx)}}}else{if(gr.onerror){gr.onerror(gx)}}}gs.onreadystatechange=null;gs=null}};gs.open("GET",gu.src,true);if(gs.hasOwnProperty&&gs.hasOwnProperty("responseType")){gs.responseType="arraybuffer"}else{if(gs.overrideMimeType){gs.overrideMimeType("text/plain; charset=x-user-defined")}else{gs.setRequestHeader("Content-Type","text/plain; charset=x-user-defined")}}gs.send(null)}else{gr.processBytes(gu.data);if(gr.data){if(gr.onload){gr.onload(gr.data,gr.width,gr.height,gr.format,200)
}}else{if(gr.onerror){gr.onerror(0)}}}return gr};gq.version=1;return gq})();cd.prototype.TYPE_MAPPED=1;cd.prototype.TYPE_COLOR=2;cd.prototype.TYPE_GRAY=3;cd.prototype.TYPE_MAPPED_RLE=9;cd.prototype.TYPE_COLOR_RLE=10;cd.prototype.TYPE_GRAY_RLE=11;cd.prototype.DESC_ABITS=15;cd.prototype.DESC_HORIZONTAL=16;cd.prototype.DESC_VERTICAL=32;cd.prototype.SIGNATURE="TRUEVISION-XFILE";cd.prototype.RLE_PACKETSIZE=128;var ai=(function(){function gq(){}gq.create=function(gr){var gs=new gq();gs.force=gr.force;gs.identifier=gr.identifier;gs.isGameTouch=gr.isGameTouch;gs.positionX=gr.positionX;gs.positionY=gr.positionY;gs.radiusX=gr.radiusX;gs.radiusY=gr.radiusY;gs.rotationAngle=gr.rotationAngle;return gs};return gq})();var cx=(function(){function gq(){}gq.create=function(gs){var gr=new gq();gr.changedTouches=gs.changedTouches;gr.gameTouches=gs.gameTouches;gr.touches=gs.touches;return gr};return gq})();var eT=(function(){function gq(){this.version="0.27.0.0"}gq.prototype.setInterval=function(gt,gr){var gs=this;
return window.setInterval(function(){gs.updateTime();gt()},gr)};gq.prototype.clearInterval=function(gr){window.clearInterval(gr)};gq.prototype.createGraphicsDevice=function(gs){if(this.graphicsDevice){this.callOnError("GraphicsDevice already created");return null}else{var gr=d8.create(this.canvas,gs);this.graphicsDevice=gr;return gr}};gq.prototype.createPhysicsDevice=function(gt){if(this.physicsDevice){this.callOnError("PhysicsDevice already created");return null}else{var gs;var gr=this.getPluginObject();if(gr){gs=gr.createPhysicsDevice(gt)}else{gs=dq.create()}this.physicsDevice=gs;return gs}};gq.prototype.createSoundDevice=function(gt){if(this.soundDevice){this.callOnError("SoundDevice already created");return null}else{var gr;var gs=this.getPluginObject();if(gs){gr=gs.createSoundDevice(gt)}else{gr=c4.create(gt)}this.soundDevice=gr;return gr}};gq.prototype.createInputDevice=function(gs){if(this.inputDevice){this.callOnError("InputDevice already created");return null}else{var gr=y.create(this.canvas);
this.inputDevice=gr;return gr}};gq.prototype.createNetworkDevice=function(gs){if(this.networkDevice){throw"NetworkDevice already created"}else{var gr=aa.create(gs);this.networkDevice=gr;return gr}};gq.prototype.createMathDevice=function(gt){try{var gr=new Float32Array([1,2,3]);f2.v3Build.apply(f2,gr);gr[0]=f2.FLOAT_MAX;f2.FLOAT_MAX=gr[0]}catch(gs){}return WebGLMathDevice};gq.prototype.createNativeMathDevice=function(gr){return WebGLMathDevice};gq.prototype.getGraphicsDevice=function(){var gr=this.graphicsDevice;if(gr===null){this.callOnError("GraphicsDevice not created yet.")}return gr};gq.prototype.getPhysicsDevice=function(){return this.physicsDevice};gq.prototype.getSoundDevice=function(){return this.soundDevice};gq.prototype.getInputDevice=function(){return this.inputDevice};gq.prototype.getNetworkDevice=function(){return this.networkDevice};gq.prototype.getMathDevice=function(){return WebGLMathDevice};gq.prototype.getNativeMathDevice=function(){return WebGLMathDevice};gq.prototype.getObjectStats=function(){return null
};gq.prototype.flush=function(){};gq.prototype.run=function(){};gq.prototype.encrypt=function(gr){return gr};gq.prototype.decrypt=function(gr){return gr};gq.prototype.generateSignature=function(gr){return null};gq.prototype.verifySignature=function(gs,gr){return true};gq.prototype.onerror=function(gr){console.error(gr)};gq.prototype.onwarning=function(gr){console.warn(gr)};gq.prototype.onperformancewarning=function(gr){};gq.prototype.getSystemInfo=function(){return this.systemInfo};gq.prototype.request=function(gs,gw){var gt=this;var gv;if(window.XMLHttpRequest){gv=new window.XMLHttpRequest()}else{if(window.ActiveXObject){gv=new window.ActiveXObject("Microsoft.XMLHTTP")}else{gt.callOnError("No XMLHTTPRequest object could be created");return}}var gu=function gr(){if(gv.readyState===4){if(!gt.isUnloading()){var gy=gv.responseText;var gx=gv.status;if(""===gy){gy=null}if(gx===0&&gy&&window.location.protocol==="file:"){gx=200}else{if(null===gv.getResponseHeader("Content-Type")&&""===gv.getAllResponseHeaders()){gw(null,0);
return}}if(gx!==0){if(404===gx){gy=null}gw(gy,gx)}else{gw(gy,0)}}gv.onreadystatechange=null;gv=null;gw=null}};gv.open("GET",gs,true);if(gw){gv.onreadystatechange=gu}gv.send()};gq.prototype.destroy=function(){if(this.networkDevice){delete this.networkDevice}if(this.inputDevice){this.inputDevice.destroy();delete this.inputDevice}if(this.physicsDevice){delete this.physicsDevice}if(this.soundDevice){if(this.soundDevice.destroy){this.soundDevice.destroy()}delete this.soundDevice}if(this.graphicsDevice){this.graphicsDevice.destroy();delete this.graphicsDevice}if(this.canvas){delete this.canvas}if(this.resizeCanvas){window.removeEventListener("resize",this.resizeCanvas,false)}};gq.prototype.getPluginObject=function(){if(!this.plugin&&this.pluginId){this.plugin=document.getElementById(this.pluginId)}return this.plugin};gq.prototype.unload=function(){if(!this.unloading){this.unloading=true;if(this.onunload){this.onunload()}if(this.destroy){this.destroy()}}};gq.prototype.isUnloading=function(){return this.unloading
};gq.prototype.enableProfiling=function(){};gq.prototype.startProfiling=function(){if(console&&console.profile&&console.profileEnd){console.profile("turbulenz")}};gq.prototype.stopProfiling=function(){var gr;if(console&&console.profile&&console.profileEnd){console.profileEnd();if(console.profiles){gr=console.profiles[console.profiles.length-1]}}return gr};gq.prototype.callOnError=function(gs){var gr=this.onerror;if(gr){gr(gs)}};gq.create=function(gP){var gQ=new gq();var gy=gP.canvas;var gu=gP.fillParent;window.TurbulenzEngineCanvas=gQ;gQ.pluginId=gP.pluginId;gQ.plugin=null;var gM=Date.now;var gD=window.performance;if(gD){if(gD.now){gM=function gH(){return gD.now()}}else{if((gD).webkitNow){gM=function gH(){return(gD).webkitNow()}}}}gQ.getTime=gM;var gJ=gM();var gG=true;var gR=navigator.userAgent;var gx=gR.indexOf("Version/6.0");if(-1!==gx){if(-1!==gR.substring(gx).indexOf("Safari/")){gG=false}}if(gG&&Object.defineProperty){Object.defineProperty(gQ,"time",{get:function(){return((gM()-gJ)*0.001)
},set:function(gV){if(typeof gV==="number"){gJ=(gM()-(gV*1000))}else{gQ.callOnError("Must set 'time' attribute to a number")}},enumerable:false,configurable:false});gQ.updateTime=function(){}}else{gQ.updateTime=function(){this.time=((gM()-gJ)*0.001)}}if(window.postMessage){var gO="0-timeout-message";var gw=[];var gN=0;var gt=function gI(gV){gN+=1;var gW={id:gN,fn:gV};gw.push(gW);window.postMessage(gO,"*");return gW};var gr=function gF(gW){var gY=gW;var gV=gw.length;for(var gX=0;gX<gV;gX+=1){if(gw[gX].id===gY){gw.splice(gX,1);return}}};var gU=function gC(gW){if(gW.source===window&&gW.data===gO){gW.stopPropagation();if(gw.length&&!gQ.isUnloading()){var gX=gw.shift();var gV=gX.fn;gV()}}};window.addEventListener("message",gU,true);gQ.setTimeout=function(gX,gV){if(gV<1){return(gt(gX))}else{var gW=this;return window.setTimeout(function(){gW.updateTime();if(!gW.isUnloading()){gX()}},gV)}};gQ.clearTimeout=function(gV){if(typeof gV==="object"){return gr(gV)}else{return window.clearTimeout(gV)}}}else{gQ.setTimeout=function(gX,gV){var gW=this;
return window.setTimeout(function(){gW.updateTime();if(!gW.isUnloading()){gX()}},gV)};gQ.clearTimeout=function(gV){return window.clearTimeout(gV)}}var gz=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame);if(gz){gQ.setInterval=function(g1,gY){var g0=this;if(Math.abs(gY-(1000/60))<=1){var gV={enabled:true};var gZ=(gM()+16.6);var gX=function gX(){if(gV.enabled){var g2=gM();var g3=(g2-gZ);if(0<=g3){if(g3>50){gZ=(g2+16.6)}else{gZ+=16.6}g0.updateTime();if(!g0.isUnloading()){g1()}}gz(gX,g0.canvas)}};gz(gX,g0.canvas);return gV}else{var gW=function gW(){g0.updateTime();if(!g0.isUnloading()){g1()}};return window.setInterval(gW,gY)}};gQ.clearInterval=function(gV){if(typeof gV==="object"){gV.enabled=false}else{window.clearInterval(gV)}}}gQ.canvas=gy;gQ.networkDevice=null;gQ.inputDevice=null;gQ.physicsDevice=null;gQ.soundDevice=null;gQ.graphicsDevice=null;if(gu){gQ.resizeCanvas=function(){if(document.fullscreenElement===gy||document.mozFullScreenElement===gy||document.webkitFullscreenElement===gy){gy.width=window.innerWidth;
gy.height=window.innerHeight}else{var gV=gy.parentNode;gy.width=gV.clientWidth;gy.height=gV.clientHeight}};gQ.resizeCanvas();window.addEventListener("resize",gQ.resizeCanvas,false)}try{var gB=window.onbeforeunload;window.onbeforeunload=function(){gQ.unload();if(gB){gB.call(this)}}}catch(gL){}gQ.time=0;var gA={architecture:"",cpuDescription:"",cpuVendor:"",numPhysicalCores:1,numLogicalCores:1,ramInMegabytes:0,frequencyInMegaHZ:0,osVersionMajor:0,osVersionMinor:0,osVersionBuild:0,osName:navigator.platform,platformProfile:"desktop",userLocale:(navigator.language||navigator.userLanguage).replace("-","_")};var gv=function gT(){var gV=Math.min(window.screen.height,window.screen.width);return gV<900};var gS=navigator.userAgent;var gE=gS.indexOf("Windows");if(gE!==-1){gA.osName="Windows";if(navigator.platform==="Win64"){gA.architecture="x86_64"}else{if(navigator.platform==="Win32"){gA.architecture="x86"}}gE+=7;if(gS.slice(gE,(gE+4))===" NT "){gE+=4;gA.osVersionMajor=parseInt(gS.slice(gE,(gE+1)),10);
gA.osVersionMinor=parseInt(gS.slice((gE+2),(gE+4)),10)}if(gv()){gA.platformProfile="tablet"}}else{gE=gS.indexOf("Mac OS X");if(gE!==-1){gA.osName="Darwin";if(navigator.platform.indexOf("Intel")!==-1){gA.architecture="x86"}gE+=9;gA.osVersionMajor=parseInt(gS.slice(gE,(gE+2)),10);gA.osVersionMinor=parseInt(gS.slice((gE+3),(gE+4)),10);gA.osVersionBuild=(parseInt(gS.slice((gE+5),(gE+6)),10)||0)}else{gE=gS.indexOf("Linux");if(gE!==-1){gA.osName="Linux";if(navigator.platform.indexOf("64")!==-1){gA.architecture="x86_64"}else{if(navigator.platform.indexOf("x86")!==-1){gA.architecture="x86"}}if(gv()){gA.platformProfile="tablet"}}else{gE=gS.indexOf("Android");if(-1!==gE){gA.osName="Android";if(navigator.platform.indexOf("arm")){gA.architecture="arm"}else{if(navigator.platform.indexOf("x86")){gA.architecture="x86"}}if(-1!==gS.indexOf("Mobile")){gA.platformProfile="smartphone"}else{gA.platformProfile="tablet"}}else{if(-1!==gS.indexOf("iPhone")||-1!==gS.indexOf("iPod")){gA.osName="iOS";gA.architecture="arm";
gA.platformProfile="smartphone"}else{if(-1!==gS.indexOf("iPad")){gA.osName="iOS";gA.architecture="arm";gA.platformProfile="tablet"}}}}}}gQ.systemInfo=gA;var gs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("");gQ.base64Encode=function gK(g6){var gY="";var gV=g6.length;var gW=gs;var gX,g5,g3,g1,g4,g2,g0,gZ;gX=0;while(gX<gV){g5=g6[gX];gX+=1;g4=(g5>>2);if(gX<gV){g3=g6[gX];gX+=1;if(gX<gV){g1=g6[gX];gX+=1;g2=(((g5&3)<<4)|(g3>>4));g0=(((g3&15)<<2)|(g1>>6));gZ=(g1&63)}else{g2=(((g5&3)<<4)|(g3>>4));g0=((g3&15)<<2);gZ=64}}else{g2=((g5&3)<<4);g0=64;gZ=64}gY+=gW[g4];gY+=gW[g2];gY+=gW[g0];gY+=gW[gZ]}return gY};return gQ};return gq})();window.WebGLTurbulenzEngine=eT;var fc=(function(){function gq(){this.viewOffsetX=0;this.viewOffsetY=0;this.recipViewWindowX=1/1;this.recipViewWindowY=1/1;this.infinite=false;this.parallel=false;this.aspectRatio=4/3;this.nearPlane=1;this.farPlane=1000}gq.prototype.lookAt=function(gs,gu,gr){var gy=this.md;var gv=gy.v3Normalize;var gt=gy.v3Cross;
var gw=gy.v3Sub(gr,gs);gv.call(gy,gw,gw);var gz=gt.call(gy,gv.call(gy,gu,gu),gw);gv.call(gy,gz,gz);var gx=gt.call(gy,gw,gz);this.matrix=gy.m43Build(gz,gx,gw,gr,this.matrix)};gq.prototype.updateProjectionMatrix=function(){var gA=this.recipViewWindowX;var gz=this.recipViewWindowY*this.aspectRatio;var gw=gA*this.viewOffsetX;var gt=gz*this.viewOffsetY;var gx=this.farPlane;var gB=this.nearPlane;var gr;if(gx!==gB){gr=(1/(gx-gB))}else{gr=0}var gv,gs,gy,gu;if(this.parallel){gv=-2*gr;gy=(-(gx+gB)*gr);gs=0;gu=1}else{if(this.infinite){gv=-1}else{gv=(-(gx+gB)*gr)}gy=-(2*gx*gB*gr);gs=-1;gu=0}this.projectionMatrix=this.md.m44Build(gA,0,0,0,0,gz,0,0,-gw,-gt,gv,gs,0,0,gy,gu,this.projectionMatrix)};gq.prototype.updateViewMatrix=function(){var gr=this.md;this.viewMatrix=gr.m43InverseOrthonormal(this.matrix,this.viewMatrix)};gq.prototype.updateViewProjectionMatrix=function(){var gr=this.md;this.viewProjectionMatrix=gr.m43MulM44(this.viewMatrix,this.projectionMatrix,this.viewProjectionMatrix)};gq.prototype.extractFrustumPlanes=function(gy,gx){var gK=this.md;
var gu=gy[0];var gt=gy[1];var gs=gy[2];var gr=gy[3];var gL=gy[4];var gJ=gy[5];var gH=gy[6];var gF=gy[7];var gD=gy[8];var gB=gy[9];var gI=gy[10];var gG=gy[11];var gE=gy[12];var gC=gy[13];var gA=gy[14];var gz=gy[15];var gw=(gx||[]);var gv=gK.v4Build((gr+gu),(gF+gL),(gG+gD),-(gz+gE));gw[0]=gK.planeNormalize(gv,gw[0]);gK.v4Build((gr-gu),(gF-gL),(gG-gD),-(gz-gE),gv);gw[1]=gK.planeNormalize(gv,gw[1]);gK.v4Build((gr-gt),(gF-gJ),(gG-gB),-(gz-gC),gv);gw[2]=gK.planeNormalize(gv,gw[2]);gK.v4Build((gr+gt),(gF+gJ),(gG+gB),-(gz+gC),gv);gw[3]=gK.planeNormalize(gv,gw[3]);gK.v4Build((gr+gs),(gF+gH),(gG+gI),-(gz+gA),gv);gw[4]=gK.planeNormalize(gv,gw[4]);gK.v4Build((gr-gs),(gF-gH),(gG-gI),-(gz-gA),gv);gw[5]=gK.planeNormalize(gv,gw[5]);return gw};gq.prototype.updateFrustumPlanes=function(){this.frustumPlanes=this.extractFrustumPlanes(this.viewProjectionMatrix,this.frustumPlanes)};gq.prototype.isVisiblePoint=function(gs){var gr=this.md;return gr.isInsidePlanesPoint(gs,this.frustumPlanes)};gq.prototype.isVisibleSphere=function(gt,gr){var gs=this.md;
return gs.isInsidePlanesSphere(gt,gr,this.frustumPlanes)};gq.prototype.isVisibleBox=function(gt,gr){var gs=this.md;return gs.isInsidePlanesBox(gt,gr,this.frustumPlanes)};gq.prototype.isVisibleAABB=function(gr){var gs=this.md;return gs.aabbIsInsidePlanes(gr,this.frustumPlanes)};gq.prototype.isFullyInsideAABB=function(gr){var gs=this.md;return gs.aabbIsFullyInsidePlanes(gr,this.frustumPlanes)};gq.prototype.getFrustumPoints=function(gv){var gx=this.viewOffsetX;var gw=this.viewOffsetY;var gG=1/this.recipViewWindowX;var gF=1/(this.recipViewWindowY*this.aspectRatio);var gH=this.matrix;var gM=gv||this.farPlane;var gu=this.nearPlane;var gZ=[];if(!this.parallel){var gY=((gH[0]*gx)+(gH[3]*gw));var gX=((gH[1]*gx)+(gH[4]*gw));var gW=((gH[2]*gx)+(gH[5]*gw));var g2=(gH[0]*gG);var g1=(gH[1]*gG);var g0=(gH[2]*gG);var gC=(gH[3]*gF);var gA=(gH[4]*gF);var gz=(gH[5]*gF);var gE=(gY-gH[6]);var gD=(gX-gH[7]);var gB=(gW-gH[8]);var gt=(gH[9]+gY);var gs=(gH[10]+gX);var gr=(gH[11]+gW);var gO=(gE+g2+gC);var gN=(gD+g1+gA);
var gL=(gB+g0+gz);var gK=(gE-g2+gC);var gJ=(gD-g1+gA);var gI=(gB-g0+gz);var gR=(gE-g2-gC);var gQ=(gD-g1-gA);var gP=(gB-g0-gz);var gV=(gE+g2-gC);var gU=(gD+g1-gA);var gT=(gB+g0-gz);gZ[0]=[(gt+(gO*gu)),(gs+(gN*gu)),(gr+(gL*gu))];gZ[4]=[(gt+(gO*gM)),(gs+(gN*gM)),(gr+(gL*gM))];gZ[1]=[(gt+(gK*gu)),(gs+(gJ*gu)),(gr+(gI*gu))];gZ[5]=[(gt+(gK*gM)),(gs+(gJ*gM)),(gr+(gI*gM))];gZ[2]=[(gt+(gR*gu)),(gs+(gQ*gu)),(gr+(gP*gu))];gZ[6]=[(gt+(gR*gM)),(gs+(gQ*gM)),(gr+(gP*gM))];gZ[3]=[(gt+(gV*gu)),(gs+(gU*gu)),(gr+(gT*gu))];gZ[7]=[(gt+(gV*gM)),(gs+(gU*gM)),(gr+(gT*gM))]}else{gZ[0]=[];gZ[4]=[];gZ[1]=[];gZ[5]=[];gZ[2]=[];gZ[6]=[];gZ[3]=[];gZ[7]=[];gZ[0][2]=gu;gZ[1][2]=gu;gZ[2][2]=gu;gZ[3][2]=gu;gZ[4][2]=gM;gZ[5][2]=gM;gZ[6][2]=gM;gZ[7][2]=gM;var gS=(1-gu)*gx;gZ[0][0]=(gG+gS);gZ[1][0]=(gS-gG);gZ[2][0]=(gS-gG);gZ[3][0]=(gG+gS);gS=(1-gM)*gx;gZ[4][0]=(gG+gS);gZ[5][0]=(gS-gG);gZ[6][0]=(gS-gG);gZ[7][0]=(gG+gS);gS=(1-gu)*gw;gZ[0][1]=(gF+gS);gZ[1][1]=(gF+gS);gZ[2][1]=(gS-gF);gZ[3][1]=(gS-gF);gS=(1-gM)*gw;gZ[4][1]=(gF+gS);
gZ[5][1]=(gF+gS);gZ[6][1]=(gS-gF);gZ[7][1]=(gS-gF);var gy=this.md;gZ[0]=gy.m43TransformPoint(gH,gZ[0]);gZ[1]=gy.m43TransformPoint(gH,gZ[1]);gZ[2]=gy.m43TransformPoint(gH,gZ[2]);gZ[3]=gy.m43TransformPoint(gH,gZ[3]);gZ[4]=gy.m43TransformPoint(gH,gZ[4]);gZ[5]=gy.m43TransformPoint(gH,gZ[5]);gZ[6]=gy.m43TransformPoint(gH,gZ[6]);gZ[7]=gy.m43TransformPoint(gH,gZ[7])}return gZ};gq.prototype.getFrustumFarPoints=function(){var gx=this.viewOffsetX;var gw=this.viewOffsetY;var gG=1/this.recipViewWindowX;var gF=1/(this.recipViewWindowY*this.aspectRatio);var gI=this.matrix;var gX=this.farPlane;var ha;if(!this.parallel){var gU=gI[0];var gS=gI[1];var gQ=gI[2];var gO=gI[3];var gN=gI[4];var gM=gI[5];var gL=gI[6];var gK=gI[7];var gJ=gI[8];var gH=gI[9];var gs=gI[10];var gr=gI[11];var g9=((gU*gx)+(gO*gw));var g8=((gS*gx)+(gN*gw));var g7=((gQ*gx)+(gM*gw));var hd=(gU*gG);var hc=(gS*gG);var hb=(gQ*gG);var gC=(gO*gF);var gA=(gN*gF);var gz=(gM*gF);var gE=(g9-gL);var gD=(g8-gK);var gB=(g7-gJ);var gv=(gH+g9);var gu=(gs+g8);
var gt=(gr+g7);var gY=((gE+hd+gC)*gX);var gW=((gD+hc+gA)*gX);var gV=((gB+hb+gz)*gX);var gT=((gE-hd+gC)*gX);var gR=((gD-hc+gA)*gX);var gP=((gB-hb+gz)*gX);var g1=((gE-hd-gC)*gX);var g0=((gD-hc-gA)*gX);var gZ=((gB-hb-gz)*gX);var g6=((gE+hd-gC)*gX);var g5=((gD+hc-gA)*gX);var g4=((gB+hb-gz)*gX);ha=[[(gv+gY),(gu+gW),(gt+gV)],[(gv+gT),(gu+gR),(gt+gP)],[(gv+g1),(gu+g0),(gt+gZ)],[(gv+g6),(gu+g5),(gt+g4)]]}else{var g3=(1-gX)*gx;var g2=(1-gX)*gw;var gy=this.md;ha=[gy.m43TransformPoint(gI,[(gG+g3),(gF+g2),gX]),gy.m43TransformPoint(gI,[(g3-gG),(gF+g2),gX]),gy.m43TransformPoint(gI,[(g3-gG),(g2-gF),gX]),gy.m43TransformPoint(gI,[(gG+g3),(g2-gF),gX])]}return ha};gq.prototype.getFrustumExtents=function(gw,gx){var gB=this.getFrustumPoints(gx);var gs=gB[0];var gr=gs[0];var gE=gs[1];var gD=gs[2];var gy=gr;var gv=gE;var gu=gD;for(var gt=1;gt<8;gt+=1){gs=gB[gt];var gC=gs[0];var gA=gs[1];var gz=gs[2];if(gr>gC){gr=gC}else{if(gy<gC){gy=gC}}if(gE>gA){gE=gA}else{if(gv<gA){gv=gA}}if(gD>gz){gD=gz}else{if(gu<gz){gu=gz
}}}gw[0]=gr;gw[1]=gE;gw[2]=gD;gw[3]=gy;gw[4]=gv;gw[5]=gu};gq.create=function(gr){var gs=new gq();gs.md=gr;gs.matrix=gr.m43BuildIdentity();gs.viewMatrix=gr.m43BuildIdentity();gs.updateProjectionMatrix();gs.viewProjectionMatrix=gs.projectionMatrix.slice();gs.frustumPlanes=[];gs.updateFrustumPlanes();return gs};gq.version=1;return gq})();var fF=(function(){function gq(){this.rotateSpeed=2;this.maxSpeed=1;this.mouseRotateFactor=0.1}gq.prototype.rotate=function(gu,gx){var gv=(Math.PI/180);var gw=this.md;var gr=this.camera.matrix;var gy=gw.m43Pos(gr);gw.m43SetPos(gr,gw.v3BuildZero());var gs;if(gx!==0){gx*=this.rotateSpeed*gv;gx*=this.mouseRotateFactor;var gt=gw.v3Normalize(gw.m43Right(gr));gw.m43SetRight(gr,gt);gs=gw.m43FromAxisRotation(gt,gx);gr=gw.m43Mul(gr,gs)}if(gu!==0){gu*=this.rotateSpeed*gv;gu*=this.mouseRotateFactor;gs=gw.m43FromAxisRotation(gw.v3BuildYAxis(),gu);gr=gw.m43Mul(gr,gs)}gw.m43SetPos(gr,gy);this.camera.matrix=gr};gq.prototype.translate=function(gu,gr,gt){var gw=this.md;var gs=this.camera.matrix;
var gx=gw.m43Pos(gs);var gv=this.maxSpeed;gx=gw.v3Add4(gx,gw.v3ScalarMul(gw.m43Right(gs),(gv*gu)),gw.v3ScalarMul(gw.m43Up(gs),(gv*gr)),gw.v3ScalarMul(gw.m43At(gs),-(gv*gt)));gw.m43SetPos(gs,gx)};gq.prototype.update=function(){var gs=false;if(this.turn!==0||this.pitch!==0){gs=true;this.rotate(this.turn,this.pitch);this.turn=0;this.pitch=0}if(this.step>0){this.forward+=this.step}else{if(this.step<0){this.backward-=this.step}}var gu=((this.right+this.padright)-(this.left+this.padleft));var gr=this.up-this.down;var gt=((this.forward+this.padforward)-(this.backward+this.padbackward));if(gu!==0||gr!==0||gt!==0){gs=true;this.translate(gu,gr,gt);if(this.step>0){this.forward-=this.step;this.step=0}else{if(this.step<0){this.backward+=this.step;this.step=0}}}if(gs){this.camera.updateViewMatrix()}};gq.create=function(gI,gz,gC,gt){var gG=new gq();gG.md=gC.md;gG.camera=gC;gG.turn=0;gG.pitch=0;gG.right=0;gG.left=0;gG.up=0;gG.down=0;gG.forward=0;gG.backward=0;gG.step=0;gG.padright=0;gG.padleft=0;gG.padforward=0;
gG.padbackward=0;gG.looktouch={id:-1,originX:0,originY:0};gG.movetouch={id:-1,originX:0,originY:0};var gH;if(gz){gH=gz.keyCodes}var gs=function(gK){switch(gK){case gH.A:case gH.LEFT:case gH.NUMPAD_4:gG.left=1;break;case gH.D:case gH.RIGHT:case gH.NUMPAD_6:gG.right=1;break;case gH.W:case gH.UP:case gH.NUMPAD_8:gG.forward=1;break;case gH.S:case gH.DOWN:case gH.NUMPAD_2:gG.backward=1;break;case gH.E:case gH.NUMPAD_9:gG.up=1;break;case gH.Q:case gH.NUMPAD_7:gG.down=1;break}};var gD=function(gK){switch(gK){case gH.A:case gH.LEFT:case gH.NUMPAD_4:gG.left=0;break;case gH.D:case gH.RIGHT:case gH.NUMPAD_6:gG.right=0;break;case gH.W:case gH.UP:case gH.NUMPAD_8:gG.forward=0;break;case gH.S:case gH.DOWN:case gH.NUMPAD_2:gG.backward=0;break;case gH.E:case gH.NUMPAD_9:gG.up=0;break;case gH.Q:case gH.NUMPAD_7:gG.down=0;break;case gH.RETURN:gI.fullscreen=!gI.fullscreen;break}};if(gt){gG.onkeydown=function gE(gK){gt.innerHTML+=" KeyDown:&nbsp;"+gK;gs(gK)};gG.onkeyup=function gy(gK){if(gK===gH.BACKSPACE){gt.innerHTML=""
}else{gt.innerHTML+=" KeyUp:&nbsp;"+gK}gD(gK)}}else{gG.onkeydown=gs;gG.onkeyup=gD}gG.onmouseup=function gv(){if(!gz.isLocked()){gz.lockMouse()}};gG.onmousewheel=function gx(gK){gG.step=gK*5};gG.onmousemove=function gu(gL,gK){gG.turn+=gL;gG.pitch+=gK};gG.onpadmove=function gw(gN,gL,gK,gO,gM){gG.turn+=gN*10;gG.pitch+=gL*10;if(gO>=0){gG.padright=gO;gG.padleft=0}else{gG.padright=0;gG.padleft=-gO}if(gM>=0){gG.padforward=gM;gG.padbackward=0}else{gG.padforward=0;gG.padbackward=-gM}};gG.onmouselocklost=function gA(){gz.unlockMouse()};gG.ontouchstart=function gr(gM){var gQ=gM.changedTouches;var gR=gQ.length;var gP;var gO=gI.width*0.5;for(gP=0;gP<gR;gP+=1){var gL=gQ[gP].identifier;var gN=gQ[gP].positionX;var gK=gQ[gP].positionY;if(gN<gO&&gG.looktouch.id===-1){gG.looktouch.id=gL;gG.looktouch.originX=gN;gG.looktouch.originY=gK}else{if(gN>=gO&&gG.movetouch.id===-1){gG.movetouch.id=gL;gG.movetouch.originX=gN;gG.movetouch.originY=gK}}}};gG.ontouchend=function gB(gL){var gN=gL.changedTouches;var gO=gN.length;
var gM;for(gM=0;gM<gO;gM+=1){var gK=gN[gM].identifier;if(gG.looktouch.id===gK){gG.looktouch.id=-1;gG.looktouch.originX=0;gG.looktouch.originY=0;gG.turn=0;gG.pitch=0}else{if(gG.movetouch.id===gK){gG.movetouch.id=-1;gG.movetouch.originX=0;gG.movetouch.originY=0;gG.left=0;gG.right=0;gG.forward=0;gG.backward=0}}}};gG.ontouchmove=function gJ(gM){var gP=gM.changedTouches;var gR=gP.length;var gQ=16;var gO;for(gO=0;gO<gR;gO+=1){var gL=gP[gO].identifier;var gN=gP[gO].positionX;var gK=gP[gO].positionY;if(gG.looktouch.id===gL){if(gN-gG.looktouch.originX>gQ||gN-gG.looktouch.originX<-gQ){gG.turn=(gN-gG.looktouch.originX)/gQ}else{gG.turn=0}if(gK-gG.looktouch.originY>gQ||gK-gG.looktouch.originY<-gQ){gG.pitch=(gK-gG.looktouch.originY)/16}else{gG.pitch=0}}else{if(gG.movetouch.id===gL){if(gN-gG.movetouch.originX>gQ){gG.left=0;gG.right=1}else{if(gN-gG.movetouch.originX<-gQ){gG.left=1;gG.right=0}else{gG.left=0;gG.right=0}}if(gK-gG.movetouch.originY>gQ){gG.forward=0;gG.backward=1}else{if(gK-gG.movetouch.originY<-gQ){gG.forward=1;
gG.backward=0}else{gG.forward=0;gG.backward=0}}}}}};gG.attach=function gF(gK){gK.addEventListener("keydown",gG.onkeydown);gK.addEventListener("keyup",gG.onkeyup);gK.addEventListener("mouseup",gG.onmouseup);gK.addEventListener("mousewheel",gG.onmousewheel);gK.addEventListener("mousemove",gG.onmousemove);gK.addEventListener("padmove",gG.onpadmove);gK.addEventListener("mouselocklost",gG.onmouselocklost);gK.addEventListener("touchstart",gG.ontouchstart);gK.addEventListener("touchend",gG.ontouchend);gK.addEventListener("touchmove",gG.ontouchmove)};if(gz){gG.attach(gz)}return gG};gq.version=1;return gq})();var c={};c.Main=function(){var gy=Date.now(),gx=gy,gD=0,gw=Infinity,gv=0,gC=0,gu=Infinity,gt=0,gs=0,gr=0,gE=document.createElement("div");gE.id="stats";gE.addEventListener("mousedown",function(gJ){gJ.preventDefault();gq(++gr%2)},!1);gE.style.cssText="width:80px;opacity:0.9;cursor:pointer";var gI=document.createElement("div");gI.id="fps";gI.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";
gE.appendChild(gI);var gB=document.createElement("div");gB.id="fpsText";gB.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";gB.innerHTML="FPS";gI.appendChild(gB);var gH=document.createElement("div");gH.id="fpsGraph";gH.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(gI.appendChild(gH);74>gH.children.length;){var gA=document.createElement("span");gA.style.cssText="width:1px;height:30px;float:left;background-color:#113";gH.appendChild(gA)}var gG=document.createElement("div");gG.id="ms";gG.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";gE.appendChild(gG);var gz=document.createElement("div");gz.id="msText";gz.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";gz.innerHTML="MS";gG.appendChild(gz);var gF=document.createElement("div");gF.id="msGraph";gF.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";
for(gG.appendChild(gF);74>gF.children.length;){gA=document.createElement("span"),gA.style.cssText="width:1px;height:30px;float:left;background-color:#131",gF.appendChild(gA)}var gq=function(gJ){gr=gJ;switch(gr){case 0:gI.style.display="block";gG.style.display="none";break;case 1:gI.style.display="none",gG.style.display="block"}};return{REVISION:11,domElement:gE,setMode:gq,begin:function(){gy=Date.now()},end:function(){var gJ=Date.now();gD=gJ-gy;gw=Math.min(gw,gD);gv=Math.max(gv,gD);gz.textContent=gD+" MS ("+gw+"-"+gv+")";var gK=Math.min(30,30-30*(gD/200));gF.appendChild(gF.firstChild).style.height=gK+"px";gs++;gJ>gx+1000&&(gC=Math.round(1000*gs/(gJ-gx)),gu=Math.min(gu,gC),gt=Math.max(gt,gC),gB.textContent=gC+" FPS ("+gu+"-"+gt+")",gK=Math.min(30,30-30*(gC/100)),gH.appendChild(gH.firstChild).style.height=gK+"px",gx=gJ,gs=0);return gJ},update:function(){gy=this.end()}}};var dw=this.__extends||function(gt,gq){for(var gs in gq){if(gq.hasOwnProperty(gs)){gt[gs]=gq[gs]}}function gr(){this.constructor=gt
}gr.prototype=gq.prototype;gt.prototype=new gr()};var l={CONTACT_SLOP:0.01,EFF_MASS_EPSILON:1e-10,ILL_THRESHOLD:100000,CLIP_EPSILON:1.65e-10,BIAS_COEF:0.15,STATIC_BIAS_COEF:0.75,CONT_BIAS_COEF:0.5,CONT_STATIC_BIAS_COEF:0.6,BOUNCE_VELOCITY_THRESHOLD:0.25,STATIC_FRIC_SQ_EPSILON:0.0001,POINT_BIAS_COEF:0.5,POINT_MAX_ERROR:0.2,POINT_MAX_ERROR_SQ:(0.2*0.2),POINT_SLOP_SQ:0.000001,POINT_LARGE_ERROR_SQ:0.01,POINT_LARGE_ERROR_BIAS:0.75,POINT_LARGE_ERROR_MAX:0.4,WELD_BIAS_COEF:0.5,WELD_MAX_LINEAR_ERROR:0.2,WELD_MAX_ANGULAR_ERROR:0.5,WELD_MAX_LINEAR_ERROR_SQ:(0.2*0.2),WELD_LINEAR_SLOP_SQ:0.000001,WELD_ANGULAR_SLOP_SQ:0.000001,WELD_LARGE_ERROR_SQ:0.01,WELD_LARGE_ERROR_BIAS:0.75,WELD_LARGE_ERROR_MAX:0.4,ANGLE_BIAS_COEF:0.5,ANGLE_SLOP_SQ:0.000001,DIST_BIAS_COEF:0.5,DIST_SLOP_SQ:0.000001,DIST_LARGE_ERROR_SQ:0.01,DIST_LARGE_ERROR_BIAS:0.75,LINE_BIAS_COEF:0.8,LINE_SLOP_SQ:0.000001,LINE_LARGE_ERROR_SQ:0.01,LINE_LARGE_ERROR_BIAS:0.9,PULLEY_BIAS_COEF:0.5,PULLEY_SLOP_SQ:0.000001,PULLEY_LARGE_ERROR_SQ:0.01,PULLEY_LARGE_ERROR_BIAS:0.75,MIN_LINEAR_STATIC_SWEEP:0.05,MIN_ANGULAR_STATIC_SWEEP:0.005,MIN_LINEAR_BULLET_SWEEP:0.5,MIN_ANGULAR_BULLET_SWEEP:0.05,SWEEP_LIMIT:0.0005,SWEEP_SLOP:0.05,MINIMUM_SWEEP_ADVANCE:0.000001,MAX_SWEEP_ITER:50,EQUAL_SQ_VEL:0.2,ZERO_ANG_BIAS:0.02,TOI_SLIP_SCALE:0.75,DELAYED_DEATH:30,DELTA_ROTATION_EPSILON:0.0001,SLEEP_DELAY:60,SLEEP_LINEAR_SQ:0.0006,SLEEP_ANGULAR_SQ:0.001,CONTAINS_EPSILON:0.000001,CONTAINS_SQ_EPSILON:1e-12,COLLINEAR_EPSILON:0.00001,COLLINEAR_SQ_EPSILON:(0.00001*0.00001),NORMALIZE_EPSILON:0.000001,NORMALIZE_SQ_EPSILON:(0.000001*0.000001)};
var cu=(function(){function gq(){}gq.prototype.getElasticity=function(){return this._data[(0)]};gq.prototype.getStaticFriction=function(){return this._data[(1)]};gq.prototype.getDynamicFriction=function(){return this._data[(2)]};gq.prototype.getRollingFriction=function(){return this._data[(3)]};gq.prototype.getDensity=function(){return this._data[(4)]};gq.create=function(gx){var gr=new gq();var gv=(gx&&gx.elasticity!==undefined?gx.elasticity:0);var gy=(gx&&gx.staticFriction!==undefined?gx.staticFriction:2);var gt=(gx&&gx.dynamicFriction!==undefined?gx.dynamicFriction:1);var gw=(gx&&gx.rollingFriction!==undefined?gx.rollingFriction:0.005);var gs=(gx&&gx.density!==undefined?gx.density:1);var gu=gr._data=new bZ.prototype.floatArray((5));gu[(0)]=gv;gu[(1)]=gy;gu[(2)]=gt;gu[(3)]=gw;gu[(4)]=gs;gr.userData=(gx&&gx.userData?gx.userData:null);return gr};gq.version=1;return gq})();var eW=(function(){function gq(){}gq.prototype._inWorld=function(){};gq.prototype._outWorld=function(){};gq.prototype._pairExists=function(gs,gr){return false
};gq.prototype._wakeConnected=function(){};gq.prototype._sleepComputation=function(gr){};gq.prototype._preStep=function(gr){return false};gq.prototype._warmStart=function(){};gq.prototype._iterateVel=function(){return false};gq.prototype._iteratePos=function(){return false};gq.prototype.init=function(gr,gt){var gs=gr._data;gs[(0)]=(gt.frequency!==undefined?gt.frequency:10);gs[(1)]=(gt.damping!==undefined?gt.damping:1);gs[(2)]=(gt.maxForce!==undefined?gt.maxForce:Number.POSITIVE_INFINITY);gs[(3)]=(gt.maxError!==undefined?gt.maxError:Number.POSITIVE_INFINITY);gs[(4)]=-1;gr._removeOnBreak=(gt.removeOnBreak!==undefined?gt.removeOnBreak:true);gr._breakUnderError=(gt.breakUnderError!==undefined?gt.breakUnderError:false);gr._breakUnderForce=(gt.breakUnderForce!==undefined?gt.breakUnderForce:false);gr._stiff=(gt.stiff!==undefined?gt.stiff:true);gr._ignoreInteractions=(gt.ignoreInteractions!==undefined?gt.ignoreInteractions:false);gr.sleeping=(gt.sleeping!==undefined?gt.sleeping:false);gr._active=(gt.disabled!==undefined?(!gt.disabled):true);
gr.world=null;gr._islandRoot=null;gr._islandRank=0;gr._island=null;gr._isBody=false;gr._wakeTime=0;gr._onBreak=[];gr._onWake=[];gr._onSleep=[];gr.userData=(gt.userData||null)};gq.prototype.configure=function(gs){var gr=this._data;if(gs.frequency!==undefined){gr[(0)]=gs.frequency}if(gs.damping!==undefined){gr[(1)]=gs.damping}if(gs.maxForce!==undefined){gr[(2)]=gs.maxForce}if(gs.maxError!==undefined){gr[(3)]=gs.maxError}if(gs.removeOnBreak!==undefined){this._removeOnBreak=gs.removeOnBreak}if(gs.breakUnderError!==undefined){this._breakUnderError=gs.breakUnderError}if(gs.breakUnderForce!==undefined){this._breakUnderForce=gs.breakUnderForce}if(gs.ignoreInteractions!==undefined){this._ignoreInteractions=gs.ignoreInteractions}if(gs.stiff!==undefined){this._stiff=gs.stiff}this.wake(true)};gq.prototype.addEventListener=function(gt,gu){var gs=(gt==="wake"?this._onWake:gt==="sleep"?this._onSleep:gt==="break"?this._onBreak:null);if(gs===null){return false}var gr=gs.indexOf(gu);if(gr!==-1){return false
}gs.push(gu);this.wake();return true};gq.prototype.removeEventListener=function(gt,gu){var gs=(gt==="wake"?this._onWake:gt==="sleep"?this._onSleep:gt==="break"?this._onBreak:null);if(gs===null){return false}var gr=gs.indexOf(gu);if(gr===-1){return false}gs.splice(gr,1);this.wake();return true};gq.prototype.wake=function(gr){if(!this.world){this.sleeping=false;return}this.world._wakeConstraint(this,!gr)};gq.prototype.sleep=function(){if(!this.world){this.sleeping=true;return}this.world._forceSleepConstraint(this)};gq.prototype.isEnabled=function(){return this._active};gq.prototype.isDisabled=function(){return(!this._active)};gq.prototype.enable=function(){if(!this._active){this._active=true;if(this.world){this.world._enabledConstraint(this);this.wake(true)}}};gq.prototype.disable=function(){if(this._active){if(this.world){this.wake(false);this.world._disabledConstraint(this)}this._active=false}};gq.prototype.getAnchorA=function(gt){if(gt===undefined){gt=new bZ.prototype.floatArray(2)}var gs=this._data;
var gr=this._ANCHOR_A;gt[0]=gs[gr];gt[1]=gs[gr+1];return gt};gq.prototype.getAnchorB=function(gt){if(gt===undefined){gt=new bZ.prototype.floatArray(2)}var gs=this._data;var gr=this._ANCHOR_B;gt[0]=gs[gr];gt[1]=gs[gr+1];return gt};gq.prototype.setAnchorA=function(gs){var gt=this._data;var gr=this._ANCHOR_A;var gv=gs[0];var gu=gs[1];if(gv!==gt[gr]||gu!==gt[gr+1]){gt[gr]=gv;gt[gr+1]=gu;this.wake(true)}};gq.prototype.setAnchorB=function(gs){var gt=this._data;var gr=this._ANCHOR_B;var gv=gs[0];var gu=gs[1];if(gv!==gt[gr]||gu!==gt[gr+1]){gt[gr]=gv;gt[gr+1]=gu;this.wake(true)}};gq.prototype.rotateAnchor=function(gx,gs,gu,gv){var gr=gx[gu];var gy=gx[gu+1];var gw=gs[(5)];var gt=gs[(5)+1];gx[gv]=((gw*gr)-(gt*gy));gx[gv+1]=((gt*gr)+(gw*gy))};gq.prototype.dtRatio=function(gu,gs){var gr=gu[(4)];var gt=(gr===-1?1:(gs/gr));gu[(4)]=gs;return gt};gq.prototype.twoBodyInWorld=function(){this.bodyA.constraints.push(this);this.bodyB.constraints.push(this)};gq.prototype.twoBodyOutWorld=function(){var gs=this.bodyA.constraints;
var gr=gs.indexOf(this);gs[gr]=gs[gs.length-1];gs.pop();gs=this.bodyB.constraints;gr=gs.indexOf(this);gs[gr]=gs[gs.length-1];gs.pop()};gq.prototype.twoBodyPairExists=function(gs,gr){return((gs===this.bodyA&&gr===this.bodyB)||(gr===this.bodyA&&gs===this.bodyB))};gq.prototype.twoBodyWakeConnected=function(){var gr=this.bodyA;if(gr._type===(0)){gr.wake(true)}gr=this.bodyB;if(gr._type===(0)){gr.wake(true)}};gq.prototype.twoBodySleepComputation=function(gs){var gr=this.bodyA;if(gr._type===(0)){gs(gr,this)}gr=this.bodyB;if(gr._type===(0)){gs(gr,this)}};gq.prototype._clearCache=function(){};gq.prototype.clearCache=function(){var gr=this._data;gr[this._JACC]=0;gr[(4)]=-1};gq.prototype.clearCache2=function(){var gs=this._data;var gr=this._JACC;gs[gr]=gs[gr+1]=0;gs[(4)]=-1};gq.prototype.clearCache3=function(){var gs=this._data;var gr=this._JACC;gs[gr]=gs[gr+1]=gs[gr+2]=0;gs[(4)]=-1};gq.prototype.soft_params=function(gx,gr,gD,gy,gB,gA){var gz=gx[gy];var gv=(gz*gz);var gw=gx[(3)];if(gA&&(gv>(gw*gw))){return true
}var gC=(2*Math.PI*gx[(0)]);var gt=(1/(gB*gC*((2*gx[(1)])+(gC*gB))));var gu=(1/(1+gt));var gs=(gB*gC*gC*gt);gx[gD]=(gt*gu);gx[gr]*=gu;gz*=gs;gv*=(gs*gs);if(gv>(gw*gw)){gv=(gw/Math.sqrt(gv));gz*=gv}gx[gy]=gz;return false};gq.prototype.soft_params2=function(gz,gr,gE,gA,gC,gB){var gv=gz[gA];var gu=gz[gA+1];var gx=((gv*gv)+(gu*gu));var gy=gz[(3)];if(gB&&(gx>(gy*gy))){return true}var gD=(2*Math.PI*gz[(0)]);var gt=(1/(gC*gD*((2*gz[(1)])+(gD*gC))));var gw=(1/(1+gt));var gs=(gC*gD*gD*gt);gz[gE]=(gt*gw);gz[gr]*=gw;gz[gr+1]*=gw;gz[gr+2]*=gw;gv*=gs;gu*=gs;gx*=(gs*gs);if(gx>(gy*gy)){gx=(gy/Math.sqrt(gx));gv*=gx;gu*=gx}gz[gA]=gv;gz[gA+1]=gu;return false};gq.prototype.soft_params3=function(gA,gr,gF,gB,gD,gC){var gw=gA[gB];var gv=gA[gB+1];var gt=gA[gB+2];var gy=((gw*gw)+(gv*gv)+(gt*gt));var gz=gA[(3)];if(gC&&(gy>(gz*gz))){return true}var gE=(2*Math.PI*gA[(0)]);var gu=(1/(gD*gE*((2*gA[(1)])+(gE*gD))));var gx=(1/(1+gu));var gs=(gD*gE*gE*gu);gA[gF]=(gu*gx);gA[gr]*=gx;gA[gr+1]*=gx;gA[gr+2]*=gx;gA[gr+3]*=gx;
gA[gr+4]*=gx;gA[gr+5]*=gx;gw*=gs;gv*=gs;gt*=gs;gy*=(gs*gs);if(gy>(gz*gz)){gy=(gz/Math.sqrt(gy));gw*=gy;gv*=gy;gt*=gy}gA[gB]=gw;gA[gB+1]=gv;gA[gB+2]=gt;return false};gq.prototype.safe_solve=function(gv,gw,gt,gs){var gu=gv[gt];var gr=gv[gw];gv[gs]=(gr!==0?(gu/gr):0)};gq.prototype.safe_solve2=function(gs,gr,gz,gv){var gA=gs[gz];var gy=gs[gz+1];var gx=gs[gr];var gw=gs[gr+1];var gu=gs[gr+2];var gt=((gx*gu)-(gw*gw));if(gt===0){gs[gv]=(gx!==0?(gA/gx):0);gs[gv+1]=(gu!==0?(gy/gu):0)}else{gt=(1/gt);gs[gv]=(gt*((gu*gA)-(gw*gy)));gs[gv+1]=(gt*((gx*gy)-(gw*gA)))}};gq.prototype.safe_solve3=function(gJ,gt,gv,gI){var gs=gJ[gv];var gr=gJ[gv+1];var gK=gJ[gv+2];var gB=gJ[gt];var gA=gJ[gt+1];var gz=gJ[gt+2];var gy=gJ[gt+3];var gx=gJ[gt+4];var gw=gJ[gt+5];var gH=((gy*gw)-(gx*gx));var gG=((gz*gx)-(gA*gw));var gF=((gA*gx)-(gz*gy));var gu=((gB*gH)+(gA*gG)+(gz*gF));if(gu===0){gu=((gB*gy)-(gA*gA));if(gu!==0){gu=(1/gu);gJ[gI]=(gu*((gy*gs)-(gA*gr)));gJ[gI+1]=(gu*((gB*gr)-(gA*gs)));gJ[gI+2]=(gw!==0?(gK/gw):0);return
}gu=((gB*gw)-(gz*gz));if(gu!==0){gu=(1/gu);gJ[gI]=(gu*((gw*gs)-(gz*gK)));gJ[gI+1]=(gy!==0?(gr/gy):0);gJ[gI+2]=(gu*((gB*gK)-(gz*gs)));return}gu=((gy*gw)-(gx*gx));if(gu!==0){gu=(1/gu);gJ[gI]=(gB!==0?(gs/gB):0);gJ[gI+1]=(gu*((gw*gr)-(gx*gK)));gJ[gI+2]=(gu*((gy*gK)-(gx*gr)));return}gJ[gI]=(gB!==0?(gs/gB):0);gJ[gI+1]=(gy!==0?(gr/gy):0);gJ[gI+2]=(gw!==0?(gK/gw):0)}else{gu=(1/gu);var gE=((gB*gw)-(gz*gz));var gD=((gA*gz)-(gB*gx));var gC=((gB*gy)-(gA*gA));gJ[gI]=(gu*((gH*gs)+(gG*gr)+(gF*gK)));gJ[gI+1]=(gu*((gG*gs)+(gE*gr)+(gD*gK)));gJ[gI+2]=(gu*((gF*gs)+(gD*gr)+(gC*gK)))}};gq.prototype.safe_invert=function(gt,gu,gs){var gr=gt[gu];if(gr===0){gt[gs]=0}else{gt[gu]=(1/gr)}};gq.prototype.safe_invert2=function(gv,gx,gr){var gw=gv[gx];var gu=gv[gx+1];var gt=gv[gx+2];var gs=((gw*gt)-(gu*gu));if(gs===0){if(gw!==0){gv[gx]=(1/gw)}else{gv[gr]=0}if(gt!==0){gv[gx+2]=(1/gt)}else{gv[gr+1]=0}gv[gx+1]=0}else{gs=(1/gs);gv[gx]=(gs*gt);gv[gx+1]=(gs*-gu);gv[gx+2]=(gs*gw)}};gq.prototype.safe_invert3=function(gv,gr,gB){var gD=gv[gr];
var gC=gv[gr+1];var gA=gv[gr+2];var gz=gv[gr+3];var gx=gv[gr+4];var gw=gv[gr+5];var gu=((gz*gw)-(gx*gx));var gt=((gA*gx)-(gC*gw));var gs=((gC*gx)-(gA*gz));var gy=((gD*gu)+(gC*gt)+(gA*gs));if(gy===0){gy=((gD*gz)-(gC*gC));if(gy!==0){gy=(1/gy);gv[gr]=(gy*gz);gv[gr+1]=(gy*-gC);gv[gr+3]=(gy*gD);if(gw!==0){gv[gr+5]=(1/gw)}else{gv[gB+2]=0}gv[gr+2]=gv[gr+4]=0;return}gy=((gD*gw)-(gA*gA));if(gy!==0){gy=(1/gy);gv[gr]=(gy*gw);gv[gr+2]=(gy*-gA);gv[gr+5]=(gy*gD);if(gz!==0){gv[gr+3]=(1/gz)}else{gv[gB+1]=0}gv[gr+1]=gv[gr+4]=0;return}gy=((gz*gw)-(gx*gx));if(gy!==0){gy=(1/gy);gv[gr+3]=(gy*gw);gv[gr+4]=(gy*-gx);gv[gr+5]=(gy*gz);if(gD!==0){gv[gr]=(1/gD)}else{gv[gB]=0}gv[gr+1]=gv[gr+2]=0;return}if(gD!==0){gv[gr]=(1/gD)}else{gv[gB]=0}if(gz!==0){gv[gr+3]=(1/gz)}else{gv[gB+1]=0}if(gw!==0){gv[gr+5]=(1/gw)}else{gv[gB+2]=0}gv[gr+1]=gv[gr+2]=gv[gr+4]=0}else{gy=(1/gy);gv[gr]=(gy*gu);gv[gr+1]=(gy*gt);gv[gr+2]=(gy*gs);gv[gr+3]=(gy*((gD*gw)-(gA*gA)));gv[gr+4]=(gy*((gC*gA)-(gD*gx)));gv[gr+5]=(gy*((gD*gz)-(gC*gC)))}};return gq
})();var fM=(function(gq){dw(gr,gq);function gr(){gq.apply(this,arguments);this.type="CUSTOM"}gr.prototype._inWorld=function(){var gt=this.bodies;var gs=gt.length;var gu;for(gu=0;gu<gs;gu+=1){gt[gu].constraints.push(this)}};gr.prototype._outWorld=function(){var gt=this.bodies;var gs=gt.length;var gv;for(gv=0;gv<gs;gv+=1){var gw=gt[gv].constraints;var gu=gw.indexOf(this);gw[gu]=gw[gw.length-1];gw.pop()}};gr.prototype._pairExists=function(gw,gu){var gt=this.bodies;var gs=gt.length;var gx;for(gx=0;gx<gs;gx+=1){var gz=gt[gx];if(gz===gw||gz===gu){var gv;for(gv=(gx+1);gv<gs;gv+=1){var gy=gt[gv];if((gz===gw&&gy===gu)||(gz===gu&&gy===gw)){return true}}}}return false};gr.prototype._wakeConnected=function(){var gu=this.bodies;var gt=gu.length;var gv;for(gv=0;gv<gt;gv+=1){var gs=gu[gv];if(gs._type===(0)){gs.wake(true)}}};gr.prototype._sleepComputation=function(gw){var gu=this.bodies;var gt=gu.length;var gv;for(gv=0;gv<gt;gv+=1){var gs=gu[gv];if(gs._type===(0)){gw(gs,this)}}};gr.prototype._clearCache=function(){var gu=this._data;
var gv=this._J_ACC;var gs=(gv+this.dimension);var gt;for(gt=gv;gt<gs;gt+=1){gu[gt]=0}gu[(4)]=-1};gr.prototype._cholesky=function(){var gz=this._data;var gt=this._K_MASS;var gC=this._K_CHOLESKY;var gA=this.dimension;var gw;for(gw=0;gw<gA;gw+=1){var gB=0;var gv;for(gv=0;gv<=(gw-1);gv+=1){var gx=gz[gC+(gw*gA)+gv];gB+=(gx*gx)}var gu=gz[gt]-gB;var gs=(gu<=0);if(gs){gu=gz[gt]}gu=(gu<=0?0:Math.sqrt(gu));gt+=1;gz[gC+(gw*gA)+gw]=gu;var gy;if(gu!==0&&!gs){gu=(1/gu);for(gy=(gw+1);gy<gA;gy+=1){gB=0;for(gv=0;gv<=(gw-1);gv+=1){gB+=(gz[gC+(gy*gA)+gv]*gz[gC+(gw*gA)+gv])}gz[gC+(gy*gA)+gw]=gu*(gz[gt]-gB);gt+=1}}if(gs){for(gy=(gw+1);gy<gA;gy+=1){gz[gC+(gy*gA)+gw]=0}for(gy=0;gy<gw;gy+=1){gz[gC+(gw*gA)+gy]=0}gt+=(gA-gw-1)}}};gr.prototype._transform=function(gt){var gx=this._data;var gs=this._VECTOR_TMP;var gB=this._K_CHOLESKY;var gz=this.dimension;var gy,gw,gA,gv;for(gy=0;gy<gz;gy+=1){gA=gx[gt+gy];gw=gx[gB+(gy*gz)+gy];if(gw!==0){for(gv=0;gv<gy;gv+=1){gA-=gx[gB+(gy*gz)+gv]*gx[gs+gv]}gx[gs+gy]=(gA/gw)}else{gx[gs+gy]=0
}}var gu;for(gu=0;gu<gz;gu+=1){gy=(gz-1-gu);gw=gx[gB+(gy*gz)+gy];if(gw!==0){gA=gx[gs+gy];for(gv=(gy+1);gv<gz;gv+=1){gA-=gx[gB+(gv*gz)+gy]*gx[gt+gv]}gx[gt+gy]=(gA/gw)}else{gx[gt+gy]=0}}};gr.prototype._effMass=function(){var gB=this._data;var gA=this.dimension;var gt=this.bodies;var gy=gt.length;var gu=(gy*3);var gG=this._JACOBIAN;var gs=this._K_MASS;var gC,gz,gx;for(gC=0;gC<gA;gC+=1){var gw=(gG+(gC*gu));for(gz=gC;gz<gA;gz+=1){var gv=(gG+(gz*gu));var gF=0;for(gx=0;gx<gy;gx+=1){var gD=gt[gx]._data;var gE=(gx*3);gF+=(gD[(0)]*((gB[gw+gE]*gB[gv+gE])+(gB[gw+gE+1]*gB[gv+gE+1])));gF+=(gD[(1)]*(gB[gw+gE+2]*gB[gv+gE+2]))}gB[gs]=gF;gs+=1}}};gr.prototype._preStep=function(gF){var gy=this.dimension;var gA=this._data;var gC,gv;if(this._posConsts){this._posConsts.call(this)}var gE=this._JACOBIAN;var gG=this._K_CHOLESKY;var gB=this._BIAS;if(!this._stiff&&!this._velocityOnly){this._posError.call(this,gA,gB);this._jacobian.call(this,gA,gE);this._effMass();this._cholesky();var gx=0;gv=(gB+gy);for(gC=gB;gC<gv;
gC+=1){var gD=gA[gC];gx+=(gD*gD)}var gz=gA[(3)];if(this._breakUnderError&&(gx>(gz*gz))){return true}var gI=(2*Math.PI*gA[(0)]);var gu=(1/(gF*gI*((2*gA[(1)])+(gI*gF))));var gw=(1/(1+gu));var gt=-(gF*gI*gI*gu);gA[(6)]=(gu*gw);gv=(gG+(gy*gy));gw=(1/Math.sqrt(gw));for(gC=gG;gC<gv;gC+=1){gA[gC]*=gw}gx*=(gt*gt);if(gx>(gz*gz)){gt*=(gz/Math.sqrt(gx))}gv=(gB+gy);for(gC=gB;gC<gv;gC+=1){gA[gC]*=gt}}else{this._jacobian.call(this,gA,gE);this._effMass();this._cholesky();gv=(gB+gy);for(gC=gB;gC<gv;gC+=1){gA[gC]=0}gA[(6)]=0}var gs=eW.prototype.dtRatio(gA,gF);var gH=this._J_ACC;gv=(gH+this.dimension);for(gC=gH;gC<gv;gC+=1){gA[gC]*=gs}gA[(5)]=(gA[(2)]*gF);return false};gr.prototype._warmStart=function(){this._applyImpulse(this._J_ACC)};gr.prototype.getImpulseForBody=function(gz,gD){if(gD===undefined){gD=new bZ.prototype.floatArray(3)}var gx=this._data;var gA=this._JACOBIAN;var gG=this._J_ACC;var gs=this.bodies;var gu=gs.length;var gt=(gu*3);var gy=this.dimension;var gw;for(gw=0;gw<gu;gw+=1){var gF=gs[gw];
if(gF===gz){var gC=0;var gB=0;var gE=0;var gv;for(gv=0;gv<gy;gv+=1){gC+=(gx[gG+gv]*gx[gA+(gt*gv)]);gB+=(gx[gG+gv]*gx[gA+(gt*gv)+1]);gE+=(gx[gG+gv]*gx[gA+(gt*gv)+2])}gD[0]=gC;gD[1]=gB;gD[2]=gE;return gD}gA+=3}gD[0]=gD[1]=gD[2]=0;return gD};gr.prototype._applyImpulse=function(gI,gA){var gy=this._data;var gC=this._JACOBIAN;var gs=this.bodies;var gv=gs.length;var gt=(gv*3);var gz=this.dimension;var gx;for(gx=0;gx<gv;gx+=1){var gH=gs[gx];var gB=gH._data;var gE=0;var gD=0;var gG=0;var gw;for(gw=0;gw<gz;gw+=1){gE+=(gy[gI+gw]*gy[gC+(gt*gw)]);gD+=(gy[gI+gw]*gy[gC+(gt*gw)+1]);gG+=(gy[gI+gw]*gy[gC+(gt*gw)+2])}var gF=gB[(0)];var gu=gG*gB[(1)];if(gA){gB[(2)]+=gE*gF;gB[(2)+1]+=gD*gF;if(gu!==0){gH._deltaRotation(gu)}}else{gB[(7)]+=gE*gF;gB[(7)+1]+=gD*gF;gB[(7)+2]+=gu}gC+=3}};gr.prototype._iterateVel=function(){var gI=this.dimension;var gJ=this._data;var gF,gH;var gA=this._VECTOR;var gz=this._BIAS;var gD;var gx=this.bodies;var gE=gx.length;var gB=this._JACOBIAN;for(gF=0;gF<gI;gF+=1){var gC=gJ[gz+gF];for(gD=0;
gD<gE;gD+=1){var gy=gx[gD]._data;gC-=((gy[(7)]*gJ[gB])+(gy[(7)+1]*gJ[gB+1])+(gy[(7)+2]*gJ[gB+2]));gB+=3}gJ[gA+gF]=gC}this._transform(gA);var gw=this._J_ACC;var gs=this._VECTOR_TMP;var gu;var gv=gJ[(6)];for(gF=0;gF<gI;gF+=1){gu=gJ[gs+gF]=gJ[gw+gF];gJ[gw+gF]+=(gJ[gA+gF]-(gu*gv))}if(this._velClamp){this._velClamp.call(this,gJ,gw)}var gt=0;gH=(gw+gI);for(gF=gw;gF<gH;gF+=1){gu=gJ[gF];gt+=(gu*gu)}var gG=gJ[(5)];if(this._breakUnderForce&&gt>(gG*gG)){return true}else{if(!this._stiff&&gt>(gG*gG)){gt=(gG/Math.sqrt(gt));for(gF=gw;gF<gH;gF+=1){gJ[gF]*=gt}}}for(gF=0;gF<gI;gF+=1){gJ[gA+gF]=(gJ[gw+gF]-gJ[gs+gF])}this._applyImpulse(gA);return false};gr.prototype._iteratePos=function(){if(this._velocityOnly){return false}if(this._posConsts){this._posConsts.call(this)}var gv=this.dimension;var gw=this._data;var gy,gu;var gx=this._BIAS;this._posError.call(this,gw,gx);gu=(gx+gv);var gt;var gs=0;for(gy=gx;gy<gu;gy+=1){gt=gw[gy];gs+=(gt*gt);gw[gy]=-gt}var gz=gw[(3)];if(this._breakUnderError&&(gs>(gz*gz))){return true
}var gA=this._JACOBIAN;this._jacobian.call(this,gw,gA);this._effMass();this._cholesky();this._transform(gx);if(this._posClamp){this._posClamp.call(this,gw,gx)}this._applyImpulse(gx,true);return false};gr.create=function(gv){var gu=new gr();var gt=gu.dimension=gv.dimension;gu.bodies=gv.bodies.concat();var gs=7+(gt*(4+gt)+((gt*(gt+1))/2));gs+=(gt*gu.bodies.length*3);gu._data=new bZ.prototype.floatArray(gs);eW.prototype.init(gu,gv);gu._K_MASS=7;gu._K_CHOLESKY=gu._K_MASS+((gt*(gt+1))/2);gu._BIAS=gu._K_CHOLESKY+(gt*gt);gu._J_ACC=gu._BIAS+gt;gu._VECTOR=gu._J_ACC+gt;gu._JACOBIAN=gu._VECTOR+gt;gu._VECTOR_TMP=gu._JACOBIAN+(gt*gu.bodies.length*3);gu._draw=gv.debugDraw;gu._posConsts=gv.positionConstants;gu._posError=gv.position;gu._posClamp=gv.positionClamp;gu._velClamp=gv.velocityClamp;gu._jacobian=gv.jacobian;gu._velocityOnly=(gu._posError===undefined);return gu};return gr})(eW);var fm=(function(gr){dw(gq,gr);function gq(){gr.apply(this,arguments);this.type="PULLEY";this.dimension=1;this._ANCHOR_A=(11);
this._ANCHOR_B=(13);this._ANCHOR_C=(15);this._ANCHOR_D=(17);this._JACC=(9)}gq.prototype.getRatio=function(){return this._data[(7)]};gq.prototype.setRatio=function(gs){var gt=this._data;if(gt[(7)]!==gs){gt[(7)]=gs;this.wake(true)}};gq.prototype.getLowerBound=function(){return this._data[(5)]};gq.prototype.getUpperBound=function(){return this._data[(6)]};gq.prototype.setLowerBound=function(gt){var gs=this._data;if(gs[(5)]!==gt){gs[(5)]=gt;this._equal=(gt===gs[(6)]);this.wake(true)}};gq.prototype.setUpperBound=function(gt){var gs=this._data;if(gs[(6)]!==gt){gs[(6)]=gt;this._equal=(gt===gs[(5)]);this.wake(true)}};gq.prototype.getAnchorC=function(gu){if(gu===undefined){gu=new bZ.prototype.floatArray(2)}var gt=this._data;var gs=this._ANCHOR_C;gu[0]=gt[gs];gu[1]=gt[gs+1];return gu};gq.prototype.setAnchorC=function(gt){var gu=this._data;var gs=this._ANCHOR_C;var gw=gt[0];var gv=gt[1];if(gw!==gu[gs]||gv!==gu[gs+1]){gu[gs]=gw;gu[gs+1]=gv;this.wake(true)}};gq.prototype.getAnchorD=function(gu){if(gu===undefined){gu=new bZ.prototype.floatArray(2)
}var gt=this._data;var gs=this._ANCHOR_D;gu[0]=gt[gs];gu[1]=gt[gs+1];return gu};gq.prototype.setAnchorD=function(gt){var gu=this._data;var gs=this._ANCHOR_D;var gw=gt[0];var gv=gt[1];if(gw!==gu[gs]||gv!==gu[gs+1]){gu[gs]=gw;gu[gs+1]=gv;this.wake(true)}};gq.prototype._inWorld=function(){this.bodyA.constraints.push(this);this.bodyB.constraints.push(this);if(this.bodyB!==this.bodyC){this.bodyC.constraints.push(this)}this.bodyD.constraints.push(this)};gq.prototype._outWorld=function(){var gt=this.bodyA.constraints;var gs=gt.indexOf(this);gt[gs]=gt[gt.length-1];gt.pop();gt=this.bodyB.constraints;gs=gt.indexOf(this);gt[gs]=gt[gt.length-1];gt.pop();if(this.bodyB!==this.bodyC){gt=this.bodyB.constraints;gs=gt.indexOf(this);gt[gs]=gt[gt.length-1];gt.pop()}gt=this.bodyD.constraints;gs=gt.indexOf(this);gt[gs]=gt[gt.length-1];gt.pop()};gq.prototype._pairExists=function(gt,gs){var gx=this.bodyA;var gw=this.bodyB;var gv=this.bodyC;var gu=this.bodyD;return((gt===gx&&(gs===gw||gs===gv||gs===gu))||(gt===gw&&(gs===gx||gs===gv||gs===gu))||(gt===gv&&(gs===gx||gs===gw||gs===gu))||(gt===gu&&(gs===gx||gs===gw||gs===gv)))
};gq.prototype._wakeConnected=function(){var gs=this.bodyA;if(gs._type===(0)){gs.wake(true)}gs=this.bodyB;if(gs._type===(0)){gs.wake(true)}gs=this.bodyC;if(gs!==this.bodyB&&gs._type===(0)){gs.wake(true)}gs=this.bodyD;if(gs._type===(0)){gs.wake(true)}};gq.prototype._sleepComputation=function(gt){var gs=this.bodyA;if(gs._type===(0)){gt(gs,this)}gs=this.bodyB;if(gs._type===(0)){gt(gs,this)}gs=this.bodyC;if(gs!==this.bodyB&&gs._type===(0)){gt(gs,this)}gs=this.bodyD;if(gs._type===(0)){gt(gs,this)}};gq.prototype._posError=function(){var gC=this._data;var gH=this.bodyA._data;var gG=this.bodyB._data;var gF=this.bodyC._data;var gE=this.bodyD._data;eW.prototype.rotateAnchor(gC,gH,(11),(19));eW.prototype.rotateAnchor(gC,gG,(13),(21));eW.prototype.rotateAnchor(gC,gF,(15),(23));eW.prototype.rotateAnchor(gC,gE,(17),(25));var gu=gC[(5)];var gB=gC[(6)];var gA=((gG[(2)]+gC[(21)])-(gH[(2)]+gC[(19)]));var gx=((gG[(2)+1]+gC[(21)+1])-(gH[(2)+1]+gC[(19)+1]));var gv=((gE[(2)]+gC[(25)])-(gF[(2)]+gC[(23)]));var gt=((gE[(2)+1]+gC[(25)+1])-(gF[(2)+1]+gC[(23)+1]));
var gs=((gA*gA)+(gx*gx));var gw=((gv*gv)+(gt*gt));var gz;if(gs<l.NORMALIZE_SQ_EPSILON){gs=0;gA=gC[(29)];gx=gC[(29)+1]}else{gs=Math.sqrt(gs);gz=(1/gs);gA*=gz;gx*=gz}var gD=gC[(7)];if(gw<l.NORMALIZE_SQ_EPSILON){gw=0;gv=gC[(31)];gt=gC[(31)+1]}else{gw=Math.sqrt(gw);gz=(gD/gw);gv*=gz;gt*=gz}var gy=(gs+(gw*gD));if(this._equal){gy-=gu;this._slack=false}else{if(gy<gu){gy=(gu-gy);gA=-gA;gx=-gx;gv=-gv;gt=-gt;this._slack=false}else{if(gy>gB){gy-=gB;this._slack=false}else{gA=-gA;gx=-gx;gv=-gv;gt=-gt;gy=0;this._slack=true}}}gC[(29)]=gA;gC[(29)+1]=gx;gC[(31)]=gv;gC[(31)+1]=gt;gC[(28)]=(-gy)};gq.prototype._preStep=function(gt){this._posError();if(this._slack){return false}var gK=this._data;var gx=this.bodyA._data;var gw=this.bodyB._data;var gv=this.bodyC._data;var gu=this.bodyD._data;var gz=gK[(7)];gz*=gz;var gJ=gK[(29)];var gI=gK[(29)+1];var gF=gK[(31)];var gE=gK[(31)+1];var gD=gK[(33)]=((gK[(19)]*gI)-(gK[(19)+1]*gJ));var gC=gK[(34)]=((gK[(21)]*gI)-(gK[(21)+1]*gJ));var gB=gK[(35)]=((gK[(23)]*gE)-(gK[(23)+1]*gF));
var gA=gK[(36)]=((gK[(25)]*gE)-(gK[(25)+1]*gF));var gs=gv[(0)];var gG=gv[(1)];var gy=(gx[(0)]+gw[(0)]+(gz*(gs+gu[(0)]))+(gD*gx[(1)]*gD)+(gC*gw[(1)]*gC)+(gB*gG*gB)+(gA*gu[(1)]*gA));if(gw===gv){gy-=2*((((gJ*gF)+(gI*gE))*gs)+(gC*gB*gG))}gK[(8)]=gy;eW.prototype.safe_invert(gK,(8),(9));if(!this._stiff){if(eW.prototype.soft_params(gK,(8),(27),(28),gt,this._breakUnderError)){return true}}else{gK[(27)]=0;gK[(28)]=0}var gH=eW.prototype.dtRatio(gK,gt);gK[(9)]*=gH;gK[(10)]=(gK[(2)]*gt);return false};gq.prototype._warmStart=function(){if(this._slack){return false}var gs=this._data;var gy=this.bodyA._data;var gx=this.bodyB._data;var gu=this.bodyC._data;var gt=this.bodyD._data;var gw=gs[(9)];var gA=(gs[(29)]*gw);var gz=(gs[(29)+1]*gw);var gv=gy[(0)];gy[(7)]-=(gA*gv);gy[(7)+1]-=(gz*gv);gy[(7)+2]-=(gs[(33)]*gw*gy[(1)]);gv=gx[(0)];gx[(7)]+=(gA*gv);gx[(7)+1]+=(gz*gv);gx[(7)+2]+=(gs[(34)]*gw*gx[(1)]);gA=(gs[(31)]*gw);gz=(gs[(31)+1]*gw);gv=gu[(0)];gu[(7)]-=(gA*gv);gu[(7)+1]-=(gz*gv);gu[(7)+2]-=(gs[(35)]*gw*gu[(1)]);
gv=gt[(0)];gt[(7)]+=(gA*gv);gt[(7)+1]+=(gz*gv);gt[(7)+2]+=(gs[(36)]*gw*gt[(1)])};gq.prototype.getImpulseForBody=function(gs,gy){if(gy===undefined){gy=new bZ.prototype.floatArray(3)}var gt=gu[(9)];var gu=this._data;if(gs===this.bodyA){gy[0]=-(gu[(29)]*gt);gy[1]=-(gu[(29)+1]*gt);gy[2]=-gu[(33)]*gt}else{if(gs===this.bodyD){gy[0]=(gu[(31)]*gt);gy[1]=(gu[(31)+1]*gt);gy[2]=gu[(36)]*gt}else{var gw=0;var gv=0;var gx=0;if(gs===this.bodyB){gw+=(gu[(29)]*gt);gv+=(gu[(29)+1]*gt);gx+=gu[(34)]*gt}if(gs===this.bodyC){gw-=(gu[(31)]*gt);gv-=(gu[(31)+1]*gt);gx-=gu[(35)]*gt}gy[0]=gw;gy[1]=gv;gy[2]=gx}}return gy};gq.prototype._iterateVel=function(){if(this._slack){return false}var gM=this._data;var gw=this.bodyA._data;var gv=this.bodyB._data;var gu=this.bodyC._data;var gt=this.bodyD._data;var gL=gM[(29)];var gK=gM[(29)+1];var gI=gM[(31)];var gG=gM[(31)+1];var gF=gM[(33)];var gE=gM[(34)];var gD=gM[(35)];var gB=gM[(36)];var gz=(gM[(28)]-((gL*(gv[(7)]-gw[(7)]))+(gK*(gv[(7)+1]-gw[(7)+1]))+(gI*(gt[(7)]-gu[(7)]))+(gG*(gt[(7)+1]-gu[(7)+1]))+(gE*gv[(7)+2])-(gF*gw[(7)+2])+(gB*gt[(7)+2])-(gD*gu[(7)+2])));
var gs=gM[(9)];var gH=((gM[(8)]*gz)-(gs*gM[(27)]));var gx=(gs+gH);var gJ=gM[(10)];if(!this._equal&&gx>0){gx=0}if(this._breakUnderForce){if(gx>gJ||gx<-gJ){return true}}else{if(!this._stiff){if(gx>gJ){gx=gJ}else{if(gx<-gJ){gx=-gJ}}}}gH=(gx-gs);gM[(9)]=gx;var gC=(gM[(29)]*gH);var gA=(gM[(29)+1]*gH);var gy=gw[(0)];gw[(7)]-=(gC*gy);gw[(7)+1]-=(gA*gy);gw[(7)+2]-=(gF*gH*gw[(1)]);gy=gv[(0)];gv[(7)]+=(gC*gy);gv[(7)+1]+=(gA*gy);gv[(7)+2]+=(gE*gH*gv[(1)]);gC=(gM[(31)]*gH);gA=(gM[(31)+1]*gH);gy=gu[(0)];gu[(7)]-=(gC*gy);gu[(7)+1]-=(gA*gy);gu[(7)+2]-=(gD*gH*gu[(1)]);gy=gt[(0)];gt[(7)]+=(gC*gy);gt[(7)+1]+=(gA*gy);gt[(7)+2]+=(gB*gH*gt[(1)]);return false};gq.prototype._iteratePos=function(){this._posError();if(this._slack){return false}var gV=this._data;var gB=this.bodyA._data;var gA=this.bodyB._data;var gz=this.bodyC._data;var gw=this.bodyD._data;var gv=gB[(0)];var gu=gA[(0)];var gt=gz[(0)];var gs=gw[(0)];var gR=gB[(1)];var gQ=gA[(1)];var gP=gz[(1)];var gM=gw[(1)];var gx=gV[(28)];var gS=gV[(3)];if(this._breakUnderError&&(gx>gS||gx<-gS)){return true
}var gy=l.PULLEY_SLOP_SQ;if((gx*gx)<gy){return false}gx*=l.PULLEY_BIAS_COEF;var gD=gV[(7)];gD*=gD;var gC=(gv+gu+(gD*(gt+gs)));var gU=gV[(29)];var gT=gV[(29)+1];var gO=gV[(31)];var gL=gV[(31)+1];if(gA===gz){gC-=2*((gU*gO)+(gT*gL))*gu}var gN,gH,gF;if((gx*gx)>l.PULLEY_LARGE_ERROR_SQ){if(gC>l.EFF_MASS_EPSILON){gN=(gx*l.PULLEY_LARGE_ERROR_BIAS/gC);if(this._equal||gN<0){gH=(gU*gN);gF=(gT*gN);gB[(2)]-=(gH*gv);gB[(2)+1]-=(gF*gv);gA[(2)]+=(gH*gu);gA[(2)+1]+=(gF*gu);gH=(gO*gN);gF=(gL*gN);gz[(2)]-=(gH*gt);gz[(2)+1]-=(gF*gt);gw[(2)]+=(gH*gs);gw[(2)+1]+=(gF*gs);this._posError();gU=gV[(29)];gT=gV[(29)+1];gO=gV[(31)];gL=gV[(31)+1];gx=gV[(28)]*l.PULLEY_BIAS_COEF}}}var gJ=((gV[(19)]*gT)-(gV[(19)+1]*gU));var gI=((gV[(21)]*gT)-(gV[(21)+1]*gU));var gG=((gV[(23)]*gL)-(gV[(23)+1]*gO));var gE=((gV[(25)]*gL)-(gV[(25)+1]*gO));gC+=((gJ*gR*gJ)+(gI*gQ*gI)+(gG*gP*gG)+(gE*gM*gE));if(gA===gA){gC-=(2*gI*gQ*gG)}gV[(8)]=gC;gV[(28)]=gx;eW.prototype.safe_solve(gV,(8),(28),(28));gN=gV[(28)];if(this._equal||gN<0){var gK;gH=(gU*gN);
gF=(gT*gN);gB[(2)]-=(gH*gv);gB[(2)+1]-=(gF*gv);gK=(-gJ*gN*gR);if(gK!==0){this.bodyA._deltaRotation(gK)}gA[(2)]+=(gH*gu);gA[(2)+1]+=(gF*gu);gK=(gI*gN*gQ);if(gK!==0){this.bodyB._deltaRotation(gK)}gH=(gO*gN);gF=(gL*gN);gz[(2)]-=(gH*gt);gz[(2)+1]-=(gF*gt);gK=(-gG*gN*gP);if(gK!==0){this.bodyC._deltaRotation(gK)}gw[(2)]+=(gH*gs);gw[(2)+1]+=(gF*gs);gK=(gE*gN*gM);if(gK!==0){this.bodyD._deltaRotation(gK)}}return false};gq.create=function(gx){var gw=new gq();var gv=gw._data=new bZ.prototype.floatArray((37));eW.prototype.init(gw,gx);var gt=gx.anchorA;gv[(11)]=(gt?gt[0]:0);gv[(11)+1]=(gt?gt[1]:0);gt=gx.anchorB;gv[(13)]=(gt?gt[0]:0);gv[(13)+1]=(gt?gt[1]:0);gt=gx.anchorC;gv[(15)]=(gt?gt[0]:0);gv[(15)+1]=(gt?gt[1]:0);gt=gx.anchorD;gv[(17)]=(gt?gt[0]:0);gv[(17)+1]=(gt?gt[1]:0);var gu=gv[(5)]=(gx.lowerBound!==undefined?gx.lowerBound:0);var gs=gv[(6)]=(gx.upperBound!==undefined?gx.upperBound:0);gw._equal=(gu===gs);gv[(7)]=(gx.ratio!==undefined?gx.ratio:1);gw._slack=false;gw.bodyA=gx.bodyA;gw.bodyB=gx.bodyB;
gw.bodyC=gx.bodyC;gw.bodyD=gx.bodyD;gv[(29)]=1;gv[(29)+1]=0;gv[(31)]=1;gv[(31)+1]=0;return gw};return gq})(eW);var fr=(function(gq){dw(gr,gq);function gr(){gq.apply(this,arguments);this.type="MOTOR";this.dimension=1;this._JACC=(8)}gr.prototype.getRate=function(){return this._data[(5)]};gr.prototype.getRatio=function(){return this._data[(6)]};gr.prototype.setRate=function(gs){var gt=this._data;if(gt[(5)]!==gs){gt[(5)]=gs;this.wake(true)}};gr.prototype.setRatio=function(gs){var gt=this._data;if(gt[(6)]!==gs){gt[(6)]=gs;this.wake(true)}};gr.prototype._preStep=function(gt){var gx=this._data;var gv=this.bodyA._data;var gs=this.bodyB._data;var gw=gx[(6)];gx[(7)]=(gv[(1)]+(gw*gw*gs[(1)]));eW.prototype.safe_invert(gx,(7),(8));var gu=eW.prototype.dtRatio(gx,gt);gx[(8)]*=gu;gx[(9)]=(gx[(2)]*gt);return false};gr.prototype._warmStart=function(){var gv=this._data;var gu=this.bodyA._data;var gs=this.bodyB._data;var gt=gv[(8)];gu[(7)+2]-=(gt*gu[(1)]);gs[(7)+2]+=(gv[(6)]*gt*gs[(1)])};gr.prototype.getImpulseForBody=function(gs,gu){if(gu===undefined){gu=new bZ.prototype.floatArray(3)
}var gt=this._data;gu[0]=gu[1]=0;gu[2]=(gs===this.bodyA?-1:(gs===this.bodyB?gt[(6)]:0))*gt[(8)];return gu};gr.prototype._iterateVel=function(){var gx=this._data;var gu=this.bodyA._data;var gs=this.bodyB._data;var gw=gx[(6)];var gt=(gx[(7)]*(gx[(5)]+gu[(7)+2]-(gw*gs[(7)+2])));var gz=gx[(8)];var gv=(gz+gt);var gy=gx[(9)];if(this._breakUnderForce&&(gv>gy||gv<-gy)){return true}else{if(gv>gy){gv=gy}else{if(gv<-gy){gv=-gy}}}gt=(gv-gz);gx[(8)]=gv;gu[(7)+2]-=(gt*gu[(1)]);gs[(7)+2]+=(gw*gt*gs[(1)]);return false};gr.prototype._iteratePos=function(){return false};gr.create=function(gu){var gt=new gr();var gs=gt._data=new bZ.prototype.floatArray((10));eW.prototype.init(gt,gu);gs[(5)]=(gu.rate!==undefined?gu.rate:0);gs[(6)]=(gu.ratio!==undefined?gu.ratio:1);gt.bodyA=gu.bodyA;gt.bodyB=gu.bodyB;return gt};return gr})(eW);fr.prototype._inWorld=eW.prototype.twoBodyInWorld;fr.prototype._outWorld=eW.prototype.twoBodyOutWorld;fr.prototype._pairExists=eW.prototype.twoBodyPairExists;fr.prototype._wakeConnected=eW.prototype.twoBodyWakeConnected;
fr.prototype._sleepComputation=eW.prototype.twoBodySleepComputation;var fp=(function(gq){dw(gr,gq);function gr(){gq.apply(this,arguments);this.type="LINE";this.dimension=2;this._ANCHOR_A=(7);this._ANCHOR_B=(9);this._JACC=(22)}gr.prototype.getLowerBound=function(){return this._data[(5)]};gr.prototype.getUpperBound=function(){return this._data[(6)]};gr.prototype.setLowerBound=function(gt){var gs=this._data;if(gs[(5)]!==gt){gs[(5)]=gt;this._equal=(gt===gs[(6)]);this.wake(true)}};gr.prototype.setUpperBound=function(gt){var gs=this._data;if(gs[(6)]!==gt){gs[(6)]=gt;this._equal=(gt===gs[(5)]);this.wake(true)}};gr.prototype.getAxis=function(gt){if(gt===undefined){gt=new bZ.prototype.floatArray(2)}var gs=this._data;gt[0]=gs[(11)];gt[1]=gs[(11)+1];return gt};gr.prototype.setAxis=function(gt){var gu=this._data;var gw=gt[0];var gv=gt[1];if(gw!==gu[(11)]||gv!==gu[(11)+1]){var gs=((gw*gw)+(gv*gv));if(gs===0){return}else{gs=(1/Math.sqrt(gs));gw*=gs;gv*=gs}gu[(11)]=gw;gu[(11)+1]=gv;this.wake(true)}};gr.prototype._posError=function(){var gu=this._data;
var gA=this.bodyA._data;var gz=this.bodyB._data;eW.prototype.rotateAnchor(gu,gA,(7),(13));eW.prototype.rotateAnchor(gu,gz,(9),(15));eW.prototype.rotateAnchor(gu,gA,(11),(17));var gs=gu[(5)];var gt=gu[(6)];var gD=gu[(13)];var gy=gu[(13)+1];var gB=gu[(15)];var gx=gu[(15)+1];var gw=gu[(17)];var gv=gu[(17)+1];var gG=gu[(28)]=((gz[(2)]+gB)-(gA[(2)]+gD));var gF=gu[(29)]=((gz[(2)+1]+gx)-(gA[(2)+1]+gy));var gE=((gw*gF)-(gv*gG));var gC=((gw*gG)+(gv*gF));if(this._equal){gC-=gs;gu[(32)]=1}else{if(gC>gt){gC-=gt;gu[(32)]=1}else{if(gC<gs){gC=(gs-gC);gu[(32)]=-1}else{gC=0;gu[(32)]=0}}}gu[(26)]=(-gE);gu[(26)+1]=(-gC)};gr.prototype._preStep=function(gs){var gL=this._data;var gw=this.bodyA._data;var gv=this.bodyB._data;this._posError();var gH=gL[(13)];var gu=gL[(13)+1];var gG=gL[(15)];var gt=gL[(15)+1];var gJ=gL[(17)];var gI=gL[(17)+1];var gM=gL[(32)];var gA=(gL[(28)]+gH);var gz=(gL[(29)]+gu);var gy=gL[(28)]=(gJ*gz)-(gI*gA);var gx=gL[(29)]=(gJ*gt)-(gI*gG);var gC=gL[(30)]=(gJ*gA)+(gI*gz);var gB=gL[(31)]=(gJ*gG)+(gI*gt);
var gF=(gw[(0)]+gv[(0)]);var gE=gw[(1)];var gD=gv[(1)];gL[(19)]=gF+(gC*gE*gC)+(gB*gD*gB);gL[(19)+1]=-gM*((gC*gE*gy)+(gB*gD*gx));gL[(19)+2]=gM*gM*(gF+(gy*gE*gy)+(gx*gD*gx));eW.prototype.safe_invert2(gL,(19),(22));if(!this._stiff){if(eW.prototype.soft_params2(gL,(19),(25),(26),gs,this._breakUnderError)){return true}}else{gL[(25)]=0;gL[(26)]=0;gL[(26)+1]=0}var gK=eW.prototype.dtRatio(gL,gs);gL[(22)]*=gK;gL[(22)+1]*=gK;gL[(24)]=(gL[(2)]*gs);return false};gr.prototype._warmStart=function(){var gv=this._data;var gA=this.bodyA._data;var gz=this.bodyB._data;var gC=gv[(22)];var gB=gv[(22)+1];var gu=gv[(32)];var gx=gv[(17)];var gw=gv[(17)+1];var gt=(gu*gx*gB)-(gw*gC);var gs=(gx*gC)+(gu*gw*gB);var gy=gA[(0)];gA[(7)]-=(gt*gy);gA[(7)+1]-=(gs*gy);gA[(7)+2]+=(((gu*gv[(28)]*gB)-(gv[(30)]*gC))*gA[(1)]);gy=gz[(0)];gz[(7)]+=(gt*gy);gz[(7)+1]+=(gs*gy);gz[(7)+2]+=(((gv[(31)]*gC)-(gu*gv[(29)]*gB))*gz[(1)])};gr.prototype.getImpulseForBody=function(gx,gz){if(gz===undefined){gz=new bZ.prototype.floatArray(3)}var gv=this._data;
var gB=gv[(22)];var gA=gv[(22)+1];var gu=gv[(32)];var gy=gv[(17)];var gw=gv[(17)+1];var gt=(gu*gy*gA)-(gw*gB);var gs=(gy*gB)+(gu*gw*gA);if(gx===this.bodyA){gz[0]=-gt;gz[1]=-gs;gz[2]=((gu*gv[(28)]*gA)-(gv[(30)]*gB))}else{if(gx===this.bodyB){gz[0]=gt;gz[1]=gs;gz[2]=((gv[(31)]*gB)-(gu*gv[(29)]*gA))}else{gz[0]=gz[1]=gz[2]=0}}return gz};gr.prototype._iterateVel=function(){var gT=this._data;var gy=this.bodyA._data;var gx=this.bodyB._data;var gU=gT[(32)];var gS=gT[(17)];var gR=gT[(17)+1];var gH=gT[(28)];var gG=gT[(29)];var gO=gT[(30)];var gM=gT[(31)];var gJ=(gx[(7)]-gy[(7)]);var gI=(gx[(7)+1]-gy[(7)+1]);var gP=gy[(7)+2];var gN=gx[(7)+2];var gD=(gT[(26)]-((gS*gI)-(gR*gJ)+(gN*gM)-(gP*gO)));var gB=(gT[(26)+1]-(gU*((gS*gJ)+(gR*gI)-(gN*gG)+(gP*gH))));var gt=gT[(22)];var gs=gT[(22)+1];var gz=gT[(25)];var gC=gT[(19)+1];var gF=((gT[(19)]*gD)+(gC*gB))-(gt*gz);var gE=((gC*gD)+(gT[(19)+2]*gB))-(gs*gz);var gL=(gt+gF);var gK=(gs+gE);if(!this._equal&&gK>0){gK=0}var gw=((gL*gL)+(gK*gK));var gQ=gT[(24)];if(this._breakUnderForce){if(gw>(gQ*gQ)){return true
}}else{if(!this._stiff){if(gw>(gQ*gQ)){gw=(gQ/Math.sqrt(gw));gL*=gw;gK*=gw}}}gF=(gL-gt);gE=(gK-gs);gT[(22)]=gL;gT[(22)+1]=gK;var gv=(gU*gS*gE)-(gR*gF);var gu=(gS*gF)+(gU*gR*gE);var gA=gy[(0)];gy[(7)]-=(gv*gA);gy[(7)+1]-=(gu*gA);gy[(7)+2]+=(((gU*gH*gE)-(gO*gF))*gy[(1)]);gA=gx[(0)];gx[(7)]+=(gv*gA);gx[(7)+1]+=(gu*gA);gx[(7)+2]+=(((gM*gF)-(gU*gG*gE))*gx[(1)]);return false};gr.prototype._iteratePos=function(){var gX=this._data;var gD=this.bodyA._data;var gC=this.bodyB._data;this._posError();var gt=gX[(26)];var gs=gX[(26)+1];var gH=((gt*gt)+(gs*gs));var gW=gX[(3)];if(this._breakUnderError&&gH>(gW*gW)){return true}var gB=l.LINE_SLOP_SQ;if(gH<gB){return false}var gA=l.LINE_BIAS_COEF;gt*=gA;gs*=gA;gH*=(gA*gA);var gv=gD[(0)];var gu=gC[(0)];var gQ=gD[(1)];var gP=gC[(1)];var gR=(gv+gu);var gV=gX[(17)];var gU=gX[(17)+1];var gY=gX[(32)];var gz,gx;if(gH>l.LINE_LARGE_ERROR_SQ){if(gR>l.EFF_MASS_EPSILON){var gE=(l.LINE_LARGE_ERROR_BIAS/gR);gz=gE*((gU*gt)-(gY*gV*gs));gx=gE*((gV*gt*gY)-(gU*gt));gD[(2)]-=(gz*gv);
gD[(2)+1]-=(gx*gv);gC[(2)]+=(gz*gu);gC[(2)+1]+=(gx*gu);this._posError();gV=gX[(17)];gU=gX[(17)+1];gY=gX[(32)];gt=(gX[(26)]*gA);gs=(gX[(26)+1]*gA)}}var gT=gX[(13)];var gy=gX[(13)+1];var gS=gX[(15)];var gw=gX[(15)+1];var gM=(gX[(28)]+gT);var gL=(gX[(29)]+gy);var gJ=(gV*gL)-(gU*gM);var gI=(gV*gw)-(gU*gS);var gO=(gV*gM)+(gU*gL);var gN=(gV*gS)+(gU*gw);gX[(19)]=gR+(gO*gQ*gO)+(gN*gP*gN);gX[(19)+1]=-gY*((gO*gQ*gJ)+(gN*gP*gI));gX[(19)+2]=gY*gY*(gR+(gJ*gQ*gJ)+(gI*gP*gI));gX[(26)]=gt;gX[(26)+1]=gs;eW.prototype.safe_solve2(gX,(19),(26),(26));var gG=gX[(26)];var gF=gX[(26)+1];if(!this._equal&&gF>0){gF=0}gz=(gY*gV*gF)-(gU*gG);gx=(gV*gG)+(gY*gU*gF);gD[(2)]-=(gz*gv);gD[(2)+1]-=(gx*gv);var gK=(((gY*gJ*gF)-(gO*gG))*gQ);if(gK!==0){this.bodyA._deltaRotation(gK)}gC[(2)]+=(gz*gu);gC[(2)+1]+=(gx*gu);gK=(((gN*gG)-(gY*gI*gF))*gP);if(gK!==0){this.bodyB._deltaRotation(gK)}return false};gr.create=function(gx){var gw=new gr();var gv=gw._data=new bZ.prototype.floatArray((33));eW.prototype.init(gw,gx);var gt=gx.anchorA;
gv[(7)]=(gt?gt[0]:0);gv[(7)+1]=(gt?gt[1]:0);gt=gx.anchorB;gv[(9)]=(gt?gt[0]:0);gv[(9)+1]=(gt?gt[1]:0);gt=gx.axis;gv[(11)]=gt[0];gv[(11)+1]=gt[1];var gu=gv[(5)]=(gx.lowerBound!==undefined?gx.lowerBound:Number.NEGATIVE_INFINITY);var gs=gv[(6)]=(gx.upperBound!==undefined?gx.upperBound:Number.POSITIVE_INFINITY);gw._equal=(gu===gs);gw.bodyA=gx.bodyA;gw.bodyB=gx.bodyB;return gw};return gr})(eW);fp.prototype._inWorld=eW.prototype.twoBodyInWorld;fp.prototype._outWorld=eW.prototype.twoBodyOutWorld;fp.prototype._pairExists=eW.prototype.twoBodyPairExists;fp.prototype._wakeConnected=eW.prototype.twoBodyWakeConnected;fp.prototype._sleepComputation=eW.prototype.twoBodySleepComputation;var ed=(function(gr){dw(gq,gr);function gq(){gr.apply(this,arguments);this.type="DISTANCE";this.dimension=1;this._ANCHOR_A=(7);this._ANCHOR_B=(9);this._JACC=(16)}gq.prototype.getLowerBound=function(){return this._data[(5)]};gq.prototype.getUpperBound=function(){return this._data[(6)]};gq.prototype.setLowerBound=function(gt){var gs=this._data;
if(gs[(5)]!==gt){gs[(5)]=gt;this._equal=(gt===gs[(6)]);this.wake(true)}};gq.prototype.setUpperBound=function(gt){var gs=this._data;if(gs[(6)]!==gt){gs[(6)]=gt;this._equal=(gt===gs[(5)]);this.wake(true)}};gq.prototype._posError=function(){var gw=this._data;var gA=this.bodyA._data;var gz=this.bodyB._data;var gs=gw[(5)];var gv=gw[(6)];eW.prototype.rotateAnchor(gw,gA,(7),(11));eW.prototype.rotateAnchor(gw,gz,(9),(13));var gy=((gz[(2)]+gw[(13)])-(gA[(2)]+gw[(11)]));var gx=((gz[(2)+1]+gw[(13)+1])-(gA[(2)+1]+gw[(11)+1]));var gu=((gy*gy)+(gx*gx));if(gu<l.NORMALIZE_SQ_EPSILON){gy=gw[(20)];gx=gw[(20)+1];gu=0}else{gu=Math.sqrt(gu);var gt=(1/gu);gy*=gt;gx*=gt}if(this._equal){gu-=gs;this._slack=false}else{if(gu<gs){gu=(gs-gu);gy=-gy;gx=-gx;this._slack=false}else{if(gu>gv){gu-=gv;this._slack=false}else{gy=-gy;gx=-gx;gu=0;this._slack=true}}}gw[(20)]=gy;gw[(20)+1]=gx;gw[(19)]=(-gu)};gq.prototype._preStep=function(gw){this._posError();if(this._slack){return false}var gt=this._data;var gA=this.bodyA._data;
var gz=this.bodyB._data;var gv=gt[(20)];var gu=gt[(20)+1];var gy=gt[(22)]=((gt[(11)]*gu)-(gt[(11)+1]*gv));var gx=gt[(23)]=((gt[(13)]*gu)-(gt[(13)+1]*gv));gt[(15)]=(gA[(0)]+(gy*gA[(1)]*gy)+gz[(0)]+(gx*gz[(1)]*gx));eW.prototype.safe_invert(gt,(15),(16));if(!this._stiff){if(eW.prototype.soft_params(gt,(15),(18),(19),gw,this._breakUnderError)){return true}}else{gt[(18)]=0;gt[(19)]=0}var gs=eW.prototype.dtRatio(gt,gw);gt[(16)]*=gs;gt[(17)]=(gt[(2)]*gw);return false};gq.prototype._warmStart=function(){if(this._slack){return}var gy=this._data;var gw=this.bodyA._data;var gu=this.bodyB._data;var gx=gy[(16)];var gv=(gy[(20)]*gx);var gt=(gy[(20)+1]*gx);var gs=gw[(0)];gw[(7)]-=(gv*gs);gw[(7)+1]-=(gt*gs);gw[(7)+2]-=(gy[(22)]*gx*gw[(1)]);gs=gu[(0)];gu[(7)]+=(gv*gs);gu[(7)+1]+=(gt*gs);gu[(7)+2]+=(gy[(23)]*gx*gu[(1)])};gq.prototype.getImpulseForBody=function(gs,gx){if(gx===undefined){gx=new bZ.prototype.floatArray(3)}var gw=this._data;var gv=gw[(16)];var gu=(gw[(20)]*gv);var gt=(gw[(20)+1]*gv);if(gs===this.bodyA){gx[0]=-gu;
gx[1]=-gt;gx[2]=-(gw[(22)]*gv)}else{if(gs===this.bodyB){gx[0]=gu;gx[1]=gt;gx[2]=(gw[(23)]*gv)}else{gx[0]=gx[1]=gx[2]=0}}return gx};gq.prototype._iterateVel=function(){if(this._slack){return false}var gu=this._data;var gD=this.bodyA._data;var gC=this.bodyB._data;var gw=gu[(20)];var gv=gu[(20)+1];var gz=gu[(22)];var gy=gu[(23)];var gE=(gu[(19)]-((gw*(gC[(7)]-gD[(7)]))+(gv*(gC[(7)+1]-gD[(7)+1]))+(gy*gC[(7)+2])-(gz*gD[(7)+2])));var gx=gu[(16)];var gt=((gu[(15)]*gE)-(gx*gu[(18)]));var gB=(gx+gt);var gs=gu[(17)];if(!this._equal&&gB>0){gB=0}if(this._breakUnderForce){if(gB>gs||gB<-gs){return true}}else{if(!this._stiff){if(gB>gs){gB=gs}else{if(gB<-gs){gB=-gs}}}}gt=(gB-gx);gu[(16)]=gB;var gG=(gw*gt);var gF=(gv*gt);var gA=gD[(0)];gD[(7)]-=(gG*gA);gD[(7)+1]-=(gF*gA);gD[(7)+2]-=(gu[(22)]*gt*gD[(1)]);gA=gC[(0)];gC[(7)]+=(gG*gA);gC[(7)+1]+=(gF*gA);gC[(7)+2]+=(gu[(23)]*gt*gC[(1)]);return false};gq.prototype._iteratePos=function(){this._posError();if(this._slack){return false}var gK=this._data;var gx=this.bodyA._data;
var gw=this.bodyB._data;var gt=gx[(0)];var gs=gw[(0)];var gF=gx[(1)];var gE=gw[(1)];var gu=gK[(19)];var gJ=gK[(3)];if(this._breakUnderError&&(gu>gJ||gu<-gJ)){return true}var gv=l.DIST_SLOP_SQ;if((gu*gu)<gv){return false}gu*=l.DIST_BIAS_COEF;var gG=(gt+gs);var gI=gK[(20)];var gH=gK[(20)+1];var gD,gz,gy;if((gu*gu)>l.DIST_LARGE_ERROR_SQ){if(gG>l.EFF_MASS_EPSILON){gD=(gu*l.DIST_LARGE_ERROR_BIAS/gG);if(this._equal||gD<0){gz=(gI*gD);gy=(gH*gD);gx[(2)]-=(gz*gt);gx[(2)+1]-=(gy*gt);gw[(2)]+=(gz*gs);gw[(2)+1]+=(gy*gs);this._posError();gu=gK[(19)]*l.DIST_BIAS_COEF;gI=gK[(20)];gH=gK[(20)+1]}}}var gB=((gK[(11)]*gH)-(gK[(11)+1]*gI));var gA=((gK[(13)]*gH)-(gK[(13)+1]*gI));gK[(15)]=(gG+(gB*gF*gB)+(gA*gE*gA));gK[(19)]=gu;eW.prototype.safe_solve(gK,(15),(19),(19));gD=gK[(19)];if(this._equal||gD<0){gz=(gI*gD);gy=(gH*gD);gx[(2)]-=(gz*gt);gx[(2)+1]-=(gy*gt);var gC=(-gB*gF*gD);if(gC!==0){this.bodyA._deltaRotation(gC)}gw[(2)]+=(gz*gs);gw[(2)+1]+=(gy*gs);gC=(gA*gE*gD);if(gC!==0){this.bodyB._deltaRotation(gC)}}return false
};gq.create=function(gx){var gw=new gq();var gv=gw._data=new bZ.prototype.floatArray((24));eW.prototype.init(gw,gx);var gt=gx.anchorA;gv[(7)]=(gt?gt[0]:0);gv[(7)+1]=(gt?gt[1]:0);gt=gx.anchorB;gv[(9)]=(gt?gt[0]:0);gv[(9)+1]=(gt?gt[1]:0);var gu=gv[(5)]=(gx.lowerBound!==undefined?gx.lowerBound:0);var gs=gv[(6)]=(gx.upperBound!==undefined?gx.upperBound:0);gw._equal=(gu===gs);gw._slack=false;gw.bodyA=gx.bodyA;gw.bodyB=gx.bodyB;gv[(20)]=1;gv[(20)+1]=0;return gw};return gq})(eW);ed.prototype._inWorld=eW.prototype.twoBodyInWorld;ed.prototype._outWorld=eW.prototype.twoBodyOutWorld;ed.prototype._pairExists=eW.prototype.twoBodyPairExists;ed.prototype._wakeConnected=eW.prototype.twoBodyWakeConnected;ed.prototype._sleepComputation=eW.prototype.twoBodySleepComputation;var b2=(function(gq){dw(gr,gq);function gr(){gq.apply(this,arguments);this.type="ANGLE";this.dimension=1;this._JACC=(9)}gr.prototype.getLowerBound=function(){return this._data[(5)]};gr.prototype.getUpperBound=function(){return this._data[(6)]
};gr.prototype.getRatio=function(){return this._data[(7)]};gr.prototype.setLowerBound=function(gt){var gs=this._data;if(gs[(5)]!==gt){gs[(5)]=gt;this._equal=(gt===gs[(6)]);this.wake(true)}};gr.prototype.setUpperBound=function(gt){var gs=this._data;if(gs[(6)]!==gt){gs[(6)]=gt;this._equal=(gt===gs[(5)]);this.wake(true)}};gr.prototype.setRatio=function(gs){var gt=this._data;if(gt[(7)]!==gs){gt[(7)]=gs;this.wake(true)}};gr.prototype._posError=function(){var gx=this._data;var gt=this.bodyA._data;var gs=this.bodyB._data;var gu=gx[(7)];var gy=gx[(5)];var gw=gx[(6)];var gv=((gu*gs[(2)+2])-gt[(2)+2]);if(this._equal){gv-=gw;this._slack=false;gx[(13)]=1}else{if(gv<gy){gv=(gy-gv);this._slack=false;gx[(13)]=-1}else{if(gv>gw){gv-=gw;this._slack=false;gx[(13)]=1}else{gv=0;this._slack=true;gx[(13)]=0}}}gx[(12)]=(-gv)};gr.prototype._preStep=function(gt){var gz=this._data;var gw=this.bodyA._data;var gs=this.bodyB._data;var gy=gz[(7)];var gx=gw[(1)];var gv=gs[(1)];gz[(8)]=gx+(gy*gy*gv);eW.prototype.safe_invert(gz,(8),(9));
this._posError();if(this._slack){return false}if(!this._stiff){if(eW.prototype.soft_params(gz,(8),(11),(12),gt,this._breakUnderError)){return true}}else{gz[(11)]=0;gz[(12)]=0}var gu=eW.prototype.dtRatio(gz,gt);gz[(9)]*=gu;gz[(10)]=(gz[(2)]*gt);return false};gr.prototype._warmStart=function(){if(this._slack){return}var gv=this._data;var gu=this.bodyA._data;var gs=this.bodyB._data;var gt=(gv[(9)]*gv[(13)]);gu[(7)+2]-=(gt*gu[(1)]);gs[(7)+2]+=(gt*gv[(7)]*gs[(1)])};gr.prototype.getImpulseForBody=function(gs,gv){if(gv===undefined){gv=new bZ.prototype.floatArray(3)}var gu=this._data;var gt=(gu[(9)]*gu[(13)]);gv[0]=gv[1]=0;gv[2]=(gs===this.bodyA?-1:(gs===this.bodyB?gu[(7)]:0))*gt;return gv};gr.prototype._iterateVel=function(){if(this._slack){return false}var gv=this._data;var gA=this.bodyA._data;var gz=this.bodyB._data;var gt=gv[(13)];var gx=gv[(7)];var gB=(gv[(12)]-(gt*((gx*gz[(7)+2])-gA[(7)+2])));var gw=gv[(9)];var gu=(gv[(8)]*gB)-(gw*gv[(11)]);var gy=(gw+gu);var gs=gv[(10)];if(this._breakUnderForce){if(gy>gs||gy<-gs){return true
}else{if(!this._equal&&gy>0){gy=0}}}else{if(!this._stiff){if(!this._equal){if(gy>0){gy=0}else{if(gy<-gs){gy=-gs}}}else{if(gy>gs){gy=gs}else{if(gy<-gs){gy=-gs}}}}else{if(!this._equal&&gy>0){gy=0}}}gu=(gy-gw);gv[(9)]=gy;gu*=gt;gA[(7)+2]-=(gu*gA[(1)]);gz[(7)+2]+=(gu*gx*gz[(1)]);return false};gr.prototype._iteratePos=function(){this._posError();if(this._slack){return false}var gx=this._data;var gw=gx[(12)];var gv=gx[(3)];if(this._breakUnderError&&(gw>gv||gw<-gv)){return true}var gu=l.ANGLE_SLOP_SQ;if((gw*gw)<gu){return false}gw*=l.ANGLE_BIAS_COEF;var gt=(gw*l.ANGLE_BIAS_COEF*gx[(8)]);if(this._equal||gt<0){var gs=this.bodyA;gt*=gx[(13)];var gy=(-gt*gs._data[(1)]);if(gy!==0){gs._deltaRotation(gy)}gs=this.bodyB;gy=(gt*gs._data[(1)]);if(gy!==0){gs._deltaRotation(gy)}}return false};gr.create=function(gw){var gv=new gr();var gu=gv._data=new bZ.prototype.floatArray((14));eW.prototype.init(gv,gw);gu[(7)]=(gw.ratio!==undefined?gw.ratio:1);var gt=gu[(5)]=(gw.lowerBound!==undefined?gw.lowerBound:0);var gs=gu[(6)]=(gw.upperBound!==undefined?gw.upperBound:0);
gv._equal=(gt===gs);gv._slack=false;gv.bodyA=gw.bodyA;gv.bodyB=gw.bodyB;return gv};return gr})(eW);b2.prototype._inWorld=eW.prototype.twoBodyInWorld;b2.prototype._outWorld=eW.prototype.twoBodyOutWorld;b2.prototype._pairExists=eW.prototype.twoBodyPairExists;b2.prototype._wakeConnected=eW.prototype.twoBodyWakeConnected;b2.prototype._sleepComputation=eW.prototype.twoBodySleepComputation;var dv=(function(gq){dw(gr,gq);function gr(){gq.apply(this,arguments);this.type="WELD";this.dimension=3;this._ANCHOR_A=(5);this._ANCHOR_B=(7);this._JACC=(20)}gr.prototype.getPhase=function(){return this._data[(13)]};gr.prototype.setPhase=function(gs){var gt=this._data;if(gs!==gt[(13)]){gt[(13)]=gs;this.wake(true)}};gr.prototype._preStep=function(gz){var gv=this._data;var gB=this.bodyA._data;var gA=this.bodyB._data;eW.prototype.rotateAnchor(gv,gB,(5),(9));var gD=gv[(9)];var gy=gv[(9)+1];eW.prototype.rotateAnchor(gv,gA,(7),(11));var gC=gv[(11)];var gx=gv[(11)+1];var gw=(gB[(0)]+gA[(0)]);var gu=gB[(1)];var gs=gA[(1)];
gv[(14)]=gw+(gy*gu*gy)+(gx*gs*gx);gv[(14)+1]=-(gD*gu*gy)-(gC*gs*gx);gv[(14)+2]=-(gy*gu)-(gx*gs);gv[(14)+3]=gw+(gD*gu*gD)+(gC*gs*gC);gv[(14)+4]=(gD*gu)+(gC*gs);gv[(14)+5]=gu+gs;eW.prototype.safe_invert3(gv,(14),(20));if(!this._stiff){gv[(25)]=((gB[(2)]+gD)-(gA[(2)]+gC));gv[(25)+1]=((gB[(2)+1]+gy)-(gA[(2)+1]+gx));gv[(25)+2]=((gB[(2)+2]+gv[(13)])-gA[(2)+2]);if(eW.prototype.soft_params3(gv,(14),(24),(25),gz,this._breakUnderError)){return true}}else{gv[(24)]=0;gv[(25)]=0;gv[(25)+1]=0;gv[(25)+2]=0}var gt=eW.prototype.dtRatio(gv,gz);gv[(20)]*=gt;gv[(20)+1]*=gt;gv[(20)+2]*=gt;gv[(23)]=(gv[(2)]*gz);return false};gr.prototype._warmStart=function(){var gy=this._data;var gx=this.bodyA._data;var gv=this.bodyB._data;var gw=gy[(20)];var gu=gy[(20)+1];var gt=gy[(20)+2];var gs=gx[(0)];gx[(7)]-=(gw*gs);gx[(7)+1]-=(gu*gs);gx[(7)+2]-=(((gy[(9)]*gu)-(gy[(9)+1]*gw)+gt)*gx[(1)]);gs=gv[(0)];gv[(7)]+=(gw*gs);gv[(7)+1]+=(gu*gs);gv[(7)+2]+=(((gy[(11)]*gu)-(gy[(11)+1]*gw)+gt)*gv[(1)])};gr.prototype.getImpulseForBody=function(gs,gx){if(gx===undefined){gx=new bZ.prototype.floatArray(3)
}var gw=this._data;var gv=gw[(20)];var gu=gw[(20)+1];var gt=gw[(20)+2];if(gs===this.bodyA){gx[0]=-gv;gx[1]=-gu;gx[2]=-((gw[(9)]*gu)-(gw[(9)+1]*gv)+gt)}else{if(gs===this.bodyB){gx[0]=gv;gx[1]=gu;gx[2]=((gw[(11)]*gu)-(gw[(11)+1]*gv)+gt)}else{gx[0]=gx[1]=gx[2]=0}}return gx};gr.prototype._iterateVel=function(){var gT=this._data;var gy=this.bodyA._data;var gx=this.bodyB._data;var gS=gT[(9)];var gw=gT[(9)+1];var gR=gT[(11)];var gv=gT[(11)+1];var gP=gy[(7)+2];var gO=gx[(7)+2];var gG=(gT[(25)]-(gx[(7)]-(gv*gO))+(gy[(7)]-(gw*gP)));var gF=(gT[(25)+1]-(gx[(7)+1]+(gR*gO))+(gy[(7)+1]+(gS*gP)));var gC=(gT[(25)+2]-gO+gP);var gu=gT[(20)];var gt=gT[(20)+1];var gs=gT[(20)+2];var gz=gT[(24)];var gH=gT[(14)+1];var gE=gT[(14)+2];var gB=gT[(14)+4];var gK=((gT[(14)]*gG)+(gH*gF)+(gE*gC))-(gu*gz);var gJ=((gH*gG)+(gT[(14)+3]*gF)+(gB*gC))-(gt*gz);var gI=((gE*gG)+(gB*gF)+(gT[(14)+5]*gC))-(gs*gz);var gN=(gu+gK);var gM=(gt+gJ);var gL=(gs+gI);var gA=((gN*gN)+(gM*gM)+(gL*gL));var gQ=gT[(23)];if(this._breakUnderForce){if(gA>(gQ*gQ)){return true
}}else{if(!this._stiff){if(gA>(gQ*gQ)){gA=(gQ/Math.sqrt(gA));gN*=gA;gM*=gA;gL*=gA}}}gK=(gN-gu);gJ=(gM-gt);gI=(gL-gs);gT[(20)]=gN;gT[(20)+1]=gM;gT[(20)+2]=gL;var gD=gy[(0)];gy[(7)]-=(gK*gD);gy[(7)+1]-=(gJ*gD);gy[(7)+2]-=(((gS*gJ)-(gw*gK)+gI)*gy[(1)]);gD=gx[(0)];gx[(7)]+=(gK*gD);gx[(7)+1]+=(gJ*gD);gx[(7)+2]+=(((gR*gJ)-(gv*gK)+gI)*gx[(1)]);return false};gr.prototype._iteratePos=function(){var gR=this._data;var gC=this.bodyA._data;var gB=this.bodyB._data;var gv=gC[(0)];var gu=gB[(0)];var gK=gC[(1)];var gJ=gB[(1)];eW.prototype.rotateAnchor(gR,gC,(5),(9));var gN=gR[(9)];var gz=gR[(9)+1];eW.prototype.rotateAnchor(gR,gB,(7),(11));var gM=gR[(11)];var gy=gR[(11)+1];var gt=((gC[(2)]+gN)-(gB[(2)]+gM));var gs=((gC[(2)+1]+gz)-(gB[(2)+1]+gy));var gS=((gC[(2)+2]+gR[(13)])-gB[(2)+2]);var gI=((gt*gt)+(gs*gs));var gA=(gS*gS);var gP=gR[(3)];if(this._breakUnderError&&(gI+gA>(gP*gP))){return true}if(gI<l.WELD_LINEAR_SLOP_SQ&&gA<l.WELD_ANGULAR_SLOP_SQ){return false}var gQ=l.WELD_BIAS_COEF;gt*=gQ;gs*=gQ;gS*=gQ;
gI*=(gQ*gQ);var gL=(gv+gu);var gH,gG;if(gI>l.WELD_LARGE_ERROR_SQ){if(gL>l.EFF_MASS_EPSILON){var gE=(l.WELD_BIAS_COEF/gL);gH=(gt*gE);gG=(gs*gE);var gD=((gH*gH)+(gG*gG));var gw=l.WELD_LARGE_ERROR_MAX;if(gD>(gw*gw)){gD=(gw/Math.sqrt(gD));gH*=gD;gG*=gD}gC[(2)]-=(gH*gv);gC[(2)+1]-=(gG*gv);gB[(2)]+=(gH*gv);gB[(2)+1]+=(gG*gv);gt=((gC[(2)]+gN)-(gB[(2)]+gM));gs=((gC[(2)+1]+gz)-(gB[(2)+1]+gy));gt*=gQ;gs*=gQ;gI=((gt*gt)+(gs*gs))}}gR[(14)]=gL+(gz*gK*gz)+(gy*gJ*gy);gR[(14)+1]=-(gN*gK*gz)-(gM*gJ*gy);gR[(14)+2]=-(gz*gK)-(gy*gJ);gR[(14)+3]=gL+(gN*gK*gN)+(gM*gJ*gM);gR[(14)+4]=(gN*gK)+(gM*gJ);gR[(14)+5]=gK+gJ;if(gI>l.WELD_MAX_LINEAR_ERROR_SQ){gI=(l.WELD_MAX_LINEAR_ERROR/Math.sqrt(gI));gt*=gI;gs*=gI}var gO=l.WELD_MAX_ANGULAR_ERROR;if(gS>gO){gS=gO}else{if(gS<-gO){gS=-gO}}gR[(25)]=gt;gR[(25)+1]=gs;gR[(25)+2]=gS;eW.prototype.safe_solve3(gR,(14),(25),(25));gH=gR[(25)];gG=gR[(25)+1];var gF=gR[(25)+2];gC[(2)]-=(gH*gv);gC[(2)+1]-=(gG*gv);var gx=-(((gN*gG)-(gz*gH)+gF)*gK);if(gx!==0){this.bodyA._deltaRotation(gx)}gB[(2)]+=(gH*gu);
gB[(2)+1]+=(gG*gu);gx=(((gM*gG)-(gy*gH)+gF)*gJ);if(gx!==0){this.bodyB._deltaRotation(gx)}return false};gr.create=function(gv){var gu=new gr();var gt=gu._data=new bZ.prototype.floatArray((28));eW.prototype.init(gu,gv);var gs=gv.anchorA;gt[(5)]=(gs?gs[0]:0);gt[(5)+1]=(gs?gs[1]:0);gs=gv.anchorB;gt[(7)]=(gs?gs[0]:0);gt[(7)+1]=(gs?gs[1]:0);gt[(13)]=(gv.phase!==undefined?gv.phase:0);gu.bodyA=gv.bodyA;gu.bodyB=gv.bodyB;return gu};return gr})(eW);dv.prototype._inWorld=eW.prototype.twoBodyInWorld;dv.prototype._outWorld=eW.prototype.twoBodyOutWorld;dv.prototype._pairExists=eW.prototype.twoBodyPairExists;dv.prototype._wakeConnected=eW.prototype.twoBodyWakeConnected;dv.prototype._sleepComputation=eW.prototype.twoBodySleepComputation;var aq=(function(gr){dw(gq,gr);function gq(){gr.apply(this,arguments);this.type="POINT";this.dimension=2;this._ANCHOR_A=(5);this._ANCHOR_B=(7);this._JACC=(16)}gq.prototype._preStep=function(gz){var gv=this._data;var gB=this.bodyA._data;var gA=this.bodyB._data;eW.prototype.rotateAnchor(gv,gB,(5),(9));
var gD=gv[(9)];var gy=gv[(9)+1];eW.prototype.rotateAnchor(gv,gA,(7),(11));var gC=gv[(11)];var gx=gv[(11)+1];var gw=(gB[(0)]+gA[(0)]);var gu=gB[(1)];var gs=gA[(1)];gv[(13)]=gw+(gy*gu*gy)+(gx*gs*gx);gv[(13)+1]=-(gD*gu*gy)-(gC*gs*gx);gv[(13)+2]=gw+(gD*gu*gD)+(gC*gs*gC);eW.prototype.safe_invert2(gv,(13),(16));if(!this._stiff){gv[(20)]=((gB[(2)]+gD)-(gA[(2)]+gC));gv[(20)+1]=((gB[(2)+1]+gy)-(gA[(2)+1]+gx));if(eW.prototype.soft_params2(gv,(13),(19),(20),gz,this._breakUnderError)){return true}}else{gv[(19)]=0;gv[(20)]=0;gv[(20)+1]=0}var gt=eW.prototype.dtRatio(gv,gz);gv[(16)]*=gt;gv[(16)+1]*=gt;gv[(18)]=(gv[(2)]*gz);return false};gq.prototype._warmStart=function(){var gx=this._data;var gw=this.bodyA._data;var gu=this.bodyB._data;var gv=gx[(16)];var gt=gx[(16)+1];var gs=gw[(0)];gw[(7)]-=(gv*gs);gw[(7)+1]-=(gt*gs);gw[(7)+2]-=(((gx[(9)]*gt)-(gx[(9)+1]*gv))*gw[(1)]);gs=gu[(0)];gu[(7)]+=(gv*gs);gu[(7)+1]+=(gt*gs);gu[(7)+2]+=(((gx[(11)]*gt)-(gx[(11)+1]*gv))*gu[(1)])};gq.prototype.getImpulseForBody=function(gs,gw){if(gw===undefined){gw=new bZ.prototype.floatArray(3)
}var gv=this._data;var gu=gv[(16)];var gt=gv[(16)+1];if(gs===this.bodyA){gw[0]=-gu;gw[1]=-gt;gw[2]=-((gv[(9)]*gt)-(gv[(9)+1]*gu))}else{if(gs===this.bodyB){gw[0]=gu;gw[1]=gt;gw[2]=((gv[(11)]*gt)-(gv[(11)+1]*gu))}else{gw[0]=gw[1]=gw[2]=0}}return gw};gq.prototype._iterateVel=function(){var gN=this._data;var gx=this.bodyA._data;var gw=this.bodyB._data;var gM=gN[(9)];var gv=gN[(9)+1];var gL=gN[(11)];var gu=gN[(11)+1];var gJ=gx[(7)+2];var gI=gw[(7)+2];var gC=(gN[(20)]-(gw[(7)]-(gu*gI))+(gx[(7)]-(gv*gJ)));var gB=(gN[(20)+1]-(gw[(7)+1]+(gL*gI))+(gx[(7)+1]+(gM*gJ)));var gt=gN[(16)];var gs=gN[(16)+1];var gD=gN[(13)+1];var gy=gN[(19)];var gF=((gN[(13)]*gC)+(gD*gB))-(gt*gy);var gE=((gD*gC)+(gN[(13)+2]*gB))-(gs*gy);var gH=(gt+gF);var gG=(gs+gE);var gz=((gH*gH)+(gG*gG));var gK=gN[(18)];if(this._breakUnderForce){if(gz>(gK*gK)){return true}}else{if(!this._stiff){if(gz>(gK*gK)){gz=(gK/Math.sqrt(gz));gH*=gz;gG*=gz}}}gF=(gH-gt);gE=(gG-gs);gN[(16)]=gH;gN[(16)+1]=gG;var gA=gx[(0)];gx[(7)]-=(gF*gA);gx[(7)+1]-=(gE*gA);
gx[(7)+2]-=(((gM*gE)-(gv*gF))*gx[(1)]);gA=gw[(0)];gw[(7)]+=(gF*gA);gw[(7)+1]+=(gE*gA);gw[(7)+2]+=(((gL*gE)-(gu*gF))*gw[(1)]);return false};gq.prototype._iteratePos=function(){var gN=this._data;var gB=this.bodyA._data;var gA=this.bodyB._data;var gv=gB[(0)];var gu=gA[(0)];var gI=gB[(1)];var gH=gA[(1)];eW.prototype.rotateAnchor(gN,gB,(5),(9));var gL=gN[(9)];var gz=gN[(9)+1];eW.prototype.rotateAnchor(gN,gA,(7),(11));var gK=gN[(11)];var gy=gN[(11)+1];var gt=((gB[(2)]+gL)-(gA[(2)]+gK));var gs=((gB[(2)+1]+gz)-(gA[(2)+1]+gy));var gG=((gt*gt)+(gs*gs));var gM=gN[(3)];if(this._breakUnderError&&(gG>(gM*gM))){return true}if(gG<l.POINT_SLOP_SQ){return false}var gO=l.POINT_BIAS_COEF;gt*=gO;gs*=gO;gG*=(gO*gO);var gJ=(gv+gu);var gF,gE;if(gG>l.POINT_LARGE_ERROR_SQ){if(gJ>l.EFF_MASS_EPSILON){var gD=(l.POINT_LARGE_ERROR_BIAS/gJ);gF=(gt*gD);gE=(gs*gD);var gC=((gF*gF)+(gE*gE));var gw=l.POINT_LARGE_ERROR_MAX;if(gC>(gw*gw)){gC=(gw/Math.sqrt(gC));gF*=gC;gE*=gC}gB[(2)]-=(gF*gv);gB[(2)+1]-=(gE*gv);gA[(2)]+=(gF*gv);
gA[(2)+1]+=(gE*gv);gt=((gB[(2)]+gL)-(gA[(2)]+gK));gs=((gB[(2)+1]+gz)-(gA[(2)+1]+gy));gt*=gO;gs*=gO;gG=((gt*gt)+(gs*gs))}}gN[(13)]=(gJ+(gz*gI*gz)+(gy*gH*gy));gN[(13)+1]=(-(gL*gI*gz)-(gK*gH*gy));gN[(13)+2]=(gJ+(gL*gI*gL)+(gK*gH*gK));if(gG>l.POINT_MAX_ERROR_SQ){gG=(l.POINT_MAX_ERROR/Math.sqrt(gG));gt*=gG;gs*=gG}gN[(20)]=gt;gN[(20)+1]=gs;eW.prototype.safe_solve2(gN,(13),(20),(20));gF=gN[(20)];gE=gN[(20)+1];gB[(2)]-=(gF*gv);gB[(2)+1]-=(gE*gv);var gx=-(((gL*gE)-(gz*gF))*gI);if(gx!==0){this.bodyA._deltaRotation(gx)}gA[(2)]+=(gF*gu);gA[(2)+1]+=(gE*gu);gx=(((gK*gE)-(gy*gF))*gH);if(gx!==0){this.bodyB._deltaRotation(gx)}return false};gq.create=function(gv){var gu=new gq();var gt=gu._data=new bZ.prototype.floatArray((22));eW.prototype.init(gu,gv);var gs=gv.anchorA;gt[(5)]=(gs?gs[0]:0);gt[(5)+1]=(gs?gs[1]:0);gs=gv.anchorB;gt[(7)]=(gs?gs[0]:0);gt[(7)+1]=(gs?gs[1]:0);gu.bodyA=gv.bodyA;gu.bodyB=gv.bodyB;return gu};return gq})(eW);aq.prototype._inWorld=eW.prototype.twoBodyInWorld;aq.prototype._outWorld=eW.prototype.twoBodyOutWorld;
aq.prototype._pairExists=eW.prototype.twoBodyPairExists;aq.prototype._wakeConnected=eW.prototype.twoBodyWakeConnected;aq.prototype._sleepComputation=eW.prototype.twoBodySleepComputation;var es=(function(){function gq(){}gq.prototype.computeArea=function(){return 0};gq.prototype.computeMasslessInertia=function(){return 0};gq.prototype.computeCenterOfMass=function(gr){return null};gq.prototype.translate=function(gs,gr){};gq.prototype._update=function(gv,gu,gs,gr,gt){};gq.prototype.clone=function(){return undefined};gq.prototype.getGroup=function(){return this._group};gq.prototype.setGroup=function(gr){this._group=gr;if(this.body){this.body.wake(true)}};gq.prototype.getMask=function(){return this._mask};gq.prototype.setMask=function(gr){this._mask=gr;if(this.body){this.body.wake(true)}};gq.prototype.getMaterial=function(){return this._material};gq.prototype.setMaterial=function(gu){if(this._material!==gu){this._material=gu;if(this.body){this.body._invalidate()}var gt=this.arbiters;var gr=gt.length;
var gs;for(gs=0;gs<gr;gs+=1){gt[gs]._invalidate()}}};gq.prototype.copyCommon=function(gw,gv){gv._type=gw._type;gv._material=gw._material;gv._group=gw._group;gv._mask=gw._mask;gv.sensor=gw.sensor;gv.id=gq.uniqueId;gq.uniqueId+=1;gv.arbiters=[];gv._bphaseHandle=null;gv.userData=gw.userData;var gu=gw._data;var gr=gw._data.length;var gt=gv._data=new bZ.prototype.floatArray(gr);var gs;for(gs=0;gs<gr;gs+=1){gt[gs]=gu[gs]}gv._onPreSolve=[];gv._events=[]};gq.prototype.init=function(gr,gs){gr._material=gs.material||cu.create();gr._group=(gs.group!==undefined)?gs.group:1;gr._mask=(gs.mask!==undefined)?gs.mask:4294967295;gr.sensor=(gs.sensor!==undefined)?gs.sensor:false;gr.arbiters=[];gr._bphaseHandle=null;gr.userData=(gs.userData!==undefined)?gs.userData:null;gr.id=gq.uniqueId;gq.uniqueId+=1;gr._onPreSolve=[];gr._events=[]};gq.eventIndex=function(gu,gv,gx,gw){var gs=gu.length;var gt;for(gt=0;gt<gs;gt+=1){var gr=gu[gt];if(gr.callback===gx&&gr.mask===gw&&gr.type===gv){return gt}}return -1};gq.prototype.addEventListener=function(gt,gx,gv,gw){var gs,gu;
if(gt==="preSolve"){gs=this._onPreSolve;gu=(6)}else{gs=this._events;gu=(gt==="begin"?(1):gt==="progress"?(2):gt==="end"?(3):null)}if(gu===null){return false}if(gt!=="preSolve"){gw=undefined}else{if(gw===undefined){gw=false}}var gr=gq.eventIndex(gs,gu,gx,gv);if(gr!==-1){return false}gs.push({callback:gx,mask:gv,type:gu,deterministic:gw});if(this.body){this.body.wake(true)}return true};gq.prototype.removeEventListener=function(gt,gw,gv){var gs,gu;if(gt==="preSolve"){gs=this._onPreSolve;gu=(6)}else{gs=this._events;gu=(gt==="begin"?(1):gt==="progress"?(2):gt==="end"?(3):null)}if(gu===null){return false}var gr=gq.eventIndex(gs,gu,gw,gv);if(gr===-1){return false}gs.splice(gr,1);if(this.body){this.body.wake(true)}return true};gq.uniqueId=0;return gq})();var er=(function(gq){dw(gr,gq);function gr(){gq.call(this);this.type="CIRCLE"}gr.prototype.computeArea=function(){var gs=this._data[(6)];return(Math.PI*gs*gs)};gr.prototype.computeMasslessInertia=function(){var gu=this._data;var gt=this._data[(6)];
var gs=gu[(7)];var gv=gu[(7)+1];return((0.5*gt*gt)+((gs*gs)+(gv*gv)))};gr.prototype.getRadius=function(){return this._data[(6)]};gr.prototype.setRadius=function(gt){var gs=this.body;if(gs&&gs.world&&(gs._type===(2)||gs.world._midStep)){return}var gu=this._data;if(gt!==gu[(6)]){gu[(6)]=gt;this._validate();if(gs){gs._invalidate()}}};gr.prototype.getOrigin=function(gt){if(gt===undefined){gt=new bZ.prototype.floatArray(2)}var gs=this._data;gt[0]=gs[(7)];gt[1]=gs[(7)+1];return gt};gr.prototype.setOrigin=function(gu){var gs=this.body;if(gs&&gs.world&&(gs._type===(2)||gs.world._midStep)){return}var gw=this._data;var gv=gu[0];var gt=gu[1];if(gw[(7)]!==gv||gw[(7)+1]!==gt){gw[(7)]=gv;gw[(7)+1]=gt;this._validate();if(gs){gs._invalidate()}}};gr.prototype.clone=function(){var gs=new gr();es.prototype.copyCommon(this,gs);return gs};gr.prototype.scale=function(gu){if(gu<=0){return}var gs=this.body;if(gs&&gs.world&&(gs._type===(2)||gs.world._midStep)){return}var gt=this._data;gt[(7)]*=gu;gt[(7)+1]*=gu;
gt[(6)]*=gu;this._validate();if(gs){gs._invalidate()}};gr.prototype.translate=function(gv,gt){var gs=this.body;if(!gt&&gs&&gs.world&&(gs._type===(2)||gs.world._midStep)){return}var gu=this._data;gu[(7)]+=gv[0];gu[(7)+1]+=gv[1];this._validate();if(!gt&&gs){gs._invalidate()}};gr.prototype.rotate=function(gv){var gt=this.body;if(gt&&gt.world&&(gt._type===(2)||gt.world._midStep)){return}var gx=Math.cos(gv);var gu=Math.sin(gv);var gw=this._data;var gs=gw[(7)];var gy=gw[(7)+1];gw[(7)]=((gx*gs)-(gu*gy));gw[(7)+1]=((gu*gs)+(gx*gy));this._validate();if(gt){gt._invalidate()}};gr.prototype.transform=function(gA){var gt=this.body;if(gt&&gt.world&&(gt._type===(2)||gt.world._midStep)){return}var gB=gA[0];var gy=gA[2];var gw=gA[1];var gv=gA[3];var gs=this._data;var gu=((gB*gv)-(gy*gw));if(gu<=0){return}gs[(6)]*=Math.sqrt(gu);var gz=gs[(7)];var gx=gs[(7)+1];gs[(7)]=((gB*gz)+(gy*gx)+gA[4]);gs[(7)+1]=((gw*gz)+(gv*gx)+gA[5]);this._validate();if(gt){gt._invalidate()}};gr.prototype._update=function(gt,gs,gA,gz,gu){var gx=this._data;
var gC=gx[(7)];var gB=gx[(7)+1];var gw=gx[(9)]=gt+(gA*gC)-(gz*gB);var gv=gx[(9)+1]=gs+(gz*gC)+(gA*gB);if(!gu){var gy=gx[(6)];gx[(0)]=(gw-gy);gx[(0)+1]=(gv-gy);gx[(0)+2]=(gw+gy);gx[(0)+3]=(gv+gy)}};gr.prototype._validate=function(){var gw=this._data;var gv=gw[(7)];var gu=gw[(7)+1];var gs=gw[(6)];var gt=Math.sqrt((gv*gv)+(gu*gu));gw[(4)]=(gs+gt);gw[(5)]=(gw[(4)]-Math.max(gs-gt,0))};gr.prototype.computeCenterOfMass=function(gs){return this.getOrigin(gs)};gr.create=function(gw){var gx=new gr();gx._type=(0);es.prototype.init(gx,gw);var gs=gw.radius;var gu=(gw.origin?gw.origin[0]:0);var gt=(gw.origin?gw.origin[1]:0);var gv=gx._data=new bZ.prototype.floatArray((11));gv[(6)]=gs;gv[(7)]=gu;gv[(7)+1]=gt;gx._validate();return gx};gr.version=1;return gr})(es);var O=(function(gr){dw(gq,gr);function gq(){gr.call(this);this.type="POLYGON"}gq.prototype.computeArea=function(){var gw=this._data;var gt=(6);var gs=gw.length;var gv=0;for(;gt<gs;gt+=(13)){var gu=gt+(13);if(gu===gs){gu=(6)}gv+=((gw[gt+(0)]*gw[gu+(0)+1])-(gw[gt+(0)+1]*gw[gu+(0)]))
}return(gv*0.5)};gq.prototype.computeMasslessInertia=function(){var gv=this._data;var gx=(6);var gu=gv.length;var gD=0;var gC=0;for(;gx<gu;gx+=(13)){var gw=gx+(13);if(gw===gu){gw=(6)}var gt=gv[gx+(0)];var gB=gv[gx+(0)+1];var gs=gv[gw+(0)];var gz=gv[gw+(0)+1];var gA=(gt*gz)-(gs*gB);var gy=((gt*gt)+(gB*gB))+((gs*gs)+(gz*gz))+((gt*gs)+(gB*gz));gD+=(gA*gy);gC+=gA}return(gD/(6*gC))};gq.prototype.computeCenterOfMass=function(gC){if(gC===undefined){gC=new bZ.prototype.floatArray(2)}var gz=this._data;var gB=(6);var gx=gz.length;var gu=0;var gy=0;var gv=0;for(;gB<gx;gB+=(13)){var gA=gB+(13);if(gA===gx){gA=(6)}var gt=gz[gB+(0)];var gF=gz[gB+(0)+1];var gs=gz[gA+(0)];var gD=gz[gA+(0)+1];var gE=((gt*gD)-(gF*gs));gu+=gE;gy+=((gt+gs)*gE);gv+=((gF+gD)*gE)}var gw=(1/(3*gu));gC[0]=(gy*gw);gC[1]=(gv*gw);return gC};gq.prototype.setVertices=function(gt){var gs=this.body;if(gs&&gs.world&&(gs._type===(2)||gs.world._midStep)){return}this._validate(gt);if(gs){gs._invalidate()}};gq.prototype.clone=function(){var gs=new gq();
es.prototype.copyCommon(this,gs);return gs};gq.prototype.scale=function(gL,gI){var gA=this.body;if(gA&&gA.world&&(gA._type===(2)||gA.world._midStep)){return}if(gI===undefined){gI=gL}if(gL<=0||gI<=0){return}var gE=(1/gL);var gD=(1/gI);var gM=this._data;var gG=gM.length;var gu=(6);var gt=0;var gF=Number.POSITIVE_INFINITY;for(;gu<gG;gu+=(13)){var gy=(gM[gu+(0)]*=gL);var gx=(gM[gu+(0)+1]*=gI);var gJ=(gM[gu+(4)]*gE);var gH=(gM[gu+(4)+1]*gD);var gv=(1/Math.sqrt((gJ*gJ)+(gH*gH)));gM[gu+(4)]=(gJ*=gv);gM[gu+(4)+1]=(gH*=gv);var gK=gM[gu+(8)]=((gJ*gy)+(gH*gx));if(gK<gF){gF=gK}var gs=((gy*gy)+(gx*gx));if(gs>gt){gt=gs}var gC=(gu+(13));if(gC===gG){gC=(6)}var gB=((gM[gC+(0)]*gL)-gy);var gz=((gM[gC+(0)+1]*gI)-gx);var gw=Math.sqrt((gB*gB)+(gz*gz));gM[gu+(12)]=gw}gM[(4)]=Math.sqrt(gt);gM[(5)]=(gM[(4)]-Math.max(gF,0));if(gA){gA._invalidate()}};gq.prototype.translate=function(gs,gG){var gA=this.body;if(!gG&&gA&&gA.world&&(gA._type===(2)||gA.world._midStep)){return}var gv=this._data;var gt=gv.length;var gC=(6);
var gw=gs[0];var gu=gs[1];var gB=0;var gy=Number.POSITIVE_INFINITY;for(;gC<gt;gC+=(13)){var gF=(gv[gC+(0)]+=gw);var gD=(gv[gC+(0)+1]+=gu);var gz=gv[gC+(4)];var gx=gv[gC+(4)+1];var gH=(gv[gC+(8)]+=((gz*gw)+(gx*gu)));if(gH<gy){gy=gH}var gE=((gF*gF)+(gD*gD));if(gE>gB){gB=gE}}gv[(4)]=Math.sqrt(gB);gv[(5)]=(gv[(4)]-Math.max(gy,0));if(!gG&&gA){gA._invalidate()}};gq.prototype.rotate=function(gA){var gu=this.body;if(gu&&gu.world&&(gu._type===(2)||gu.world._midStep)){return}var gt=this._data;var gs=gt.length;var gv=(6);var gz=Math.cos(gA);var gw=Math.sin(gA);for(;gv<gs;gv+=(13)){var gy=gt[gv+(0)];var gx=gt[gv+(0)+1];gt[gv+(0)]=((gy*gz)-(gx*gw));gt[gv+(0)+1]=((gy*gw)+(gx*gz));gy=gt[gv+(4)];gx=gt[gv+(4)+1];gt[gv+(4)]=((gy*gz)-(gx*gw));gt[gv+(4)+1]=((gy*gw)+(gx*gz))}if(gu){gu._invalidate()}};gq.prototype.transform=function(gE){var gA=this.body;if(gA&&gA.world&&(gA._type===(2)||gA.world._midStep)){return}var gN=gE[0];var gL=gE[2];var gJ=gE[1];var gH=gE[3];var gO=gE[4];var gM=gE[5];if(((gN*gH)-(gL*gJ))<=0){return
}var gP=this._data;var gF=gP.length;var gu=(6);var gy,gx;for(;gu<gF;gu+=(13)){gy=gP[gu+(0)];gx=gP[gu+(0)+1];gP[gu+(0)]=((gN*gy)+(gL*gx)+gO);gP[gu+(0)+1]=((gJ*gy)+(gH*gx)+gM)}var gt=0;var gD=Number.POSITIVE_INFINITY;gu=(6);for(;gu<gF;gu+=(13)){gy=gP[gu+(0)];gx=gP[gu+(0)+1];var gC=(gu+(13));if(gC===gF){gC=(6)}var gB=-(gP[gC+(0)]-gy);var gz=-(gP[gC+(0)+1]-gx);var gw=Math.sqrt((gB*gB)+(gz*gz));var gv=(1/gw);var gI=(-gz*gv);var gG=(gB*gv);gP[gu+(4)]=gI;gP[gu+(4)+1]=gG;gP[gu+(12)]=gw;var gK=gP[gu+(8)]=((gI*gy)+(gG*gx));var gs=((gy*gy)+(gx*gx));if(gs>gt){gt=gs}if(gK<gD){gD=gK}}gP[(4)]=Math.sqrt(gt);gP[(5)]=(gP[(4)]-Math.max(gD,0));if(gA){gA._invalidate()}};gq.prototype._update=function(gz,gy,gt,gs,gu){var gK=this._data;var gD=gK.length;var gx=(6);var gC;var gJ,gG,gH,gE;for(;gx<gD;gx+=(13)){var gB=gK[gx+(0)];var gA=gK[gx+(0)+1];var gw=gK[gx+(2)]=gz+(gt*gB)-(gs*gA);var gv=gK[gx+(2)+1]=gy+(gs*gB)+(gt*gA);gB=gK[gx+(4)];gA=gK[gx+(4)+1];var gI=gK[gx+(6)]=(gt*gB)-(gs*gA);var gF=gK[gx+(6)+1]=(gs*gB)+(gt*gA);
gK[gx+(9)]=(gI*gw)+(gF*gv);gK[gx+(10)]=(gI*gv)-(gF*gw);if(gx!==(6)){gC=gx-(13);gK[gC+(11)]=((gK[gC+(6)]*gv)-(gK[gC+(6)+1]*gw));if(!gu){if(gw<gJ){gJ=gw}else{if(gw>gH){gH=gw}}if(gv<gG){gG=gv}else{if(gv>gE){gE=gv}}}}else{if(!gu){gJ=gH=gw;gG=gE=gv}}}gx=(6);gC=gK.length-(13);gK[gC+(11)]=((gK[gC+(6)]*gK[gx+(2)+1])-(gK[gC+(6)+1]*gK[gx+(2)]));if(!gu){gK[(0)]=gJ;gK[(0)+1]=gG;gK[(0)+2]=gH;gK[(0)+3]=gE}};gq.prototype._validate=function(gx){var gt=gx.length;var gL=this._data;var gF=(6)+(gt*(13));if(!gL||gF!==gL.length){gL=this._data=new bZ.prototype.floatArray(gF)}var gw=0;var gG=Number.POSITIVE_INFINITY;var gy=(6);var gH;for(gH=0;gH<gt;gH+=1,gy+=(13)){var gv=gx[gH];var gu=gx[(gH===(gt-1)?0:(gH+1))];var gC=gv[0];var gB=gv[1];var gE=gC-gu[0];var gD=gB-gu[1];var gA=Math.sqrt((gE*gE)+(gD*gD));var gz=(1/gA);var gJ=(-gD*gz);var gI=(gE*gz);gL[gy+(0)]=gC;gL[gy+(0)+1]=gB;gL[gy+(4)]=gJ;gL[gy+(4)+1]=gI;gL[gy+(12)]=gA;var gK=gL[gy+(8)]=((gJ*gC)+(gI*gB));var gs=((gC*gC)+(gB*gB));if(gs>gw){gw=gs}if(gK<gG){gG=gK
}}gL[(4)]=Math.sqrt(gw);gL[(5)]=(gL[(4)]-Math.max(gG,0))};gq.create=function(gu,gs){var gt=new gq();gt._type=(1);es.prototype.init(gt,gu);gt._validate(gs||gu.vertices);return gt};gq.version=1;return gq})(es);O;var eS=(function(){function gq(){}gq.prototype.isDynamic=function(){return(this._type===(0))};gq.prototype.setAsDynamic=function(){if(this.world&&this.world._midStep){return}this._setTypeValue((0));var gt=this._data;var gs=gt[(23)];var gr=gt[(24)];gt[(0)]=(gs===Number.POSITIVE_INFINITY?0:(1/gs));gt[(1)]=(gr===Number.POSITIVE_INFINITY?0:(1/gr))};gq.prototype.isStatic=function(){return(this._type===(2))};gq.prototype.setAsStatic=function(){if(this.world&&this.world._midStep){return}this._setTypeValue((2));var gr=this._data;gr[(0)]=gr[(1)]=0;gr[(7)]=gr[(7)+1]=gr[(7)+2]=0};gq.prototype.isKinematic=function(){return(this._type===(1))};gq.prototype.setAsKinematic=function(){if(this.world&&this.world._midStep){return}this._setTypeValue((1));var gr=this._data;gr[(0)]=gr[(1)]=0};gq.prototype._setTypeValue=function(gr){if(gr===this._type){return
}if(!this.world){this._type=gr;return}this.world._transmitBodyType(this,gr)};gq.prototype.applyImpulse=function(gx,gt){if(this._type!==(0)){return}var gw=this._data;var gs,gy;if(gt){gs=(gt[0]-gw[(2)]);gy=(gt[1]-gw[(2)+1])}else{gs=0;gy=0}var gv=gx[0];var gr=gx[1];var gu=gw[(0)];gw[(7)]+=(gv*gu);gw[(7)+1]+=(gr*gu);gw[(7)+2]+=(((gs*gr)-(gy*gv))*gw[(1)]);this.wake(true)};gq.prototype.setVelocityFromPosition=function(gt,gv,gr){if(this._type===(2)){return}var gu=this._data;var gs=(1/gr);gu[(7)]=((gt[0]-gu[(2)])*gs);gu[(7)+1]=((gt[1]-gu[(2)+1])*gs);gu[(7)+2]=((gv-gu[(2)+2])*gs);this.wake(true)};gq.prototype.transformWorldPointToLocal=function(gv,gx){if(gx===undefined){gx=new bZ.prototype.floatArray(2)}var gu=this._data;var gt=gu[(5)];var gs=gu[(5)+1];var gr=(gv[0]-gu[(2)]);var gw=(gv[1]-gu[(2)+1]);gx[0]=((gt*gr)+(gs*gw));gx[1]=((gt*gw)-(gs*gr));return gx};gq.prototype.transformWorldVectorToLocal=function(gv,gx){if(gx===undefined){gx=new bZ.prototype.floatArray(2)}var gu=this._data;var gt=gu[(5)];
var gs=gu[(5)+1];var gr=gv[0];var gw=gv[1];gx[0]=((gt*gr)+(gs*gw));gx[1]=((gt*gw)-(gs*gr));return gx};gq.prototype.transformLocalPointToWorld=function(gv,gx){if(gx===undefined){gx=new bZ.prototype.floatArray(2)}var gu=this._data;var gt=gu[(5)];var gs=gu[(5)+1];var gr=gv[0];var gw=gv[1];gx[0]=((gt*gr)-(gs*gw)+gu[(2)]);gx[1]=((gs*gr)+(gt*gw)+gu[(2)+1]);return gx};gq.prototype.transformLocalVectorToWorld=function(gv,gx){if(gx===undefined){gx=new bZ.prototype.floatArray(2)}var gu=this._data;var gt=gu[(5)];var gs=gu[(5)+1];var gr=gv[0];var gw=gv[1];gx[0]=((gt*gr)-(gs*gw));gx[1]=((gs*gr)+(gt*gw));return gx};gq.prototype.getPosition=function(gs){if(gs===undefined){gs=new bZ.prototype.floatArray(2)}var gr=this._data;gs[0]=gr[(2)];gs[1]=gr[(2)+1];return gs};gq.prototype.setPosition=function(gr){if(this.world&&(this.world._midStep||this._type===(2))){return}var gs=this._data;var gu=gr[0];var gt=gr[1];if((gs[(2)]!==gu)||(gs[(2)+1]!==gt)){gs[(2)]=gu;gs[(2)+1]=gt;this._invalidated=true;this.wake(true)
}};gq.prototype.getRotation=function(){return this._data[(2)+2]};gq.prototype.setRotation=function(gr){if(this.world&&(this.world._midStep||this._type===(2))){return}var gs=this._data;if(gs[(2)+2]!==gr){this._data[(2)+2]=gr;this._data[(5)]=Math.cos(gr);this._data[(5)+1]=Math.sin(gr);this._invalidated=true;this.wake(true)}};gq.prototype.getVelocity=function(gs){if(gs===undefined){gs=new bZ.prototype.floatArray(2)}var gr=this._data;gs[0]=gr[(7)];gs[1]=gr[(7)+1];return gs};gq.prototype.setVelocity=function(gr){if(this._type===(2)){return}var gs=this._data;var gu=gr[0];var gt=gr[1];if((gs[(7)]!==gu)||(gs[(7)+1]!==gt)){gs[(7)]=gu;gs[(7)+1]=gt;this.wake(true)}};gq.prototype.getAngularVelocity=function(){return this._data[(7)+2]};gq.prototype.setAngularVelocity=function(gs){if(this._type===(2)){return}var gr=this._data;if(gr[(7)+2]!==gs){gr[(7)+2]=gs;this.wake(true)}};gq.prototype.getForce=function(gs){if(gs===undefined){gs=new bZ.prototype.floatArray(2)}var gr=this._data;gs[0]=gr[(10)];gs[1]=gr[(10)+1];
return gs};gq.prototype.setForce=function(gs){var gr=this._data;var gu=gs[0];var gt=gs[1];if((gr[(10)]!==gu)||(gr[(10)+1]!==gt)){gr[(10)]=gu;gr[(10)+1]=gt;this.wake(true)}};gq.prototype.getTorque=function(){return this._data[(10)+2]};gq.prototype.setTorque=function(gr){var gs=this._data;if(gs[(10)+2]!==gr){gs[(10)+2]=gr;this.wake(true)}};gq.prototype.getSurfaceVelocity=function(gs){if(gs===undefined){gs=new bZ.prototype.floatArray(2)}var gr=this._data;gs[0]=gr[(13)];gs[1]=gr[(13)+1];return gs};gq.prototype.setSurfaceVelocity=function(gr){var gs=this._data;gs[(13)]=gr[0];gs[(13)+1]=gr[1];this.wake(true)};gq.prototype.getMass=function(){return this._data[(23)]};gq.prototype.getInertia=function(){return this._data[(24)]};gq.prototype.setMass=function(gr){var gt=this._data;var gs=gt[(23)];if(!this._customMass||(gs!==gr)){gt[(23)]=gr;this._customMass=true;this._invalidateMassInertia()}};gq.prototype.setMassFromShapes=function(){if(this._customMass){this._customMass=false;this._data[(23)]=this.computeMassFromShapes();
this._invalidateMassInertia()}};gq.prototype.setInertia=function(gs){var gt=this._data;var gr=gt[(24)];if(!this._customInertia||(gr!==gs)){gt[(24)]=gs;this._customInertia=true;this._invalidateMassInertia()}};gq.prototype.setInertiaFromShapes=function(){if(this._customInertia){this._customInertia=false;this._data[(24)]=this.computeInertiaFromShapes();this._invalidateMassInertia()}};gq.prototype._invalidateMassInertia=function(){var gv=this._data;var gs=gv[(23)];var gr=gv[(24)];var gu=(this._type!==(0));var gt=Number.POSITIVE_INFINITY;gv[(0)]=(gu||gs===gt)?0:(1/gs);gv[(1)]=(gu||gr===gt)?0:(1/gr);this.wake(true)};gq.prototype.getLinearDrag=function(){return(1-Math.exp(this._data[(21)]))};gq.prototype.setLinearDrag=function(gr){this._data[(21)]=Math.log(1-gr);this.wake(true)};gq.prototype.getAngularDrag=function(){return(1-Math.exp(this._data[(22)]))};gq.prototype.setAngularDrag=function(gr){this._data[(22)]=Math.log(1-gr);this.wake(true)};gq.prototype.addShape=function(gs){if(this.world&&(this.world._midStep||this._type===(2))){return false
}if(gs.body){return false}gs.body=this;this.shapes.push(gs);if(this.world){this.wake(true);this.world._addShape(gs)}var gr=gs._data[(4)];var gt=this._data;if(gr>gt[(19)]){gt[(19)]=gr}this._invalidate();return true};gq.prototype.removeShape=function(gv){if(this.world&&(this.world._midStep||this._type===(2))){return false}if(gv.body!==this){return false}if(this.world){this.wake(true);this.world._removeShape(gv)}gv.body=null;var gu=this.shapes;var gt=(gu.length-1);var gw=gu.indexOf(gv);gu[gw]=gu[gt];gu.pop();var gx;var gs=0;for(gx=0;gx<gt;gx+=1){gv=gu[gx];var gr=gv._data[(4)];if(gr>gs){gs=gr}}this._data[(19)]=gs;this._invalidate();return true};gq.prototype.computeMassFromShapes=function(){var gv=0;var gu;var gs=this.shapes;var gr=gs.length;for(gu=0;gu<gr;gu+=1){var gt=gs[gu];gv+=gt._material._data[(4)]*gt.computeArea()}return gv};gq.prototype.computeInertiaFromShapes=function(){var gt=0;var gv;var gs=this.shapes;var gr=gs.length;for(gv=0;gv<gr;gv+=1){var gu=gs[gv];gt+=gu._material._data[(4)]*gu.computeMasslessInertia()*gu.computeArea()
}return gt};gq.prototype.wake=function(gr){if(!this.world){this.sleeping=false;return}this.world._wakeBody(this,!gr)};gq.prototype.sleep=function(){if(!this.world){this.sleeping=true;return}this.world._forceSleepBody(this)};gq.prototype.computeLocalCenterOfMass=function(gA){if(gA===undefined){gA=new bZ.prototype.floatArray(2)}var gx=0;var gw=0;var gu=0;var gr=this.shapes;var gs=gr.length;var gt;for(gt=0;gt<gs;gt+=1){var gy=gr[gt];gy.computeCenterOfMass(gA);var gz=gy.computeArea()*gy._material._data[(4)];gx+=(gA[0]*gz);gw+=(gA[1]*gz);gu+=gz}var gv=(1/gu);gA[0]=(gx*gv);gA[1]=(gw*gv);return gA};gq.prototype.computeWorldBounds=function(gC){if(gC===undefined){gC=new bZ.prototype.floatArray(4)}var gu=Number.POSITIVE_INFINITY;var gy=gu;var gx=gu;var gs=-gu;var gr=-gu;this._update();var gv=this.shapes;var gz=gv.length;var gA;for(gA=0;gA<gz;gA+=1){var gB=gv[gA]._data;var gw=gB[(0)];var gE=gB[(0)+1];var gt=gB[(0)+2];var gD=gB[(0)+3];if(gw<gy){gy=gw}if(gt>gs){gs=gt}if(gE<gx){gx=gE}if(gD>gr){gr=gD}}gC[0]=gy;
gC[1]=gx;gC[2]=gs;gC[3]=gr;return gC};gq.prototype.alignWithOrigin=function(){if(this.world&&(this.world._midStep||this._type===(2))){return}var gt=this.computeLocalCenterOfMass();gt[0]*=-1;gt[1]*=-1;var gs=this.shapes;var gr=gs.length;var gu;for(gu=0;gu<gr;gu+=1){gs[gu].translate(gt,true)}this._invalidate()};gq.prototype._invalidate=function(){this._invalidated=true;var gs=this._customMass;var gr=this._customInertia;if((!gs)||(!gr)){if(!gs){this._data[(23)]=this.computeMassFromShapes()}if(!gr){this._data[(24)]=this.computeInertiaFromShapes()}this._invalidateMassInertia()}this.wake(true)};gq.prototype._update=function(){if(this._invalidated){this._invalidated=false;var gu=this._data;var gs=this.shapes;var gr=gs.length;var gt;for(gt=0;gt<gr;gt+=1){gs[gt]._update(gu[(2)],gu[(2)+1],gu[(5)],gu[(5)+1])}}};gq.prototype._atRest=function(gu,gt){if(this._type!==(0)){return this.sleeping}else{var gw=this._data;var gx;do{var gs=gw[(7)];var gy=gw[(7)+1];var gv=l.SLEEP_LINEAR_SQ;if(((gs*gs)+(gy*gy))>gv){gx=false;
break}gs=(gw[(2)]-gw[(15)]);gy=(gw[(2)+1]-gw[(15)+1]);var gr=(gu*gu*gv);if(((gs*gs)+(gy*gy))>gr){gx=false;break}gy=gw[(19)];gs=gw[(7)+2]*gy;gv=l.SLEEP_ANGULAR_SQ;if((gs*gs)>gv){gx=false;break}gs=(gw[(2)+2]-gw[(15)+2])*gy;gr=(gu*gu*gv);gx=(gs*gs<=gr)}while(false);if(!gx){this._wakeTime=gt;return false}else{return((this._wakeTime+l.SLEEP_DELAY)<gt)}}};gq.prototype._deltaRotation=function(gy){var gw=this._data;var gA=(gw[(2)+2]+=gy);if((gy*gy)>l.DELTA_ROTATION_EPSILON){gw[(5)]=Math.cos(gA);gw[(5)+1]=Math.sin(gA)}else{var gs=(gy*gy);var gt=(1-(0.5*gs));var gv=(1-(gs*gs*0.125));var gz=gw[(5)];var gx=gw[(5)+1];var gr=((gt*gx)+(gy*gz))*gv;var gu=((gt*gz)-(gy*gx))*gv;gw[(5)]=gu;gw[(5)+1]=gr}return gA};gq.prototype._sweepIntegrate=function(gr){var gt=this._data;var gu=(gr-gt[(18)]);if(gu!==0){gt[(18)]=gr;gt[(2)]+=(gt[(7)]*gu);gt[(2)+1]+=(gt[(7)+1]*gu);var gs=gt[(20)];if(gs!==0){this._deltaRotation(gt[(20)]*gu)}}};gq.prototype.integrate=function(gr){if(this.world&&(this.world._midStep||this._type===(2))){return
}var gs=this._data;gs[(18)]=0;gs[(20)]=gs[(7)+2];this._sweepIntegrate(gr);gs[(18)]=0;this._invalidated=true;this.wake(true)};gq.prototype.addEventListener=function(gt,gu){var gs=(gt==="wake"?this._onWake:gt==="sleep"?this._onSleep:null);if(gs===null){return false}var gr=gs.indexOf(gu);if(gr!==-1){return false}gs.push(gu);this.wake();return true};gq.prototype.removeEventListener=function(gt,gu){var gs=(gt==="wake"?this._onWake:gt==="sleep"?this._onSleep:null);if(gs===null){return false}var gr=gs.indexOf(gu);if(gr===-1){return false}gs.splice(gr,1);this.wake();return true};gq.create=function(gF){var gG=new gq();var gI=gG._data=new bZ.prototype.floatArray((25));var gu=Number.POSITIVE_INFINITY;gG._type=(gF.type==="dynamic"?(0):gF.type==="static"?(2):gF.type==="kinematic"?(1):(0));var gC=gF.shapes;gG.shapes=[];gG.constraints=[];gG.world=null;var gt=0;if(gC){var gE=gC.length;var gD;for(gD=0;gD<gE;gD+=1){var gr=gC[gD];if(gr.body===gG){continue}gr.body=gG;gG.shapes.push(gr);var gH=gr._data[(4)];
if(gH>gt){gt=gH}}}gI[(19)]=gt;gG._customMass=(gF.mass!==undefined);gG._customInertia=(gF.inertia!==undefined);var gB=(gG._customMass?gF.mass:gG.computeMassFromShapes());var gw=(gG._customInertia?gF.inertia:gG.computeInertiaFromShapes());var gs=(gG._type===(0));var gx=(gG._type===(2));gI[(0)]=((!gs)||gB===gu)?0:(1/gB);gI[(1)]=((!gs)||gw===gu)?0:(1/gw);gI[(23)]=gB;gI[(24)]=gw;var gA=gF.position;var gz=gI[(2)]=(gA?gA[0]:0);var gy=gI[(2)+1]=(gA?gA[1]:0);var gv=gI[(2)+2]=(gF.rotation||0);gI[(5)]=Math.cos(gv);gI[(5)+1]=Math.sin(gv);gI[(15)]=gz;gI[(15)+1]=gy;gI[(15)+2]=gv;gA=gF.velocity;gI[(7)]=(((!gx)&&gA)?gA[0]:0);gI[(7)+1]=(((!gx)&&gA)?gA[1]:0);gI[(7)+2]=(((!gx)&&gF.angularVelocity)||0);gA=gF.force;gI[(10)]=(gA?gA[0]:0);gI[(10)+1]=(gA?gA[1]:0);gI[(10)+2]=(gF.torque||0);gA=gF.surfaceVelocity;gI[(13)]=(gA?gA[0]:0);gI[(13)+1]=(gA?gA[1]:0);gG.sleeping=(gF.sleeping||false);gG.bullet=(gF.bullet||false);gG._sweepFrozen=(gG._type!==(0));gG._deferred=false;gG._island=null;gG._islandRank=0;gG._islandRoot=null;
gG._isBody=true;gG._wakeTime=0;gG._woken=false;gG._invalidated=true;gI[(21)]=Math.log(1-(gF.linearDrag!==undefined?gF.linearDrag:0.05));gI[(22)]=Math.log(1-(gF.angularDrag!==undefined?gF.angularDrag:0.05));gG.userData=(gF.userData||null);gG._onWake=[];gG._onSleep=[];return gG};gq.version=1;return gq})();var cI=(function(){function gq(){this.thisObject=null;this.callback=null;this.time=0;this.index=0;this.arbiter=null;this.next=null}gq.allocate=function(){if(gq.pool){var gr=gq.pool;gq.pool=gr.next;gr.next=null;return gr}else{return(new gq())}};gq.deallocate=function(gr){gr.next=gq.pool;gq.pool=gr;gr.thisObject=null;gr.callback=null;gr.arbiter=null};gq.pool=null;return gq})();var fW=(function(){function gq(){this.components=[];this.sleeping=false;this.wakeTime=0;this.next=null}gq.allocate=function(){if(gq.pool){var gr=gq.pool;gq.pool=gr.next;gr.next=null;return gr}else{return(new gq())}};gq.deallocate=function(gr){gr.next=gq.pool;gq.pool=gr;gr.wakeTime=0};gq.pool=null;return gq})();var d1=(function(){function gq(){this.next=null;
this.shapeA=null;this.shapeB=null;this.frozenA=this.frozenB=false;this.arbiter=null;this.failed=false;this.slipped=false;this._data=new bZ.prototype.floatArray((7))}gq.allocate=function(){if(gq.pool){var gr=gq.pool;gq.pool=gr.next;gr.next=null;return gr}else{return(new gq())}};gq.deallocate=function(gr){gr.next=gq.pool;gq.pool=gr;gr.shapeA=gr.shapeB=null;gr.failed=false;gr.slipped=false;gr.arbiter=null};gq.pool=null;return gq})();var a3=(function(){function gq(){this.boxTreeIndex=-1;this.data=null;this.isStatic=false}gq.allocate=function(){if(0<this.pool.length){return this.pool.pop()}else{return new gq()}};gq.deallocate=function(gr){this.pool.push(gr);gr.data=null};gq.pool=[];return gq})();var e6=(function(){function gq(){this.staticTree=f5.create(true);this.dynamicTree=f5.create(false);this.overlappingNodes=[]}gq.prototype.sample=function(gu,gt,gs){var gr=this.overlappingNodes;var gv=this.staticTree.getOverlappingNodes(gu,gr,0);gv+=this.dynamicTree.getOverlappingNodes(gu,gr,gv);var gw;
for(gw=0;gw<gv;gw+=1){gt.call(gs,gr[gw],gu)}};gq.prototype.insert=function(gu,gs,gr){var gt=a3.allocate();gt.data=gu;gt.isStatic=gr;if(gr){this.staticTree.add(gt,gs)}else{this.dynamicTree.add(gt,gs)}return gt};gq.prototype.update=function(gt,gs,gr){if(gr!==undefined&&gt.isStatic!==gr){if(gt.isStatic){this.staticTree.remove(gt);this.dynamicTree.add(gt,gs)}else{this.dynamicTree.remove(gt);this.staticTree.add(gt,gs)}gt.isStatic=gr}else{if(gr){this.staticTree.update(gt,gs)}else{this.dynamicTree.update(gt,gs)}}};gq.prototype.remove=function(gr){if(gr.isStatic){this.staticTree.remove(gr)}else{this.dynamicTree.remove(gr)}a3.deallocate(gr)};gq.prototype.clear=function(gs,gr){this._clearTree(this.staticTree,gs,gr);this._clearTree(this.dynamicTree,gs,gr)};gq.prototype._clearTree=function(gr,gx,gt){var gs=gr.getNodes();var gu=gs.length;var gw;for(gw=0;gw<gu;gw+=1){var gv=gs[gw].externalNode;if(gv){if(gx){gx.call(gt,gv)}a3.deallocate(gv)}}gr.clear()};gq.prototype._validate=function(){this.staticTree.finalize();
this.dynamicTree.finalize()};gq.prototype.perform=function(gw,gx){this._validate();var gC=this.overlappingNodes;var gB=this.staticTree;var gz=this.dynamicTree;var gA=gz.getNodes();var gt=gA.length;var gs;for(gs=0;gs<gt;gs+=1){var gD=gA[gs];var gv=gD.externalNode;if(gv){var gy=gB.getOverlappingNodes(gD.extents,gC,0);var gu;for(gu=0;gu<gy;gu+=1){gw.call(gx,gv,gC[gu])}}}var gr=gz.getOverlappingPairs(gC,0);for(gs=0;gs<gr;gs+=2){gw.call(gx,gC[gs],gC[gs+1])}};gq.create=function(){return new gq()};gq.version=1;return gq})();var dD=(function(){function gq(){this._next=null;this._prev=null;this._aabb=new bZ.prototype.floatArray(4);this.data=null;this.isStatic=false}gq.allocate=function(){if(!this.pool){return new gq()}else{var gr=this.pool;this.pool=gr._next;gr._next=null;return gr}};gq.deallocate=function(gr){gr._prev=null;gr._next=this.pool;this.pool=gr;gr.data=null};gq.pool=null;return gq})();var fX=(function(){function gq(){}gq.prototype.sample=function(gz,gx,gy){var gv=gz[0];var gu=gz[1];var gs=gz[2];
var gr=gz[3];this._validate();var gt=this._list;while(gt){var gw=gt._aabb;if(gw[2]<gv){gt=gt._next;continue}if(gw[0]>gs){break}if(gw[1]<=gr&&gu<=gw[3]){gx.call(gy,gt,gz)}gt=gt._next}};gq.prototype.insert=function(gw,gs,gr){var gv=dD.allocate();var gu=gv._aabb;gu[0]=gs[0];gu[1]=gs[1];gu[2]=gs[2];gu[3]=gs[3];gv.data=gw;gv.isStatic=gr;var gt=this._list;gv._next=gt;if(gt){gt._prev=gv}this._list=gv;return gv};gq.prototype.update=function(gu,gs,gr){var gt=gu._aabb;gt[0]=gs[0];gt[1]=gs[1];gt[2]=gs[2];gt[3]=gs[3];if(gr!==undefined){gu.isStatic=gr}};gq.prototype.remove=function(gr){if(!gr._prev){this._list=gr._next}else{gr._prev._next=gr._next}if(gr._next){gr._next._prev=gr._prev}dD.deallocate(gr)};gq.prototype.clear=function(gu,gr){var gt=this._list;while(gt){var gs=gt._next;if(gu){gu.call(gr,gt)}dD.deallocate(gt);gt=gs}this._list=null};gq.prototype._validate=function(){if(!this._list){return}var gs=this._list._next;while(gs){var gt=gs._next;var gr=gs._prev;var gv=gs._aabb[0];if(gv>gr._aabb[0]){gs=gt;
continue}while(gr._prev&&gr._prev._aabb[0]>gv){gr=gr._prev}var gu=gs._prev;gu._next=gt;if(gt){gt._prev=gu}if(!gr._prev){gs._prev=null;this._list=gs;gs._next=gr;gr._prev=gs}else{gs._prev=gr._prev;gr._prev=gs;gs._prev._next=gs;gs._next=gr}gs=gt}};gq.prototype.perform=function(gu,gt){this._validate();var gx=this._list;while(gx){var gw=gx._next;var gs=gx._aabb;var gv=gx.isStatic;var gy=gs[2];while(gw){var gr=gw._aabb;if(gr[0]>gy){break}if(gv&&gw.isStatic){gw=gw._next;continue}if(gs[1]>gr[3]||gr[1]>gs[3]){gw=gw._next;continue}gu.call(gt,gx,gw);gw=gw._next}gx=gx._next}};gq.create=function(){var gr=new gq();gr._list=null;return gr};gq.version=1;return gq})();var fI=(function(){function gq(){this._data=new bZ.prototype.floatArray((17));this.fresh=false;this._hash=0;this._timeStamp=0;this._next=null;this.active=false;this.virtual=false}gq.allocate=function(){if(!this.pool){return new gq()}else{var gr=this.pool;this.pool=gr._next;gr._next=null;return gr}};gq.deallocate=function(gr){gr._next=this.pool;
this.pool=gr};gq.prototype.getPosition=function(gs){if(gs===undefined){gs=new bZ.prototype.floatArray(2)}var gr=this._data;gs[0]=gr[(0)];gs[1]=gr[(0)+1];return gs};gq.prototype.getPenetration=function(){return(-this._data[(2)])};gq.prototype.getNormalImpulse=function(){return(this.virtual?0:this._data[(11)])};gq.prototype.getTangentImpulse=function(){return(this.virtual?0:this._data[(12)])};gq.version=1;gq.pool=null;return gq})();var aR=(function(){function gq(){this.shapeA=null;this.shapeB=null;this.bodyA=null;this.bodyB=null;this._next=null;this._retired=false;this._lazyRetired=false;this._static=false;this._state=0;this.sensor=false;this._createStamp=0;this._updateStamp=0;this._sleepStamp=0;this._timeStamp=0;this._createContinuous=false;this._endGenerated=0;this._midStep=false;this.sleeping=false;this.active=false;this._invalidated=false;this._data=new bZ.prototype.floatArray((24));this.contacts=[];this._userdef=0;this._velocity2Contact=false;this._position2Contact=false;this._contact1=this._contact2=null;
this._faceType=0}gq.prototype.getNormal=function(gs){if(gs===undefined){gs=new bZ.prototype.floatArray(2)}if(this.sensor){gs[0]=gs[1]=0}else{var gr=this._data;gs[0]=gr[(4)];gs[1]=gr[(4)+1]}return gs};gq.prototype.getRollingImpulse=function(){if(this.sensor||this._velocity2Contact||this._contact1._hash!==(0)){return 0}else{return this._data[(16)]}};gq.prototype.getElasticity=function(){if(this.sensor){return undefined}this._validate();return this._data[(2)]};gq.prototype.getDynamicFriction=function(){if(this.sensor){return undefined}this._validate();return this._data[(0)]};gq.prototype.getStaticFriction=function(){if(this.sensor){return undefined}this._validate();return this._data[(1)]};gq.prototype.getRollingFriction=function(){if(this.sensor){return undefined}this._validate();return this._data[(3)]};gq.prototype.setElasticity=function(gr){if(this.sensor){return}this._data[(2)]=gr;this._userdef|=(1<<(2));this._invalidate(true)};gq.prototype.setDynamicFriction=function(gr){if(this.sensor){return
}this._data[(0)]=gr;this._userdef|=(1<<(0));this._invalidate(true)};gq.prototype.setStaticFriction=function(gr){if(this.sensor){return}this._data[(1)]=gr;this._userdef|=(1<<(1));this._invalidate(true)};gq.prototype.setRollingFriction=function(gr){if(this.sensor){return}this._data[(3)]=gr;this._userdef|=(1<<(3));this._invalidate(true)};gq.prototype.setElasticityFromShapes=function(){if(this.sensor){return}this._userdef&=~(1<<(2));this._invalidate(true)};gq.prototype.setDynamicFrictionFromShapes=function(){if(this.sensor){return}this._userdef&=~(1<<(0));this._invalidate(true)};gq.prototype.setStaticFrictionFromShapes=function(){if(this.sensor){return}this._userdef&=~(1<<(1));this._invalidate(true)};gq.prototype.setRollingFrictionFromShapes=function(){if(this.sensor){return}this._userdef&=~(1<<(3));this._invalidate(true)};gq.prototype.isStateAccepted=function(){if(this.sensor){return false}else{return((this._state&(1))!==0)}};gq.prototype.isStatePersistent=function(){if(this.sensor){return false
}else{return((this._state&(2))!==0)}};gq.prototype.setAcceptedState=function(gr){if(this.sensor){return}if(gr){this._state|=(1)}else{this._state&=~(1)}this._invalidate(true)};gq.prototype.setPersistentState=function(gr){if(this.sensor){return}if(gr){this._state|=(2)}else{this._state&=~(2)}this._invalidate(true)};gq.prototype._lazyRetire=function(gt){this._lazyRetired=true;this._retired=true;this.active=false;var gs;var gr;if(this.shapeA!==gt){gs=this.shapeA.arbiters;gr=gs.indexOf(this);gs[gr]=gs[gs.length-1];gs.pop()}if(this.shapeB!==gt){gs=this.shapeB.arbiters;gr=gs.indexOf(this);gs[gr]=gs[gs.length-1];gs.pop()}};gq.prototype._assign=function(gs,gr){this.bodyA=gs.body;this.bodyB=gr.body;this.shapeA=gs;this.shapeB=gr;gs.arbiters.push(this);gr.arbiters.push(this);this._retired=false;this.sleeping=false;this._invalidate()};gq.prototype._retire=function(){this.shapeA=this.shapeB=null;this.bodyA=this.bodyB=null;this._retired=true;this._lazyRetired=false;this.active=false;this._data[(6)]=0;var gs=this.contacts;
while(gs.length>0){var gr=gs.pop();fI.deallocate(gr)}this._contact1=this._contact2=null};gq.prototype._invalidate=function(gr){this._invalidated=true;if(gr&&!this._midStep){this.shapeA.body.wake();this.shapeB.body.wake()}};gq.prototype._validate=function(){this._invalidated=false;var gv=this._data;var gy=this.shapeA._material._data;var gx=this.shapeB._material._data;var gs=this._userdef;if((gs&(1<<(2)))===0){var gw;var gt=gy[(0)];var gr=gx[(0)];if(gt<=Number.NEGATIVE_INFINITY||gr<=Number.NEGATIVE_INFINITY){gw=0}else{if(gt>=Number.POSITIVE_INFINITY||gr>=Number.POSITIVE_INFINITY){gw=1}else{gw=(gt+gr)*0.5;if(gw<0){gw=0}else{if(gw>1){gw=1}}}}gv[(2)]=gw}var gu=Math.sqrt;if((gs&(1<<(0)))===0){gv[(0)]=gu(gy[(2)]*gx[(2)])}if((gs&(1<<(1)))===0){gv[(1)]=gu(gy[(1)]*gx[(1)])}if((gs&(1<<(3)))===0){gv[(3)]=gu(gy[(3)]*gx[(3)])}};gq.prototype._injectContact=function(gA,gz,gw,gv,gy,gu,gr){var gx;var gB=this.contacts;var gs=gB.length;if(gs!==0){gx=gB[0];if(gx._hash!==gu){if(gs!==1){gx=gB[1];if(gx._hash!==gu){gx=null
}}else{gx=null}}}if(gr===undefined){gr=false}var gt;if(!gx){gx=fI.allocate();gt=gx._data;gt[(11)]=gt[(12)]=0;gx._hash=gu;gx.fresh=(!gr);gB.push(gx);if(gu===(0)){this._data[(16)]=0}}else{gx.fresh=(!gr&&gx.virtual);gt=gx._data}gt[(0)]=gA;gt[(0)+1]=gz;gt[(2)]=gy;gx._timeStamp=this._timeStamp;gx.virtual=gr;gt=this._data;gt[(4)]=gw;gt[(4)+1]=gv;return gx};gq.prototype._cleanContacts=function(gt){var gs=true;this._position2Contact=false;this._contact2=null;var gw=this.contacts;var gr=gw.length;var gv;for(gv=0;gv<gr;){var gx=gw[gv];if(gx._timeStamp+l.DELAYED_DEATH<gt){gr-=1;gw[gv]=gw[gr];gw.pop();fI.deallocate(gx);continue}gx.active=(gx._timeStamp===gt);if(gx.active){if(gs){this._contact1=gx;gs=false}else{this._contact2=gx;this._position2Contact=true}}gv+=1}if(this._position2Contact){if(this._contact1.virtual){var gu=this._contact1;this._contact1=this._contact2;this._contact2=gu}this._velocity2Contact=!(this._contact2.virtual)}else{this._velocity2Contact=false}return !gs};gq.prototype._preStep=function(g2,hf,gV){if(!this._cleanContacts(hf)){return false
}if(this._invalidated){this._validate()}var gN=this._data;var gT=gN[(6)];var gU=(gT===0)?1:(g2/gT);gN[(6)]=g2;var g6=this.bodyA._data;var g5=this.bodyB._data;var gM=g6[(2)];var gu=g6[(2)+1];var gK=g5[(2)];var gs=g5[(2)+1];var gX=g6[(7)];var gJ=g6[(7)+1];var hh=g6[(7)+2];var gW=g5[(7)];var gH=g5[(7)+1];var he=g5[(7)+2];var g4=gN[(4)];var g3=gN[(4)+1];var gC=g6[(0)]+g5[(0)];var gy=g6[(1)];var gx=g5[(1)];var gt=l.EFF_MASS_EPSILON;var gS=(gV?(this._static?l.CONT_STATIC_BIAS_COEF:l.CONT_BIAS_COEF):this._static?l.STATIC_BIAS_COEF:l.BIAS_COEF);gN[(15)]=gS;var hc=this._contact1;var hb;var gB,g1,gz,g0;while(true){hb=hc._data;var gE=hb[(0)];var gD=hb[(0)+1];gB=hb[(7)]=(gE-gM);g1=hb[(7)+1]=(gD-gu);gz=hb[(9)]=(gE-gK);g0=hb[(9)+1]=(gD-gs);var hg=(gB*g4)+(g1*g3);var hd=(gz*g4)+(g0*g3);var g8=gC+(gx*hd*hd)+(gy*hg*hg);hb[(6)]=(g8<gt)?0:(1/g8);hg=(gB*g3)-(g1*g4);hd=(gz*g3)-(g0*g4);var ha=gC+(gx*hd*hd)+(gy*hg*hg);hb[(5)]=(ha<gt)?0:(1/ha);var g9=(gW-(g0*he))-(gX-(g1*hh));var g7=(gH+(gz*he))-(gJ+(gB*hh));var gO=(g4*g9)+(g3*g7);
var gA=(gO*gN[(2)]);if(gA>-l.BOUNCE_VELOCITY_THRESHOLD){gA=0}hb[(3)]=gA;gO=(g4*g7)-(g3*g9);if((gO*gO)>l.STATIC_FRIC_SQ_EPSILON){hb[(4)]=gN[(0)]}else{hb[(4)]=gN[(1)]}hb[(11)]*=gU;hb[(12)]*=gU;if(this._velocity2Contact){if(hc===this._contact2){break}hc=this._contact2}else{break}}hb=this._contact1._data;gB=hb[(7)];g1=hb[(7)+1];gz=hb[(9)];g0=hb[(9)+1];var gw=gN[(7)]=(gB*g3)-(g1*g4);var gv=gN[(8)]=(gz*g3)-(g0*g4);gN[(9)]=(gB*g4)+(g1*g3);gN[(10)]=(gz*g4)+(g0*g3);if(!this._velocity2Contact&&this._contact1._hash===(0)){gN[(16)]*=gU;var gL=gy+gx;gN[(17)]=(gL<gt)?0:(1/gL)}else{if(this._velocity2Contact){hb=this._contact2._data;var gI=hb[(7)];var gr=hb[(7)+1];var gG=hb[(9)];var hi=hb[(9)+1];var gZ=gN[(16)]=(gI*g3)-(gr*g4);var gY=gN[(17)]=(gG*g3)-(hi*g4);gN[(18)]=(gI*g4)+(gr*g3);gN[(19)]=(gG*g4)+(hi*g3);var gR=gN[(20)]=gC+(gy*gw*gw)+(gx*gv*gv);var gQ=gN[(20)+1]=gC+(gy*gw*gZ)+(gx*gv*gY);var gP=gN[(20)+2]=gC+(gy*gZ*gZ)+(gx*gY*gY);var gF=((gR*gP)-(gQ*gQ));if((gR*gR)>(l.ILL_THRESHOLD*gF)){if(this._contact2._data[(2)]<this._contact1._data[(2)]){this._contact1=this._contact2;
gN[(7)]=gZ;gN[(8)]=gY;gN[(9)]=gN[(18)];gN[(10)]=gN[(19)]}this._velocity2Contact=false;this._position2Contact=false;this._contact2=null}else{gN[(23)]=(1/gF)}}}return true};gq.prototype._iterateVelocity=function(){var he=this.bodyA._data;var hd=this.bodyB._data;var g8=he[(0)];var gx=he[(1)];var g7=hd[(0)];var gv=hd[(1)];var g1=he[(7)];var gL=he[(7)+1];var hj=he[(7)+2];var g0=hd[(7)];var gJ=hd[(7)+1];var hi=hd[(7)+2];var gP=this._data;var hc=gP[(4)];var hb=gP[(4)+1];var gw=gP[(7)];var gu=gP[(8)];var gO=gP[(9)];var gN=gP[(10)];var hh=this._contact1._data;var gD=hh[(7)];var ha=hh[(7)+1];var gC=hh[(9)];var g9=hh[(9)+1];var g4=(hd[(13)]-he[(13)]);var g2=(hd[(13)+1]-he[(13)+1]);var gY=(g0-(g9*hi))-(g1-(ha*hj));var gH=(gJ+(gC*hi))-(gL+(gD*hj));var hf,gz,gT,gF,gE,g3;hf=(((hc*gH)-(hb*gY))+g4)*hh[(6)];g3=(hh[(4)]*hh[(11)]);gz=hh[(12)];gT=(gz-hf);if(gT>g3){gT=g3}else{if(gT<-g3){gT=-g3}}hf=(gT-gz);hh[(12)]=gT;gF=(-hb*hf);gE=(hc*hf);g1-=(gF*g8);gL-=(gE*g8);hj-=(gO*hf*gx);g0+=(gF*g7);gJ+=(gE*g7);hi+=(gN*hf*gv);
if(this._velocity2Contact){var hg=this._contact2._data;var gK=hg[(7)];var gr=hg[(7)+1];var gI=hg[(9)];var hk=hg[(9)+1];var gS=gP[(20)];var gR=gP[(20)+1];var gQ=gP[(20)+2];var gM=gP[(23)];var g6=gP[(16)];var g5=gP[(17)];var gt=gP[(18)];var gs=gP[(19)];var gV=(g0-(hk*hi))-(g1-(gr*hj));var gG=(gJ+(gI*hi))-(gL+(gK*hj));hf=(((hc*gG)-(hb*gV))+g4)*hg[(6)];g3=(hg[(4)]*hg[(11)]);gz=hg[(12)];gT=(gz-hf);if(gT>g3){gT=g3}else{if(gT<-g3){gT=-g3}}hf=(gT-gz);hg[(12)]=gT;gF=(-hb*hf);gE=(hc*hf);g1-=(gF*g8);gL-=(gE*g8);hj-=(gt*hf*gx);g0+=(gF*g7);gJ+=(gE*g7);hi+=(gs*hf*gv);gY=(g0-(g9*hi))-(g1-(ha*hj));gH=(gJ+(gC*hi))-(gL+(gD*hj));gV=(g0-(hk*hi))-(g1-(gr*hj));gG=(gJ+(gI*hi))-(gL+(gK*hj));var gA=hh[(11)];var gy=hg[(11)];var gX=((gY*hc)+(gH*hb))+g2+hh[(3)]-((gS*gA)+(gR*gy));var gU=((gV*hc)+(gG*hb))+g2+hg[(3)]-((gR*gA)+(gQ*gy));var gZ=gM*((gR*gU)-(gQ*gX));var gW=gM*((gR*gX)-(gS*gU));if(gZ>=0&&gW>=0){gX=(gZ-gA);gU=(gW-gy);hh[(11)]=gZ;hg[(11)]=gW}else{gZ=-(hh[(5)]*gX);if(gZ>=0&&((gR*gZ)+gU)>=0){gX=(gZ-gA);gU=-gy;
hh[(11)]=gZ;hg[(11)]=0}else{gW=-(hg[(5)]*gU);if(gW>=0&&((gR*gW)+gX)>=0){gX=-gA;gU=(gW-gy);hh[(11)]=0;hg[(11)]=gW}else{if(gX>=0&&gU>=0){gX=-gA;gU=-gy;hh[(11)]=hg[(11)]=0}else{gX=0;gU=0}}}}hf=(gX+gU);gF=(hc*hf);gE=(hb*hf);g1-=(gF*g8);gL-=(gE*g8);hj-=((gw*gX)+(g6*gU))*gx;g0+=(gF*g7);gJ+=(gE*g7);hi+=((gu*gX)+(g5*gU))*gv}else{if(this._contact1._hash===(0)){var gB=(hi-hj);hf=(gB*gP[(17)]);g3=(gP[(3)]*hh[(11)]);gz=gP[(16)];gT=(gz-hf);if(gT>g3){gT=g3}else{if(gT<-g3){gT=-g3}}hf=(gT-gz);gP[(16)]=gT;hj-=(hf*gx);hi+=(hf*gv)}gY=(g0-(g9*hi))-(g1-(ha*hj));gH=(gJ+(gC*hi))-(gL+(gD*hj));hf=(hh[(3)]+g2+((hc*gY)+(hb*gH)))*hh[(5)];gz=hh[(11)];gT=(gz-hf);if(gT<0){gT=0}hf=(gT-gz);hh[(11)]=gT;gF=(hc*hf);gE=(hb*hf);g1-=(gF*g8);gL-=(gE*g8);hj-=(gw*hf*gx);g0+=(gF*g7);gJ+=(gE*g7);hi+=(gu*hf*gv)}he[(7)]=g1;he[(7)+1]=gL;he[(7)+2]=hj;hd[(7)]=g0;hd[(7)+1]=gJ;hd[(7)+2]=hi};gq.prototype._refreshContactData=function(){var g1=this.bodyA._data;var gZ=this.bodyB._data;var gT=g1[(5)];var gP=g1[(5)+1];var gS=gZ[(5)];var gO=gZ[(5)+1];
var gF=g1[(2)];var gs=g1[(2)+1];var gE=gZ[(2)];var gr=gZ[(2)+1];var g3,gY,gX;var gG=this._data;var gt=gG[(14)];var g6=this._contact1._data;if(this._faceType===(0)){var gR=g6[(13)];var gQ=g6[(13)+1];var gx=((gT*gR)-(gP*gQ)+gF);var gW=((gP*gR)+(gT*gQ)+gs);gR=g6[(15)];gQ=g6[(15)+1];var gw=((gS*gR)-(gO*gQ)+gE);var gU=((gO*gR)+(gS*gQ)+gr);var gv=(gw-gx);var gu=(gU-gW);var gB=Math.sqrt((gv*gv)+(gu*gu));gY=gG[(4)];gX=gG[(4)+1];if(gB<l.NORMALIZE_EPSILON){gv=gY;gu=gX}else{var gV=(1/gB);gv*=gV;gu*=gV}g3=(gB-gt);if(((gv*gY)+(gu*gX))<0){g3-=gt;gv=-gv;gu=-gu}gG[(4)]=gv;gG[(4)+1]=gu;var gz,gy,gC;if(this.shapeA._type===(0)){gC=this.shapeA._data[(6)]+(g3*0.5);gz=g6[(0)]=(gx+(gv*gC));gy=g6[(0)+1]=(gW+(gu*gC))}else{gC=this.shapeB._data[(6)]+(g3*0.5);gz=g6[(0)]=(gw-(gv*gC));gy=g6[(0)+1]=(gU-(gu*gC))}g6[(2)]=g3}else{var g5=(this._position2Contact?this._contact2._data:null);var gH;var g2,g0,gN,gL;var gJ=gG[(11)];var gI=gG[(11)+1];var gM=g6[(13)];var gK=g6[(13)+1];if(this._faceType===(1)){gY=(gJ*gT)-(gI*gP);
gX=(gJ*gP)+(gI*gT);gH=gG[(13)]+((gY*gF)+(gX*gs));g2=(gE+(gM*gS)-(gK*gO));gN=(gr+(gM*gO)+(gK*gS));if(g5){gM=g5[(13)];gK=g5[(13)+1];g0=(gE+(gM*gS)-(gK*gO));gL=(gr+(gM*gO)+(gK*gS))}}else{gY=(gJ*gS)-(gI*gO);gX=(gJ*gO)+(gI*gS);gH=gG[(13)]+((gY*gE)+(gX*gr));g2=(gF+(gM*gT)-(gK*gP));gN=(gs+(gM*gP)+(gK*gT));if(g5){gM=g5[(13)];gK=g5[(13)+1];g0=(gF+(gM*gT)-(gK*gP));gL=(gs+(gM*gP)+(gK*gT))}}var g4=(this._reverse?-1:1);gG[(4)]=(g4*gY);gG[(4)+1]=(g4*gX);var gA=-gH-gt;g3=((g2*gY)+(gN*gX))+gA;var gD=((g3*0.5)+gt);g6[(0)]=(g2-(gY*gD));g6[(0)+1]=(gN-(gX*gD));g6[(2)]=g3;if(g5){g3=((g0*gY)+(gL*gX))+gA;gD=((g3*0.5)+gt);g5[(0)]=(g0-(gY*gD));g5[(0)+1]=(gL-(gX*gD));g5[(2)]=g3}}};gq.prototype._iteratePosition=function(){this._refreshContactData();var gM=this.bodyA;var gK=this.bodyB;var g6=gM._data;var g5=gK._data;var g2=g6[(0)];var gw=g6[(1)];var g0=g5[(0)];var gu=g5[(1)];var gG=g6[(2)];var gs=g6[(2)+1];var gF=g5[(2)];var gr=g5[(2)+1];var gA,gz,g4,g3,gU,gT,gE,gy,gL,hb;var gR,gP,gD,gB,gv,gt;var gH=this._data;var g8=this._contact1._data;
var gO=g8[(2)]+l.CONTACT_SLOP;if(this._position2Contact){var g7=this._contact2._data;var gN=g7[(2)]+l.CONTACT_SLOP;if(gO<0||gN<0){gA=g8[(0)];gz=g8[(0)+1];gR=(gA-gG);gP=(gz-gs);gD=(gA-gF);gB=(gz-gr);gA=g7[(0)];gz=g7[(0)+1];var ha=(gA-gG);var g9=(gz-gs);var gW=(gA-gF);var gV=(gz-gr);g4=gH[(4)];g3=gH[(4)+1];gv=(gR*g3)-(gP*g4);gt=(gD*g3)-(gB*g4);var gY=(ha*g3)-(g9*g4);var gX=(gW*g3)-(gV*g4);var gx=(g2+g0);gL=gx+(gw*gv*gv)+(gu*gt*gt);var gJ=gx+(gw*gv*gY)+(gu*gt*gX);var gI=gx+(gw*gY*gY)+(gu*gX*gX);hb=gH[(15)];var g1=(gO*hb);var gZ=(gN*hb);var gC=((gL*gI)-(gJ*gJ));var gS,gQ;if(gC===0){gS=(gL===0)?0:(-g1/gL);gQ=(gI===0)?0:(-gZ/gI)}else{gC=(1/gC);gS=(gC*(gJ*gZ-gI*g1));gQ=(gC*(gJ*g1-gL*gZ))}if(gS<0||gQ<0){gS=(-g1/gL);gQ=0;if(gS<0||((gJ*gS)+gZ)<0){gS=0;gQ=(-gZ/gI);if(gQ<0||((gJ*gQ)+g1)<0){gS=gQ=0}}}gE=gS+gQ;gU=(g4*gE);gT=(g3*gE);gG-=(gU*g2);gs-=(gT*g2);gy=-((gv*gS)+(gY*gQ))*gw;if(gy!==0){gM._deltaRotation(gy)}gF+=(gU*g0);gr+=(gT*g0);gy=((gt*gS)+(gX*gQ))*gu;if(gy!==0){gK._deltaRotation(gy)}}}else{if(gO<0){gA=g8[(0)];
gz=g8[(0)+1];gR=(gA-gG);gP=(gz-gs);gD=(gA-gF);gB=(gz-gr);g4=gH[(4)];g3=gH[(4)+1];gv=(gR*g3)-(gP*g4);gt=(gD*g3)-(gB*g4);gL=g0+(gt*gt*gu)+g2+(gv*gv*gw);if(gL!==0){hb=gH[(15)];gE=-(hb*gO/gL);gU=(g4*gE);gT=(g3*gE);gG-=(gU*g2);gs-=(gT*g2);gy=-(gv*gw*gE);if(gy!==0){gM._deltaRotation(gy)}gF+=(gU*g0);gr+=(gT*g0);gy=(gt*gu*gE);if(gy!==0){gK._deltaRotation(gy)}}}}g6[(2)]=gG;g6[(2)+1]=gs;g5[(2)]=gF;g5[(2)+1]=gr};gq.prototype._warmStart=function(){var gw=this.bodyA._data;var gu=this.bodyB._data;var gA=gw[(0)];var gt=gw[(1)];var gz=gu[(0)];var gs=gu[(1)];var gE=this._data;var gy=gE[(4)];var gx=gE[(4)+1];var gB=this._contact1._data;var gv=gB[(11)];var gr=gB[(12)];var gD=(gy*gv)-(gx*gr);var gC=(gx*gv)+(gy*gr);gw[(7)]-=(gD*gA);gw[(7)+1]-=(gC*gA);gw[(7)+2]-=((gB[(7)]*gC)-(gB[(7)+1]*gD))*gt;gu[(7)]+=(gD*gz);gu[(7)+1]+=(gC*gz);gu[(7)+2]+=((gB[(9)]*gC)-(gB[(9)+1]*gD))*gs;if(this._velocity2Contact){gB=this._contact2._data;gv=gB[(11)];gr=gB[(12)];gD=(gy*gv)-(gx*gr);gC=(gx*gv)+(gy*gr);gw[(7)]-=(gD*gA);gw[(7)+1]-=(gC*gA);
gw[(7)+2]-=((gB[(7)]*gC)-(gB[(7)+1]*gD))*gt;gu[(7)]+=(gD*gz);gu[(7)+1]+=(gC*gz);gu[(7)+2]+=((gB[(9)]*gC)-(gB[(9)+1]*gD))*gs}else{if(this._contact1._hash===(0)){gv=gE[(16)];gw[(7)+2]-=(gv*gt);gu[(7)+2]+=(gv*gs)}}};gq.prototype.getImpulseForBody=function(gu,gy){if(gy===undefined){gy=new bZ.prototype.floatArray(3)}var gD=this._data;var gv=gD[(4)];var gt=gD[(4)+1];var gA=this._contact1._data;var gs=gA[(11)];var gr=gA[(12)];var gC=(gv*gs)-(gt*gr);var gB=(gt*gs)+(gv*gr);var gx=0;var gw=0;var gz=0;if(gu===this.bodyA){gx-=gC;gw-=gB;gz-=((gA[(7)]*gB)-(gA[(7)+1]*gC))}else{if(gu===this.bodyB){gx+=gC;gw+=gB;gz+=((gA[(9)]*gB)-(gA[(9)+1]*gC))}}if(this._velocity2Contact){gA=this._contact2._data;gs=gA[(11)];gr=gA[(12)];gC=(gv*gs)-(gt*gr);gB=(gt*gs)+(gv*gr);if(gu===this.bodyA){gx-=gC;gw-=gB;gz-=((gA[(7)]*gB)-(gA[(7)+1]*gC))}else{if(gu===this.bodyB){gx+=gC;gw+=gB;gz+=((gA[(9)]*gB)-(gA[(9)+1]*gC))}}}else{if(this._contact1._hash===(0)){gs=gD[(16)];gz+=(gu===this.bodyA?-1:(gu===this.bodyB?1:0))*gs}}gy[0]=gx;
gy[1]=gw;gy[2]=gz;return gy};gq.allocate=function(){if(!this.pool){return new gq()}else{var gr=this.pool;this.pool=gr._next;gr._next=null;return gr}};gq.deallocate=function(gr){gr._next=this.pool;this.pool=gr;gr._userdef=0};gq.version=1;gq.pool=null;return gq})();var cv=(function(){function gq(){}gq.prototype.getGravity=function(gr){if(gr===undefined){gr=new bZ.prototype.floatArray(2)}gr[0]=this._gravityX;gr[1]=this._gravityY;return gr};gq.prototype.setGravity=function(gw){var gv=gw[0];var gu=gw[1];if(gv!==this._gravityX||gu!==this._gravityY){this._gravityX=gv;this._gravityY=gu;var gs=this.rigidBodies;var gr=gs.length;var gt;for(gt=0;gt<gr;gt+=1){this._wakeBody(gs[gt])}}};gq.prototype._addShape=function(gs){var gr=gs.body;gr._update();var gt=((gr._type===(2))||gr.sleeping);gs._bphaseHandle=this.broadphase.insert(gs,gs._data,gt)};gq.prototype._removeShape=function(gt,gs){var gr=gt.body;this.broadphase.remove(gt._bphaseHandle);gt._bphaseHandle=null;var gu=gt.arbiters;while(gu.length!==0){var gv=gu.pop();
if(gv._retired){continue}if(gv.bodyA!==gr&&gv.bodyA._type===(0)){this._wakeBody(gv.bodyA)}if(gv.bodyB!==gr&&gv.bodyB._type===(0)){this._wakeBody(gv.bodyB)}gv._lazyRetire(gt);if(!gs){this._pushInteractionEvents((3),gv)}}};gq.prototype._enabledConstraint=function(gr){gr._islandRoot=gr;gr._islandRank=0;if(!gr.sleeping){gr.sleeping=true;this._wakeConstraint(gr,true)}};gq.prototype._disabledConstraint=function(gs){this._wakeConstraint(gs);var gt=this.liveConstraints;var gr=gt.indexOf(gs);gt[gr]=gt[gt.length-1];gt.pop()};gq.prototype.addConstraint=function(gr){if(gr.world){return false}gr.world=this;this.constraints.push(gr);gr._inWorld();if(gr._active){this._enabledConstraint(gr)}return true};gq.prototype.removeConstraint=function(gs){if(gs.world!==this){return false}var gt=this.constraints;var gr=gt.indexOf(gs);gt[gr]=gt[gt.length-1];gt.pop();if(gs._active){this._disabledConstraint(gs)}gs.world=null;gs._outWorld();return true};gq.prototype.addRigidBody=function(gr){if(gr.world){return false
}gr.world=this;this.rigidBodies.push(gr);gr._update();var gu;var gt=gr.shapes;var gs=gt.length;for(gu=0;gu<gs;gu+=1){this._addShape(gt[gu])}if(gr._type===(2)){gr.sleeping=true;return true}gr._islandRoot=gr;gr._islandRank=0;if(!gr.sleeping){gr.sleeping=true;this._wakeBody(gr,true)}return true};gq.prototype.removeRigidBody=function(gr,gu){if(gr.world!==this){return false}this._wakeBody(gr);gr.world=null;var gy=this.rigidBodies;var gv=gy.indexOf(gr);gy[gv]=gy[gy.length-1];gy.pop();if(!gr.sleeping&&(gr._type!==(2))){if(gr._type===(0)){gy=this.liveDynamics}else{gy=this.liveKinematics}gv=gy.indexOf(gr);gy[gv]=gy[gy.length-1];gy.pop()}var gw;var gt=gr.shapes;var gs=gt.length;for(gw=0;gw<gs;gw+=1){this._removeShape(gt[gw],gu)}var gx=gr.constraints;while(gx.length>0){this.removeConstraint(gx[0])}return true};gq.prototype.clear=function(){var gs=this.rigidBodies;var gr=gs.length;while(gr>0){gr-=1;this.removeRigidBody(gs[gr],true)}var gu=this.constraints;gr=gu.length;while(gr>0){gr-=1;this.removeConstraint(gu[gr])
}this._clearArbiters(this.staticArbiters);this._clearArbiters(this.dynamicArbiters);var gt=this._callbacks;gr=gt.length;while(gr>0){gr-=1;cI.deallocate(gt.pop())}};gq.prototype._clearArbiters=function(gs){var gr=gs.length;while(gr>0){var gt=gs.pop();gr-=1;gt._retire();aR.deallocate(gt)}};gq.prototype.shapePointQuery=function(gr,gs){return this._pointQuery(this._shapePointCallback,gr,gs)};gq.prototype.bodyPointQuery=function(gr,gs){return this._pointQuery(this._bodyPointCallback,gr,gs)};gq.prototype._pointQuery=function(gu,gr,gs){var gt=this._sampleRectangle;gt[0]=gt[2]=gr[0];gt[1]=gt[3]=gr[1];gu.store=gs;gu.count=0;this.broadphase.sample(gt,gu.sample,gu);return gu.count};gq.prototype.shapeCircleQuery=function(gs,gr,gt){return this._circleQuery(this._shapeCircleCallback,gs,gr,gt)};gq.prototype.bodyCircleQuery=function(gs,gr,gt){return this._circleQuery(this._bodyCircleCallback,gs,gr,gt)};gq.prototype._circleQuery=function(gy,gs,gr,gt){var gv=this._circleQueryShape;gv.setRadius(gr);var gx=gs[0];
var gw=gs[1];gv._update(gx,gw,1,0);var gu=this._sampleRectangle;gu[0]=(gx-gr);gu[1]=(gw-gr);gu[2]=(gx+gr);gu[3]=(gw+gr);gy.store=gt;gy.count=0;this.broadphase.sample(gu,gy.sample,gy);return gy.count};gq.prototype.shapeRectangleQuery=function(gr,gs){return this._rectangleQuery(this._shapeRectangleCallback,gr,gs)};gq.prototype.bodyRectangleQuery=function(gr,gs){return this._rectangleQuery(this._bodyRectangleCallback,gr,gs)};gq.prototype._rectangleQuery=function(gz,gu,gy){var gv=this._rectangleQueryVertices;var gt=gu[0];var gx=gu[1];var gs=gu[2];var gw=gu[3];gv[0][0]=gv[3][0]=(gt<gs?gt:gs);gv[0][1]=gv[1][1]=(gx<gw?gx:gw);gv[1][0]=gv[2][0]=(gt<gs?gs:gt);gv[2][1]=gv[3][1]=(gx<gw?gw:gx);var gr=this._rectangleQueryShape;gr.setVertices(gv);gr._update(0,0,1,0);gz.store=gy;gz.count=0;this.broadphase.sample(gu,gz.sample,gz);return gz.count};gq.prototype.rayCast=function(gE,gA,gt,gx){var gF=gE.origin;var gD=gE.direction;var gw=gE.maxFactor;var gs=gF[0];var gC=gF[1];var gr=gs+(gD[0]*gw);var gz=gC+(gD[1]*gw);
var gy=this._sampleRectangle;gy[0]=(gs<gr?gs:gr);gy[1]=(gC<gz?gC:gz);gy[2]=(gs<gr?gr:gs);gy[3]=(gC<gz?gz:gC);var gG=this._rayCast;gG.ray=gE;gG.noInner=(gA||false);gG.minFactor=gE.maxFactor;gG.userCallback=gt;gG.userThis=gx;gG.minShape=null;this.broadphase.sample(gy,gG.sample,gG);if(gG.minShape){var gu=gG.minNormal;var gB=new bZ.prototype.floatArray(2);var gv=new bZ.prototype.floatArray(2);gB[0]=gu[0];gB[1]=gu[1];gv[0]=(gs+(gD[0]*gG.minFactor));gv[1]=(gC+(gD[1]*gG.minFactor));return{shape:gG.minShape,hitNormal:gB,hitPoint:gv,factor:gG.minFactor}}else{return null}};gq.prototype.convexCast=function(gA,gB,gt,gC){var gw=gA.body;var gG=gw._data;var gz=gG[(2)];var gy=gG[(2)+1];gw._sweepIntegrate(gB);var gs=gG[(2)];var gr=gG[(2)+1];var gD=this._sampleRectangle;var gx=gA._data[(4)];gD[0]=((gz<gs?gz:gs)-gx);gD[1]=((gy<gr?gy:gr)-gx);gD[2]=((gz<gs?gs:gz)+gx);gD[3]=((gy<gr?gr:gy)+gx);gw[(20)]=gw[(7)+2];var gF=this._convexCast;gF.deltaTime=gB;gF.minTOIAlpha=1;gF.minShape=null;gF.toi.shapeA=gA;gF.userCallback=gt;
gF.userThis=gC;this.broadphase.sample(gD,gF.sample,gF);gw._sweepIntegrate(0);gA._update(gz,gy,gG[(5)],gG[(5)+1],true);if(gF.minShape){var gu=gF.minData;var gE=new bZ.prototype.floatArray(2);var gv=new bZ.prototype.floatArray(2);gE[0]=-gu[0];gE[1]=-gu[1];gv[0]=gu[2];gv[1]=gu[3];return{shape:gF.minShape,hitNormal:gE,hitPoint:gv,factor:(gF.minTOIAlpha*gB)}}else{return null}};gq.prototype.step=function(gr){this._midStep=true;this._eventTime=(0);this.timeStamp+=1;this._deltaTime=gr;this.simulatedTime+=gr;this._validate();this._discreteCollisions();this._sleepComputations(gr);this._preStep(gr);this._sortArbiters();this._integrateVelocity(gr);this._warmStart();this._iterateVelocity(this.velocityIterations);this._integratePosition(gr);this._eventTime=(1);this._continuousCollisions(gr);this._sortArbiters();this._iteratePosition(this.positionIterations);this._finalize();this._midStep=false;this._eventTime=(-1);this._doCallbacks()};gq.prototype._discreteCollisions=function(){this.broadphase.perform(this._discreteNarrowPhase,this);
this._doDeferredWake(false)};gq.prototype._doDeferredWake=function(gu){var gt=this._deferredWake;var gs=gt.length;while(gs>0){var gr=gt.pop();gr._deferred=false;this._wakeBody(gr,false,gu);gs-=1}};gq.prototype._collisionType=function(gz,gy,gx,gw){if(gx===gw){return undefined}var gs=((gx.constraints.length<gw.constraints.length)?gx.constraints:gw.constraints);var gt=gs.length;var gv;for(gv=0;gv<gt;gv+=1){var gr=gs[gv];if(gr._active&&gr._ignoreInteractions&&gr._pairExists(gx,gw)){return undefined}}if((gz._group&gy._mask)===0||(gy._group&gz._mask)===0){return undefined}var gu=!(gz.sensor||gy.sensor);if(gx._type!==(0)&&gw._type!==(0)&&gu){return undefined}return gu};gq.prototype._discreteNarrowPhase=function(gx,gw,gy){var gv=gx.data;var gt=gw.data;var gB=gv.body;var gA=gt.body;var gz=this._collisionType(gv,gt,gB,gA);if(gz===undefined){return null}var gG=(gB._type!==(0)||gA._type!==(0));var gu,gr;if(gv.id<gt.id){gu=gv;gr=gt}else{gu=gt;gr=gv}var gJ=(gu.arbiters.length<gr.arbiters.length?gu:gr).arbiters;
var gK=gJ.length;var gI;var gD;for(gI=0;gI<gK;gI+=1){var gE=gJ[gI];if(gE.shapeA===gu&&gE.shapeB===gr){gD=gE;break}}var gC=(!gD);if(gC){gD=aR.allocate()}if(gC||gD._timeStamp!==this.timeStamp||gy){gD._timeStamp=this.timeStamp;if((gz&&this._collisions._collide(gu,gr,gD))||(!gz&&this._collisions._test(gu,gr))){if(gC){gD.sensor=(!gz);gD._assign(gu,gr);gD._static=gG;if(gG){this.staticArbiters.push(gD)}else{this.dynamicArbiters.push(gD)}}if(gC||(gD._endGenerated===this.timeStamp&&gy)||(gD._updateStamp<(this.timeStamp-1))){gD._createContinuous=gy;gD._createStamp=this.timeStamp;gD._state=(gz?0:((1)|(2)))}gD._updateStamp=this.timeStamp;var gF=false;if(gz&&(gD._state&(2))===0){gD._state=(1);gD._midStep=true;var gs=gu._onPreSolve;gK=gs.length;var gH;for(gI=0;gI<gK;gI+=1){gH=gs[gI];gH.callback.call(gH.thisObject,gD,gr);if(!gH.deterministic){gF=true}}gs=gr._onPreSolve;gK=gs.length;for(gI=0;gI<gK;gI+=1){gH=gs[gI];gH.callback.call(gH.thisObject,gD,gu);if(!gH.deterministic){gF=true}}gD._midStep=false;gD._indeterminate=gF;
if(gF&&(gD._state&(2))===0){if(gB._type===(0)&&!gB._deferred){gB._deferred=true;this._deferredWake.push(gB)}if(gA._type===(0)&&!gB._deferred){gA._deferred=true;this._deferredWake.push(gA)}}}if(gz&&((gD._state&(1))!==0)){if(gB._type===(0)&&gB.sleeping&&!gB._deferred){gB._deferred=true;this._deferredWake.push(gB)}if(gA._type===(0)&&gA.sleeping&&!gA._deferred){gA._deferred=true;this._deferredWake.push(gA)}}if(gD.sleeping){this._wakeArbiter(gD)}}else{if(gC){aR.deallocate(gD);gD=null}}}return gD};gq.prototype._continuousCollisions=function(gu){this.broadphase.perform(this._continuousNarrowPhase,this);var gD=0;var gC=this._toiEvents;var gH=gC.length;var gF,gG;while(gD<1&&gH!==0){var gK=Number.POSITIVE_INFINITY;var gt=false;var gE=-1;var gy,gw;for(gG=0;gG<gH;){gF=gC[gG];gy=gF.shapeA.body;gw=gF.shapeB.body;if(gy._sweepFrozen&&gw._sweepFrozen){gH-=1;gC[gG]=gC[gH];gC.pop();d1.deallocate(gF);continue}if(gF.frozenA!==gy._sweepFrozen||gF.frozenB!==gw._sweepFrozen){gF.frozenA=gy._sweepFrozen;gF.frozenB=gw._sweepFrozen;
if(gF.frozenA){var gI=gF.shapeA;gF.shapeA=gF.shapeB;gF.shapeB=gI;gF.frozenA=false;gF.frozenB=true}this._collisions._staticSweep(gF,gu,l.SWEEP_SLOP);if(gF._data[(6)]<0){gH-=1;gC[gG]=gC[gH];gC.pop();d1.deallocate(gF);continue}}var gJ=gF._data[(6)];if(gJ>=0&&(gJ<gK||(!gt&&gF.kinematic))){gK=gJ;gt=gF.kinematic;gE=gG}gG+=1}if(gE===-1){break}gF=gC[gE];gH-=1;gC[gE]=gC[gH];gC.pop();gD=gK;var gs=gF.shapeA;var gr=gF.shapeB;gy=gs.body;gw=gr.body;var gx=gy._data;var gv=gw._data;if(!gy._sweepFrozen||gF.kinematic){gy._sweepIntegrate(gD*gu);gs._update(gx[(2)],gx[(2)+1],gx[(5)],gx[(5)+1],true)}if(!gw._sweepFrozen||gF.kinematic){gw._sweepIntegrate(gD*gu);gr._update(gv[(2)],gv[(2)+1],gv[(5)],gv[(5)+1],true)}var gA=this._discreteNarrowPhase(gs._bphaseHandle,gr._bphaseHandle,true);if(gA){this._continuousArbiterPrepare(gA,gu)}if(gA&&!gA.sensor&&(gA._state&(1))!==0){if(!gy._sweepFrozen&&gy._type===(0)){gy._sweepFrozen=true;if(gF.failed){gx[(20)]=0}else{if(gF.slipped){gx[(20)]*=l.TOI_SLIP_SCALE}}gx[(7)+2]=gx[(20)]
}if(!gw._sweepFrozen&&gw._type===(0)){gw._sweepFrozen=true;if(gF.failed){gv[(20)]=0}else{if(gF.slipped){gv[(20)]*=l.TOI_SLIP_SCALE}}gv[(7)+2]=gv[(20)]}}d1.deallocate(gF)}while(gH>0){gF=gC.pop();d1.deallocate(gF);gH-=1}var gz=this.liveDynamics;gH=gz.length;for(gG=0;gG<gH;gG+=1){var gB=gz[gG];if(!gB._sweepFrozen){gB._sweepIntegrate(gu)}}gz=this.liveKinematics;gH=gz.length;for(gG=0;gG<gH;gG+=1){gz[gG]._sweepIntegrate(gu)}this._doDeferredWake(true)};gq.prototype._continuousNarrowPhase=function(gt,gr){var gy=gt.data;var gx=gr.data;var gw=gy.body;var gv=gx.body;if(gw._sweepFrozen&&gv._sweepFrozen){return}var gu=(gw._type!==(0)||gv._type!==(0));if(gu||(gw._bullet||gv._bullet)){var gs=d1.allocate();var gz=(gw._type===(1)||gv._type===(1));if(gu&&!gz){if(gw._type!==(0)){gs.shapeB=gy;gs.shapeA=gx}else{gs.shapeA=gy;gs.shapeB=gx}this._collisions._staticSweep(gs,this._deltaTime,l.SWEEP_SLOP)}else{if(gy.body._sweepFrozen){gs.shapeB=gy;gs.shapeA=gx;this._collisions._staticSweep(gs,this._deltaTime,l.SWEEP_SLOP)
}else{if(gx.body._sweepFrozen){gs.shapeA=gy;gs.shapeB=gx;this._collisions._staticSweep(gs,this._deltaTime,l.SWEEP_SLOP)}else{gs.shapeA=gy;gs.shapeB=gx;this._collisions._dynamicSweep(gs,this._deltaTime,l.SWEEP_SLOP)}}}if((gu&&gs._data[(6)]<0)||gs.failed){d1.deallocate(gs)}else{this._toiEvents.push(gs);gs.frozenA=gs.shapeA.body._sweepFrozen;gs.frozenB=gs.shapeB.body._sweepFrozen;gs.staticType=gu;gs.kinematic=gz}}};gq.prototype.__union=function(gs,gu){var gr,gt;while(gs!==gs._islandRoot){gt=gs._islandRoot;gs._islandRoot=gr;gr=gs;gs=gt}while(gr){gt=gr._islandRoot;gr._islandRoot=gs;gr=gt}while(gu!==gu._islandRoot){gt=gu._islandRoot;gu._islandRoot=gr;gr=gu;gu=gt}while(gr){gt=gr._islandRoot;gr._islandRoot=gu;gr=gt}if(gs!==gu){if(gs._islandRank<gu._islandRank){gs._islandRoot=gu}else{if(gu._islandRank<gs._islandRank){gu._islandRoot=gs}else{gu._islandRoot=gs;gs._islandRank+=1}}}};gq.prototype.__find=function(gs){if(gs===gs._islandRoot){return gs}var gr=null;var gt;while(gs!==gs._islandRoot){gt=gs._islandRoot;
gs._islandRoot=gr;gr=gs;gs=gt}while(gr){gt=gr._islandRoot;gr._islandRoot=gs;gr=gt}return gs};gq.prototype._sleepComputations=function(gt){var gL=this.dynamicArbiters;var gz;var gM=gL.length;var gK;for(gK=0;gK<gM;gK+=1){gz=gL[gK];if(!gz.sensor&&!gz._retired&&gz._updateStamp===this.timeStamp&&(gz._state&(1))!==0){var gx=gz.bodyA;var gw=gz.bodyB;if(gx._type===(0)&&gw._type===(0)){this.__union(gx,gw)}}}var gG=this.liveConstraints;gM=gG.length;for(gK=0;gK<gM;gK+=1){gG[gK]._sleepComputation(this.__union)}var gA=this._islands;var gO,gE;var gy=this.liveDynamics;gM=gy.length;while(gM>0){gM-=1;var gB=gy.pop();gE=this.__find(gB);gO=gE._island;if(gO===null){gE._island=gO=fW.allocate();gA.push(gO);gO.sleeping=true;gO.wakeTime=0}gB._island=gO;gO.components.push(gB);var gs=gB._atRest(gt,this.timeStamp);gO.sleeping=(gO.sleeping&&gs);if(gB._wakeTime>gO.wakeTime){gO.wakeTime=gB._wakeTime}}gM=gG.length;while(gM>0){gM-=1;var gv=gG.pop();gE=this.__find(gv);gO=gE._island;if(gO===null){gE._island=gO=fW.allocate();
gA.push(gO);gO.sleeping=true;gO.wakeTime=0}gv._island=gO;gO.components.push(gv);if(gv._wakeTime>gO.wakeTime){gO.wakeTime=gv._wakeTime}}gM=gA.length;var gJ;var gu=this.broadphase;while(gM>0){gM-=1;gO=gA[gM];gA.pop();var gN,gC;if(gO.sleeping){gC=gO.components;gJ=gC.length;var gI;for(gI=0;gI<gJ;gI+=1){gN=gC[gI];gN.sleeping=true;if(gN._isBody){var gD=gN.shapes;var gH=gD.length;var gF;for(gF=0;gF<gH;gF+=1){var gr=gD[gF];gu.update(gr._bphaseHandle,gr._data,true)}var gP=gN._data;gP[(7)]=0;gP[(7)+1]=0;gP[(7)+2]=0}if(gN._onSleep.length>0){this._pushCallbacks(gN,gN._onSleep)}}}else{gC=gO.components;gJ=gC.length;while(gJ>0){gJ-=1;gN=gC.pop();gN._wakeTime=gO.wakeTime;if(gN._isBody){gy.push(gN)}else{gG.push(gN)}gN._island=null;gN._islandRoot=gN;gN._islandRank=0}fW.deallocate(gO)}}};gq.prototype._sortArbiters=function(){this._subSortArbiters(this.dynamicArbiters);this._subSortArbiters(this.staticArbiters)};gq.prototype._subSortArbiters=function(gw){var gv;var gu=gw.length-1;for(gv=1;gv<gu;gv+=1){var gz=gw[gv];
var gt=gz.shapeA.id;var gs=gz.shapeB.id;var gr=gv;while(gr>0){var gy=gw[gr-1];var gx=gy.shapeA.id;if(gx<gt||(gx===gt&&gy.shapeB.id<gs)){break}gw[gr]=gy;gr-=1}gw[gr]=gz}};gq.prototype._onWakeCallbacks=function(gr){if(this._midStep){if(gr._onWake.length>0){this._pushCallbacks(gr,gr._onWake)}}else{gr._woken=true}};gq.prototype._pushCallbacks=function(gt,gw){var gu=this._callbacks;var gs=gw.length;var gv;for(gv=0;gv<gs;gv+=1){var gr=cI.allocate();gr.thisObject=gt;gr.callback=gw[gv];gr.time=this._eventTime;gr.index=gv;gu.push(gr)}};gq.prototype._pushInteractionEvents=function(gr,gs){var gB=this._callbacks;var gw=gs.shapeA;var gt=gs.shapeB;var gz=gw._group;var gy=gt._group;var gC=gw._events;var gx=gC.length;var gA,gv,gu;for(gA=0;gA<gx;gA+=1){gv=gC[gA];if(gv.type===gr&&(gv.mask===undefined||((gv.mask&gy)!==0))){gu=cI.allocate();gu.thisObject=gw;gu.callback=gv.callback;gu.time=this._eventTime;gu.index=gA;gu.arbiter=gs;gB.push(gu)}}gC=gt._events;gx=gC.length;for(gA=0;gA<gx;gA+=1){gv=gC[gA];if(gv.type===gr&&(gv.mask===undefined||((gv.mask&gz)!==0))){gu=cI.allocate();
gu.thisObject=gw;gu.callback=gv.callback;gu.time=this._eventTime;gu.index=gA;gu.arbiter=gs;gB.push(gu)}}};gq.prototype._brokenConstraint=function(gr){if(gr._onBreak.length>0){this._pushCallbacks(gr,gr._onBreak)}if(gr._removeOnBreak){gr.world=null;var gt=this.constraints;var gs=gt.indexOf(gr);gt[gs]=gt[gt.length-1];gt.pop();gr._outWorld()}else{gr._active=false}gr._clearCache()};gq.prototype._preStep=function(gt){var gv=this.liveConstraints;var gs=gv.length;var gu;for(gu=0;gu<gs;){var gr=gv[gu];if(gr._preStep(gt)){gs-=1;gv[gu]=gv[gs];gv.pop();this._brokenConstraint(gr);continue}gu+=1}this._preStepArbiters(this.dynamicArbiters,gt);this._preStepArbiters(this.staticArbiters,gt)};gq.prototype._preStepArbiter=function(gt,gs,gu){var gr=this.timeStamp;gt.active=(gt._updateStamp===gr);if(gt._createContinuous&&gt._createStamp===gr){this._pushInteractionEvents((1),gt)}else{if(gu&&gt.active){this._pushInteractionEvents((2),gt)}}if(gt.active){if((gt._state&(1))!==0){if(!gt._preStep(gs,gr,true)){gt.active=false
}}else{if(!gt.sensor&&!gt._cleanContacts(gr)){gt.active=false}}}};gq.prototype._preStepArbiters=function(gv,gt){var gs=this.timeStamp;var gr=gv.length;var gu;for(gu=0;gu<gr;){var gw=gv[gu];if(!gw._retired&&(gw.bodyA.sleeping&&gw.bodyB.sleeping)){gw._sleepStamp=gs;gw.sleeping=true;gw.active=false;this._pushInteractionEvents((2),gw);gr-=1;gv[gu]=gv[gr];gv.pop();continue}if(!gw._lazyRetired){if(gw._retired||gw._updateStamp+(gw.sensor?1:l.DELAYED_DEATH)<gs){gw._retire();gr-=1;gv[gu]=gv[gr];gv.pop();aR.deallocate(gw);continue}}else{gw._lazyRetired=false;gu+=1;continue}gw.active=(gw._updateStamp===gs);if(gw._createStamp===gs){this._pushInteractionEvents((1),gw)}else{if(gw.active){this._pushInteractionEvents((2),gw)}else{if(gw._updateStamp===(gs-1)){this._pushInteractionEvents((3),gw);gw._endGenerated=this.timeStamp}}}if(gw.active){if((gw._state&(1))!==0){if(!gw._preStep(gt,gs)){gw.active=false}}else{if(!gw.sensor&&!gw._cleanContacts(gs)){gw.active=false}}}gu+=1}};gq.prototype._iterateVelocity=function(gu){var gv=this.liveConstraints;
while(gu>0){var gs=gv.length;var gt;for(gt=0;gt<gs;){var gr=gv[gt];if(gr._iterateVel()){gs-=1;gv[gt]=gv[gs];gv.pop();this._brokenConstraint(gr);continue}gt+=1}this._iterateVelocityArbiters(this.dynamicArbiters);this._iterateVelocityArbiters(this.staticArbiters);gu-=1}};gq.prototype._iterateVelocityArbiters=function(gt){var gr=gt.length;var gs;for(gs=0;gs<gr;gs+=1){var gu=gt[gs];if(gu.active&&!gu.sensor&&(gu._state&(1))!==0){gu._iterateVelocity()}}};gq.prototype._iteratePosition=function(gu){var gv=this.liveConstraints;while(gu>0){var gs=gv.length;var gt;for(gt=0;gt<gs;){var gr=gv[gt];if(gr._stiff&&gr._iteratePos()){gs-=1;gv[gt]=gv[gs];gv.pop();this._brokenConstraint(gr);continue}gt+=1}this._iteratePositionArbiters(this.dynamicArbiters);this._iteratePositionArbiters(this.staticArbiters);gu-=1}};gq.prototype._iteratePositionArbiters=function(gt){var gr=gt.length;var gs;for(gs=0;gs<gr;gs+=1){var gu=gt[gs];if(gu.active&&!gu.sensor&&(gu._state&(1))!==0){gu._iteratePosition()}}};gq.prototype._integrateVelocity=function(gy){var gA=this._gravityX;
var gz=this._gravityY;var gr=this.liveDynamics;var gs=gr.length;var gu;for(gu=0;gu<gs;gu+=1){var gx=gr[gu];var gt=gx._data;var gw=gt[(0)];var gv;if(gw!==0){gt[(7)]+=((gt[(10)]*gw)+gA)*gy;gt[(7)+1]+=((gt[(10)+1]*gw)+gz)*gy;gv=Math.exp(gy*gt[(21)]);gt[(7)]*=gv;gt[(7)+1]*=gv}var gB=gt[(1)];if(gB!==0){gt[(7)+2]+=(gt[(10)+2]*gB)*gy;gt[(7)+2]*=Math.exp(gy*gt[(22)])}}};gq.prototype._integratePosition=function(gr){this._integratePositionBodies(this.liveDynamics,gr);this._integratePositionBodies(this.liveKinematics,gr)};gq.prototype._integratePositionBodies=function(gA,gu){var gw=(2*Math.PI/gu);var gB=(1/(gu*gu));var gr=l.MIN_LINEAR_STATIC_SWEEP;var gO=l.MIN_ANGULAR_STATIC_SWEEP;gr*=gr*gB;gO*=gO*gB;var gF=l.MIN_LINEAR_BULLET_SWEEP;var gy=l.MIN_ANGULAR_BULLET_SWEEP;gF*=gF*gB;gy*=gy*gB;var gv=this.broadphase;var gR=gA.length;var gP;for(gP=0;gP<gR;gP+=1){var gE=gA[gP];var gX=gE._data;var gz=gX[(15)]=gX[(2)];var gx=gX[(15)+1]=gX[(2)+1];gX[(15)+2]=gX[(2)+2];var gD=gX[(2)]+=(gX[(7)]*gu);var gC=gX[(2)+1]+=(gX[(7)+1]*gu);
var gL=gX[(7)+2];gE._deltaRotation(gL*gu);gX[(18)]=gu;var gH=gX[(7)];var gG=gX[(7)+1];var gJ=gX[(20)]=(gL%gw);var gW=gX[(19)];var gt=(gr*gW*gW);var gK=((gH*gH)+(gG*gG));if(gK>gt||(gJ*gJ)>gO){var gU=(gz<gD?gz:gD);var gT=(gx<gC?gx:gC);var gS=(gz<gD?gD:gz);var gQ=(gx<gC?gC:gx);var gI=gE.shapes;var gN=gI.length;var gM;for(gM=0;gM<gN;gM+=1){var gs=gI[gM];var gV=gs._data;gW=gV[(4)];gV[(0)]=(gU-gW);gV[(0)+1]=(gT-gW);gV[(0)+2]=(gS+gW);gV[(0)+3]=(gQ+gW);gv.update(gs._bphaseHandle,gV)}gE._sweepFrozen=false;if(gE._type===(0)){gE._bullet=(gE.bullet&&(gK>(gF*gW*gW)||(gJ*gJ)>gy))}}else{gE._sweepFrozen=true;gE._bullet=false}}};gq.prototype._finalize=function(){this._finalizeBodies(this.liveDynamics);this._finalizeBodies(this.liveKinematics);this._finalizeArbiters(this.dynamicArbiters);this._finalizeArbiters(this.staticArbiters)};gq.prototype._finalizeArbiters=function(gt){var gr=gt.length;var gs;for(gs=0;gs<gr;gs+=1){var gu=gt[gs];if(gu.active&&!gu.sensor){gu._refreshContactData()}}};gq.prototype._finalizeBodies=function(gr){var gA=this.broadphase;
var gt=gr.length;var gw;for(gw=0;gw<gt;){var gx=gr[gw];var gv=gx._data;var gs=gx.shapes;var gz=gs.length;var gu,gy;if(gv[(15)]!==gv[(2)]||gv[(15)+1]!==gv[(2)+1]||gv[(15)+2]!==gv[(2)+2]){gx._invalidated=true}else{if(gx._type===(1)){gt-=1;gr[gw]=gr[gt];gr.pop();gx.sleeping=true;for(gu=0;gu<gz;gu+=1){gy=gs[gu];gA.update(gy._bphaseHandle,gy._data,true)}continue}}gw+=1}};gq.prototype._doCallbacks=function(){var gy=this._callbacks;var gw;var gC=[gy.length-1,0];do{var gt=gC.pop();var gG=gC.pop();if(gt>gG){continue}var gH=(gt+gG)>>1;var gz=gy[gH];var gx=gt;var gA=gz.index;var gF=gz.time;gy[gH]=gy[gG];gy[gG]=gz;for(gw=gt;gw<gG;gw+=1){var gE=gy[gw];if(gE.time<gF||(gE.time===gF&&gE.index<gA)){gy[gw]=gy[gx];gy[gx]=gE;gx+=1}}gy[gG]=gy[gx];gy[gx]=gz;if(gx+1<gG){gC.push(gG);gC.push(gx+1)}if(gt<gx-1){gC.push(gx-1);gC.push(gt)}}while(gC.length>0);var gv=gy.length;for(gw=0;gw<gv;gw+=1){var gu=gy[gw];if(gu.arbiter){var gs=gu.arbiter;var gD=gs.shapeA;var gB=gs.shapeB;var gr=gu.thisObject;gu.callback.call(gr,gs,(gr===gD?gB:gD))
}else{gu.callback.call(gu.thisObject)}cI.deallocate(gu)}gy.length=0};gq.prototype._warmStart=function(){var gt=this.liveConstraints;var gr=gt.length;var gs;for(gs=0;gs<gr;gs+=1){gt[gs]._warmStart()}this._warmStartArbiters(this.dynamicArbiters);this._warmStartArbiters(this.staticArbiters)};gq.prototype._warmStartArbiters=function(gt){var gr=gt.length;var gs;for(gs=0;gs<gr;gs+=1){var gu=gt[gs];if(gu.active&&!gu.sensor&&(gu._state&(1))!==0){gu._warmStart()}}};gq.prototype._forceSleepBody=function(gz){if(gz.sleeping||gz._type!==(0)){return}gz.sleeping=true;var gr=this.liveDynamics;var gA=gr.indexOf(gz);gr[gA]=gr[gr.length-1];gr.pop();var gs=gz.shapes;var gu=gs.length;var gx;var gD=this.broadphase;for(gx=0;gx<gu;gx+=1){var gB=gs[gx];gD.update(gB._bphaseHandle,gB._data,true);var gy=gB.arbiters;var gC=gy.length;var gw;for(gw=0;gw<gC;gw+=1){var gt=gy[gw];if(gt._retired||gt.sleeping){continue}gt.sleeping=true;gt._sleepStamp=this.timeStamp;var gv;if(gt._static){gv=this.staticArbiters}else{gv=this.dynamicArbiters
}gA=gv.indexOf(gt);gv[gA]=gv[gv.length-1];gv.pop()}}};gq.prototype._forceSleepConstraint=function(gs){if(gs.sleeping){return}gs.sleeping=true;if(gs._active){var gt=this.liveConstraints;var gr=gt.indexOf(gs);gt[gr]=gt[gt.length-1];gt.pop()}};gq.prototype._wakeConstraint=function(gs,gr){if(gs.world!==this){return}if(gs._active){gs._wakeTime=(this.timeStamp+(this._midStep?0:1));if(gs.sleeping){if(!gs._island){gs.sleeping=false;this.liveConstraints.push(gs);gs._wakeConnected();if(!gr){this._onWakeCallbacks(gs)}}else{this._wakeIsland(gs._island,(gr?gs:null))}}}};gq.prototype._wakeBody=function(gw,gA,gv){if(gw.world!==this){return}gw._wakeTime=(this.timeStamp+(this._midStep?0:1));if(gw.sleeping){if(!gw._island){var gz=this.broadphase;if(gw._type===(0)){gw.sleeping=false;this.liveDynamics.push(gw)}else{if(gw._type===(1)){gw.sleeping=false;this.liveKinematics.push(gw)}}var gs=gw.constraints;var gt=gs.length;var gu;for(gu=0;gu<gt;gu+=1){this._wakeConstraint(gs[gu])}var gy=(gw._type===(2));var gr=gw.shapes;
gt=gr.length;for(gu=0;gu<gt;gu+=1){var gx=gr[gu];this._wakeArbiters(gx.arbiters,false,gv);if(!gy){gz.update(gx._bphaseHandle,gx._data,false)}}if(!gA&&(gw._type===(0))){this._onWakeCallbacks(gw)}}else{this._wakeIsland(gw._island,(gA?gw:null),gv)}}};gq.prototype._wakeArbiter=function(gw,gv){gw.sleeping=false;var gt=(this.timeStamp+(this._midStep?0:1));var gr=(gt-gw._sleepStamp);gw._updateStamp+=gr;var gx=gw.contacts;var gs=gx.length;var gu;for(gu=0;gu<gs;gu+=1){gx[gu]._timeStamp+=gr}if(gw._static){this.staticArbiters.push(gw)}else{this.dynamicArbiters.push(gw)}if(gv){this._continuousArbiterPrepare(gw,this._deltaTime,true)}};gq.prototype._continuousArbiterPrepare=function(gs,gr,gt){this._preStepArbiter(gs,gr,gt);if(gs.active&&!gs.sensor&&(gs._state&(1))!==0){gs._iterateVelocity()}};gq.prototype._wakeArbiters=function(gv,gz,gw){var gs=gv.length;var gu;var gt=(this.timeStamp+(this._midStep?0:1));for(gu=0;gu<gs;gu+=1){var gr=gv[gu];if(gr._retired){continue}if(gr.sleeping){this._wakeArbiter(gr,gw)
}if(!gz){if((gr._updateStamp===gt)&&!gr.sensor&&(gr._state&(1))!==0){var gy=gr.bodyA;var gx=gr.bodyB;if(gy._type===(0)&&gy.sleeping){this._wakeBody(gy,false,gw)}if(gx._type===(0)&&gx.sleeping){this._wakeBody(gx,false,gw)}}}}};gq.prototype._wakeIsland=function(gz,gB,gx){var gE=this.broadphase;var gr=this.liveDynamics;var gu=this.liveConstraints;var gv=(this.timeStamp+(this._midStep?0:1));var gy=gz.components;var gt=gy.length;while(gt>0){gt-=1;var gC=gy.pop();gC._wakeTime=gv;gC._island=null;gC._islandRoot=gC;gC._islandRank=0;gC.sleeping=false;if(gC._isBody){gr.push(gC);var gs=(gC).shapes;var gD=gs.length;var gw;for(gw=0;gw<gD;gw+=1){var gA=gs[gw];this._wakeArbiters(gA.arbiters,true,gx);gE.update(gA._bphaseHandle,gA._data,false)}}else{gu.push(gC)}if(gB!==gC){this._onWakeCallbacks(gC)}}fW.deallocate(gz)};gq.prototype._transmitBodyType=function(gy,gA){this._wakeBody(gy);var gv;if(gy._type===(0)){gv=this.liveDynamics}else{if(gy._type===(1)){gv=this.liveKinematics}}var gt;if(gv){gt=gv.indexOf(gy);
gv[gt]=gv[gv.length-1];gv.pop()}gy._type=gA;var gI=(gA===(2));if(gI){gy._update()}if(gA===(0)){gy._islandRoot=gy;gy._islandRank=0}var gs=this.broadphase;var gB=gy.shapes;var gH=gB.length;var gF;for(gF=0;gF<gH;gF+=1){var gr=gB[gF];if(gI){gs.update(gr._bphaseHandle,gr._data,true)}var gG=gr.arbiters;var gE=gG.length;var gD;for(gD=0;gD<gE;){var gw=gG[gD];if(gw._retired){continue}var gu=(gw.bodyA._type!==(0)&&gw.bodyB._type!==(0));var gz=(gw.bodyA._type===(1)||gw.bodyB._type===(1));if(gu&&!(gz&&gw.sensor)){gE-=1;gG[gD]=gG[gE];gG.pop();gw._lazyRetire(gr);this._pushInteractionEvents((3),gw);continue}var gC=(gw.bodyA._type!==(0)||gw.bodyB._type!==(0));if(gC!==gw._static){var gx=(gw._static?this.staticArbiters:this.dynamicArbiters);gt=gx.indexOf(gw);gx[gt]=gx[gx.length-1];gx.pop();gw._static=gC;gx=(gC?this.staticArbiters:this.dynamicArbiters);gx.push(gw)}gD+=1}}gy.sleeping=true;this._wakeBody(gy)};gq.prototype._validate=function(){this._validateBodies(this.liveDynamics);this._validateBodies(this.liveKinematics);
var gu=this.liveConstraints;var gt;var gs=gu.length;for(gt=0;gt<gs;gt+=1){var gr=gu[gt];if(gr._woken&&gr._onWake.length>0){this._pushCallbacks(gr,gr._onWake)}gr._woken=false}};gq.prototype._validateBodies=function(gr){var gB=this.broadphase;var gx;var gu=gr.length;for(gx=0;gx<gu;gx+=1){var gy=gr[gx];var gw=gy._data;var gs=gw[(2)+2];gw[(5)]=Math.cos(gs);gw[(5)+1]=Math.sin(gs);gy._update();if(gy._type===(0)&&gy._woken&&gy._onWake.length>0){this._pushCallbacks(gy,gy._onWake)}gy._woken=false;var gt=gy.shapes;var gA=gt.length;var gv;for(gv=0;gv<gA;gv+=1){var gz=gt[gv];gB.update(gz._bphaseHandle,gz._data)}}};gq.create=function(gv){var gB=new gq();gB.simulatedTime=0;gB.rigidBodies=[];gB.constraints=[];gB.liveDynamics=[];gB.liveKinematics=[];gB.liveConstraints=[];gB.dynamicArbiters=[];gB.staticArbiters=[];gB._islands=[];gB._toiEvents=[];gB._deferredWake=[];gB._eventTime=(-1);gB._callbacks=[];gB.broadphase=(gv.broadphase||e6.create());gB.velocityIterations=(gv.velocityIterations||8);gB.positionIterations=(gv.positionIterations||8);
gB._midStep=false;gB.timeStamp=0;var gC=gv.gravity;gB._gravityX=(gC?gC[0]:0);gB._gravityY=(gC?gC[1]:10);gB._collisions=dG.create();gB._sampleRectangle=new bZ.prototype.floatArray(4);var gu=function gr(gG){return{store:null,count:0,collisions:gB._collisions,sample:function(gJ,gI){var gH=gJ.data;if(gG.call(this,gH,gI)){this.store[this.count]=gH;this.count+=1}}}};var gD=function gE(gG){return{store:null,count:0,collisions:gB._collisions,sample:function(gO,gM){var gK=gO.data;if(gG.call(this,gK,gM)){var gN=false;var gH=gK.body;var gL;var gI=this.count;var gJ=this.store;for(gL=0;gL<gI;gL+=1){if(gJ[gL]===gH){gN=true;break}}if(!gN){gJ[gI]=gH;this.count+=1}}}}};var gw=function gz(gH,gG){return this.collisions._contains(gH,gG[0],gG[1])};gB._shapePointCallback=gu(gw);gB._bodyPointCallback=gD(gw);var gF=function gy(gG,gH){return(this).collisions._test(gG,this.rectangleShape)};gB._shapeRectangleCallback=gu(gF);gB._bodyRectangleCallback=gD(gF);gB._rectangleQueryVertices=[new bZ.prototype.floatArray(2),new bZ.prototype.floatArray(2),new bZ.prototype.floatArray(2),new bZ.prototype.floatArray(2)];
gB._rectangleQueryShape=O.create({vertices:gB._rectangleQueryVertices});gB._shapeRectangleCallback.rectangleShape=gB._rectangleQueryShape;gB._bodyRectangleCallback.rectangleShape=gB._rectangleQueryShape;var gA=function gs(gG,gH){return(this).collisions._test(gG,this.circleShape)};gB._shapeCircleCallback=gu(gA);gB._bodyCircleCallback=gD(gA);gB._circleQueryShape=er.create({radius:1});gB._shapeCircleCallback.circleShape=gB._circleQueryShape;gB._bodyCircleCallback.circleShape=gB._circleQueryShape;var gx={shape:null,hitPoint:new bZ.prototype.floatArray(2),hitNormal:new bZ.prototype.floatArray(2),factor:0};gB._rayCast={minNormal:new bZ.prototype.floatArray(2),minShape:null,minFactor:0,userCallback:null,userThis:null,ray:null,noInner:false,normal:new bZ.prototype.floatArray(2),sample:function gt(gH,gQ){var gJ=gH.data;var gN=(this).ray;var gI=(this).normal;var gL=gN.maxFactor;gN.maxFactor=(this).minFactor;var gK=gB._collisions.rayTest(gJ,gN,gI,(this).noInner);gN.maxFactor=gL;if((this).userCallback){var gR=gx;
var gG=gR.hitNormal;gG[0]=gI[0];gG[1]=gI[1];gG=gR.hitPoint;var gO=gN.origin;var gM=gN.direction;gG[0]=(gO[0]+(gM[0]*gK));gG[1]=(gO[1]+(gM[1]*gK));gR.factor=gK;gR.shape=gJ;if(!(this).userCallback.call((this).userThis,gN,gR)){return}}if(gK!==undefined){(this).minFactor=gK;(this).minShape=gJ;var gP=(this).minNormal;gP[0]=gI[0];gP[1]=gI[1]}}};gB._convexCast={toi:gB._collisions._toi,minData:new bZ.prototype.floatArray(4),minShape:null,minTOIAlpha:0,userCallback:null,userThis:null,deltaTime:0,sample:function gt(gK,gN){var gG=(this).toi;var gM=gK.data;if(gM===gG.shapeA){return}gG.shapeB=gM;gM.body._update();var gL=gB._collisions._staticSweep(gG,((this).minTOIAlpha*(this).deltaTime),0)*(this).minTOIAlpha;if(gL<=0){return}var gI=gG._data;if((this).userCallback){var gO=gx;var gH=gO.hitNormal;gH[0]=(-gI[(0)]);gH[1]=(-gI[(0)+1]);gH=gO.hitPoint;gH[0]=gI[(4)];gH[1]=gI[(4)+1];gO.factor=(gL*(this).deltaTime);gO.shape=gM;gO.shape=gM;if(!(this).userCallback.call((this).userThis,gG.shapeA,gO)){return}}(this).minTOIAlpha=gL;
var gJ=(this).minData;gJ[0]=gI[(0)];gJ[1]=gI[(0)+1];gJ[2]=gI[(4)];gJ[3]=gI[(4)+1];(this).minShape=gM}};return gB};gq.version=1;return gq})();var dG=(function(){function gq(){}gq.prototype.containsPoint=function(gs,gr){gs.body._update();return this._contains(gs,gr[0],gr[1])};gq.prototype.signedDistance=function(gx,gv,gs,gr,gu){gx.body._update();if(gv.body!==gx.body){gv.body._update()}var gw=this._toi._data;var gt=this._distance(gx,gv,gw);gs[0]=gw[(2)];gs[1]=gw[(2)+1];gr[0]=gw[(4)];gr[1]=gw[(4)+1];gu[0]=gw[(0)];gu[1]=gw[(0)+1];return gt};gq.prototype.intersects=function(gs,gr){gs.body._update();if(gr.body!==gs.body){gr.body._update()}return this._test(gs,gr)};gq.prototype.rayTest=function(gs,gr,gu,gt){gs.body._update();return this._rayTest(gs,gr,gu,gt)};gq.prototype.sweepTest=function(gu,gs,gA,gC,gz){var gr=this._toi;gr.shapeA=gu;gr.shapeB=gs;var gv=gu.body;var gt=gs.body;var gB=gv._data;var gy=gt._data;gB[(18)]=0;gy[(18)]=0;gB[(20)]=(gB[(7)+2]);gy[(20)]=(gy[(7)+2]);var gx=this._dynamicSweep(gr,gA,0,true);
gv._sweepIntegrate(0);gt._sweepIntegrate(0);gu._update(gB[(2)],gB[(2)+1],gB[(5)],gB[(5)+1]);gs._update(gy[(2)],gy[(2)+1],gy[(5)],gy[(5)+1]);if(gx<0){return undefined}var gw=gr._data;gC[0]=(0.5*(gw[(2)]+gw[(4)]));gC[1]=(0.5*(gw[(2)+1]+gw[(4)+1]));gz[0]=gw[(0)];gz[1]=gw[(0)+1];return(gx*gA)};gq.prototype._rayTest=function(gt,gs,gu,gr){if(gt._type===(0)){return this._rayTestCircle(gt,gs,gu,gr)}else{return this._rayTestPolygon(gt,gs,gu,gr)}};gq.prototype._rayTestPolygon=function(gx,gC,gN,gv){var gM=gC.origin;var gI=gC.direction;var gO=gx._data;var gu=gM[0];var gt=gM[1];var gB=gI[0];var gA=gI[1];var gE=gC.maxFactor;var gw,gL;var gy=(6);var gF=gO.length;for(;gy<gF;gy+=(13)){var gH=gO[gy+(6)];var gG=gO[gy+(6)+1];var gz=(gH*gB)+(gG*gA);if((gz>=0&&gv)||(gz*gz)<l.COLLINEAR_SQ_EPSILON){continue}var gD=(gO[gy+(9)]-((gu*gH)+(gt*gG)))/gz;if(gD<0||gD>=gE){continue}var gs=gu+(gB*gD);var gr=gt+(gA*gD);var gK=(gH*gr)-(gG*gs);if(gK<gO[gy+(10)]||gK>gO[gy+(11)]){continue}gE=gD;gw=gy;gL=(gz>=0)}if(gw===undefined){return undefined
}else{var gJ=(gL?-1:1);gN[0]=(gO[gw+(6)]*gJ);gN[1]=(gO[gw+(6)+1]*gJ);return gE}};gq.prototype._rayTestCircle=function(gB,gI,gQ,gC){var gP=gI.origin;var gM=gI.direction;var gR=gB._data;var gA=gP[0];var gy=gP[1];var gG=gM[0];var gF=gM[1];var gs=gR[(9)];var gr=gR[(9)+1];var gx=gR[(6)];var gz=(gA-gs);var gw=(gy-gr);var gN=((gG*gG)+(gF*gF));var gL=2*((gz*gG)+(gw*gF));var gK=(gz*gz)+(gw*gw)-(gx*gx);var gJ=((gL*gL)-(4*gN*gK));if(gJ<0){return undefined}var gH=1;var gE=(1/(2*gN));var gD=Math.sqrt(gJ);var gv=((-gL-gD)*gE);if(gv<0){if(gC){return undefined}gv+=(gD*2*gE);gH=-1}if(0<=gv&&gv<gI.maxFactor){var gu=(gA+(gG*gv)-gs);var gt=(gy+(gF*gv)-gr);var gO=(gH/gx);gQ[0]=(gu*gO);gQ[1]=(gt*gO);return gv}else{return undefined}};gq.prototype._contains=function(gs,gr,gt){if(gs._type===(0)){return this._containsCircle(gs,gr,gt)}else{return this._containsPolygon(gs,gr,gt)}};gq.prototype._containsCircle=function(gw,gs,gx){var gv=gw._data;var gu=(gv[(9)]-gs);var gt=(gv[(9)+1]-gx);var gr=gv[(6)];return((gu*gu)+(gt*gt)-(gr*gr))<=l.CONTAINS_SQ_EPSILON
};gq.prototype._containsPolygon=function(gw,gr,gy){var gv=gw._data;var gt=(6);var gs=gv.length;var gx=l.CONTAINS_EPSILON;for(;gt<gs;gt+=(13)){var gu=((gv[gt+(6)]*gr)+(gv[gt+(6)+1]*gy))-gv[gt+(9)];if(gu>gx){return false}}return true};gq.prototype._dynamicSweep=function(gS,gK,gI,gN){var gw=gS.shapeA;var gu=gS.shapeB;var gG=gw.body;var gD=gu.body;var gF=gG._data;var gB=gD._data;var gX=(gB[(7)]-gF[(7)]);var gW=(gB[(7)+1]-gF[(7)+1]);var gH=gF[(20)];var gE=gB[(20)];var gC=((gw._data[(5)]*(gH<0?-gH:gH))+(gu._data[(5)]*(gE<0?-gE:gE)));if(!gN){if(((gX*gX)+(gW*gW))<l.EQUAL_SQ_VEL&&gC<l.ZERO_ANG_BIAS){gS._data[(6)]=undefined;gS.failed=true;return}}var gV=0;var gT=0;var gy=gS._data;var gM=l.SWEEP_LIMIT;var gz=(gM*0.5);var gO=l.MINIMUM_SWEEP_ADVANCE;var gR=l.MAX_SWEEP_ITER;while(true){gG._sweepIntegrate(gV*gK);gD._sweepIntegrate(gV*gK);var gL=gF[(2)];var gJ=gF[(2)+1];gw._update(gL,gJ,gF[(5)],gF[(5)+1],true);gL=gB[(2)];gJ=gB[(2)+1];gu._update(gL,gJ,gB[(5)],gB[(5)+1],true);var gP=this._distance(gw,gu,gy)+gI;
var gt=gy[(0)];var gs=gy[(0)+1];var gQ=((gt*gX)+(gs*gW));if(gP<gM){if(gN){break}else{var gx=(gy[(2)]-gL);var gv=(gy[(2)+1]-gJ);var gA=(gQ-(gH*((gx*gs)-(gv*gt))));if(gA>0){gS.slipped=true}if(gA<=0||gP<gz){break}}}var gr=(gC-gQ)*gK;if(gr<=0){gV=-1;break}var gU=(gP/gr);if(gU<gO){gU=gO}gV+=gU;if(gV>=1){gV=-1;break}gT+=1;if(gT>=gR){if(gP>gI){gS.failed=true}else{if(gN){gV=-1}}break}}gy[(6)]=gV;return gV};gq.prototype._staticSweep=function(gO,gH,gF){var gw=gO.shapeA;var gu=gO.shapeB;var gD=gw.body;var gC=gD._data;var gT=-gC[(7)];var gS=-gC[(7)+1];var gE=gC[(20)];var gB=(gw._data[(5)]*(gE<0?-gE:gE));var gR=0;var gP=0;var gy=gO._data;var gJ=l.SWEEP_LIMIT;var gz=(gJ*0.5);var gK=l.MINIMUM_SWEEP_ADVANCE;var gN=l.MAX_SWEEP_ITER;while(true){gD._sweepIntegrate(gR*gH);var gI=gC[(2)];var gG=gC[(2)+1];gw._update(gI,gG,gC[(5)],gC[(5)+1],true);var gL=this._distance(gw,gu,gy)+gF;var gt=gy[(0)];var gs=gy[(0)+1];var gM=((gt*gT)+(gs*gS));if(gL<gJ){var gx=(gy[(2)]-gI);var gv=(gy[(2)+1]-gG);var gA=(gM-(gE*((gx*gs)-(gv*gt))));
if(gA>0){gO.slipped=true}if(gA<=0||gL<gz){break}}var gr=(gB-gM)*gH;if(gr<=0){gR=-1;break}var gQ=(gL/gr);if(gQ<gK){gQ=gK}gR+=gQ;if(gR>=1){gR=-1;break}gP+=1;if(gP>=gN){if(gL>gF){gO.failed=true}break}}gy[(6)]=gR;return gR};gq.prototype._distance=function(gv,gu,gt){if(gv._type===(0)){if(gu._type===(0)){return this._distanceCircle2Circle(gv,gu,gt)}else{return this._distanceCircle2Polygon(gv,gu,gt)}}else{if(gu._type===(0)){var gr=this._distanceCircle2Polygon(gu,gv,gt);gt[(0)]=-gt[(0)];gt[(0)+1]=-gt[(0)+1];var gs=gt[(2)];gt[(2)]=gt[(4)];gt[(4)]=gs;gs=gt[(2)+1];gt[(2)+1]=gt[(4)+1];gt[(4)+1]=gs;return gr}else{return this._distancePolygon2Polygon(gv,gu,gt)}}};gq.prototype._distanceCircle2Circle=function(gD,gA,gw){var gx=gD._data;var gv=gA._data;var gs=gx[(9)];var gr=gx[(9)+1];var gC=gv[(9)];var gz=gv[(9)+1];var gB=gx[(6)];var gy=gv[(6)];var gG=(gC-gs);var gF=(gz-gr);var gE=(gB+gy);var gu=Math.sqrt((gG*gG)+(gF*gF));if(gu===0){gw[(0)]=gG=1;gw[(0)+1]=gF=0}else{var gt=(1/gu);gw[(0)]=(gG*=gt);gw[(0)+1]=(gF*=gt)
}gw[(2)]=gs+(gG*gB);gw[(2)+1]=gr+(gF*gB);gw[(4)]=gC-(gG*gy);gw[(4)+1]=gz-(gF*gy);return(gu-gE)};gq.prototype._distanceCircle2Polygon=function(gv,gE,gr){var gM=gv._data;var gF=gE._data;var gt=gM[(9)];var gs=gM[(9)+1];var gu=gM[(6)];var gH=Number.NEGATIVE_INFINITY;var gy,gx;var gA=(6);var gJ=gF.length;for(;gA<gJ;gA+=(13)){gx=((gF[gA+(6)]*gt)+(gF[gA+(6)+1]*gs));var gG=gx-(gu+gF[gA+(9)]);if(gG>gH){gH=gG;gy=gA}}var gL=gF[gy+(6)];var gK=gF[gy+(6)+1];gx=((gL*gs)-(gK*gt));if(gx>=gF[gy+(10)]){if(gx<=gF[gy+(11)]){gr[(0)]=-gL;gr[(0)+1]=-gK;gr[(2)]=(gt-=(gL*gu));gr[(2)+1]=(gs-=(gK*gu));gr[(4)]=(gt-(gL*gH));gr[(4)+1]=(gs-(gK*gH));return gH}else{gy+=(13);if(gy===gJ){gy=(6)}}}var gz=gF[gy+(2)];var gw=gF[gy+(2)+1];var gD=(gz-gt);var gC=(gw-gs);var gI=Math.sqrt((gD*gD)+(gC*gC));if(gI===0){gr[(0)]=gD=-gL;gr[(0)+1]=gC=-gK}else{var gB=(1/gI);gr[(0)]=(gD*=gB);gr[(0)+1]=(gC*=gB)}gr[(2)]=(gt+(gD*gu));gr[(2)+1]=(gs+(gC*gu));gr[(4)]=gz;gr[(4)+1]=gw;return(gI-gu)};gq.prototype._distancePolygon2Polygon=function(gD,gB,gP){var gX=Number.POSITIVE_INFINITY;
var gR=gD._data;var gQ=gB._data;var gu=gR.length;var gs=gQ.length;var gZ,gY;var g1,gW,gV,gU;var gK=-gX;var gC,gA;for(gZ=(6);gZ<gu;gZ+=(13)){g1=gX;gV=gR[gZ+(6)];gU=gR[gZ+(6)+1];for(gY=(6);gY<gs;gY+=(13)){gW=(gV*gQ[gY+(2)])+(gU*gQ[gY+(2)+1]);if(gW<g1){g1=gW}}g1-=gR[gZ+(9)];if(g1>gK){gK=g1;gA=gZ;gC=true}}for(gY=(6);gY<gs;gY+=(13)){g1=gX;gV=gQ[gY+(6)];gU=gQ[gY+(6)+1];for(gZ=(6);gZ<gu;gZ+=(13)){gW=(gV*gR[gZ+(2)])+(gU*gR[gZ+(2)+1]);if(gW<g1){g1=gW}}g1-=gQ[gY+(9)];if(g1>gK){gK=g1;gA=gY;gC=false}}var g0=(gC?1:-1);var gv,gt;if(!gC){gR=gB._data;gQ=gD._data;gu=gR.length;gs=gQ.length;gv=(4);gt=(2)}else{gv=(2);gt=(4)}gV=gR[gA+(6)];gU=gR[gA+(6)+1];g1=gX;var gL;for(gY=(6);gY<gs;gY+=(13)){gW=(gV*gQ[gY+(6)])+(gU*gQ[gY+(6)+1]);if(gW<g1){g1=gW;gL=gY}}var gw=gL+(13);if(gw===gs){gw=(6)}var gz,gy;var gO,gM;var gF,g3;var gE,g2;var gN;var gH=gQ[gL+(2)];var g5=gQ[gL+(2)+1];var gG=gQ[gw+(2)];var g4=gQ[gw+(2)+1];var gr=(g1<(l.COLLINEAR_EPSILON-1));if(gK<0&&gr){gP[(0)]=(gV*g0);gP[(0)+1]=(gU*g0);gz=gR[gA+(2)];gy=gR[gA+(2)+1];
gN=gR[gA+(12)];gO=(gV*(g5-gy))-(gU*(gH-gz));if(gO>=0&&gO<=gN){gP[gt]=gz=gH;gP[gt+1]=gy=g5}else{gM=(gV*(g4-gy))-(gU*(gH-gz));if(gM>=0&&gM<=gN){gP[gt]=gz=gG;gP[gt+1]=gy=g4}else{if(gO<0){gO=-gO}else{if(gO>gN){gO=(gN-gO)}}gP[gt]=gz=gH-(gU*gO);gP[gt+1]=gy=g5+(gV*gO)}}gP[gv]=gz-(gV*gK);gP[gv+1]=gy-(gU*gK);return gK}else{if(gK<=0){gP[(0)]=(gV*g0);gP[(0)+1]=(gU*g0);gO=(gV*gH)+(gU*g5);gM=(gV*gG)+(gU*g4);if(gM<gO){gL=gw}gP[gt]=gz=gQ[gL+(2)];gP[gt+1]=gy=gQ[gL+(2)+1];gP[gv]=gz-(gV*gK);gP[gv+1]=gy-(gU*gK);return gK}else{gN=gR[gA+(12)];if(gr){var gx=gQ[gL+(12)];if(gx>gN){gN=gx;gw=gA;gA=gL;gL=gw;gw=(gL+(13));if(gw===gu){gw=(6)}gH=gR[gL+(2)];g5=gR[gL+(2)+1];gG=gR[gw+(2)];g4=gR[gw+(2)+1];gR=gQ;gV*=-1;gU*=-1;g0*=-1;var gT=gv;gv=gt;gt=gT}}gz=gR[gA+(2)];gy=gR[gA+(2)+1];gO=-((gV*(gy-g5))-(gU*(gz-gH)));var gJ=true;if(gO<0){gO=0;gJ=false}else{if(gO>gN){gO=gN;gJ=false}}gM=-((gV*(gy-g4))-(gU*(gz-gG)));var gI=true;if(gM<0){gM=0;gI=false}else{if(gM>gN){gM=gN;gI=false}}gF=gH-(gz-(gU*gO));g3=g5-(gy+(gV*gO));gE=gG-(gz-(gU*gM));
g2=g4-(gy+(gV*gM));gO=((gF*gF)+(g3*g3));gM=((gE*gE)+(g2*g2));var gS;if(gO<gM){gP[gt]=gz=gH;gP[gt+1]=gy=g5;gK=Math.sqrt(gO);if(gJ||gK<l.NORMALIZE_EPSILON){gP[(0)]=(gV*=g0);gP[(0)+1]=(gU*=g0)}else{gS=g0/gK;gP[(0)]=gV=(gF*gS);gP[(0)+1]=gU=(g3*gS)}}else{gP[gt]=gz=gG;gP[gt+1]=gy=g4;gK=Math.sqrt(gM);if(gI||gK<l.NORMALIZE_EPSILON){gP[(0)]=(gV*=g0);gP[(0)+1]=(gU*=g0)}else{gS=g0/gK;gP[(0)]=gV=(gE*gS);gP[(0)+1]=gU=(g2*gS)}}gP[gv]=gz-(gV*gK*g0);gP[gv+1]=gy-(gU*gK*g0);return gK}}};gq.prototype._collide=function(gt,gs,gr){if(gt._type===(0)){if(gs._type===(0)){return this._collideCircle2Circle(gt,gs,gr)}else{return this._collideCircle2Polygon(gt,gs,gr,false)}}else{if(gs._type===(0)){return this._collideCircle2Polygon(gs,gt,gr,true)}else{return this._collidePolygon2Polygon(gt,gs,gr)}}};gq.prototype._collideCircle2Polygon=function(gz,gJ,gF,gG){var gT=gz._data;var gL=gJ._data;var gw=gT[(9)];var gv=gT[(9)+1];var gx=gT[(6)];var gN=Number.NEGATIVE_INFINITY;var gC,gB;var gE=(6);var gP=gL.length;for(;gE<gP;gE+=(13)){gB=((gL[gE+(6)]*gw)+(gL[gE+(6)+1]*gv))-(gL[gE+(9)]+gx);
if(gB>0){return false}if(gB>gN){gN=gB;gC=gE}}var gO=gF._data;var gy,gu;var gS=gL[gC+(6)];var gR=gL[gC+(6)+1];var gD,gA,gs,gr;var gI,gH;gB=((gS*gv)-(gR*gw));if(gB>=gL[gC+(10)]){if(gB<=gL[gC+(11)]){gB=(gx+(gN*0.5));gI=(gS*gB);gH=(gR*gB);gy=gF._injectContact(gw-gI,gv-gH,(gG?gS:-gS),(gG?gR:-gR),gN,(0));gF._faceType=(gG?(1):(2));gF._reverse=!gG;gO[(11)]=gL[gC+(4)];gO[(11)+1]=gL[gC+(4)+1];gO[(13)]=gL[gC+(8)];gO[(14)]=gx;gu=gy._data;gu[(13)]=gT[(7)];gu[(13)+1]=gT[(7)+1];return true}else{var gK=gC+(13);if(gK===gP){gK=(6)}gD=gL[gK+(2)];gA=gL[gK+(2)+1];gs=gL[gK+(0)];gr=gL[gK+(0)+1]}}else{gD=gL[gC+(2)];gA=gL[gC+(2)+1];gs=gL[gC+(0)];gr=gL[gC+(0)+1]}gI=(gw-gD);gH=(gv-gA);var gt=((gI*gI)+(gH*gH));if(gt>(gx*gx)){return false}if(gt<l.NORMALIZE_SQ_EPSILON){gy=gF._injectContact(gw,gv,(gG?gS:-gS),(gG?gR:-gR),0,(0))}else{var gM=Math.sqrt(gt);var gU=(1/gM);var gQ=0.5+(gx*gU*0.5);if(!gG){gU=-gU}gy=gF._injectContact(gw-(gI*gQ),gv-(gH*gQ),gI*gU,gH*gU,gM-gx,(0))}gu=gy._data;if(gG){gu[(13)]=gs;gu[(13)+1]=gr;gu[(15)]=gT[(7)];
gu[(15)+1]=gT[(7)+1]}else{gu[(13)]=gT[(7)];gu[(13)+1]=gT[(7)+1];gu[(15)]=gs;gu[(15)+1]=gr}gO[(14)]=gx;gF._faceType=(0);gF._reverse=false;return true};gq.prototype._collidePolygon2Polygon=function(gB,gz,gN){var g0=Number.POSITIVE_INFINITY;var gR=gB._data;var gQ=gz._data;var gs=gR.length;var gr=gQ.length;var g2,g1;var g4,gZ,gX,gV;var gI=-g0;var gA,gy,gH;for(g2=(6);g2<gs;g2+=(13)){g4=g0;gX=gR[g2+(6)];gV=gR[g2+(6)+1];gH=gR[g2+(9)];for(g1=(6);g1<gr;g1+=(13)){gZ=(gX*gQ[g1+(2)])+(gV*gQ[g1+(2)+1]);if(gZ<g4){g4=gZ}if((g4-gH)<=gI){break}}g4-=gH;if(g4>=0){return false}if(g4>gI){gI=g4;gy=g2;gA=true}}for(g1=(6);g1<gr;g1+=(13)){g4=g0;gX=gQ[g1+(6)];gV=gQ[g1+(6)+1];gH=gQ[g1+(9)];for(g2=(6);g2<gs;g2+=(13)){gZ=(gX*gR[g2+(2)])+(gV*gR[g2+(2)+1]);if(gZ<g4){g4=gZ}if((g4-gH)<=gI){break}}g4-=gH;if(g4>=0){return false}if(g4>gI){gI=g4;gy=g1;gA=false}}var g3=(gA?1:-1);var gv;if(!gA){gR=gz._data;gQ=gB._data;gs=gR.length;gr=gQ.length;gv=gB.body._data}else{gv=gz.body._data}gX=gR[gy+(6)];gV=gR[gy+(6)+1];g4=g0;var gJ;
for(g1=(6);g1<gr;g1+=(13)){gZ=(gX*gQ[g1+(6)])+(gV*gQ[g1+(6)+1]);if(gZ<g4){g4=gZ;gJ=g1}}var gt=gJ+(13);if(gt===gr){gt=(6)}var gP=gQ[gJ+(2)];var gO=gQ[gJ+(2)+1];var gE=gQ[gt+(2)];var gD=gQ[gt+(2)+1];var g6=(gE-gP);var g5=(gD-gO);var gY=(gP*gV)-(gO*gX);var gW=(gE*gV)-(gD*gX);var gF=(1/(gW-gY));var gU=(-gR[gy+(11)]-gY)*gF;if(gU>l.CLIP_EPSILON){gP+=(g6*gU);gO+=(g5*gU)}gU=(-gR[gy+(10)]-gW)*gF;if(gU<-l.CLIP_EPSILON){gE+=(g6*gU);gD+=(g5*gU)}var gG=gN._data;gG[(11)]=gR[gy+(4)];gG[(11)+1]=gR[gy+(4)+1];gG[(13)]=gR[gy+(8)];gG[(14)]=0;gN._faceType=(gA?(1):(2));gH=gR[gy+(9)];var gK=((gP*gX)+(gO*gV))-gH;var gx=((gE*gX)+(gD*gV))-gH;var gT=gv[(2)];var gS=gv[(2)+1];var gu=gv[(5)];var gC=gv[(5)+1];if(gK>0&&gx>0){return false}var gM=(gP-gT);var gL=(gO-gS);gP-=(gX*gK*0.5);gO-=(gV*gK*0.5);var gw=gN._injectContact(gP,gO,gX*g3,gV*g3,gK,(gA?(1):(2)),gK>0)._data;gw[(13)]=((gu*gM)+(gC*gL));gw[(13)+1]=((gu*gL)-(gC*gM));gM=(gE-gT);gL=(gD-gS);gE-=(gX*gx*0.5);gD-=(gV*gx*0.5);gw=gN._injectContact(gE,gD,gX*g3,gV*g3,gx,(gA?(2):(1)),gx>0)._data;
gw[(13)]=((gu*gM)+(gC*gL));gw[(13)+1]=((gu*gL)-(gC*gM));gN._reverse=(!gA);return true};gq.prototype._collideCircle2Circle=function(gB,gA,gt){var gy=gB._data;var gx=gA._data;var gs=gy[(9)];var gD=gy[(9)+1];var gu=gy[(6)];var gH=(gx[(9)]-gs);var gG=(gx[(9)+1]-gD);var gF=gu+gx[(6)];var gE=((gH*gH)+(gG*gG));if(gE>(gF*gF)){return false}var gr;if(gE<l.NORMALIZE_SQ_EPSILON){gr=gt._injectContact(gs+(gH*0.5),gD+(gG*0.5),1,0,-gF,(0))}else{var gz=Math.sqrt(gE);var gv=(1/gz);var gC=(0.5+((gu-(0.5*gF))*gv));gr=gt._injectContact(gs+(gH*gC),gD+(gG*gC),gH*gv,gG*gv,gz-gF,(0))}var gw=gr._data;gw[(13)]=gy[(7)];gw[(13)+1]=gy[(7)+1];gw[(15)]=gx[(7)];gw[(15)+1]=gx[(7)+1];gw=gt._data;gw[(14)]=gF;gt._faceType=(0);return true};gq.prototype._test=function(gs,gr){if(gs._type===(0)){if(gr._type===(0)){return this._testCircle2Circle(gs,gr)}else{return this._testCircle2Polygon(gs,gr)}}else{if(gr._type===(0)){return this._testCircle2Polygon(gr,gs)}else{return this._testPolygon2Polygon(gs,gr)}}};gq.prototype._testCircle2Circle=function(gv,gu){var gx=gv._data;
var gw=gu._data;var gt=(gx[(9)]-gw[(9)]);var gs=(gx[(9)+1]-gw[(9)+1]);var gr=gx[(6)]+gw[(6)];return(((gt*gt)+(gs*gs))<=(gr*gr))};gq.prototype._testCircle2Polygon=function(gr,gC){var gy=gr._data;var gF=gC._data;var gw=gy[(9)];var gt=gy[(9)+1];var gz=gy[(6)];var gB=Number.NEGATIVE_INFINITY;var gs,gv;var gx=(6);var gu=gF.length;for(;gx<gu;gx+=(13)){gv=((gF[gx+(6)]*gw)+(gF[gx+(6)+1]*gt));var gA=gv-(gz+gF[gx+(9)]);if(gA>0){return false}if(gA>gB){gB=gA;gs=gx}}gv=((gF[gs+(6)]*gt)-(gF[gs+(6)+1]*gw));if(gv>=gF[gs+(10)]){if(gv<=gF[gs+(11)]){return true}else{gs+=(13);if(gs===gu){gs=(6)}}}var gE=(gw-gF[gs+(2)]);var gD=(gt-gF[gs+(2)+1]);return(((gE*gE)+(gD*gD))<=(gz*gz))};gq.prototype._testPolygon2Polygon=function(gD,gC){var gr=Number.POSITIVE_INFINITY;var gB=gD._data;var gA=gC._data;var gt=gB.length;var gs=gA.length;var gx,gw;var gv,gu,gz,gy;for(gx=(6);gx<gt;gx+=(13)){gv=gr;gz=gB[gx+(6)];gy=gB[gx+(6)+1];for(gw=(6);gw<gs;gw+=(13)){gu=(gz*gA[gw+(2)])+(gy*gA[gw+(2)+1]);if(gu<gv){gv=gu}}if(gv>gB[gx+(9)]){return false
}}for(gw=(6);gw<gs;gw+=(13)){gv=gr;gz=gA[gw+(6)];gy=gA[gw+(6)+1];for(gx=(6);gx<gt;gx+=(13)){gu=(gz*gB[gx+(2)])+(gy*gB[gx+(2)+1]);if(gu<gv){gv=gu}}if(gv>gA[gw+(9)]){return false}}return true};gq.create=function(){var gr=new gq();gr._toi=d1.allocate();return gr};return gq})();var bZ=(function(){function gq(){this.vendor="Turbulenz"}gq.prototype.getDefaultMaterial=function(){return cu.defaultMaterial};gq.prototype.createCircleShape=function(gr){return er.create(gr)};gq.prototype.createPolygonShape=function(gr){return O.create(gr,null)};gq.prototype.createRigidBody=function(gr){return eS.create(gr)};gq.prototype.createWorld=function(gr){return cv.create(gr)};gq.prototype.createMaterial=function(gr){return cu.create(gr)};gq.prototype.createSweepAndPruneBroadphase=function(){return fX.create()};gq.prototype.createBoxTreeBroadphase=function(){return e6.create()};gq.prototype.createCollisionUtils=function(){return dG.create()};gq.prototype.createPointConstraint=function(gr){return aq.create(gr)
};gq.prototype.createWeldConstraint=function(gr){return dv.create(gr)};gq.prototype.createAngleConstraint=function(gr){return b2.create(gr)};gq.prototype.createDistanceConstraint=function(gr){return ed.create(gr)};gq.prototype.createLineConstraint=function(gr){return fp.create(gr)};gq.prototype.createMotorConstraint=function(gr){return fr.create(gr)};gq.prototype.createPulleyConstraint=function(gr){return fm.create(gr)};gq.prototype.createCustomConstraint=function(gr){return fM.create(gr)};gq.prototype.createRectangleVertices=function(gu,gt,gs,gr){var gv;if(gs<gu){gv=gu;gu=gs;gs=gv}if(gr<gt){gv=gt;gt=gr;gr=gv}var gz=new gq.prototype.floatArray(2);gz[0]=gu;gz[1]=gt;var gy=new gq.prototype.floatArray(2);gy[0]=gs;gy[1]=gt;var gx=new gq.prototype.floatArray(2);gx[0]=gs;gx[1]=gr;var gw=new gq.prototype.floatArray(2);gw[0]=gu;gw[1]=gr;return[gz,gy,gx,gw]};gq.prototype.createBoxVertices=function(gv,gs){var gt=(gv*0.5);var gu=(gs*0.5);var gr=new gq.prototype.floatArray(2);gr[0]=-gt;gr[1]=-gu;var gy=new gq.prototype.floatArray(2);
gy[0]=gt;gy[1]=-gu;var gx=new gq.prototype.floatArray(2);gx[0]=gt;gx[1]=gu;var gw=new gq.prototype.floatArray(2);gw[0]=-gt;gw[1]=gu;return[gr,gy,gx,gw]};gq.prototype.createRegularPolygonVertices=function(gB,gA,gz){var gw=(gB*0.5);var gu=(gA*0.5);var gx=[];var gv=gz;var gy=(Math.PI*2/gv);var gt;for(gt=0;gt<gv;gt+=1){var gs=(gy*gt);var gr=gx[gx.length]=new gq.prototype.floatArray(2);gr[0]=(gw*Math.cos(gs));gr[1]=(gu*Math.sin(gs))}return gx};gq.create=function(){var gr=new gq();return gr};gq.version=1;return gq})();((function(){bZ.prototype.floatArray=function(gs){if(arguments.length===0){return[]}var gu,gt;if(typeof gs==="number"){gt=new Array(gs)}else{gt=[];for(gu=0;gu<gs.length;gu+=1){gt[gu]=gs[gu]}}return gt};bZ.prototype.uint16Array=bZ.prototype.floatArray;var gq,gr;if(typeof Float32Array!=="undefined"){gq=new Float32Array(4);gr=Object.prototype.toString.call(gq);if(gr==="[object Float32Array]"){bZ.prototype.floatArray=Float32Array}}if(typeof Uint16Array!=="undefined"){gq=new Uint16Array(4);
gr=Object.prototype.toString.call(gq);if(gr==="[object Uint16Array]"){bZ.prototype.uint16Array=Uint16Array}}})());cu.defaultMaterial=cu.create();var eE=(function(){function gq(gt,gs,gr){this.escapeNodeOffset=gs;this.externalNode=gr;this.extents=gt}gq.prototype.isLeaf=function(){return !!this.externalNode};gq.prototype.reset=function(gr,gx,gw,gv,gu,gs){this.escapeNodeOffset=gu;this.externalNode=gs;var gt=this.extents;gt[0]=gr;gt[1]=gx;gt[2]=gw;gt[3]=gv};gq.prototype.clear=function(){this.escapeNodeOffset=1;this.externalNode=undefined;var gs=this.extents;var gr=Number.MAX_VALUE;gs[0]=gr;gs[1]=gr;gs[2]=-gr;gs[3]=-gr};gq.create=function(gt,gs,gr){return new gq(gt,gs,gr)};gq.version=1;return gq})();var f5=(function(){function gq(gr){this.numNodesLeaf=4;this.nodes=[];this.endNode=0;this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.numUpdates=0;this.numExternalNodes=0;this.startUpdate=2147483647;this.endUpdate=-2147483647;this.highQuality=gr}gq.prototype.add=function(gs,gu){var gr=this.endNode;
gs.boxTreeIndex=gr;var gt=new this.arrayConstructor(4);gt[0]=gu[0];gt[1]=gu[1];gt[2]=gu[2];gt[3]=gu[3];this.nodes[gr]=eE.create(gt,1,gs);this.endNode=(gr+1);this.needsRebuild=true;this.numAdds+=1;this.numExternalNodes+=1};gq.prototype.remove=function(gu){var gt=gu.boxTreeIndex;if(gt!==undefined){if(this.numExternalNodes>1){var gs=this.nodes;gs[gt].clear();var gr=this.endNode;if((gt+1)>=gr){while(!gs[gr-1].externalNode){gr-=1}this.endNode=gr}else{this.needsRebuild=true}this.numExternalNodes-=1}else{this.clear()}gu.boxTreeIndex=undefined}};gq.prototype.findParent=function(gv){var gr=this.nodes;var gs=gv;var gu=0;var gt;do{gs-=1;gu+=1;gt=gr[gs]}while(gt.escapeNodeOffset<=gu);return gt};gq.prototype.update=function(gx,gz){var gy=gx.boxTreeIndex;if(gy!==undefined){var gr=gz[0];var gF=gz[1];var gC=gz[2];var gA=gz[3];var gw=this.needsRebuild;var gE=this.needsRebound;var gs=this.nodes;var gv=gs[gy];var gu=gv.extents;var gD=(gw||gE||gu[0]>gr||gu[1]>gF||gu[2]<gC||gu[3]<gA);gu[0]=gr;gu[1]=gF;gu[2]=gC;
gu[3]=gA;if(gD){if(!gw&&1<gs.length){this.numUpdates+=1;if(this.startUpdate>gy){this.startUpdate=gy}if(this.endUpdate<gy){this.endUpdate=gy}if(!gE){if((2*this.numUpdates)>this.numExternalNodes){this.needsRebound=true}else{var gB=this.findParent(gy);var gt=gB.extents;if(gt[0]>gr||gt[1]>gF||gt[2]<gC||gt[3]<gA){this.needsRebound=true}}}else{if(this.numUpdates>(3*this.numExternalNodes)){this.needsRebuild=true;this.numAdds=this.numUpdates}}}}}else{this.add(gx,gz)}};gq.prototype.needsFinalize=function(){return(this.needsRebuild||this.needsRebound)};gq.prototype.finalize=function(){if(this.needsRebuild){this.rebuild()}else{if(this.needsRebound){this.rebound()}}};gq.prototype.rebound=function(){var gt=this.nodes;if(gt.length>1){var gG=this.startUpdate;var gA=this.endUpdate;var gB=[];var gz=0;var gH=0;for(;;){var gF=gt[gH];var gD=gH;var gE=(gH+gF.escapeNodeOffset);var gy=(gH+1);var gv;do{gv=gt[gy];var gx=(gy+gv.escapeNodeOffset);if(gy<gA){if(!gv.externalNode){if(gx>gG){gB[gz]=gH;gz+=1;gH=gy}}}else{break
}gy=gx}while(gy<gE);if(gH===gD){gy=(gH+1);gv=gt[gy];var gC=gv.extents;var gw=gC[0];var gu=gC[1];var gs=gC[2];var gr=gC[3];gy=(gy+gv.escapeNodeOffset);while(gy<gE){gv=gt[gy];gC=gv.extents;if(gw>gC[0]){gw=gC[0]}if(gu>gC[1]){gu=gC[1]}if(gs<gC[2]){gs=gC[2]}if(gr<gC[3]){gr=gC[3]}gy=(gy+gv.escapeNodeOffset)}gC=gF.extents;gC[0]=gw;gC[1]=gu;gC[2]=gs;gC[3]=gr;gA=gH;if(0<gz){gz-=1;gH=gB[gz]}else{break}}}}this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.startUpdate=2147483647;this.endUpdate=-2147483647};gq.prototype.rebuild=function(){if(this.numExternalNodes>0){var gs=this.nodes;var gx,gv,gu;if(this.numExternalNodes===gs.length){gx=gs;gv=gs.length;gs=[];this.nodes=gs}else{gx=[];gx.length=this.numExternalNodes;gv=0;gu=this.endNode;for(var gw=0;gw<gu;gw+=1){var gt=gs[gw];if(gt.externalNode){gs[gw]=undefined;gx[gv]=gt;gv+=1}}if(gx.length>gv){gx.length=gv}}if(gv>1){if(gv>this.numNodesLeaf&&this.numAdds>0){if(this.highQuality){this.sortNodesHighQuality(gx)}else{this.sortNodes(gx)}}this.recursiveBuild(gx,0,gv,0);
gu=gs[0].escapeNodeOffset;if(gs.length>gu){gs.length=gu}this.endNode=gu}else{var gr=gx[0];gr.externalNode.boxTreeIndex=0;gs.length=1;gs[0]=gr;this.endNode=1}gx=null}this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.numUpdates=0;this.startUpdate=2147483647;this.endUpdate=-2147483647};gq.prototype.sortNodes=function(gs){var gx=this.numNodesLeaf;var gu=gs.length;var gC=function gr(gI){var gH=gI.extents;return(gH[0]+gH[2])};var gF=function gG(gI){var gH=gI.extents;return(gH[1]+gH[3])};var gt=function gD(gI){var gH=gI.extents;return -(gH[0]+gH[2])};var gw=function gz(gI){var gH=gI.extents;return -(gH[1]+gH[3])};var gB=this.nthElement;var gy=false;var gv=0;var gE=function gA(gI,gK,gJ){var gH=((gK+gJ)>>1);if(gv===0){if(gy){gB(gI,gK,gH,gJ,gt)}else{gB(gI,gK,gH,gJ,gC)}}else{if(gy){gB(gI,gK,gH,gJ,gw)}else{gB(gI,gK,gH,gJ,gF)}}if(gv===0){gv=2}else{if(gv===2){gv=1}else{gv=0}}gy=!gy;if((gK+gx)<gH){gE(gI,gK,gH)}if((gH+gx)<gJ){gE(gI,gH,gJ)}};gE(gs,0,gu)};gq.prototype.sortNodesHighQuality=function(gJ){var gw=this.numNodesLeaf;
var gI=gJ.length;var gD=function gF(gQ){var gP=gQ.extents;return(gP[0]+gP[2])};var gr=function gv(gQ){var gP=gQ.extents;return(gP[1]+gP[3])};var gO=function gx(gQ){var gP=gQ.extents;return(gP[0]+gP[1]+gP[2]+gP[3])};var gE=function gN(gQ){var gP=gQ.extents;return(gP[0]-gP[1]+gP[2]-gP[3])};var gM=function gC(gQ){var gP=gQ.extents;return -(gP[0]+gP[2])};var gy=function gt(gQ){var gP=gQ.extents;return -(gP[1]+gP[3])};var gu=function gs(gQ){var gP=gQ.extents;return -(gP[0]+gP[1]+gP[2]+gP[3])};var gK=function gH(gQ){var gP=gQ.extents;return -(gP[0]-gP[1]+gP[2]-gP[3])};var gA=this.nthElement;var gB=this.calculateSAH;var gz=false;var gG=function gL(gS,gW,gV){var gR=((gW+gV)>>1);gA(gS,gW,gR,gV,gD);var gQ=(gB(gS,gW,gR)+gB(gS,gR,gV));gA(gS,gW,gR,gV,gr);var gP=(gB(gS,gW,gR)+gB(gS,gR,gV));gA(gS,gW,gR,gV,gO);var gT=(gB(gS,gW,gR)+gB(gS,gR,gV));gA(gS,gW,gR,gV,gE);var gU=(gB(gS,gW,gR)+gB(gS,gR,gV));if(gQ<=gP&&gQ<=gT&&gQ<=gU){if(gz){gA(gS,gW,gR,gV,gM)}else{gA(gS,gW,gR,gV,gD)}}else{if(gP<=gT&&gP<=gU){if(gz){gA(gS,gW,gR,gV,gy)
}else{gA(gS,gW,gR,gV,gr)}}else{if(gT<=gU){if(gz){gA(gS,gW,gR,gV,gu)}else{gA(gS,gW,gR,gV,gO)}}else{if(gz){gA(gS,gW,gR,gV,gK)}else{gA(gS,gW,gR,gV,gE)}}}}gz=!gz;if((gW+gw)<gR){gG(gS,gW,gR)}if((gR+gw)<gV){gG(gS,gR,gV)}};gG(gJ,0,gI)};gq.prototype.calculateSAH=function(gs,gA,gy){var gx,gz,gw,gv,gt,gr;gx=gs[gA];gz=gx.extents;gw=gz[0];gv=gz[1];gt=gz[2];gr=gz[3];for(var gu=(gA+1);gu<gy;gu+=1){gx=gs[gu];gz=gx.extents;if(gw>gz[0]){gw=gz[0]}if(gv>gz[1]){gv=gz[1]}if(gt<gz[2]){gt=gz[2]}if(gr<gz[3]){gr=gz[3]}}return((gt-gw)+(gr-gv))};gq.prototype.nthElement=function(gt,gx,gr,gA,gw){function gu(gE,gD,gF){if(gE<gD){if(gD<gF){return gD}else{if(gE<gF){return gF}else{return gE}}}else{if(gE<gF){return gE}else{if(gD<gF){return gF}}}return gD}function gv(gD,gH,gL,gG){var gK=(gH+1);while(gK!==gL){var gF=gD[gK];var gE=gG(gF);var gI=gK;var gJ=(gK-1);while(gI!==gH&&gE<gG(gD[gJ])){gD[gI]=gD[gJ];gI-=1;gJ-=1}if(gI!==gK){gD[gI]=gF}gK+=1}}while((gA-gx)>8){var gz=gu(gw(gt[gx]),gw(gt[gx+((gA-gx)>>1)]),gw(gt[gA-1]));var gs=gx;
var gy=gA;var gC;for(;;gs+=1){while(gw(gt[gs])<gz){gs+=1}do{gy-=1}while(gz<gw(gt[gy]));if(gs>=gy){gC=gs;break}else{var gB=gt[gs];gt[gs]=gt[gy];gt[gy]=gB}}if(gC<=gr){gx=gC}else{gA=gC}}gv(gt,gx,gA,gw)};gq.prototype.recursiveBuild=function(gu,gH,gD,gF){var gv=this.nodes;var gA=gF;gF+=1;var gB,gz,gt,gr,gG;var gC,gs;if((gH+this.numNodesLeaf)>=gD){gC=gu[gH];gG=gC.extents;gB=gG[0];gz=gG[1];gt=gG[2];gr=gG[3];gC.externalNode.boxTreeIndex=gF;gv[gF]=gC;for(var gx=(gH+1);gx<gD;gx+=1){gC=gu[gx];gG=gC.extents;if(gB>gG[0]){gB=gG[0]}if(gz>gG[1]){gz=gG[1]}if(gt<gG[2]){gt=gG[2]}if(gr<gG[3]){gr=gG[3]}gF+=1;gC.externalNode.boxTreeIndex=gF;gv[gF]=gC}gs=gv[gF]}else{var gE=((gH+gD)>>1);if((gH+1)>=gE){gC=gu[gH];gC.externalNode.boxTreeIndex=gF;gv[gF]=gC}else{this.recursiveBuild(gu,gH,gE,gF)}gs=gv[gF];gG=gs.extents;gB=gG[0];gz=gG[1];gt=gG[2];gr=gG[3];gF=(gF+gs.escapeNodeOffset);if((gE+1)>=gD){gC=gu[gE];gC.externalNode.boxTreeIndex=gF;gv[gF]=gC}else{this.recursiveBuild(gu,gE,gD,gF)}gs=gv[gF];gG=gs.extents;if(gB>gG[0]){gB=gG[0]
}if(gz>gG[1]){gz=gG[1]}if(gt<gG[2]){gt=gG[2]}if(gr<gG[3]){gr=gG[3]}}var gy=gv[gA];if(gy!==undefined){gy.reset(gB,gz,gt,gr,(gF+gs.escapeNodeOffset-gA))}else{var gw=new this.arrayConstructor(4);gw[0]=gB;gw[1]=gz;gw[2]=gt;gw[3]=gr;gv[gA]=eE.create(gw,(gF+gs.escapeNodeOffset-gA))}};gq.prototype.getVisibleNodes=function(gB,gF){if(this.numExternalNodes>0){var gD=this.nodes;var gv=this.endNode;var gI=gB.length;var gy=gF.length;var gE,gG,gw;var gA,gz,gt,gs;var gx,gC,gu,gr,gJ;var gH=0;for(;;){gE=gD[gH];gG=gE.extents;gA=gG[0];gz=gG[1];gt=gG[2];gs=gG[3];gx=true;gC=0;do{gu=gB[gC];gr=gu[0];gJ=gu[1];if((gr*(gr<0?gA:gt)+gJ*(gJ<0?gz:gs))<gu[2]){gx=false;break}gC+=1}while(gC<gI);if(gx){if(gE.externalNode){gF[gy]=gE.externalNode;gy+=1;gH+=1;if(gH>=gv){break}}else{gx=true;gC=0;do{gu=gB[gC];gr=gu[0];gJ=gu[1];if((gr*(gr>0?gA:gt)+gJ*(gJ>0?gz:gs))<gu[2]){gx=false;break}gC+=1}while(gC<gI);if(gx){gw=(gH+gE.escapeNodeOffset);gH+=1;do{gE=gD[gH];if(gE.externalNode){gF[gy]=gE.externalNode;gy+=1}gH+=1}while(gH<gw);if(gH>=gv){break
}}else{gH+=1}}}else{gH+=gE.escapeNodeOffset;if(gH>=gv){break}}}}};gq.prototype.getOverlappingNodes=function(gs,gy,gt){if(this.numExternalNodes>0){var gr=gs[0];var gI=gs[1];var gJ=gs[2];var gH=gs[3];var gz=this.nodes;var gv=this.endNode;var gA,gB,gw;var gu=0;var gx=(gt===undefined)?gy.length:gt;var gC=0;for(;;){gA=gz[gC];gB=gA.extents;var gG=gB[0];var gF=gB[1];var gE=gB[2];var gD=gB[3];if(gr<=gE&&gI<=gD&&gJ>=gG&&gH>=gF){if(gA.externalNode){gy[gx]=gA.externalNode;gx+=1;gu+=1;gC+=1;if(gC>=gv){break}}else{if(gJ>=gE&&gH>=gD&&gr<=gG&&gI<=gF){gw=(gC+gA.escapeNodeOffset);gC+=1;do{gA=gz[gC];if(gA.externalNode){gy[gx]=gA.externalNode;gx+=1;gu+=1}gC+=1}while(gC<gw);if(gC>=gv){break}}else{gC+=1}}}else{gC+=gA.escapeNodeOffset;if(gC>=gv){break}}}return gu}else{return 0}};gq.prototype.getCircleOverlappingNodes=function(gI,gs,gy){if(this.numExternalNodes>0){var gD=(gs*gs);var gw=gI[0];var gv=gI[1];var gz=this.nodes;var gu=this.endNode;var gA,gB;var gt=gy.length;var gC=0;for(;;){gA=gz[gC];gB=gA.extents;
var gH=gB[0];var gF=gB[1];var gG=gB[2];var gE=gB[3];var gr=0,gx;if(gw<gH){gx=(gH-gw);gr+=(gx*gx)}else{if(gw>gG){gx=(gw-gG);gr+=(gx*gx)}}if(gv<gF){gx=(gF-gv);gr+=(gx*gx)}else{if(gv>gE){gx=(gv-gE);gr+=(gx*gx)}}if(gr<=gD){gC+=1;if(gA.externalNode){gy[gt]=gA.externalNode;gt+=1;if(gC>=gu){break}}}else{gC+=gA.escapeNodeOffset;if(gC>=gu){break}}}}};gq.prototype.getOverlappingPairs=function(gG,gE){if(this.numExternalNodes>0){var gt=this.nodes;var gx=this.endNode;var gu,gw,gz,gC;var gF=0;var gv=(gE===undefined)?gG.length:gE;var gD=0,gB;for(;;){gu=gt[gD];while(!gu.externalNode){gD+=1;gu=gt[gD]}gD+=1;if(gD<gx){gw=gu.externalNode;gC=gu.extents;var gA=gC[0];var gy=gC[1];var gs=gC[2];var gr=gC[3];gB=gD;for(;;){gz=gt[gB];gC=gz.extents;if(gA<=gC[2]&&gy<=gC[3]&&gs>=gC[0]&&gr>=gC[1]){gB+=1;if(gz.externalNode){gG[gv]=gw;gG[gv+1]=gz.externalNode;gv+=2;gF+=2;if(gB>=gx){break}}}else{gB+=gz.escapeNodeOffset;if(gB>=gx){break}}}}else{break}}return gF}else{return 0}};gq.prototype.getRootNode=function(){return this.nodes[0]
};gq.prototype.getNodes=function(){return this.nodes};gq.prototype.getEndNodeIndex=function(){return this.endNode};gq.prototype.clear=function(){this.nodes=[];this.endNode=0;this.needsRebuild=false;this.needsRebound=false;this.numAdds=0;this.numUpdates=0;this.numExternalNodes=0;this.startUpdate=2147483647;this.endUpdate=-2147483647};gq.rayTest=function(gw,gA,gv){var gP=gA.origin;var gO=gA.direction;var gI=gP[0];var gG=gP[1];var gr=gO[0];var gQ=gO[1];var gt=1/gr;var gs=1/gQ;var gN=function gL(gX,gU){var gR=gX[0];var g1=gX[1];var gZ=gX[2];var gY=gX[3];if(gR<=gI&&gI<=gZ&&g1<=gG&&gG<=gY){return 0}var gT,gV;var gW,gS;var g0;if(gr>=0){g0=(gR-gI);gT=((g0===0)?0:(g0*gt));g0=(gZ-gI);gV=((g0===0)?0:(g0*gt))}else{gT=((gZ-gI)*gt);gV=((gR-gI)*gt)}if(gQ>=0){g0=(g1-gG);gW=((g0===0)?0:(g0*gs));g0=(gY-gG);gS=((g0===0)?0:(g0*gs))}else{gW=((gY-gG)*gs);gS=((g1-gG)*gs)}if((gT>gS)||(gW>gV)){return undefined}if(gW>gT){gT=gW}if(gS<gV){gV=gS}if(gT<0){gT=gV}return(0<=gT&&gT<gU)?gT:undefined};var gB=[];var gu=null;
var gM=function gy(gZ,gV,gW){var gS=gZ.getNodes();var gU=gS[gV];var gR=gN(gU.extents,gW);if(gR===undefined){return gW}if(gU.externalNode){var g0=gv(gZ,gU.externalNode,gA,gR,gW);if(g0){gu=g0;gW=g0.factor}}else{var gT=gB.length;var gX;for(gX=0;gX<gT;gX+=1){var gY=gB[gX];if(gR>gY.distance){break}}gB.splice(gX-1,0,{tree:gZ,nodeIndex:gV,distance:gR})}return gW};var gx=gA.maxFactor;var gC;var gH;for(gH=0;gH<gw.length;gH+=1){gC=gw[gH];if(gC.endNode!==0){gx=gM(gC,0,gx)}}while(gB.length!==0){var gD=gB.pop();if(gD.distance>=gx){continue}var gK=gD.nodeIndex;gC=gD.tree;var gE=gC.getNodes();var gF=gE[gK];var gz=gK+gF.escapeNodeOffset;var gJ=gK+1;do{gx=gM(gC,gJ,gx);gJ+=gE[gJ].escapeNodeOffset}while(gJ<gz)}return gu};gq.create=function(gr){return new gq(gr)};gq.version=1;return gq})();((function(){f5.prototype.arrayConstructor=Array;if(typeof Float32Array!=="undefined"){var gq=new Float32Array(4);var gr=Object.prototype.toString.call(gq);if(gr==="[object Float32Array]"){f5.prototype.arrayConstructor=Float32Array
}}})());var ca=(function(){function gq(){}gq.create=function(){var gr=new gq();gr.indices=[];gr.textures=[];gr.numSets=0;gr.vertexBufferData=new d9.floatArray(1024);gr.numVertices=0;return gr};return gq})();var bb=(function(){function gq(){}gq.prototype.getTextureRectangle=function(gt){if(gt===undefined){gt=new d9.floatArray(4)}var gs=this.data;var gr=this._texture;if(gr){gt[0]=gs[12]*gr.width;gt[1]=gs[13]*gr.height;gt[2]=gs[14]*gr.width;gt[3]=gs[15]*gr.height}else{gt[0]=gs[12];gt[1]=gs[13];gt[2]=gs[14];gt[3]=gs[15]}return gt};gq.prototype.setTextureRectangle=function(gs){var gu=this.data;var gt=this._texture;if(gt){var gr=1/gt.width;var gv=1/gt.height;gu[12]=gs[0]*gr;gu[13]=gs[1]*gv;gu[14]=gs[2]*gr;gu[15]=gs[3]*gv}else{gu[12]=gs[0];gu[13]=gs[1];gu[14]=gs[2];gu[15]=gs[3]}};gq.prototype.getColor=function(gs){if(gs===undefined){gs=new d9.floatArray(4)}var gr=this.data;gs[0]=gr[8];gs[1]=gr[9];gs[2]=gr[10];gs[3]=gr[11];return gs};gq.prototype.setColor=function(gr){var gs=this.data;gs[8]=gr[0];
gs[9]=gr[1];gs[10]=gr[2];gs[11]=gr[3]};gq.prototype.getTexture=function(){return this._texture};gq.prototype.setTexture=function(gt){if(this._texture!==gt){var gs=(this._texture?this._texture.width:1)/(gt?gt.width:1);var gr=(this._texture?this._texture.height:1)/(gt?gt.height:1);this._texture=gt||null;var gu=this.data;gu[12]*=gs;gu[13]*=gr;gu[14]*=gs;gu[15]*=gr}};gq.prototype.getWidth=function(){return this.data[17]*2};gq.prototype.setWidth=function(gr){gr*=0.5;var gs=this.data;if(gs[17]!==gr){gs[17]=gr;this._invalidate()}};gq.prototype.getHeight=function(){return this.data[18]*2};gq.prototype.setHeight=function(gr){gr*=0.5;var gs=this.data;if(gs[18]!==gr){gs[18]=gr;this._invalidate()}};gq.prototype.getScale=function(gs){if(gs===undefined){gs=new d9.floatArray(2)}var gr=this.data;gs[0]=gr[19];gs[1]=gr[20];return gs};gq.prototype.setScale=function(gu){var gs=gu[0];var gr=gu[1];var gt=this.data;if(gt[19]!==gs||gt[20]!==gr){gt[19]=gs;gt[20]=gr;this._invalidate()}};gq.prototype.getShear=function(gs){if(gs===undefined){gs=new d9.floatArray(2)
}var gr=this.data;gs[0]=gr[21];gs[1]=gr[22];return gs};gq.prototype.setShear=function(gu){var gs=gu[0];var gr=gu[1];var gt=this.data;if(gt[21]!==gs||gt[22]!==gr){gt[21]=gs;gt[22]=gr;this._invalidate()}};gq.prototype.getOrigin=function(gs){if(gs===undefined){gs=new d9.floatArray(2)}var gr=this.data;gs[0]=gr[23];gs[1]=gr[24];return gs};gq.prototype.setOrigin=function(gs){var gt=gs[0];var gr=gs[1];var gu=this.data;if(gu[23]!==gt||gu[24]!==gr){gu[23]=gt;gu[24]=gr;this._invalidate()}};gq.prototype._invalidate=function(){var gJ=this.data;var gC=gJ[19];var gB=gJ[19]*gJ[21];var gA=gJ[20]*gJ[22];var gz=gJ[20];var gy=gJ[17]-gJ[23];var gx=gJ[18]-gJ[24];var gu=gJ[25]=(gC*gy+gB*gx);var gt=gJ[26]=(gA*gy+gz*gx);gy=-gJ[17];gx=-gJ[18];var gw=gJ[27]=(gC*gy+gB*gx);var gv=gJ[28]=(gA*gy+gz*gx);gy=-gy;var gE=gJ[29]=(gC*gy+gB*gx);var gD=gJ[30]=(gA*gy+gz*gx);var gG=gJ[16]=this.rotation;var gs=Math.cos(gG);var gr=Math.sin(gG);gJ[31]=((gs*gu)-(gr*gt));gJ[32]=((gr*gu)+(gs*gt));gJ[33]=((gs*gw)-(gr*gv));gJ[34]=((gr*gw)+(gs*gv));
gJ[35]=((gs*gE)-(gr*gD));gJ[36]=((gr*gE)+(gs*gD));var gF=2*((gu*gw)+(gt*gv));if(gF<0){gF=-gF}var gI=(gw*gw)+(gv*gv)+gF;gF=2*((gu*gE)+(gt*gD));if(gF<0){gF=-gF}var gH=(gE*gE)+(gD*gD)+gF;if(gH>gI){gI=gH}gI+=((gu*gu)+(gt*gt));gJ[37]=(0.25/gI)};gq.prototype._update=function(gu){var gv=this.data;var gr,gw,gt,gs;gr=this.rotation;gw=gr-gv[16];if((gw*gw)>(gv[37]*gu)){gv[16]=gr;gt=Math.cos(gr);gs=Math.sin(gr);gr=gv[25];gw=gv[26];gv[31]=(gt*gr-gs*gw);gv[32]=(gs*gr+gt*gw);gr=gv[27];gw=gv[28];gv[33]=(gt*gr-gs*gw);gv[34]=(gs*gr+gt*gw);gr=gv[29];gw=gv[30];gv[35]=(gt*gr-gs*gw);gv[36]=(gs*gr+gt*gw)}gt=this.x+gv[31];gs=this.y+gv[32];gr=gv[33];gw=gv[34];gv[0]=gt+gr;gv[1]=gs+gw;gv[6]=gt-gr;gv[7]=gs-gw;gr=gv[35];gw=gv[36];gv[2]=gt+gr;gv[3]=gs+gw;gv[4]=gt-gr;gv[5]=gs-gw};gq.create=function(gt){if((gt.width===undefined||gt.height===undefined)&&!gt.texture){return null}var gB=new gq();var gw=gB.data=new d9.floatArray(38);var gx=gB._texture=gt.texture||null;gB.x=(gt.x||0);gB.y=(gt.y||0);gB.rotation=gw[16]=(gt.rotation||0);
var gu=gt.color;gw[8]=(gu?gu[0]:1);gw[9]=(gu?gu[1]:1);gw[10]=(gu?gu[2]:1);gw[11]=(gu?gu[3]:1);var gy=gt.textureRectangle;var gv=(gx?1/gx.width:1);var gz=(gx?1/gx.height:1);gw[12]=(gy?(gy[0]*gv):0);gw[13]=(gy?(gy[1]*gz):0);gw[14]=(gy?(gy[2]*gv):1);gw[15]=(gy?(gy[3]*gz):1);gw[17]=((gt.width!==undefined)?gt.width:gx.width)*0.5;gw[18]=((gt.height!==undefined)?gt.height:gx.height)*0.5;var gs=gt.scale;gw[19]=(gs?gs[0]:1);gw[20]=(gs?gs[1]:1);var gr=gt.shear;gw[21]=(gr?gr[0]:0);gw[22]=(gr?gr[1]:0);var gA=gt.origin;gw[23]=(gA?gA[0]:gw[17]);gw[24]=(gA?gA[1]:gw[18]);gB._invalidate();return gB};gq.version=1;return gq})();var eV={setFromRotatedRectangle:function e8(gE,gD,gr,gx,gG,gF,gK){var gJ=gr[0];var gv=gr[1];var gI=gr[2];var gt=gr[3];if(!gF){gE[0]=gJ;gE[1]=gv;gE[2]=gI;gE[3]=gv;gE[4]=gJ;gE[5]=gt;gE[6]=gI;gE[7]=gt}else{var gw,gu;if(gK){gw=gJ+gK[0];gu=gv+gK[1]}else{gw=0.5*(gJ+gI);gu=0.5*(gv+gt)}var gB=gJ-gw;var gA=gv-gu;var gs=Math.cos(gF);var gq=Math.sin(gF);var gz=(gI-gJ);var gH=(gt-gv);gE[0]=gJ=gw+(gs*gB-gq*gA);
gE[1]=gv=gu+(gq*gB+gs*gA);gE[2]=gJ+(gs*gz);gE[3]=gv+(gq*gz);gE[4]=gJ-(gq*gH);gE[5]=gv+(gs*gH);gE[6]=gJ+(gs*gz-gq*gH);gE[7]=gv+(gq*gz+gs*gH)}if(gG){gE[8]=gG[0];gE[9]=gG[1];gE[10]=gG[2];gE[11]=gG[3]}else{gE[8]=gE[9]=gE[10]=gE[11]=1}if(gx&&gD){var gC=1/gD.width;var gy=1/gD.height;gE[12]=gx[0]*gC;gE[13]=gx[1]*gy;gE[14]=gx[2]*gC;gE[15]=gx[3]*gy}else{gE[12]=gE[13]=0;gE[14]=gE[15]=1}},create:function da(){return new d9.floatArray(16)}};var d9=(function(){function gq(){this.forceUpdate=false;this.clearBackBuffer=false;this.defaultClearColor=gq.defaultClearColor;this.sort={deferred:"deferred",immediate:"immediate",texture:"texture"};this.scale={scale:"scale",none:"none"};this.blend={additive:"additive",alpha:"alpha",opaque:"opaque"};this.drawStates={uninit:0,ready:1,draw:2}}gq.prototype.clear=function(gs){if(this.state!==this.drawStates.ready){return false}var gr=this.graphicsDevice;if(this.currentRenderTarget){if(!gr.beginRenderTarget(this.currentRenderTarget.renderTarget)){return false}gr.clear(gs||this.defaultClearColor);
gr.endRenderTarget()}else{gr.clear(gs||this.defaultClearColor)}return true};gq.prototype.clearBatch=function(){var gs=this.texLists;for(var gr in gs){if(gs.hasOwnProperty(gr)){gs[gr]=undefined}}this.currentTextureGroup=undefined;this.numGroups=0};gq.prototype.bufferSprite=function(gr,gt,gs){gt._update(0);gs<<=4;var gu=gt.data;gr[gs]=gu[0];gr[gs+1]=gu[1];gr[gs+2]=gu[2];gr[gs+3]=gu[3];gr[gs+4]=gu[4];gr[gs+5]=gu[5];gr[gs+6]=gu[6];gr[gs+7]=gu[7];gr[gs+8]=gu[8];gr[gs+9]=gu[9];gr[gs+10]=gu[10];gr[gs+11]=gu[11];gr[gs+12]=gu[12];gr[gs+13]=gu[13];gr[gs+14]=gu[14];gr[gs+15]=gu[15]};gq.prototype.update=function(){var gx=this.graphicsDevice;var gH=this.width;var gD=this.height;var gr=gx.width;var gA=gx.height;if(gH!==gr||gD!==gA||this.forceUpdate){var gI,gE,gM,gL;var gz=this.viewportRectangle;if(gz){gM=gz[0];gL=gz[1];gI=gz[2]-gM;gE=gz[3]-gL}else{gM=0;gL=0;gI=gr;gE=gA}if((gI===gr)&&(gE===gA)){this.clearBackBuffer=false}else{this.clearBackBuffer=true}var gN=this.currentRenderTarget;if(this.scaleMode==="scale"){var gF=gI/gE;
var gy=gr/gA;var gv,gB,gw,gt,gC,gu;if(gy>gF){gv=Math.ceil((gA/gE)*gI);gw=gr-gv;gC=Math.floor(gw*0.5);this.scissorX=gC;this.scissorY=0;this.scissorWidth=gv;this.scissorHeight=gA;this.viewScaleX=gI/gv;this.viewScaleY=gE/gA;if(!gN){this.clipOffsetX=(gC/gr*2)-1;this.clipOffsetY=1;this.clipScaleX=(gv/gr*2)/gI;this.clipScaleY=-2/gE}}else{gB=Math.ceil((gr/gI)*gE);gt=gA-gB;gu=Math.floor(gt*0.5);this.scissorX=0;this.scissorY=gu;this.scissorWidth=gr;this.scissorHeight=gB;this.viewScaleX=gI/gr;this.viewScaleY=gE/gB;if(!gN){this.clipOffsetX=-1;this.clipOffsetY=1-((gu/gA)*2);this.clipScaleX=2/gI;this.clipScaleY=((gB/gA)*-2)/gE}}}else{this.viewScaleX=1;this.viewScaleY=1;if(!gN){this.clipOffsetX=-1;this.clipOffsetY=1;this.clipScaleX=2/gr;this.clipScaleY=-2/gA}this.scissorX=0;this.scissorY=(gA-gE);this.scissorWidth=gI;this.scissorHeight=gE}this.spriteAngleFactor=Math.min(this.viewScaleX,this.viewScaleY);this.spriteAngleFactor*=this.spriteAngleFactor;this.width=gr;this.height=gA;var gJ=0;var gG=this.renderTargetStructs;
var gK=gG.length;for(gJ=0;gJ<gK;gJ+=1){this.validateTarget(gG[gJ],this.scissorWidth,this.scissorHeight)}if(gN){this.clipOffsetX=-1;this.clipOffsetY=-1;this.clipScaleX=2*gN.actualWidth/gN.texture.width/gI;this.clipScaleY=2*gN.actualHeight/gN.texture.height/gE}this.clipOffsetX-=gM*this.clipScaleX;this.clipOffsetY-=gL*this.clipScaleY;var gs=this.techniqueParameters.clipSpace;gs[0]=this.clipScaleX;gs[1]=this.clipScaleY;gs[2]=this.clipOffsetX;gs[3]=this.clipOffsetY;this.updateRenderTargetVbo(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight);this.forceUpdate=false}};gq.prototype.getViewport=function(gs){if(!gs){gs=new gq.floatArray(4)}var gr=this.viewportRectangle;if(gr){gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3]}else{gs[0]=gs[1]=0;gs[2]=this.graphicsDevice.width;gs[3]=this.graphicsDevice.height}return gs};gq.prototype.getScreenSpaceViewport=function(gr){if(!gr){gr=new gq.floatArray(4)}this.update();gr[0]=this.scissorX;gr[1]=this.height-(this.scissorY+this.scissorHeight);
gr[2]=gr[0]+this.scissorWidth;gr[3]=gr[1]+this.scissorHeight;return gr};gq.prototype.viewportMap=function(gt,gs,gv){if(!gv){gv=new gq.floatArray(2)}this.update();var gu=(this.height-this.scissorHeight-this.scissorY);gv[0]=(gt-this.scissorX)*this.viewScaleX;gv[1]=(gs-gu)*this.viewScaleY;var gr=this.viewportRectangle;if(gr){gv[0]+=gr[0];gv[1]+=gr[1]}return gv};gq.prototype.viewportUnmap=function(gs,gv,gu){if(!gu){gu=new gq.floatArray(2)}this.update();var gr=this.viewportRectangle;if(gr){gs-=gr[0];gv-=gr[1]}var gt=(this.height-this.scissorHeight-this.scissorY);gu[0]=(gs/this.viewScaleX)+this.scissorX;gu[1]=(gv/this.viewScaleY)+gt;return gu};gq.prototype.viewportClamp=function(gu){if(gu){var gt=gu[0];var gy=gu[1];var gs,gx,gw,gv;var gr=this.viewportRectangle;if(gr){gs=gr[0];gx=gr[1];gw=gr[2];gv=gr[3]}else{gs=0;gx=0;gw=this.graphicsDevice.width;gv=this.graphicsDevice.height}if(gt<gs){gt=gs}else{if(gt>gw){gt=gw}}if(gy<gx){gy=gx}else{if(gy>gv){gy=gv}}gu[0]=gt;gu[1]=gy}return gu};gq.prototype.configure=function(gt){if(this.state!==this.drawStates.ready){return false
}var gs=("viewportRectangle" in gt)?gt.viewportRectangle:this.viewportRectangle;var gr=gt.scaleMode;if(gr!==undefined){if(!(gr in this.scale)){return false}if(gr==="scale"&&!gs){return false}this.scaleMode=gr}this.viewportRectangle=gs;this.forceUpdate=true;this.update();return true};gq.prototype.destroy=function(){this.texLists=null;this.state=this.drawStates.uninit;this.graphicsDevice=null;if(this.vertexBuffer){this.vertexBuffer.destroy()}if(this.indexBuffer){this.indexBuffer.destroy()}this.copyVertexBuffer.destroy();var gs=this.renderTargetStructs;while(gs.length>0){var gr=gs.pop();gr.texture.destroy();gr.renderTarget.destroy();gr.texture=null;gr.renderTarget=null}};gq.prototype.begin=function(gs,gr){if(gr&&!(gr in this.sort)){return false}if(gs&&!(gs in this.blend)){return false}var gt=!this.sortMode;if(this.dispatch()){this.clearBatch()}if(gt){if(this.state!==this.drawStates.ready){return false}this.update();if(!this.currentRenderTarget){this.graphicsDevice.setScissor(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight)
}}this.state=this.drawStates.draw;gr=(gr)?gr:(gt?"deferred":this.sortMode);gs=(gs)?gs:(gt?"opaque":this.blendMode);if(!gt){this.sortModeStack.push(this.sortMode);this.blendModeStack.push(this.blendMode)}this.sortMode=gr;this.blendMode=gs;this.prepareSortMode(gr);this.graphicsDevice.setTechnique(this.blendModeTechniques[gs]);return true};gq.prototype._bufferSprite=function(gE,gF){var gr=gE.vertexBufferData;var gA=this.vertexBuffer;var gz=gE.numVertices*gA.stride;var gB=gz+(4*gA.stride);if(gB>=gr.length){var gH=this.bufferSizeAlgorithm(gB,this.cpuStride);var gG=new gq.floatArray(gH);var gy;for(gy=0;gy<gz;gy+=1){gG[gy]=gr[gy]}gE.vertexBufferData=gr=gG}var gx=gF[8];var gw=gF[9];var gv=gF[10];var gu=gF[11];var gt=gF[12];var gD=gF[13];var gs=gF[14];var gC=gF[15];gr[gz]=gF[0];gr[gz+1]=gF[1];gr[gz+2]=gx;gr[gz+3]=gw;gr[gz+4]=gv;gr[gz+5]=gu;gr[gz+6]=gt;gr[gz+7]=gD;gr[gz+8]=gF[2];gr[gz+9]=gF[3];gr[gz+10]=gx;gr[gz+11]=gw;gr[gz+12]=gv;gr[gz+13]=gu;gr[gz+14]=gs;gr[gz+15]=gD;gr[gz+16]=gF[4];gr[gz+17]=gF[5];
gr[gz+18]=gx;gr[gz+19]=gw;gr[gz+20]=gv;gr[gz+21]=gu;gr[gz+22]=gt;gr[gz+23]=gC;gr[gz+24]=gF[6];gr[gz+25]=gF[7];gr[gz+26]=gx;gr[gz+27]=gw;gr[gz+28]=gv;gr[gz+29]=gu;gr[gz+30]=gs;gr[gz+31]=gC;gE.numVertices+=4;gE.indices[gE.numSets-1]+=6};gq.prototype.bufferMultiSprite=function(gx,gE,gv,gu){var gJ=gx.vertexBufferData;var gK=this.vertexBuffer;var gt=(gv===undefined)?Math.floor(gE.length/16):gv;gv=gt*16;gu=(gu!==undefined?gu:0)*16;var gG;var gw=(gx.numVertices*gK.stride);var gL=gw+(gt*4*gK.stride);if(gL>=gJ.length){var gz=this.bufferSizeAlgorithm(gL,this.cpuStride);var gy=new gq.floatArray(gz);for(gG=0;gG<gw;gG+=1){gy[gG]=gJ[gG]}gx.vertexBufferData=gJ=gy}var gI=gu+gv;for(gG=gu;gG<gI;gG+=16){var gD=gE[gG+8];var gC=gE[gG+9];var gB=gE[gG+10];var gA=gE[gG+11];var gH=gE[gG+12];var gs=gE[gG+13];var gF=gE[gG+14];var gr=gE[gG+15];gJ[gw]=gE[gG];gJ[gw+1]=gE[gG+1];gJ[gw+2]=gD;gJ[gw+3]=gC;gJ[gw+4]=gB;gJ[gw+5]=gA;gJ[gw+6]=gH;gJ[gw+7]=gs;gJ[gw+8]=gE[gG+2];gJ[gw+9]=gE[gG+3];gJ[gw+10]=gD;gJ[gw+11]=gC;gJ[gw+12]=gB;
gJ[gw+13]=gA;gJ[gw+14]=gF;gJ[gw+15]=gs;gJ[gw+16]=gE[gG+4];gJ[gw+17]=gE[gG+5];gJ[gw+18]=gD;gJ[gw+19]=gC;gJ[gw+20]=gB;gJ[gw+21]=gA;gJ[gw+22]=gH;gJ[gw+23]=gr;gJ[gw+24]=gE[gG+6];gJ[gw+25]=gE[gG+7];gJ[gw+26]=gD;gJ[gw+27]=gC;gJ[gw+28]=gB;gJ[gw+29]=gA;gJ[gw+30]=gF;gJ[gw+31]=gr;gw+=32}gx.numVertices+=(gt*4);gx.indices[gx.numSets-1]+=(gt*6)};gq.prototype.indexData=function(gu){var gs=new gq.uint16Array(gu);var gt;var gr=0;for(gt=0;gt<gu;gt+=6){gs[gt]=gr;gs[gt+1]=gr+1;gs[gt+2]=gr+2;gs[gt+3]=gr+1;gs[gt+4]=gr+2;gs[gt+5]=gr+3;gr+=4}return gs};gq.prototype.uploadBuffer=function(gA,gx,gu){var gz=this.vertexBuffer;var gB=this.vertexBufferParameters;var gv=this.graphicsDevice;var gt=gA.vertexBufferData;var gr=this.performanceData;if(gx>gB.numVertices){var gw=this.bufferSizeAlgorithm(gx,this.gpuStride);if(gw>this.maxVertices){gw=this.maxVertices}gB.numVertices=gw;this.vertexBuffer.destroy();this.vertexBuffer=gz=gv.createVertexBuffer(gB);gr.gpuMemoryUsage=gw*35;gw*=1.5;var gy=this.indexBufferParameters;gy.data=this.indexData(gw);
gy.numIndices=gw;this.indexBuffer.destroy();this.indexBuffer=gv.createIndexBuffer(gy);gy.data=null;gv.setIndexBuffer(this.indexBuffer)}gr.dataTransfers+=1;if(gu===0){gz.setData(gt,0,gx)}else{var gs=gz.stride;gz.setData(gt.subarray(gu*gs,(gu+gx)*gs),0,gx)}};gq.prototype.drawRawImmediate=function(gt,gr,gs,gv){var gu=this.drawGroups[0];gu.textures[0]=gt||this.defaultTexture;gu.indices[0]=0;gu.numSets=1;this.numGroups=1;this.bufferMultiSprite(gu,gr,gs,gv);this.dispatch()};gq.prototype.drawSpriteImmediate=function(gr){var gs=this.drawGroups[0];gs.textures[0]=gr._texture||this.defaultTexture;gs.indices[0]=0;gs.numSets=1;this.numGroups=1;gr._update(this.spriteAngleFactor);this._bufferSprite(gs,gr.data);this.dispatch()};gq.prototype.drawImmediate=function(gy){var gt=gy.texture||this.defaultTexture;var gx=gy.destinationRectangle;var gw=gy.sourceRectangle;var gr=gy.color;var gs=gy.rotation;var gv=this.drawGroups[0];gv.textures[0]=gt;gv.indices[0]=0;gv.numSets=1;this.numGroups=1;var gu=this.drawSprite;
eV.setFromRotatedRectangle(gu,gt,gx,gw,gr,gs,gy.origin);this._bufferSprite(gv,gu);this.dispatch()};gq.prototype.drawRawDeferred=function(gu,gr,gt,gw){gu=gu||this.defaultTexture;var gv=this.drawGroups[0];this.numGroups=1;var gs=gv.numSets;if(gs===0||gv.textures[gs-1]!==gu){gv.textures[gs]=gu;gv.indices[gs]=0;gv.numSets+=1}this.bufferMultiSprite(gv,gr,gt,gw)};gq.prototype.drawSpriteDeferred=function(gr){var gt=gr._texture||this.defaultTexture;var gu=this.drawGroups[0];this.numGroups=1;var gs=gu.numSets;if(gs===0||gu.textures[gs-1]!==gt){gu.textures[gs]=gt;gu.indices[gs]=0;gu.numSets+=1}gr._update(this.spriteAngleFactor);this._bufferSprite(gu,gr.data)};gq.prototype.drawDeferred=function(gt){var gw=gt.texture||this.defaultTexture;var gx=this.drawGroups[0];this.numGroups=1;var gs=gx.numSets;if(gs===0||gx.textures[gs-1]!==gw){gx.textures[gs]=gw;gx.indices[gs]=0;gx.numSets+=1}var gr=gt.destinationRectangle;var gy=gt.sourceRectangle;var gu=gt.color;var gz=gt.rotation;var gv=this.drawSprite;eV.setFromRotatedRectangle(gv,gw,gr,gy,gu,gz,gt.origin);
this._bufferSprite(gx,gv)};gq.prototype.drawRawTextured=function(gu,gr,gt,gx){gu=gu||this.defaultTexture;var gv;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===gu){gv=this.currentTextureGroup}else{var gs=gu.name;var gw=this.texLists;gv=gw[gs];if(!gv){gv=this.drawGroups[this.numGroups];if(!gv){gv=ca.create()}this.drawGroups[this.numGroups]=gw[gs]=gv;gv.textures[0]=gu;gv.indices[0]=0;gv.numSets=1;this.numGroups+=1}this.currentTextureGroup=gv}this.bufferMultiSprite(gv,gr,gt,gx)};gq.prototype.drawSpriteTextured=function(gs){var gt=gs._texture||this.defaultTexture;var gu;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===gt){gu=this.currentTextureGroup}else{var gr=gt.name;var gv=this.texLists;gu=gv[gr];if(!gu){gu=this.drawGroups[this.numGroups];if(!gu){gu=ca.create()}this.drawGroups[this.numGroups]=gv[gr]=gu;gu.textures[0]=gt;gu.indices[0]=0;gu.numSets=1;this.numGroups+=1}this.currentTextureGroup=gu}gs._update(this.spriteAngleFactor);
this._bufferSprite(gu,gs.data)};gq.prototype.drawTextured=function(gt){var gx=gt.texture||this.defaultTexture;var gy;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===gx){gy=this.currentTextureGroup}else{var gr=gx.name;var gv=this.texLists;gy=gv[gr];if(!gy){gy=this.drawGroups[this.numGroups];if(!gy){gy=ca.create()}this.drawGroups[this.numGroups]=gv[gr]=gy;gy.textures[0]=gx;gy.indices[0]=0;gy.numSets=1;this.numGroups+=1}this.currentTextureGroup=gy}var gs=gt.destinationRectangle;var gA=gt.sourceRectangle;var gu=gt.color;var gz=gt.rotation;var gw=this.drawSprite;eV.setFromRotatedRectangle(gw,gx,gs,gA,gu,gz,gt.origin);this._bufferSprite(gy,gw)};gq.prototype.prepareSortMode=function(gr){if(gr==="deferred"){this.draw=this.drawDeferred;this.drawSprite=this.drawSpriteDeferred;this.drawRaw=this.drawRawDeferred}else{if(gr==="immediate"){this.draw=this.drawImmediate;this.drawSprite=this.drawSpriteImmediate;this.drawRaw=this.drawRawImmediate}else{this.draw=this.drawTextured;
this.drawSprite=this.drawSpriteTextured;this.drawRaw=this.drawRawTextured}}};gq.prototype.end=function(){if(this.state!==this.drawStates.draw){return false}if(this.dispatch()){this.clearBatch()}if(this.blendModeStack.length!==0){this.blendMode=this.blendModeStack.pop();this.sortMode=this.sortModeStack.pop();this.prepareSortMode(this.sortMode);this.graphicsDevice.setTechnique(this.blendModeTechniques[this.blendMode])}else{this.blendMode=undefined;this.sortMode=undefined;this.state=this.drawStates.ready}return true};gq.prototype.dispatch=function(){var gr=this.numGroups;if(gr===0){return false}var gx=this.graphicsDevice;var gI=this.techniqueParameters;gx.setIndexBuffer(this.indexBuffer);var gF=this.drawGroups;var gv=false;if(this.currentRenderTarget){gv=gx.beginRenderTarget(this.currentRenderTarget.renderTarget)}var gy=this.performanceData;var gE;for(gE=0;gE<gr;gE+=1){var gA=gF[gE];var gs=gA.textures;var gw=gA.indices;var gD=0;var gG=0;var gz=gA.numVertices;while(gG<gz){var gH=gz-gG;if(gH>this.maxVertices){gH=this.maxVertices
}this.uploadBuffer(gA,gH,gG);gx.setStream(this.vertexBuffer,this.semantics);var gC=gH*1.5;var gt=0;while(gt<gC){gI.texture=gs[gD];var gu=gC-gt;if(gu>=gw[gD]){gu=gw[gD];gD+=1}else{gw[gD]-=gu}var gB=gu/6;if(gy.batchCount===0){gy.minBatchSize=gB;gy.maxBatchSize=gB;gy.avgBatchSize=gB;gy.batchCount=1}else{if(gB<gy.minBatchSize){gy.minBatchSize=gB}if(gB>gy.maxBatchSize){gy.maxBatchSize=gB}gy.avgBatchSize*=gy.batchCount;gy.avgBatchSize+=gB;gy.batchCount+=1;gy.avgBatchSize/=gy.batchCount}gx.setTechniqueParameters(gI);gx.drawIndexed(gx.PRIMITIVE_TRIANGLES,gu,gt);gt+=gu}gG+=gH}gA.numSets=0;gA.numVertices=0}if(this.currentRenderTarget&&gv){gx.endRenderTarget()}return true};gq.prototype.bufferSizeAlgorithm=function(gv,gu){var gs=1.25;var gt=Math.ceil(Math.log(gv)/Math.log(gs));var gr=Math.floor(Math.pow(gs,gt));return(gu*Math.ceil(gr/gu))};gq.prototype.updateRenderTargetVbo=function(gu,gs,gA,gx){var gy=this.graphicsDevice;var gz=0.5*gy.width;var gw=0.5*gy.height;var gB=this.copyVertexBuffer;var gv=(gu-gz)/gz;
var gD=(gu+gA-gz)/gz;var gC=(gs-gw)/gw;var gr=(gs+gx-gw)/gw;var gt=this.vertexBufferData;gt[0]=gv;gt[1]=gr;gt[2]=0;gt[3]=1;gt[4]=gv;gt[5]=gC;gt[6]=0;gt[7]=0;gt[8]=gD;gt[9]=gr;gt[10]=1;gt[11]=1;gt[12]=gD;gt[13]=gC;gt[14]=1;gt[15]=0;gB.setData(gt,0,4)};gq.makePow2=function(gs){var gr=Math.log(gs)/Math.log(2);return(1<<Math.ceil(gr))};gq.prototype.createRenderTarget=function(gu){var gA=this.graphicsDevice;var gv=this.renderTargetStructs;var gx=gv.length;var gr=(gu&&gu.name)?gu.name:("RenderTarget#"+gx);var gD=(gu&&gu.backBuffer!==undefined)?gu.backBuffer:true;var gt=(gu.width===undefined||gu.height===undefined);var gz=this.renderTargetTextureParameters;gz.name=gr;var gs=(gt)?gA.width:gu.width;var gC=(gt)?gA.height:gu.height;var gB=gq.makePow2;gz.width=gB(gs);gz.height=gB(gC);var gy=gA.createTexture(gz);var gE=this.renderTargetParams;gE.colorTexture0=gy;var gw=gA.createRenderTarget(gE);gv.push({managed:gt,renderTarget:gw,texture:gy,backBuffer:gD,actualWidth:(gD?gs:gy.width),actualHeight:(gD?gC:gy.height)});
return gx};gq.prototype.validateTarget=function(gw,gu,gr){if(gw.managed){var gs=gw.texture;if(gw.backBuffer){gw.actualWidth=gu;gw.actualHeight=gr}var gv=gq.makePow2;gu=gv(gu);gr=gv(gr);if(!gw.backBuffer){gw.actualWidth=gu;gw.actualHeight=gr}if(gs.width!==gu||gs.height!==gr){var gy=this.renderTargetTextureParameters;var gx=this.renderTargetParams;gy.name=gs.name;gy.width=gu;gy.height=gr;gs.destroy();gw.renderTarget.destroy();var gt=this.graphicsDevice;gw.texture=gt.createTexture(gy);gx.colorTexture0=gw.texture;gw.renderTarget=gt.createRenderTarget(gx)}}};gq.prototype.setBackBuffer=function(){if(this.state!==this.drawStates.ready){return false}this.currentRenderTarget=null;this.forceUpdate=true;return true};gq.prototype.getRenderTargetTexture=function(gr){var gs=this.renderTargetStructs;if(gr<0||gr>=gs.length){return null}return gs[gr].texture};gq.prototype.getRenderTarget=function(gr){var gs=this.renderTargetStructs;if(gr<0||gr>=gs.length){return null}return gs[gr].renderTarget};gq.prototype.setRenderTarget=function(gr){var gs=this.renderTargetStructs;
if(gr<0||gr>=gs.length){return false}if(this.state!==this.drawStates.ready){return false}this.currentRenderTarget=gs[gr];this.forceUpdate=true;return true};gq.prototype.copyRenderTarget=function(gu){if(this.state!==this.drawStates.ready){return false}var gy=this.renderTargetStructs;if(gu<0||gu>=gy.length){return false}this.update();if(!this.currentRenderTarget){this.graphicsDevice.setScissor(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight)}var gx=this.graphicsDevice;var gz=gy[gu];var gB=gz.texture;var gs=this.copyTechnique;var gw=this.copyTechniqueParameters;var gr=gw.copyUVScale;gr[0]=gz.actualWidth/gB.width;gr[1]=gz.actualHeight/gB.height;gw.copyFlip=(!this.currentRenderTarget?-1:1);gw.inputTexture0=gB;var gv=false;var gt=this.currentRenderTarget;var gA=this.copyVertexBuffer;if(gt){gv=gx.beginRenderTarget(gt.renderTarget)}gx.setTechnique(gs);gx.setTechniqueParameters(gw);gx.setStream(gA,this.quadSemantics);gx.draw(this.quadPrimitive,4,0);if(gt&&gv){gx.endRenderTarget()
}return true};gq.prototype.resetPerformanceData=function(){var gr=this.performanceData;gr.minBatchSize=gr.maxBatchSize=gr.avgBatchSize=undefined;gr.batchCount=0;gr.dataTransfers=0};gq.create=function(gx){var gw=new gq();var gv=gw.graphicsDevice=gx.graphicsDevice;gw.sortMode=undefined;gw.blendMode=undefined;gw.sortModeStack=[];gw.blendModeStack=[];gw.drawGroups=[ca.create()];gw.numGroups=0;gw.texLists={};gw.texGroup=undefined;gw.drawSprite=eV.create();gw.defaultTexture=gv.createTexture({name:"DefaultDraw2DTexture",width:1,height:1,depth:1,format:"L8",cubemap:false,mipmaps:true,renderable:false,dynamic:false,data:[255]});gw.draw=undefined;gw.drawSprite=undefined;gw.drawRaw=undefined;var gu=gv.createShader({version:1,name:"draw2D.cgfx",samplers:{texture:{MinFilter:9985,MagFilter:9729,WrapS:33071,WrapT:33071},inputTexture0:{MinFilter:9728,MagFilter:9729,WrapS:33071,WrapT:33071}},parameters:{clipSpace:{type:"float",columns:4},copyUVScale:{type:"float",columns:2},copyFlip:{type:"float"},texture:{type:"sampler2D"},inputTexture0:{type:"sampler2D"}},techniques:{opaque:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:false},programs:["vp_draw2D","fp_draw2D"]}],alpha:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:true,BlendFunc:[770,771]},programs:["vp_draw2D","fp_draw2D"]}],additive:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:true,BlendFunc:[770,1]},programs:["vp_draw2D","fp_draw2D"]}],copy:[{parameters:["copyUVScale","copyFlip","inputTexture0"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:false},programs:["vp_copy","fp_copy"]}]},programs:{fp_copy:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nvec4 _ret_0;uniform sampler2D inputTexture0;void main()\n{_ret_0=texture2D(inputTexture0,tz_TexCoord[0].xy);gl_FragColor=_ret_0;}"},vp_copy:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR8;\nvec4 _OutPosition1;vec2 _OutUV1;uniform vec2 copyUVScale;uniform float copyFlip;void main()\n{_OutPosition1.x=ATTR0.x;_OutPosition1.y=ATTR0.y*copyFlip;_OutPosition1.zw=ATTR0.zw;_OutUV1=ATTR8.xy*copyUVScale;tz_TexCoord[0].xy=_OutUV1;gl_Position=_OutPosition1;}"},fp_draw2D:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;varying vec4 tz_TexCoord[1];\nvec4 _ret_0;vec4 _TMP0;uniform sampler2D texture;void main()\n{_TMP0=texture2D(texture,tz_TexCoord[0].xy);_ret_0=tz_Color*_TMP0;gl_FragColor=_ret_0;}"},vp_draw2D:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;varying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR3;attribute vec4 ATTR8;\nvec4 _OUTPosition1;vec4 _OUTColor1;vec2 _OUTTexCoord01;uniform vec4 clipSpace;void main()\n{vec2 _position;_position=ATTR0.xy*clipSpace.xy+clipSpace.zw;_OUTPosition1.x=_position.x;_OUTPosition1.y=_position.y;_OUTPosition1.z=0.0;_OUTPosition1.w=1.0;_OUTColor1=ATTR3;_OUTTexCoord01=ATTR8.xy;tz_TexCoord[0].xy=ATTR8.xy;tz_Color=ATTR3;gl_Position=_OUTPosition1;}"}}});
gw.blendModeTechniques={additive:gu.getTechnique("additive"),alpha:gu.getTechnique("alpha"),opaque:gu.getTechnique("opaque")};if(gx.blendModes){for(var gt in gx.blendModes){if(gx.blendModes.hasOwnProperty(gt)){gw.blend[gt]=gt;gw.blendModeTechniques[gt]=gx.blendModes[gt]}}}gw.techniqueParameters=gv.createTechniqueParameters({clipSpace:new gq.floatArray(4),texture:null});gw.currentRenderTarget=null;gw.renderTargetStructs=[];gw.state=gw.drawStates.ready;gw.scaleMode="none";gw.blendMode="opaque";gw.width=0;gw.height=0;gw.scissorX=0;gw.scissorY=0;gw.scissorWidth=gw.graphicsDevice.width;gw.scissorHeight=gw.graphicsDevice.height;gw.clipOffsetX=-1;gw.clipOffsetY=1;gw.clipScaleX=2/gw.graphicsDevice.width;gw.clipScaleY=-2/gw.graphicsDevice.height;gw.viewScaleX=1;gw.viewScaleY=1;var gs=(gx.initialGpuMemory?gx.initialGpuMemory:0);if(gs<140){gs=140}if(gs>2293760){gs=2293760}gw.performanceData={gpuMemoryUsage:gs,minBatchSize:0,maxBatchSize:0,avgBatchSize:0,batchCount:0,dataTransfers:0};gw.maxGpuMemory=(gx.maxGpuMemory?gx.maxGpuMemory:2293760);
if(gw.maxGpuMemory<gs){gw.maxGpuMemory=gs}var gr=Math.floor(gs/140)*4;gw.maxVertices=Math.floor(gw.maxGpuMemory/140)*4;if(gw.maxVertices>65536){gw.maxVertices=65536}gw.cpuStride=64;gw.gpuStride=4;gw.vertexBufferParameters={numVertices:gr,attributes:[gv.VERTEXFORMAT_FLOAT2,gv.VERTEXFORMAT_FLOAT4,gv.VERTEXFORMAT_FLOAT2],"transient":true};gw.vertexBuffer=gv.createVertexBuffer(gw.vertexBufferParameters);gw.semantics=gv.createSemantics([gv.SEMANTIC_POSITION,gv.SEMANTIC_COLOR,gv.SEMANTIC_TEXCOORD0]);gw.indexBufferParameters={numIndices:(gr*1.5),format:gv.INDEXFORMAT_USHORT,dynamic:false,data:gw.indexData((gr*1.5))};gw.indexBuffer=gv.createIndexBuffer(gw.indexBufferParameters);gw.indexBufferParameters.data=null;gw.renderTargetIndex=0;gw.renderTargetCount=0;gw.renderTargetTextureParameters={name:"",width:0,height:0,depth:1,format:"R8G8B8A8",cubemap:false,mipmaps:true,renderable:true,dynamic:true};gw.renderTargetParams={colorTexture0:null};gw.copyTechnique=gu.getTechnique("copy");gw.copyTechniqueParameters=gv.createTechniqueParameters({inputTexture0:null,copyFlip:1,copyUVScale:new gq.floatArray([1,1])});
gw.quadSemantics=gv.createSemantics([gv.SEMANTIC_POSITION,gv.SEMANTIC_TEXCOORD0]);gw.quadPrimitive=gv.PRIMITIVE_TRIANGLE_STRIP;gw.copyVertexBufferParams={numVertices:4,attributes:[gv.VERTEXFORMAT_FLOAT2,gv.VERTEXFORMAT_FLOAT2],"transient":true};gw.copyVertexBuffer=gv.createVertexBuffer(gw.copyVertexBufferParams);gw.vertexBufferData=new gq.floatArray([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);return gw};gq.version=7;gq.defaultClearColor=[0,0,0,1];return gq})();((function(){d9.uint16Array=function(gs){if(arguments.length===0){return[]}var gu,gt;if(typeof gs==="number"){gt=new Array(gs)}else{gt=[];for(gu=0;gu<gs.length;gu+=1){gt[gu]=gs[gu]}}return gt};var gq;var gr;if(typeof Uint16Array!=="undefined"){gq=new Uint16Array(4);gr=Object.prototype.toString.call(gq);if(gr==="[object Uint16Array]"){d9.uint16Array=Uint16Array}}d9.floatArray=function(gs){if(arguments.length===0){return[]}var gu,gt;if(typeof gs==="number"){gt=new Array(gs)}else{gt=[];for(gu=0;gu<gs.length;gu+=1){gt[gu]=gs[gu]}}return gt
};if(typeof Float32Array!=="undefined"){gq=new Float32Array(4);gr=Object.prototype.toString.call(gq);if(gr==="[object Float32Array]"){d9.floatArray=Float32Array;d9.defaultClearColor=new Float32Array(d9.defaultClearColor)}}})());var k=(function(){function gq(){}gq.prototype.setPhysics2DViewport=function(gr){if(gr){var gs=this._physics2DPort;gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];this._physics2DPortEnabled=true}else{this._physics2DPortEnabled=false}this._invalidated=true};gq.prototype.setScreenViewport=function(gr){if(gr){var gs=this._screenPort;gs[0]=gr[0];gs[1]=gr[1];gs[2]=gr[2];gs[3]=gr[3];this._screenPortEnabled=true}else{this._screenPortEnabled=false}this._invalidated=true};gq.prototype.drawLine=function(gs,gz,gr,gx,gt){var gv=this._numVertices;var gw=(gv*6);var gy=(this._numLines*2);this._prepare(2,1);var gu=this._vertexData;gu[gw]=gs;gu[gw+1]=gz;gu[gw+6]=gr;gu[gw+7]=gx;gu[gw+2]=gu[gw+8]=gt[0];gu[gw+3]=gu[gw+9]=gt[1];gu[gw+4]=gu[gw+10]=gt[2];gu[gw+5]=gu[gw+11]=gt[3];gu=this._indexData;
gu[gy]=gv;gu[gy+1]=(gv+1)};gq.prototype.drawLinearSpring=function(gs,gD,gr,gC,gB,gz,gu){if(gB<=0){this.drawLine(gs,gD,gr,gC,gu);return}var gG=(gr-gs);var gF=(gC-gD);var gA=((gG*gG)+(gF*gF));var gv=(this.minSpringLength*this.screenToPhysics2D);if(gA<(gv*gv)){this.drawLine(gs,gD,gr,gC,gu);return}var gy=-gF;var gx=gG;var gE=((2*gz)/Math.sqrt((gy*gy)+(gx*gx)));gy*=gE;gx*=gE;var gt=(1/(gB*4));gG*=gt;gF*=gt;var gw;for(gw=0;gw<gB;gw+=1){gr=(gs+(gG*2));gC=(gD+(gF*2));this.drawCurve(gs,gD,(gs+gG+gy),(gD+gF+gx),gr,gC,gu);gs=gr;gD=gC;gr=(gs+(gG*2));gC=(gD+(gF*2));this.drawCurve(gs,gD,(gs+gG-gy),(gD+gF-gx),gr,gC,gu);gs=gr;gD=gC}};gq.prototype._drawAngleIndicator=function(gs,gy,gv,gr,gw,gu){var gx=Math.cos(gv);var gt=Math.sin(gv);this._drawAnchor(gs+(gr*gx),gy+(gr*gt),gw,gu)};gq.prototype._drawAnchor=function(gs,gu,gr,gt){this.drawCircle(gs,gu,gr,gt);this.drawCircle(gs,gu,gr*0.75,gt);this.drawCircle(gs,gu,gr*0.5,gt);this.drawCircle(gs,gu,gr*0.25,gt)};gq.prototype.drawSpiral=function(gF,gE,gA,gy,gL,gK,gM){if(gA>gy){var gU=gA;
gA=gy;gy=gU;gU=gL;gL=gK;gK=gU}if(gA===gy){return}var gC=(gK-gL);var gT=(gy-gA);var gD=Math.ceil(gT/this.spiralMaxArc);var gH=(gC/gD);var gQ=(gT/gD);var gr=Math.cos(gQ);var gx=Math.sin(gQ);var gS=Math.cos(gA);var gR=Math.sin(gA);var gu=gL;var gP=(gF+(gL*gS));var gt=(gE+(gL*gR));var gw=(gC*gS)-(gu*gT*gR);var gv=(gC*gR)+(gu*gT*gS);var gN;for(gN=0;gN<gD;gN+=1){var gz=(gu+gH);var gW=(gr*gS)-(gx*gR);var gV=(gx*gS)+(gr*gR);var gO=(gF+(gz*gW));var gs=(gE+(gz*gV));var gJ=(gC*gW)-(gz*gT*gV);var gI=(gC*gV)+(gz*gT*gW);var gB=((gw*gI)-(gv*gJ));if((gB*gB)<this.spiralEpsilon){this.drawLine(gP,gt,gO,gs,gM)}else{var gG=(((gO-gP)*gI)+((gt-gs)*gJ))/gB;if(gG<=0){this.drawLine(gP,gt,gO,gs,gM)}else{this.drawCurve(gP,gt,(gP+(gw*gG)),(gt+(gv*gG)),gO,gs,gM)}}gu=gz;gS=gW;gR=gV;gw=gJ;gv=gI;gP=gO;gt=gs}};gq.prototype.drawSpiralSpring=function(gP,gO,gZ,gY,gC,gB,gT,gH){if(gZ>gY){var gV=gZ;gZ=gY;gY=gV;gV=gC;gC=gB;gB=gV}if(gZ===gY){return}var gw=(gB-gC);var gN=(gY-gZ);var gF=Math.max(Math.ceil(gN/(this.spiralMaxArc*3)),(40*gT));
var gs=(gN/gF);var gE=(1/gF);var gW=Math.cos(gs);var gG=Math.sin(gs);var gM=this.spiralSpringSize;var gD=Math.abs(2*Math.PI*gw/gN);var gr=(gM*gD);var g3=(2*gT*Math.PI);var gt=(gr*g3);var gL=Math.cos(gZ);var gK=Math.sin(gZ);var gU=gC;var gz=(gP+(gU*gL));var g2=(gO+(gU*gK));var gA=(gw+gt);var gJ=(gA*gL)-(gU*gN*gK);var gI=(gA*gK)+(gU*gN*gL);var gX;for(gX=0;gX<gF;gX+=1){var gS=((gX+1)*gE);var gR=(gW*gL)-(gG*gK);var gQ=(gG*gL)+(gW*gK);gU=((gC+(gw*gS))+(gr*Math.sin(g3*gS)));var gy=(gP+(gU*gR));var g1=(gO+(gU*gQ));gA=(gw+(gt*Math.cos(g3*gS)));var gv=(gA*gR)-(gU*gN*gQ);var gu=(gA*gQ)+(gU*gN*gR);var gx=((gJ*gu)-(gI*gv));var g0=((gJ*gv)+(gI*gu));if((gx*gx)<this.spiralEpsilon||g0<0||g0>(1-this.spiralEpsilon)){this.drawLine(gz,g2,gy,g1,gH)}else{gS=(((gy-gz)*gu)+((g2-g1)*gv))/gx;if(gS<=0){this.drawLine(gz,g2,gy,g1,gH)}else{this.drawCurve(gz,g2,(gz+(gJ*gS)),(g2+(gI*gS)),gy,g1,gH)}}gL=gR;gK=gQ;gJ=gv;gI=gu;gz=gy;g2=g1}};gq.prototype.drawCurve=function(gQ,gu,gv,gt,gO,gs,gG){var gF=gG[0];var gP=gG[1];var gV=gG[2];
var gX=gG[3];var gA=this._curveStack;var gY=this._curveVerts;gA.push(gQ,gu,gv,gt,gO,gs);while(gA.length>0){gs=gA.pop();gO=gA.pop();gt=gA.pop();gv=gA.pop();gu=gA.pop();gQ=gA.pop();var gW=0.25*(gQ+(2*gv)+gO);var gU=0.25*(gu+(2*gt)+gs);var gy=0.5*(gQ+gO);var gx=0.5*(gu+gs);var gE=(gW-gy);var gD=(gU-gx);var gz=(this.curveMaxError*this.screenToPhysics2D);if(((gE*gE)+(gD*gD))<(gz*gz)){gY.push(gQ,gu)}else{var gC=0.5*(gQ+gv);var gB=0.5*(gu+gt);var gM=0.5*(gO+gv);var gJ=0.5*(gs+gt);var gT=0.5*(gC+gM);var gS=0.5*(gB+gJ);gA.push(gT,gS,gM,gJ,gO,gs);gA.push(gQ,gu,gC,gB,gT,gS)}}gY.push(gO,gs);var gr=(gY.length>>1);var gI=this._numVertices;var gR=(gI*6);var gw=(this._numLines*2);this._prepare(gr,(gr-1));var gN=this._vertexData;var gL=this._indexData;var gK,gH=0;for(gK=0;gK<gr;gK+=1){gN[gR]=gY[gH];gN[gR+1]=gY[gH+1];gN[gR+2]=gF;gN[gR+3]=gP;gN[gR+4]=gV;gN[gR+5]=gX;gH+=2;gR+=6;if(gK>0){gL[gw]=(gI+gK-1);gL[gw+1]=(gI+gK);gw+=2}}gY.length=0};gq.prototype.drawRectangle=function(gs,gA,gr,gy,gv){var gw=this._numVertices;
var gx=(gw*6);var gz=(this._numLines*2);this._prepare(4,4);var gt=this._vertexData;var gu=this._indexData;gt[gx]=gt[gx+18]=gs;gt[gx+1]=gt[gx+7]=gA;gt[gx+6]=gt[gx+12]=gr;gt[gx+13]=gt[gx+19]=gy;gt[gx+2]=gt[gx+8]=gt[gx+14]=gt[gx+20]=gv[0];gt[gx+3]=gt[gx+9]=gt[gx+15]=gt[gx+21]=gv[1];gt[gx+4]=gt[gx+10]=gt[gx+16]=gt[gx+22]=gv[2];gt[gx+5]=gt[gx+11]=gt[gx+17]=gt[gx+23]=gv[3];gu[gz]=gu[gz+7]=gw;gu[gz+1]=gu[gz+2]=(gw+1);gu[gz+3]=gu[gz+4]=(gw+2);gu[gz+5]=gu[gz+6]=(gw+3)};gq.prototype.drawCircle=function(gx,gw,gv,gB){var gA=gB[0];var gH=gB[1];var gL=gB[2];var gM=gB[3];var gK=this.circleMaxError;var gN=(gv*this.physics2DToScreen);var gs;if(gN<gK/2){gs=3}else{gs=Math.ceil(Math.PI/Math.acos(1-gK/gN));if(gs<3){gs=3}}var gC=this._numVertices;var gI=(gC*6);var gu=(this._numLines*2);this._prepare(gs,gs);var gz=gv;var gy=0;var gF=(Math.PI*2/gs);var gt=Math.cos(gF);var gr=Math.sin(gF);var gG=this._vertexData;var gE=this._indexData;var gD;for(gD=0;gD<gs;gD+=1){var gJ=(gz*gt)-(gy*gr);gy=(gz*gr)+(gy*gt);gz=gJ;
gG[gI]=gx+gz;gG[gI+1]=gw+gy;gG[gI+2]=gA;gG[gI+3]=gH;gG[gI+4]=gL;gG[gI+5]=gM;gI+=6;gE[gu]=(gC+gD);gE[gu+1]=(gC+((gD+1)%gs));gu+=2}};gq.prototype.drawRigidBody=function(gr){gr._update();var gt=gr.shapes;var gs=gt.length;var gu;for(gu=0;gu<gs;gu+=1){this._drawShape(gt[gu])}if(this.showBodyDetail){var gv=gr._data;this.drawCircle(gv[(2)],gv[(2)+1],this.screenToPhysics2D*this.bodyPositionRadius,this.bodyDetailColor);this.drawLine(gv[(15)],gv[(15)+1],gv[(2)],gv[(2)+1],this.bodyDetailColor)}};gq.prototype.drawConstraint=function(gr){if(gr._draw){gr._draw(this,gr._stiff)}};gq.prototype.drawWorld=function(gw){var gv,gt;if(this.showRigidBodies){var gu=gw.rigidBodies;gt=gu.length;for(gv=0;gv<gt;gv+=1){var gr=gu[gv];this.drawRigidBody(gr)}}if(this.showContacts){this._drawArbiters(gw.dynamicArbiters);this._drawArbiters(gw.staticArbiters)}if(this.showConstraints){var gx=gw.constraints;gt=gx.length;for(gv=0;gv<gt;gv+=1){var gs=gx[gv];if(gs._active){this.drawConstraint(gs)}}}};gq.prototype._drawArbiters=function(gE){var gI=(this.screenToPhysics2D*this.contactRadius);
var gC=(this.screenToPhysics2D*this.contactImpulseScale);var gF=gE.length;var gz;for(gz=0;gz<gF;gz+=1){var gt=gE[gz];if(!gt.active){continue}var gx=(gt._static?this.staticContactColor:this.dynamicContactColor);var gH,gG;if(gt.sensor){gH=0;gG=0}else{var gD=gt._data;gH=gD[(4)];gG=gD[(4)+1]}var gw=gt._contact1._data;var gB=gw[(0)];var gs=gw[(0)+1];this.drawCircle(gB,gs,gI,gx);var gy,gu;if(this.showContactImpulses&&!gt._contact1.virtual){gy=(gw[(11)])*gC;gu=(gw[(12)])*gC;this.drawLine(gB,gs,gB+(gH*gy),gs+(gG*gy),this.normalImpulseColor);this.drawLine(gB,gs,gB-(gG*gu),gs+(gH*gu),this.frictionImpulseColor)}if(gt._position2Contact){var gv=gt._contact2._data;var gA=gv[(0)];var gr=gv[(0)+1];if(this.showContactImpulses&&!gt._contact2.virtual){gy=(gv[(11)])*gC;gu=(gv[(12)])*gC;this.drawLine(gA,gr,gA+(gH*gy),gr+(gG*gy),this.normalImpulseColor);this.drawLine(gA,gr,gA-(gG*gu),gr+(gH*gu),this.frictionImpulseColor)}gH*=gI;gG*=gI;this.drawCircle(gA,gr,gI,gx);this.drawLine(gB+gH,gs+gG,gA+gH,gr+gG,gx);this.drawLine(gB-gH,gs-gG,gA-gH,gr-gG,gx)
}}};gq.prototype._drawShape=function(gt){var gr=gt.body;if((gt.sensor&&!this.showSensorsShapes)||(!gt.sensor&&!this.showColliderShapes)){return}var gs=this._colors[gt.body._type|(gr.sleeping?4:0)|(gt.sensor?8:0)|(gr._bullet?16:0)];if(gt._type===(0)){this._drawCircleShape(gt,gs)}else{this._drawPolygonShape(gt,gs)}if(this.showShapeDetail){var gu=gt._data;this.drawRectangle(gu[(0)],gu[(0)+1],gu[(0)+2],gu[(0)+3],this.shapeDetailColor)}};gq.prototype._drawCircleShape=function(gr,gt){var gw=gr.body._data;var gv=gr._data;var gu=gv[(9)];var gs=gv[(9)+1];var gy=gv[(6)];this.drawCircle(gu,gs,gy,gt);if(gr.body._type!==(2)){var gz=gw[(5)];var gx=gw[(5)+1];this.drawLine(gu+(gy*0.333*gz),gs+(gy*0.333*gx),gu+(gy*gz),gs+(gy*gx),gt)}if(this.showShapeDetail){this.drawCircle(gv[(9)],gv[(9)+1],this.screenToPhysics2D*this.circleOriginRadius,this.shapeDetailColor)}};gq.prototype._drawPolygonShape=function(gE,gv){var gr=gv[0];var gy=gv[1];var gC=gv[2];var gF=gv[3];var gz=this._numVertices;var gB=(gz*6);var gD=(this._numLines*2);
var gA=gE._data;var gG=(6);var gu=gA.length;var gx=((gu-gG)/(13));this._prepare(gx,gx);var gs=this._vertexData;var gt=this._indexData;var gw;for(gw=0;gG<gu;gG+=(13),gw+=1){gs[gB]=gA[gG+(2)];gs[gB+1]=gA[gG+(2)+1];gs[gB+2]=gr;gs[gB+3]=gy;gs[gB+4]=gC;gs[gB+5]=gF;gB+=6;gt[gD]=(gz+gw);gt[gD+1]=(gz+((gw+1)%gx));gD+=2}};gq.prototype.begin=function(){var gD=this._graphicsDevice;var gt=gD.width;var gE=gD.height;var gx,gu,gz,gF;var gv;if(this._screenPortEnabled){gv=this._screenPort;gx=gv[0];gu=gv[1];gz=gv[2]-gx;gF=gv[3]-gu}else{gx=0;gu=0;gz=gt;gF=gE}if(gt!==this._width||gE!==this._height||this._invalidated){this._width=gt;this._height=gE;this._invalidated=false;var gB,gA,gC,gy;if(this._physics2DPortEnabled){gv=this._physics2DPort;gB=gv[0];gA=gv[1];gC=gv[2]-gB;gy=gv[3]-gA}else{gB=0;gA=0;gC=gt/60;gy=gE/60}var gw=this._techniqueParams.clipSpace;gw[0]=(2*gz)/(gt*gC);gw[1]=-(2*gF)/(gE*gy);gw[2]=-(2*gB*gz)/(gt*gC)+(2*gx/gt)-1;gw[3]=(2*gA*gF)/(gE*gy)-(2*gu/gE)+1;var gs=(gw[0]*0.5*gt);var gr=-(gw[1]*0.5*gE);
this.physics2DToScreen=0.5*(gs+gr);this.screenToPhysics2D=1/this.physics2DToScreen}gD.setScissor(gx,gE-gu-gF,gz,gF);gD.setTechnique(this._technique);gD.setTechniqueParameters(this._techniqueParams)};gq.prototype.end=function(){this._dispatch()};gq.prototype._prepare=function(gr,gt){var gv,gw,gu;var gs=(this._numVertices*6);var gx=gs+(gr*6);var gy=this._vertexData;if(gx>gy.length){gv=this._bufferSizeAlgorithm(gx);gw=this._vertexData=new bZ.prototype.floatArray(gv);for(gu=0;gu<gs;gu+=1){gw[gu]=gy[gu]}}this._numVertices+=gr;gs=(this._numLines*2);gx=gs+(gt*2);gy=this._indexData;if(gx>gy.length){gv=this._bufferSizeAlgorithm(gx);gw=this._indexData=new bZ.prototype.uint16Array(gv);for(gu=0;gu<gs;gu+=1){gw[gu]=gy[gu]}}this._numLines+=gt};gq.prototype._bufferSizeAlgorithm=function(gu){var gs=1.25;var gt=Math.ceil(Math.log(gu)/Math.log(gs));var gr=Math.floor(Math.pow(gs,gt));return(6*Math.ceil(gr/6))};gq.prototype._dispatch=function(){var gt=this._graphicsDevice;var gx=this._vertexBuffer;var gz=this._vertexBufferParameters;
var gr=this._vertexData;var gu=this._indexBuffer;var gy=this._indexBufferParameters;var gs=this._indexData;var gw=this._numVertices;if(gw===0){return}var gv;if(gw>gz.numVertices){gv=this._bufferSizeAlgorithm(gw);gz.numVertices=gv;this._vertexBuffer.destroy();this._vertexBuffer=gx=gt.createVertexBuffer(gz)}gx.setData(gr,0,gw);gw=(this._numLines*2);if(gw>gy.numIndices){gv=this._bufferSizeAlgorithm(gw);gy.numIndices=gv;this._indexBuffer.destroy();this._indexBuffer=gu=gt.createIndexBuffer(gy)}gu.setData(gs,0,gw);gt.setStream(gx,this._semantics);gt.setIndexBuffer(gu);gt.drawIndexed(gt.PRIMITIVE_LINES,gw);this._numVertices=0;this._numLines=0};gq.prototype.destroy=function(){this._graphicsDevice=null;this._curveStack.length=0;this._curveVerts.length=0;this._colors.length=0;this._vertexBuffer.destroy();this._indexBuffer.destroy()};gq.create=function(gJ){var gA=new gq();var gK=gA._graphicsDevice=gJ.graphicsDevice;gA._screenPort=new bZ.prototype.floatArray(4);gA._screenPortEnabled=false;gA._physics2DPort=new bZ.prototype.floatArray(4);
gA._physics2DPortEnabled=false;gA._invalidated=true;gA.physics2DToScreen=0;gA.screenToPhysics2D=0;gA.circleMaxError=0.4;gA.curveMaxError=0.6;gA.spiralMaxArc=Math.PI/4;gA.spiralEpsilon=0.00001;gA.spiralSpringSize=0.75;gA._curveStack=[];gA._curveVerts=[];gA.minSpringLength=0.5;var gw=function gz(gP,gO,gL,gM){var gN=new bZ.prototype.floatArray(4);gN[0]=gP;gN[1]=gO;gN[2]=gL;gN[3]=gM;return gN};var gv=gw(1,1,1,1);var gI=gw(1,0.5,0.5,1);var gD=gw(0.9,0.7,0.7,0.6);var gB=gw(0.8,0.3,0.8,1);var gC=gw(0.8,0.4,0.8,0.6);var gt=gw(0.5,1,0.5,1);var gu=gw(0.7,0.9,0.7,0.6);var gH=gw(0.5,1,0.5,0.5);var gG=gw(0.7,0.9,0.7,0.4);var gs=gw(0.8,0.4,0.8,0.5);var gE=gw(0.8,0.5,0.8,0.4);gA.showConstraints=true;gA.constraintAnchorRadius=3;gA.constraintSpringRadius=3;gA.constraintSpringNumCoils=3;gA.constraintSpiralMinRadius=10;gA.constraintSpiralDeltaRadius=(2.5/Math.PI);gA.constraintSpiralNumCoils=4;gA.constraintColorA=gw(1,0,0,0.8);gA.constraintSleepingColorA=gw(0.7,0.2,0.2,0.6);gA.constraintColorB=gw(0,0,1,0.8);
gA.constraintSleepingColorB=gw(0.2,0.2,0.7,0.6);gA.constraintColorC=gw(0,1,0,0.8);gA.constraintSleepingColorC=gw(0.2,0.7,0.2,0.6);gA.constraintColorD=gw(1,0,1,0.8);gA.constraintSleepingColorD=gw(0.7,0.2,0.7,0.6);gA.constraintErrorColorA=gw(1,1,0.5,0.8);gA.constraintErrorSleepingColorA=gw(0.7,0.7,0.5,0.6);gA.constraintErrorColorB=gw(0.5,1,1,0.8);gA.constraintErrorSleepingColorB=gw(0.5,0.7,0.7,0.6);gA.constraintErrorColorC=gw(0.4,1,0.4,0.8);gA.constraintErrorSleepingColorC=gw(0.4,0.7,0.4,0.6);gA.constraintErrorColorD=gw(1,0.4,1,0.8);gA.constraintErrorSleepingColorD=gw(0.7,0.4,0.7,0.6);gA.showContacts=false;gA.showContactImpulses=false;gA.contactRadius=3;gA.contactImpulseScale=30;gA.dynamicContactColor=gw(1,0,0.5,0.7);gA.staticContactColor=gw(0.5,0,1,0.7);gA.normalImpulseColor=gw(1,0,0,1);gA.frictionImpulseColor=gw(0,0,1,1);gA.showRigidBodies=true;gA.showColliderShapes=true;gA.showSensorsShapes=true;gA.showBodyDetail=false;gA.showShapeDetail=false;gA.bodyPositionRadius=0.5;gA.circleOriginRadius=0.5;
gA.bodyDetailColor=gw(0,1,1,0.5);gA.shapeDetailColor=gw(1,1,0,0.5);var gx=gA._colors=[];gx[(2)+4]=gI;gx[(2)+12]=gD;gx[(0)]=gt;gx[(0)+8]=gu;gx[(0)+4]=gH;gx[(0)+12]=gG;gx[(0)+16]=gv;gx[(1)]=gB;gx[(1)+8]=gC;gx[(1)+4]=gs;gx[(1)+12]=gE;var gr=gK.createShader({version:1,name:"lines.cgfx",parameters:{clipSpace:{type:"float",columns:4}},techniques:{alpha:[{parameters:["clipSpace"],semantics:["POSITION","COLOR"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:true,BlendFunc:[770,771]},programs:["vp_draw2dlines","fp_draw2dlines"]}]},programs:{fp_draw2dlines:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;\nvoid main()\n{gl_FragColor=tz_Color;}"},vp_draw2dlines:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;attribute vec4 ATTR3;attribute vec4 ATTR0;\nvec4 _outpos1;vec4 _outcol1;uniform vec4 clipSpace;void main()\n{vec2 _TMP1;_TMP1=ATTR0.xy*clipSpace.xy+clipSpace.zw;_outpos1=vec4(_TMP1.x,_TMP1.y,0.0,1.0);_outcol1=ATTR3;tz_Color=ATTR3;gl_Position=_outpos1;}"}}});
gA._techniqueParams=gK.createTechniqueParameters({clipSpace:new bZ.prototype.floatArray(4)});gA._technique=gr.getTechnique("alpha");var gy=4;var gF=4;gA._vertexBufferParameters={numVertices:gy,attributes:[gK.VERTEXFORMAT_FLOAT2,gK.VERTEXFORMAT_FLOAT4],"transient":true};gA._vertexBuffer=gK.createVertexBuffer(gA._vertexBufferParameters);gA._semantics=gK.createSemantics([gK.SEMANTIC_POSITION,gK.SEMANTIC_COLOR]);gA._indexBufferParameters={numIndices:gF,format:gK.INDEXFORMAT_USHORT,"transient":true};gA._indexBuffer=gK.createIndexBuffer(gA._indexBufferParameters);gA._vertexData=new bZ.prototype.floatArray(60);gA._indexData=new bZ.prototype.uint16Array(60);gA._numVertices=0;gA._numLines=0;return gA};gq.version=1;return gq})();fm.prototype._draw=function ce(gI){var gH=(this.sleeping?gI.constraintSleepingColorA:gI.constraintColorA);var gG=(this.sleeping?gI.constraintSleepingColorB:gI.constraintColorB);var gF=(this.sleeping?gI.constraintSleepingColorC:gI.constraintColorC);var gE=(this.sleeping?gI.constraintSleepingColorD:gI.constraintColorD);
var gy=(this.sleeping?gI.constraintErrorSleepingColorA:gI.constraintErrorColorA);var gx=(this.sleeping?gI.constraintErrorSleepingColorB:gI.constraintErrorColorB);var gw=(this.sleeping?gI.constraintErrorSleepingColorC:gI.constraintErrorColorC);var gv=(this.sleeping?gI.constraintErrorSleepingColorD:gI.constraintErrorColorD);var gT=this._data;var gC=this.bodyA._data;var gB=this.bodyB._data;var gA=this.bodyC._data;var gz=this.bodyD._data;var gP=(gC[(2)]+gT[(19)]);var gu=(gC[(2)+1]+gT[(19)+1]);var gO=(gB[(2)]+gT[(21)]);var gt=(gB[(2)+1]+gT[(21)+1]);var gN=(gA[(2)]+gT[(23)]);var gs=(gA[(2)+1]+gT[(23)+1]);var gM=(gz[(2)]+gT[(25)]);var gr=(gz[(2)+1]+gT[(25)+1]);var gS=(gO-gP);var gQ=(gt-gu);var gL=(gM-gN);var gK=(gr-gs);var gq=Math.sqrt((gS*gS)+(gQ*gQ));var gJ=Math.sqrt((gL*gL)+(gK*gK));var gD=gT[(7)];this._drawLink(gI,gP,gu,gO,gt,gS,gQ,gq,(gJ*gD),1,gy,gx);this._drawLink(gI,gN,gs,gM,gr,gL,gK,gJ,gq,(1/gD),gw,gv);var gR=(gI.constraintAnchorRadius*gI.screenToPhysics2D);gI._drawAnchor(gP,gu,gR,gH);
gI._drawAnchor(gO,gt,gR,gG);gI._drawAnchor(gN,gs,gR,gF);gI._drawAnchor(gM,gr,gR,gE)};fm.prototype._drawLink=function a(gC,gH,gr,gG,gq,gK,gJ,gs,gw,gO,gv,gu){if(gs>l.NORMALIZE_EPSILON){var gz=(1/gs);gK*=gz;gJ*=gz;var gB=(0.5*(gH+gG));var gA=(0.5*(gr+gq));var gN=this._data;var gF=(gN[(5)]-gw)*gO;if(gF<0){gF=0}var gI=(gN[(6)]-gw)*gO;if(gI<0){gI=0}var gE=(gB-(gK*(gF*0.5)));var gR=(gA-(gJ*(gF*0.5)));var gD=(gB+(gK*(gF*0.5)));var gM=(gA+(gJ*(gF*0.5)));var gQ=(gB-(gK*(gI*0.5)));var gy=(gA-(gJ*(gI*0.5)));var gL=(gB+(gK*(gI*0.5)));var gx=(gA+(gJ*(gI*0.5)));gC.drawLine(gE,gR,gD,gM,gv);gC.drawLine(gQ,gy,gE,gR,gu);gC.drawLine(gL,gx,gD,gM,gu);if(!this._stiff){var gP=gC.constraintSpringNumCoils;var gt=(gC.constraintSpringRadius*gC.screenToPhysics2D);if(gs>gI){gC.drawLinearSpring(gQ,gy,gH,gr,gP,gt,gu);gC.drawLinearSpring(gL,gx,gG,gq,gP,gt,gu)}else{if(gs<gF){gC.drawLinearSpring(gE,gR,gH,gr,gP,gt,gv);gC.drawLinearSpring(gD,gM,gG,gq,gP,gt,gv)}}}}};fp.prototype._draw=function d5(gG){var gF=(this.sleeping?gG.constraintSleepingColorA:gG.constraintColorA);
var gC=(this.sleeping?gG.constraintSleepingColorB:gG.constraintColorB);var gw=(this.sleeping?gG.constraintErrorSleepingColorA:gG.constraintErrorColorA);var gv=(this.sleeping?gG.constraintErrorSleepingColorB:gG.constraintErrorColorB);var gt=(this.sleeping?gG.constraintErrorSleepingColorC:gG.constraintErrorColorC);var gR=this._data;var gy=this.bodyA._data;var gx=this.bodyB._data;var gO=(gy[(2)]+gR[(13)]);var gs=(gy[(2)+1]+gR[(13)+1]);var gN=(gx[(2)]+gR[(15)]);var gr=(gx[(2)+1]+gR[(15)+1]);var gA=gR[(17)];var gz=gR[(17)+1];var gL=gR[(5)];var gP=gR[(6)];if(gL===Number.NEGATIVE_INFINITY){gL=-100000000000000000000}if(gP===Number.POSITIVE_INFINITY){gP=100000000000000000000}var gJ=(gN-gO);var gH=(gr-gs);var gM=(gJ*gA)+(gH*gz);var gK=(gO+(gA*gL));var gq=(gs+(gz*gL));var gI=(gO+(gA*gP));var gT=(gs+(gz*gP));var gE;if(gM>gL){gE=Math.min(gM,gP);gG.drawLine(gK,gq,gO+(gA*gE),gs+(gz*gE),gw)}if(gM<gP){gE=Math.max(gM,gL);gG.drawLine(gI,gT,gO+(gA*gE),gs+(gz*gE),gv)}if(!this._stiff){var gD=(gM<gL?gK:(gM>gP?gI:(gO+(gA*gM))));
var gB=(gM<gL?gq:(gM>gP?gT:(gs+(gz*gM))));var gS=gG.constraintSpringNumCoils;var gu=(gG.constraintSpringRadius*gG.screenToPhysics2D);gG.drawLinearSpring(gD,gB,gN,gr,gS,gu,gt)}var gQ=(gG.constraintAnchorRadius*gG.screenToPhysics2D);gG._drawAnchor(gO,gs,gQ,gF);gG._drawAnchor(gN,gr,gQ,gC)};ed.prototype._draw=function bB(gF){var gE=(this.sleeping?gF.constraintSleepingColorA:gF.constraintColorA);var gD=(this.sleeping?gF.constraintSleepingColorB:gF.constraintColorB);var gv=(this.sleeping?gF.constraintErrorSleepingColorA:gF.constraintErrorColorA);var gu=(this.sleeping?gF.constraintErrorSleepingColorB:gF.constraintErrorColorB);var gS=this._data;var gy=this.bodyA._data;var gw=this.bodyB._data;var gK=(gy[(2)]+gS[(11)]);var gr=(gy[(2)+1]+gS[(11)+1]);var gJ=(gw[(2)]+gS[(13)]);var gq=(gw[(2)+1]+gS[(13)+1]);var gO=(gJ-gK);var gN=(gq-gr);var gM=((gO*gO)+(gN*gN));if(gM>l.NORMALIZE_SQ_EPSILON){var gs=Math.sqrt(gM);var gA=(1/gs);gO*=gA;gN*=gA;var gC=(0.5*(gK+gJ));var gB=(0.5*(gr+gq));var gI=gS[(5)];var gL=gS[(6)];
var gH=(gC-(gO*(gI*0.5)));var gV=(gB-(gN*(gI*0.5)));var gG=(gC+(gO*(gI*0.5)));var gR=(gB+(gN*(gI*0.5)));var gU=(gC-(gO*(gL*0.5)));var gz=(gB-(gN*(gL*0.5)));var gQ=(gC+(gO*(gL*0.5)));var gx=(gB+(gN*(gL*0.5)));gF.drawLine(gH,gV,gG,gR,gv);gF.drawLine(gU,gz,gH,gV,gu);gF.drawLine(gQ,gx,gG,gR,gu);if(!this._stiff){var gT=gF.constraintSpringNumCoils;var gt=(gF.constraintSpringRadius*gF.screenToPhysics2D);if(gs>gL){gF.drawLinearSpring(gU,gz,gK,gr,gT,gt,gu);gF.drawLinearSpring(gQ,gx,gJ,gq,gT,gt,gu)}else{if(gs<gI){gF.drawLinearSpring(gH,gV,gK,gr,gT,gt,gv);gF.drawLinearSpring(gG,gR,gJ,gq,gT,gt,gv)}}}}var gP=(gF.constraintAnchorRadius*gF.screenToPhysics2D);gF._drawAnchor(gK,gr,gP,gE);gF._drawAnchor(gJ,gq,gP,gD)};b2.prototype._draw=function cP(gq){var gy=(this.sleeping?gq.constraintSleepingColorA:gq.constraintColorA);var gx=(this.sleeping?gq.constraintSleepingColorB:gq.constraintColorB);var gs=(this.sleeping?gq.constraintErrorSleepingColorA:gq.constraintErrorColorA);var gr=(this.sleeping?gq.constraintErrorSleepingColorB:gq.constraintErrorColorB);
var gt=this._data;var gw=this.bodyA._data;var gv=this.bodyB._data;var gu=gt[(7)];this._drawForBody(gq,gw,gv,gu,-1,gs,gr,gy);this._drawForBody(gq,gv,gw,(1/gu),(1/gu),gs,gr,gx)};b2.prototype._drawForBody=function bD(gB,gt,gs,gq,gH,gA,gz,gr){var gK=this._data;var gG=gK[(5)];var gI=gK[(6)];var gE=(gs[(2)+2]*gq)+(gG*gH);var gF=(gs[(2)+2]*gq)+(gI*gH);if(gE>gF){var gJ=gE;gE=gF;gF=gJ}var gw=(gB.constraintSpiralMinRadius*gB.screenToPhysics2D);var gu=(gB.constraintSpiralDeltaRadius*gB.screenToPhysics2D);var gD=(gB.constraintAnchorRadius*gB.screenToPhysics2D);var gL=gB.constraintSpiralNumCoils;var gy=gt[(2)];var gx=gt[(2)+1];var gv=gt[(2)+2];var gC;if(gv>gE){gC=Math.min(gv,gF);gB.drawSpiral(gy,gx,gE,gC,gw,gw+((gC-gE)*gu),gA)}else{if(!this._stiff&&gv<gE){gB.drawSpiralSpring(gy,gx,gv,gE,gw+((gv-gE)*gu),gw,gL,gA)}}if(gv<gF){gC=Math.max(gv,gE);gB.drawSpiral(gy,gx,gC,gF,gw+((gC-gE)*gu),gw+((gF-gE)*gu),gz)}else{if(!this._stiff&&gv>gF){gB.drawSpiralSpring(gy,gx,gv,gF,gw+((gv-gE)*gu),gw+((gF-gE)*gu),gL,gz)
}}gB._drawAngleIndicator(gy,gx,gv,gw+((gv-gE)*gu),gD,gr)};dv.prototype._draw=function dM(gC){var gB=(this.sleeping?gC.constraintSleepingColorA:gC.constraintColorA);var gA=(this.sleeping?gC.constraintSleepingColorB:gC.constraintColorB);var gz=(this.sleeping?gC.constraintErrorSleepingColorC:gC.constraintErrorColorC);var gJ=this._data;var gw=this.bodyA._data;var gv=this.bodyB._data;var gG=(gw[(2)]+gJ[(9)]);var gr=(gw[(2)+1]+gJ[(9)+1]);var gF=(gv[(2)]+gJ[(11)]);var gq=(gv[(2)+1]+gJ[(11)+1]);var gH=(gC.constraintAnchorRadius*gC.screenToPhysics2D);gC._drawAnchor(gG,gr,gH,gB);gC._drawAnchor(gF,gq,gH,gA);if(this._stiff){gC.drawLine(gG,gr,gF,gq,gz)}else{var gK=gC.constraintSpringNumCoils;var gt=(gC.constraintSpringRadius*gC.screenToPhysics2D);gC.drawLinearSpring(gG,gr,gF,gq,gK,gt,gz);var gy=(gC.constraintSpiralMinRadius*gC.screenToPhysics2D);var gx=(gC.constraintSpiralDeltaRadius*gC.screenToPhysics2D);var gD=(gC.constraintAnchorRadius*gC.screenToPhysics2D);gK=gC.constraintSpiralNumCoils;var gI,gE;
gE=gw[(2)+2];gI=(gv[(2)+2]-gJ[(13)]);var gu=(this.sleeping?gC.constraintErrorSleepingColorA:gC.constraintErrorColorA);var gs=(this.sleeping?gC.constraintErrorSleepingColorB:gC.constraintErrorColorB);gC.drawSpiralSpring(gw[(2)],gw[(2)+1],gE,gI,gy,gy+((gI-gE)*gx),gK,gs);gC._drawAngleIndicator(gw[(2)],gw[(2)+1],gE,gy,gD,gu);gE=gv[(2)+2];gI=(gJ[(13)]+gw[(2)+2]);gC.drawSpiralSpring(gv[(2)],gv[(2)+1],gE,gI,gy,gy+((gI-gE)*gx),gK,gu);gC._drawAngleIndicator(gv[(2)],gv[(2)+1],gE,gy,gD,gs)}};aq.prototype._draw=function D(gr){var gD=(this.sleeping?gr.constraintSleepingColorA:gr.constraintColorA);var gC=(this.sleeping?gr.constraintSleepingColorB:gr.constraintColorB);var gy=(this.sleeping?gr.constraintErrorSleepingColorC:gr.constraintErrorColorC);var gt=this._data;var gB=this.bodyA._data;var gz=this.bodyB._data;var gs=(gB[(2)]+gt[(9)]);var gA=(gB[(2)+1]+gt[(9)+1]);var gq=(gz[(2)]+gt[(11)]);var gx=(gz[(2)+1]+gt[(11)+1]);var gv=(gr.constraintAnchorRadius*gr.screenToPhysics2D);gr._drawAnchor(gs,gA,gv,gD);
gr._drawAnchor(gq,gx,gv,gC);if(this._stiff){gr.drawLine(gs,gA,gq,gx,gy)}else{var gw=gr.constraintSpringNumCoils;var gu=(gr.constraintSpringRadius*gr.screenToPhysics2D);gr.drawLinearSpring(gs,gA,gq,gx,gw,gu,gy)}};var gj=function(gr){var gt=this;gr=gr||{};if(!gr.game||!gr.game.graphics){throw"Invalid config supplied. Game and graphics are required"}this.game=gr.game;this.init=function(){gt.setupAssetsLists()};this.setupAssetsLists=function(){gt.textures=gt.getTexturesList()||[];gt.shaders=gt.getShadersList()||[];this.pendingAssets=this.textures.length+this.shaders.length};this.load=function(){var gw;for(var gx=0,gv=gt.textures.length;gx<gv;gx++){gw={src:gt.textures[gx],mipmaps:true,onload:gu};gt.game.graphics.graphicsDevice.createTexture(gw)}gx=0;gv=gt.shaders.length;for(;gx<gv;gx++){TurbulenzEngine.request(gt.shaders[gx],gs)}gt.intervalId=TurbulenzEngine.setInterval(gq,1000/10)};this.onFinishLoad=function(){gt.game.onAssetLoaded()};function gq(){if(gt.pendingAssets===0){TurbulenzEngine.clearInterval(gt.intervalId);
gt.onFinishLoad()}}function gu(gv){gt.textures[this.src]=gv;gt.pendingAssets-=1}function gs(gv){if(gv){var gw=JSON.parse(gv);gt.shaders[gw.name]=gt.game.graphics.graphicsDevice.createShader(gw);gt.pendingAssets-=1}}this.destroyFn=function(){TurbulenzEngine.clearInterval(gt.intervalId);gt.textures=null;gt.shaders=null;TurbulenzEngine.flush()};this.getTexturesList=function(){return["assets/textures/crate.jpg","assets/textures/stones.jpg","assets/textures/brick.png","assets/textures/physics2d.png"]};this.getShadersList=function(){return["assets/shaders/generic2D.cgfx.json"]}};var cr=function(){var gr=this;this.mathDevice=TurbulenzEngine.createMathDevice({});this.graphicsDevice=TurbulenzEngine.createGraphicsDevice({});this.previousFrameTime=TurbulenzEngine.time;this.clearColor=[0,0,0,1];this.update=function gq(){var gt=TurbulenzEngine.time;var gs=(gt-gr.previousFrameTime);if(gs>0.1){gs=0.1}if(gr.graphicsDevice.beginFrame()){gr.graphicsDevice.endFrame()}gr.previousFrameTime=gt}};var bH=function(gs){var gu=this;
gs=gs||{};if(!gs.game){throw"Invalid config supplied. Game is required"}this.game=gs.game;this.htmlControls={};this.debugEnabled=true;this.contactsEnabled=false;this.textureSrc="assets/textures/physics2d.png";this.textureRectangles=[[5,132,125,252]];this.mathDevice=TurbulenzEngine.createMathDevice({});this.phys2D=bZ.create({});this.stageWidth=2;this.stageHeight=4;this.draw2D=d9.create({graphicsDevice:this.game.graphics.graphicsDevice});this.debug=k.create({graphicsDevice:this.game.graphics.graphicsDevice});this.draw2D.configure({viewportRectangle:[0,0,this.stageWidth,this.stageHeight],scaleMode:"scale"});this.debug.setPhysics2DViewport([0,0,this.stageWidth,this.stageHeight]);var gv=this.phys2D.createWorld({gravity:[0,10]});var gt=this.phys2D.createMaterial({density:0.5,elasticity:3,staticFriction:1});gu.shapeSize=0.6;var gq=[this.phys2D.createPolygonShape({vertices:this.phys2D.createBoxVertices(gu.shapeSize,gu.shapeSize),material:gt})];this.reset=function(){gv.clear();var gE=0.1;var gC=gu.phys2D.createRigidBody({type:"static",restitution:0,shapes:[gu.phys2D.createPolygonShape({vertices:gu.phys2D.createRectangleVertices(0.01,0.01,gE,gu.stageHeight)}),gu.phys2D.createPolygonShape({vertices:gu.phys2D.createRectangleVertices((gu.stageWidth-gE),0,gu.stageWidth,gu.stageHeight)}),gu.phys2D.createPolygonShape({vertices:gu.phys2D.createRectangleVertices(0.01,(gu.stageHeight-gE),gu.stageWidth,gu.stageHeight)})]});
gv.addRigidBody(gC);gu.animationState=0;var gz,gF;var gD=Math.floor(gu.stageWidth/gu.shapeSize);for(gz=0;gz<2;gz+=1){for(gF=0;gF<1;gF+=1){var gB=(gF%gq.length);var gA=gq[gB];var gy=gu.phys2D.createRigidBody({shapes:[gA.clone()],position:[gu.stageWidth/2,(gF+0.5)*gu.shapeSize],rotation:Math.PI/3,userData:bb.create({width:gu.shapeSize,height:gu.shapeSize,origin:[gu.shapeSize/2,gu.shapeSize/2],textureRectangle:gu.textureRectangles[gB],texture:gu.game.assetLoader.textures[gu.textureSrc]})});gv.addRigidBody(gy)}}};var gw=0;var gr=TurbulenzEngine.time;this.update=function(){if(!gu.game.graphics.graphicsDevice.beginFrame()){return}var gy;var gD=TurbulenzEngine.time;var gE=(gD-gr);if(gE>(1/20)){gE=(1/20)}gw+=gE;gr=gD;while(gv.simulatedTime<gw){if(gu.animationState===0){gu.animationState=1}else{if(gu.animationState===1){}else{if(gu.animationState===2){}else{if(gu.animationState===3){}}}}gv.step(1/60)}var gA=gv.rigidBodies;var gz=gA.length;var gC;if(!gu.debugEnabled){gu.draw2D.begin("alpha","deferred");
var gF=[];for(gC=0;gC<gz;gC+=1){gy=gA[gC];if(gy.userData){gy.getPosition(gF);var gB=gy.userData;gB.x=gF[0];gB.y=gF[1];gB.rotation=gy.getRotation();gu.draw2D.drawSprite(gB)}}gu.draw2D.end()}gu.debug.setScreenViewport(gu.draw2D.getScreenSpaceViewport());gu.debug.showRigidBodies=gu.debugEnabled;gu.debug.showContacts=gu.contactsEnabled;gu.debug.begin();if(!gu.debugEnabled){for(gC=0;gC<gz;gC+=1){gy=gA[gC];if(!gy.userData){gu.debug.drawRigidBody(gy)}}}gu.debug.drawWorld(gv);gu.debug.end();gu.game.graphics.graphicsDevice.endFrame()};function gx(){gu.reset()}};var aC=TurbulenzEngine;function be(){var gq=this;this.fps=60;aC.onload=gr;function gr(){gq.setupComponents()}function gs(){gq.fpsStats.begin();gq.physics.update();gq.graphics.update();gq.fpsStats.end()}this.onAssetLoaded=function(){gq.physics.reset();gq.intervalId=TurbulenzEngine.setInterval(gs,1000/gq.FPS)};this.setupComponents=function(){gq.fpsStats=new c.Main();gq.fpsStats.domElement.style.position="absolute";gq.fpsStats.domElement.style.left="0px";
gq.fpsStats.domElement.style.top="0px";document.body.appendChild(this.fpsStats.domElement);gq.componentsInitPending=2;gq.graphics=new cr({game:gq});gq.physics=new bH({game:gq});gq.assetLoader=new gj({game:gq});gq.assetLoader.init();gq.assetLoader.load()}}"use_strict";var bP=new be();window.TurbulenzEngine=TurbulenzEngine}());